--[[
    Core Milestones Catalog
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    MASSIVELY EXPANDED FOR AAA BITLIFE QUALITY
    
    Features:
    - 15+ life-defining milestone events (was 4!)
    - First day of school, learning to drive, graduation, moving out
    - First job, marriage, buying a home, having kids
    - Midlife crisis, retirement, legacy decisions
    - Specific details: emotions, locations, real consequences
    - Multiple meaningful choices (4+ options per event)
    
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

local events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CHILDHOOD MILESTONES (Ages 5-12)
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	{
		id = "childhood_playdate",
		emoji = "ğŸ§¸",
		title = "Neighborhood Playdate",
		text = "Kids on your street are having a massive game of freeze tag, hide and seek, and making mud pies in someone's backyard. Tommy from across the street runs up to you: 'Wanna play?!' Your mom says it's okay if you want to go. But you also just got a new video game and it's calling your name from your bedroom.",
		question = "What do you choose?",
		category = "milestone",
		weight = 8,
		minAge = 5,
		maxAge = 10,
		choices = {
			{
				index = 1,
				text = "Join the neighborhood kids - make friends!",
				effects = { Happiness = 5, Health = 3, Looks = -1 },
				setFlags = { has_childhood_friends = true, social_childhood = true, outdoorsy = true },
				feedText = "You played outside until the streetlights came on. Grass-stained knees. Scraped elbow. HUGE smile. Best childhood day ever!",
			},
			{
				index = 2,
				text = "Invite them ALL to play video games inside",
				effects = { Happiness = 6, Smarts = 2 },
				setFlags = { has_childhood_friends = true, gamer_kid = true },
				feedText = "You turned your living room into a gaming tournament! 8 kids, 2 controllers, TONS of snacks. Your mom regretted saying yes. You had a BLAST!",
			},
			{
				index = 3,
				text = "Stay home and play video games alone",
				effects = { Happiness = 3, Smarts = 2, Health = -2 },
				setFlags = { introverted_childhood = true, loner_tendencies = true },
				feedText = "You stayed inside. Beat 3 levels. Unlocked achievements. But when you looked out the window and saw everyone laughing together... you felt a little lonely.",
			},
			{
				index = 4,
				text = "Read a book instead - peace and quiet",
				effects = { Smarts = 5, Happiness = 2 },
				setFlags = { bookworm = true, intellectual_child = true },
				feedText = "You grabbed your favorite book and read under a tree in your backyard. Adventure in your imagination. No scraped knees required. Perfect.",
			},
		},
	},

	{
		id = "first_day_kindergarten",
		emoji = "ğŸ’",
		title = "First Day of School Ever",
		text = "Your mom is walking you to the kindergarten classroom. You're clutching her hand SO TIGHT. There are 20 other kids. Some are crying. One kid is already finger-painting. The teacher has a huge smile and says 'Welcome!' Your mom kisses your forehead: 'You'll be okay, sweetie.' She turns to leave. Your HEART DROPS. You're on your own now.",
		question = "How do you handle this scary moment?",
		category = "milestone",
		weight = 10,
		minAge = 5,
		maxAge = 6,
		oneTime = true,
		choices = {
			{
				index = 1,
				text = "Cry and run after your mom",
				effects = { Happiness = -5, Health = -1 },
				setFlags = { clingy_child = true, separation_anxiety = true },
				feedText = "You SOBBED. The teacher had to gently hold you back. Your mom looked back with tears in HER eyes. Eventually you calmed down. Rough start.",
			},
			{
				index = 2,
				text = "Wave goodbye and march in bravely",
				effects = { Happiness = 5, Smarts = 3 },
				setFlags = { brave_child = true, independent_early = true },
				feedText = "You waved goodbye! 'I'll be okay, Mom!' You walked straight to the toy bin. Made 2 friends before snack time. You THRIVED!",
			},
			{
				index = 3,
				text = "Cling to the teacher nervously",
				effects = { Happiness = -2, Smarts = 1 },
				setFlags = { shy_child = true },
				feedText = "You held the teacher's hand the whole morning. She was patient and kind. By lunch, you felt a little braver. Baby steps.",
			},
			{
				index = 4,
				text = "Immediately go play with blocks - ignore everything",
				effects = { Happiness = 4, Smarts = 2 },
				setFlags = { focused_child = true, independent = true },
				feedText = "You walked straight to the block corner. Built a tower. Didn't even notice your mom leave. You were IN THE ZONE. School is cool!",
			},
		},
	},

	{
		id = "learning_to_ride_bike",
		emoji = "ğŸš´",
		title = "Learning to Ride a Bike",
		-- CRITICAL FIX: Added text variations - User complained "bike riding spamming same text"
		textVariants = {
			"Your dad got you a bike with training wheels for your birthday. But you're {{AGE}} now. All your friends ride without training wheels. You NEED to learn. {{FATHER_NAME}} says he'll teach you this weekend. But learning means falling. Scraping your knees. Maybe crying. Are you ready?",
			"It's a sunny Saturday morning. Your shiny new bike sits in the driveway, training wheels gleaming mockingly. You watch the neighbor kids zoom past on two wheels. 'Today's the day,' {{FATHER_NAME}} says with a grin. Your palms are sweating already.",
			"The bike from your birthday has been sitting in the garage for weeks. You've been avoiding it. But your friends keep asking if you can ride yet. The training wheels make you look like a baby. It's time to face your fears. Maybe.",
			"Your older cousin came to visit and laughed when they saw your training wheels. 'You still have those?!' Your face burned with embarrassment. Now you're determined. These wheels are coming OFF. Today.",
			"You watched a YouTube video of a kid half your age doing bike tricks. Meanwhile, your training wheels squeak every time you turn. Enough is enough. You drag the bike outside. It's now or never.",
			"Mom and Dad have been arguing about when to take off the training wheels. Dad says you're ready, Mom's worried you'll get hurt. You interrupt: 'I want to try.' Their surprised faces almost make you back down. Almost.",
			"Your best friend just got a cool BMX bike for their birthday. They want to go riding together but you still have training wheels. The shame is unbearable. Time to learn for real.",
			"The neighborhood bike gang rides past your house every afternoon. You watch from the window, jealous. Today, you march outside and yell: 'I'M LEARNING TODAY!' They circle back, impressed by your courage. Now you have an audience. No pressure.",
		},
		text = "Your dad got you a bike with training wheels for your birthday. But you're {{AGE}} now. All your friends ride without training wheels. You NEED to learn. {{FATHER_NAME}} says he'll teach you this weekend. But learning means falling. Scraping your knees. Maybe crying. Are you ready?",
		question = "How hard do you push yourself?",
		category = "milestone",
		weight = 7,
		minAge = 7,
		maxAge = 10,
		oneTime = true,
	choices = {
		{
			index = 1,
			text = "Take the training wheels off - full send!",
			effects = { Happiness = 8, Health = -3, Looks = -2 },
			setFlags = { bike_rider = true, brave = true, scarred_knees = true },
			feedText = "Going for it...",
			onResolve = function(state)
				local outcomes = {
					"ğŸš´ You fell THREE TIMES. Scraped your knees. But on try #4? YOU DID IT! Pure freedom!",
					"ğŸš´ FIVE CRASHES later, you finally got it! Blood, tears, but VICTORY! You rode a whole block!",
					"ğŸš´ You wobbled, nearly fell, but stayed up! First try success! Natural talent!",
					"ğŸš´ Crashed hard on try one. Got back up. Crashed again. But try #6? NAILED IT! Champion!",
					"ğŸš´ The neighbor kids cheered you on! You fell twice but the crowd gave you courage! YOU DID IT!",
					"ğŸš´ Dad ran beside you for the first 10 feet, then let go. You didn't even notice! YOU WERE RIDING!",
				}
				state:AddFeed(outcomes[math.random(#outcomes)])
			end,
		},
		{
			index = 2,
			text = "Practice with training wheels first - be smart",
			effects = { Happiness = 4, Smarts = 3 },
			setFlags = { cautious = true, practical = true },
			feedText = "Smart approach...",
			onResolve = function(state)
				local outcomes = {
					"ğŸš´ Two weeks of practice paid off! When the wheels came off? ONE TRY. Genius!",
					"ğŸš´ You practiced balance for a week. Then? Easy peasy! No scraped knees for you!",
					"ğŸš´ The preparation method worked! Your friends called you 'the planner' but you're also RIDING!",
				}
				state:AddFeed(outcomes[math.random(#outcomes)])
			end,
		},
		{
			index = 3,
			text = "Too scary - keep the training wheels on",
			effects = { Happiness = -3, Health = 2 },
			setFlags = { risk_averse = true, scared_of_failure = true },
			feedText = "Not ready yet...",
			onResolve = function(state)
				local outcomes = {
					"ğŸš´ You kept the training wheels. Your friends zoomed past. You felt small... but safe.",
					"ğŸš´ 'Maybe next year,' you told dad. He looked disappointed. You felt guilty. But uninjured!",
					"ğŸš´ Training wheels stayed on. Some kids laughed. But you avoided the hospital! Smart or scared?",
				}
				state:AddFeed(outcomes[math.random(#outcomes)])
			end,
		},
		{
			index = 4,
			text = "Ask your older sibling/friend to teach you instead",
			effects = { Happiness = 6, Health = -1 },
			setFlags = { bike_rider = true, learns_from_peers = true },
			feedText = "Peer teaching...",
			onResolve = function(state)
				local outcomes = {
					"ğŸš´ Your older cousin was patient! Learned in an afternoon! No parental pressure!",
					"ğŸš´ Your friend's older brother taught you. Way less stressful! You're riding!",
					"ğŸš´ Peer teaching worked! Your neighbor showed you their secret technique. NAILED IT!",
				}
				state:AddFeed(outcomes[math.random(#outcomes)])
			end,
		},
	},
},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- TEEN MILESTONES (Ages 13-17)
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	{
		-- CRITICAL FIX: Renamed from "teen_social_media" to avoid duplicate ID with EarlyLifeEvents
		id = "milestone_first_social_media",
		emoji = "ğŸ“±",
		title = "First Social Media Account",
		text = "Everyone at school has Instagram, TikTok, or Snapchat. You're the ONLY ONE without it. FOMO is real. Your friends share memes you don't see. Make plans in group chats you're not in. Your parents are hesitant: 'You're only 13...' But you feel LEFT OUT. Create an account in secret? Ask permission? Or stay offline?",
		question = "What's your social media move?",
		category = "milestone",
		weight = 6,
		minAge = 12,
		maxAge = 15,
		oneTime = true,
		choices = {
			{
				index = 1,
				text = "Create accounts NOW - everyone's on it!",
				effects = { Happiness = 8, Smarts = -2, Health = -1 },
				setFlags = { social_online = true, screen_addicted = true, fomo_controlled = true },
				feedText = "You downloaded EVERYTHING. Instagram, TikTok, Snap. You spent 4 hours scrolling. You're in the loop! But you forgot to do your homework. Worth it?",
			},
			{
				index = 2,
				text = "Ask parents first - respect their rules",
				effects = { Happiness = 4, Smarts = 3 },
				setFlags = { rule_follower = true, respectful_kid = true },
				feedText = "Your parents said yes but with screen time limits. You agreed. You're on social media BUT with boundaries. Responsible choice!",
			},
			{
				index = 3,
				text = "Stay off social media - it's toxic anyway",
				effects = { Happiness = -3, Smarts = 4, Health = 3 },
				setFlags = { social_media_free = true, contrarian = true, mentally_healthy = true },
				feedText = "You stayed offline. Your friends thought you were weird. But you read books, played outside, and had ZERO anxiety about likes. Different path.",
			},
			{
				index = 4,
				text = "Create a SECRET account - hide it from parents",
				effects = { Happiness = 5, Smarts = -1 },
				setFlags = { social_online = true, sneaky = true, rebel = true },
				feedText = "You made a secret account. Fake name. Private settings. Your parents never found out. You felt sneaky and free. Risky but fun!",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX: Driver's Ed with TEXT VARIATIONS!
	-- User complaint: "THE DRIVERS ED IS ALLWAYS THE SAME EXACT TEXT BRUH"
	-- Added 6 different text variations for variety across playthroughs
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "learning_to_drive",
		emoji = "ğŸš—",
		title = "Driver's Ed & First Time Behind the Wheel",
		-- CRITICAL FIX: textVariants array for random variation each playthrough!
		textVariants = {
			"It's time to learn to drive. Your driving instructor has SEEN THINGS. You're in the parking lot. Your hands are SWEATING on the steering wheel. She says, 'Put it in Drive and ease onto the gas.' Your foot is shaking. This is REAL. Deep breath. Here we go.",
			"Your first driving lesson begins! The instructor, Mr. Rodriguez, has been teaching for 30 years and has clearly lost hope in humanity. 'Okay, mirrors first. MIRRORS.' You adjust them wrong three times. The car hasn't even moved yet and you're already sweating.",
			"Driver's Ed day has arrived! Your instructor, Ms. Park, greets you with a tired smile. She's clutching a travel mug like it's a lifeline. 'Alright, let's start with the basics.' She points at the dashboard. You have no idea what any of those symbols mean.",
			"You're finally behind the wheel! The instructor, Mr. Thompson, double-checks his seatbelt. Then triple-checks it. 'The brake is on the left. PLEASE remember that.' He looks like he's praying. This is going to be interesting.",
			"First time driving! Your instructor, Mrs. Chen, seems calm but her foot is hovering over her brake pedal. 'Nice and easy. Think of the gas pedal like a soft egg.' You're pretty sure you're about to scramble that egg.",
			"The moment has come - learning to drive! Your instructor grips the oh-no handle immediately. 'Before we start, I want you to know - the car will stop if you take your foot off the gas.' They say this like it's ground-breaking news. It probably is.",
			"Today's the day - Driver's Ed! Your instructor looks at you and sighs deeply. 'I've been doing this for 20 years. I've seen things you wouldn't believe. Just... don't hit anything.' Inspirational.",
			"Learning to drive! Your instructor asks if you've played any racing video games. 'Forget everything you learned from those,' they say firmly. 'Real driving is about NOT hitting things.'",
		},
		-- Fallback text
		text = "It's time to learn to drive. Your driving instructor has SEEN THINGS. Your hands are sweating on the steering wheel. Deep breath. Here we go.",
		question = "What kind of driver are you?",
		category = "milestone",
		weight = 9,
		minAge = 15,
		maxAge = 17,
		oneTime = true,
		-- CRITICAL FIX: Block if already learned to drive from ANY driving event!
		blockedByFlags = { 
			has_license = true, drivers_license = true, driver_license = true,
			has_drivers_license = true, learned_driving = true, good_driver = true,
			driving_done = true, in_prison = true
		},
		choices = {
			{
				index = 1,
				text = "Cautious driver - safety first always",
				effects = { Happiness = 4, Smarts = 5, Health = 4 },
				-- CRITICAL FIX: Set ALL license flags so vehicle purchase works!
				setFlags = { driver_license = true, has_license = true, drivers_license = true, safe_driver = true, follows_speed_limits = true },
				feedText = "You drove 5mph under the speed limit. Stopped fully at every stop sign. Mrs. Chen said, 'You'll pass easily.' You got your license on the first try!",
			},
			{
				index = 2,
				text = "Confident driver - I got this!",
				effects = { Happiness = 7, Smarts = 3, Health = 2 },
				-- CRITICAL FIX: Set ALL license flags so vehicle purchase works!
				setFlags = { driver_license = true, has_license = true, drivers_license = true, confident_driver = true },
				feedText = "You took to driving like a natural! Changed lanes smoothly. Parallel parked on the 2nd try. Mrs. Chen was impressed! License acquired!",
			},
			{
				index = 3,
				text = "Nervous wreck - this is terrifying",
				effects = { Happiness = -3, Health = -2 },
				setFlags = { driving_anxiety = true, failed_first_test = true },
				feedText = "You hit the curb twice. Forgot to signal. Cried a little. Mrs. Chen said, 'It's okay, we'll keep practicing.' You didn't pass. Yet.",
			},
			{
				index = 4,
				text = "Reckless driver - speed demon mode",
				effects = { Happiness = 9, Health = -4, Smarts = -2 },
				-- CRITICAL FIX: Set ALL license flags so vehicle purchase works!
				setFlags = { driver_license = true, has_license = true, drivers_license = true, reckless_driver = true, speeding_tickets_incoming = true },
				feedText = "You went 50 in a 35 zone. Mrs. Chen SCREAMED. 'SLOW DOWN!' You laughed. You barely passed. Your parents are terrified. Yikes.",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX: High School Graduation with TEXT VARIATIONS!
	-- User complaint: "HIGH SCHOOL GRADUATION IS ALLWAYS SAME NO VARIATIONS"
	-- Added multiple text variations based on different experiences
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "high_school_graduation",
		emoji = "ğŸ“",
		title = "High School Graduation Day",
		textVariants = {
			"You're sitting in an auditorium wearing a cap and gown. You've been here since 8am. It's been 3 HOURS of speeches and names. Finally: 'And now, graduating... [YOUR NAME]!' You walk across the stage. Your family is SCREAMING your name. Your mom is crying. Your dad is filming vertically (tragic). You grab your diploma. High school is OVER. What now?",
			"Graduation day has arrived! The gymnasium is packed with families. Someone's baby won't stop crying. The valedictorian's speech is putting everyone to sleep. But then YOUR name is called and suddenly none of that matters. You did it. You actually did it. Four years of drama, tests, and cafeteria food - all for this moment.",
			"The ceremony seemed endless, but now you're walking across that stage! Your friends are cheering. Your parents are an emotional mess in the audience. The principal hands you your diploma with a firm handshake. You flip your tassel. This chapter of your life is officially closed.",
			"High school graduation! You almost can't believe you made it. Through all the late-night cramming, the friend drama, the awkward phases - here you are. A graduate. Your family takes approximately 500 photos. Your face hurts from smiling. Worth it.",
			"The caps are flying! Four years of your life, distilled into one ceremony. One handshake. One diploma. Your classmates are crying and hugging. Some you'll never see again. Others will be your friends for life. But right now, in this moment, you're all just graduates.",
			"You walk across that stage and grab your diploma. In your head, you're replaying the last four years like a movie montage. The good times. The bad times. The WEIRD times. And now? A whole new adventure awaits. Your whole life is ahead of you.",
			"Graduation! The principal calls your name - they somehow STILL mispronounce it. Classic. But you don't care. You're done! DONE! No more early mornings. No more boring assemblies. Well, until college at least. But that's future you's problem.",
			"The ceremony is over and reality hits - you're actually graduating. No more high school hallways. No more locker combinations. No more weird lunch schedules. You're holding your diploma and your whole family is ugly-crying with pride. Even your dad.",
		},
		text = "You're sitting in an auditorium wearing a cap and gown. Finally: your name is called! You walk across the stage. Your family is cheering. You grab your diploma. High school is OVER. What now?",
		question = "What's your next chapter?",
		category = "milestone",
		weight = 10,
		minAge = 17,
		maxAge = 19,
		oneTime = true,
		-- CRITICAL FIX: Set graduation flags on any choice
		onComplete = function(state, choice, eventDef, outcome)
			state.Education = state.Education or "high_school"
			state.Flags = state.Flags or {}
			state.Flags.graduated_high_school = true
			state.Flags.high_school_graduate = true
			state.Flags.has_diploma = true
			state.Flags.has_ged_or_diploma = true
		end,
		choices = {
			{
				index = 1,
				text = "University (pay tuition if you can)",
				effects = { Happiness = 7, Smarts = 5 },
				setFlags = { plans_for_college = true, higher_education_path = true, in_college = true },
				feedText = "Enrolled in college!",
				onResolve = function(state)
					local money = state.Money or 0
					state.Flags = state.Flags or {}
					local loanNeeded = 0
					local tuitionPaid = 0
					local collegeName = "State University"
					
					if money >= 5000 then
						tuitionPaid = 5000
						state.Money = money - tuitionPaid
						if state.AddFeed then state:AddFeed("ğŸ“ Paid $5,000 tuition! Starting university!") end
					elseif money >= 1000 then
						tuitionPaid = money
						state.Money = 0
						loanNeeded = 5000 - tuitionPaid
						state.Flags.financial_aid = true
						state.Flags.student_loans = true
						if state.AddFeed then state:AddFeed(string.format("ğŸ“ Paid $%d and took $%d in loans for university!", tuitionPaid, loanNeeded)) end
					else
						loanNeeded = 5000
						state.Flags.work_study = true
						state.Flags.student_loans = true
						if state.AddFeed then state:AddFeed("ğŸ“ Full financial aid! Student loans cover tuition.") end
					end
					
					state.EducationData = state.EducationData or {}
					state.EducationData.Status = "enrolled"
					state.EducationData.Level = "bachelor"
					state.EducationData.Progress = 0
					state.EducationData.Duration = 4
					state.EducationData.Institution = collegeName
					state.EducationData.Debt = (state.EducationData.Debt or 0) + loanNeeded
					state.EducationData.LoanAmount = loanNeeded
					state.EducationData.enrolledAge = state.Age
					
					state.Flags.in_college = true
					state.Flags.college_student = true
					state.Flags.enrolled_college = true
					state.Flags.college_bound = true
					state.Education = state.Education or "high_school"

					state.PendingFeed = string.format("ğŸ“ You're going to %s! New chapter begins!", collegeName)
				end,
			},
			{
				index = 2,
				text = "Trade school (pay what you can)",
				effects = { Happiness = 6, Smarts = 4 },
				setFlags = { trade_school = true, practical_path = true, in_trade_school = true },
				feedText = "Enrolled in trade school!",
				onResolve = function(state)
					local money = state.Money or 0
					state.Flags = state.Flags or {}
					local loanNeeded = 0
					local tuitionPaid = 0
					local schoolName = "Technical Institute"
					
					if money >= 2000 then
						tuitionPaid = 2000
						state.Money = money - tuitionPaid
						if state.AddFeed then state:AddFeed("ğŸ”§ Paid $2,000 tuition! Starting trade school!") end
					elseif money >= 500 then
						tuitionPaid = money
						state.Money = 0
						loanNeeded = 2000 - tuitionPaid
						state.Flags.financial_aid = true
						if state.AddFeed then state:AddFeed(string.format("ğŸ”§ Paid $%d and took $%d in loans for trade school!", tuitionPaid, loanNeeded)) end
					else
						state.Flags.apprentice = true
						schoolName = "Apprenticeship Program"
						if state.AddFeed then state:AddFeed("ğŸ”§ Starting apprenticeship program! Learn while you earn!") end
					end
					
					state.EducationData = state.EducationData or {}
					state.EducationData.Status = "enrolled"
					state.EducationData.Level = "trade"
					state.EducationData.Progress = 0
					state.EducationData.Duration = 2
					state.EducationData.Institution = schoolName
					state.EducationData.Debt = (state.EducationData.Debt or 0) + loanNeeded
					state.EducationData.enrolledAge = state.Age
					
					state.Flags.trade_school_student = true
					state.Flags.in_trade_school = true
					state.Flags.trade_school_bound = true
					state.Education = state.Education or "high_school"
				end,
			},
		{
			index = 3,
			text = "Get a job - start earning immediately",
			effects = { Happiness = 5 },
			setFlags = { working_class = true, hustler = true },
			feedText = "Time to start your career...",
			-- CRITICAL FIX: User complained "IT SAYS YOU GOT HIRED AT TARGET,STARBUCKS OR A LOCAL SHOP ???"
			-- Don't hardcode job names! Actually assign a real entry-level job from the job system
			onResolve = function(state)
				local entryJobs = {
					{ id = "fastfood", name = "Fast Food Worker", company = "Burger Palace", salary = 22000, category = "entry" },
					{ id = "retail", name = "Retail Associate", company = "MegaMart", salary = 26000, category = "entry" },
					{ id = "cashier", name = "Cashier", company = "QuickMart", salary = 24000, category = "entry" },
					{ id = "barista", name = "Barista", company = "Coffee House", salary = 25000, category = "entry" },
					{ id = "server", name = "Server", company = "Local Restaurant", salary = 28000, category = "service" },
					{ id = "grocery", name = "Grocery Stocker", company = "Fresh Foods", salary = 23000, category = "entry" },
					{ id = "movie_theater", name = "Theater Staff", company = "Cinema World", salary = 21000, category = "entry" },
					{ id = "warehouse", name = "Warehouse Worker", company = "Distribution Co", salary = 30000, category = "entry" },
				}
				local job = entryJobs[math.random(1, #entryJobs)]
				
				state.CurrentJob = {
					id = job.id,
					name = job.name,
					company = job.company,
					salary = job.salary,
					category = job.category,
				}
				state.Flags = state.Flags or {}
				state.Flags.employed = true
				state.Flags.has_job = true
				state.Flags.first_job = true
				state.CareerInfo = state.CareerInfo or {}
				state.CareerInfo.yearsAtJob = 0
				state.CareerInfo.jobStartAge = state.Age
				
				-- Give first paycheck bonus
				state.Money = (state.Money or 0) + 2000
				
				if state.AddFeed then
					state:AddFeed(string.format("ğŸ‰ You got hired as a %s at %s! Making $%d/year. No debt! Living at home and stacking cash!", job.name, job.company, job.salary))
				end
			end,
		},
			{
				index = 4,
				text = "Gap year road trip ($1,000)",
				effects = { Happiness = 10, Health = 4, Money = -1000 },
				setFlags = { gap_year = true, free_spirit = true, wanderlust = true },
				eligibility = function(state) return (state.Money or 0) >= 1000, "ğŸ’¸ Need $1,000 for travel" end,
				feedText = "ğŸ“ Road trip adventure! Finding yourself before adulthood!",
			},
			{
				index = 5,
				text = "Volunteer gap year",
				effects = { Happiness = 8, Health = 3, Smarts = 2 },
				setFlags = { gap_year = true, volunteer_gap_year = true },
				feedText = "ğŸ“ Volunteer gap year! Free room and board while helping others!",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- YOUNG ADULT MILESTONES (Ages 18-30)
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	{
		id = "young_adult_move_out",
		emoji = "ğŸ“¦",
		title = "Moving Out of Your Parents' House",
		-- CRITICAL FIX: Dynamic age and clearer text about money requirements
		text = "You're {{AGE}}. Your parents' house is comfortable and FREE. But you're a grown adult living in your childhood bedroom. Your high school trophies are still on the shelf. Your mom still does your laundry. It's time. Time to be independent. Time to adult. But rent is expensive... Your savings: ${{MONEY}}",
		question = "What's your living situation?",
		category = "milestone",
		weight = 9,
		minAge = 18,
		maxAge = 28,
		oneTime = true,
		blockedByFlags = { 
			living_independently = true, 
			in_prison = true,
			moved_out = true,
			has_own_place = true,
			homeless = true,
		},
		
		-- CRITICAL FIX: Event-level eligibility - need SOME money to even see this event!
		-- This prevents broke players from getting "move out" popups when they can't afford it
		eligibility = function(state)
			local money = state.Money or 0
			-- Need at least $500 to even consider moving out
			if money < 500 then
				return false, "ğŸ’¸ You need at least $500 saved before considering moving out!"
			end
			return true
		end,
		
		choices = {
			{
				index = 1,
				-- CRITICAL FIX: Show EXACT cost - $1,500 for deposit + first month
				text = "Get your own apartment ($1,500)",
				effects = { Happiness = 10, Health = 2, Money = -1500 },
				setFlags = { living_independently = true, lives_alone = true, adulting = true, moved_out = true, has_own_place = true, has_apartment = true, renting = true },
				-- CRITICAL FIX: Check exact amount needed
				eligibility = function(state)
					local money = state.Money or 0
					if money < 1500 then
						return false, "ğŸ’¸ You need $1,500 for deposit + first month rent!"
					end
					return true
				end,
				feedText = "ğŸ“¦ Got your own apartment! Rent is $900/month. Freedom!",
				-- CRITICAL FIX: Only set up housing - DON'T take more money (already in effects)
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.HousingState = state.HousingState or {}
					
					-- Set housing state
					state.Flags.living_with_parents = nil
					state.HousingState.status = "renter"
					state.HousingState.type = "apartment"
					state.HousingState.rent = 900
					state.HousingState.yearsWithoutPayingRent = 0
					state.HousingState.missedRentYears = 0
					state.HousingState.moveInYear = state.Year or 2025
				end,
			},
			{
				index = 2,
				-- CRITICAL FIX: Show EXACT cost - $700 for deposit + first month share
				text = "Find roommates ($700)",
				effects = { Happiness = 7, Money = -700 },
				setFlags = { living_independently = true, has_roommates = true, moved_out = true, has_own_place = true, has_apartment = true, renting = true },
				-- CRITICAL FIX: Check exact amount
				eligibility = function(state)
					local money = state.Money or 0
					if money < 700 then
						return false, "ğŸ’¸ You need $700 for deposit + first month share!"
					end
					return true
				end,
				feedText = "ğŸ“¦ Moved in with roommates! Your share is $450/month!",
				-- CRITICAL FIX: Only set up housing - DON'T take more money (already in effects)
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.HousingState = state.HousingState or {}
					
					state.Flags.living_with_parents = nil
					state.HousingState.status = "renter"
					state.HousingState.type = "shared_apartment"
					state.HousingState.rent = 450
					state.HousingState.yearsWithoutPayingRent = 0
					state.HousingState.missedRentYears = 0
					state.HousingState.moveInYear = state.Year or 2025
				end,
			},
			{
				index = 3,
				-- CRITICAL FIX: This option is ALWAYS available (free!)
				text = "Stay with parents - save money",
				effects = { Money = 8000, Happiness = -4 },
				setFlags = { lives_with_parents = true, saving_money = true, late_bloomer = true },
				feedText = "You stayed home. Your friends judge you. But your savings account is GROWING. You'll move out when you're READY. Smart, not sorry.",
				onResolve = function(state)
					state.HousingState = state.HousingState or {}
					state.HousingState.status = "with_parents"
					state.HousingState.type = "family_home"
					state.HousingState.rent = 0
					state.Flags = state.Flags or {}
					state.Flags.moved_out = nil
					state.Flags.has_apartment = nil
					state.Flags.renting = nil
				end,
			},
			{
				index = 4,
				text = "Move in with your partner (Need partner + $2,000)",
				effects = { Happiness = 9 },
				setFlags = { living_independently = true, cohabitating = true, serious_relationship = true },
				-- CRITICAL FIX #952: Requires having a partner and some money!
				eligibility = function(state)
					-- Check for partner/relationship
					local hasPartner = state.Flags and (
						state.Flags.has_partner or 
						state.Flags.dating or 
						state.Flags.in_relationship or
						state.Flags.married or
						state.Flags.engaged
					)
					
					-- Also check relationships table
					if not hasPartner and state.Relationships then
						for _, rel in pairs(state.Relationships) do
							local relType = rel and (rel.type or "")
							local relRole = rel and (rel.role or "")
							relType = string.lower(tostring(relType))
							relRole = string.lower(tostring(relRole))
							if rel.alive and (relType == "romance" or relType == "partner" or relType == "spouse" or
								relRole:find("partner") or relRole:find("girlfriend") or relRole:find("boyfriend") or
								relRole:find("spouse") or relRole:find("wife") or relRole:find("husband")) then
								hasPartner = true
								break
							end
						end
					end
					
					if not hasPartner then
						return false, "ğŸ’” You don't have a partner to move in with! Find love first."
					end
					
					local money = state.Money or 0
					if money < 2000 then
						return false, "ğŸ’¸ Need at least $2,000 to move in together!"
					end
					return true
				end,
				feedText = "Moving in with partner...",
				-- CRITICAL FIX: Set proper housing flags for cohabitation!
				onResolve = function(state)
					local money = state.Money or 0
					state.Flags = state.Flags or {}
					state.HousingState = state.HousingState or {}
					
					-- Set housing flags for moving in with partner
					state.Flags.moved_out = true
					state.Flags.has_own_place = true
					state.Flags.has_apartment = true
					state.Flags.renting = true
					state.Flags.living_with_parents = nil
					state.HousingState.status = "renter"
					state.HousingState.type = "apartment"
					state.HousingState.yearsWithoutPayingRent = 0
					state.HousingState.missedRentYears = 0
					state.HousingState.moveInYear = state.Year or 2025
					
					if money >= 10000 then
						state.Money = money - 10000
						state.HousingState.rent = 700 -- Your share of nice place
						if state.AddFeed then
							state:AddFeed("ğŸ“¦ Moved in together! Nice place, your share is $700/month. Serious!")
						end
					elseif money >= 5000 then
						state.Money = money - 5000
						state.HousingState.rent = 500 -- Cozy apartment
						if state.AddFeed then
							state:AddFeed("ğŸ“¦ Cozy apartment together! Your share is $500/month!")
						end
					elseif money >= 2000 then
						state.Money = money - 2000
						state.HousingState.rent = 400 -- Tiny place
						if state.ModifyStat then state:ModifyStat("Happiness", -2) end
						if state.AddFeed then
							state:AddFeed("ğŸ“¦ Tiny place together. $400/month. Love conquers square footage!")
						end
					end
				end,
			},
			-- CRITICAL FIX: Add a 5th option for broke players - couch surfing!
			{
				index = 5,
				text = "Crash with friends for now",
				effects = { Happiness = 2, Health = -3 },
				setFlags = { living_independently = true, couch_surfing = true, unstable_housing = true },
				-- Always available - no money required!
				feedText = "Crashing on couches...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.HousingState = state.HousingState or {}
					
					state.Flags.moved_out = true
					state.Flags.living_with_parents = nil
					state.HousingState.status = "couch_surfing"
					state.HousingState.type = "temporary"
					state.HousingState.rent = 0
					
					if state.AddFeed then
						state:AddFeed("ğŸ“¦ Couch surfing! Free but not stable. Different friend's house every week. Time to get on your feet!")
					end
				end,
			},
		},
	},

	-- CRITICAL FIX: Renamed from "first_real_job" to avoid ID conflict with Milestones.lua
	{
		id = "first_real_job_career",
		emoji = "ğŸ’¼",
		title = "Your First REAL Job",
		-- CRITICAL FIX: Removed hardcoded salary
		text = "You got an offer! Not retail. Not food service. A REAL job with benefits, 401(k), and PTO! You're in a cubicle. You have business cards. You wear business casual. You send emails that end with 'Best regards.' Is this... being an adult? It feels surreal. First day is Monday.",
		question = "What's your work approach?",
		category = "milestone",
		weight = 8,
		minAge = 21,
		maxAge = 26,
		oneTime = true,
		choices = {
			{
				index = 1,
				text = "Work HARD - impress everyone immediately",
				effects = { Happiness = 5, Smarts = 6, Health = -3 },
				setFlags = { career_focused = true, workaholic = true, hustler = true },
				feedText = "You stayed late every day. Volunteered for projects. Your boss noticed. 'Great work ethic!' You're on the fast track! (But exhausted.)",
			},
			{
				index = 2,
				text = "Work smart - 9 to 5, no more",
				effects = { Happiness = 7, Health = 3 },
				setFlags = { work_life_balance = true, boundaries = true },
				feedText = "You do quality work but leave at 5pm sharp. No overtime. No weekends. Your manager respects it. Balance achieved!",
			},
			{
				index = 3,
				text = "Coast - do the bare minimum",
				effects = { Happiness = 4, Smarts = -2 },
				setFlags = { coasting = true, underachiever = true },
				feedText = "You show up. Do the minimum. Browse Reddit for 3 hours a day. Your reviews are 'meets expectations.' Good enough, right?",
			},
			{
				index = 4,
				text = "Network like CRAZY - it's who you know",
				effects = { Happiness = 6, Smarts = 4, Money = 1000 },
				setFlags = { networker = true, ambitious = true, social_climber = true },
				feedText = "You had coffee with 10 people in your first month. LinkedIn connections: +200. You know everyone. Networking pays OFF!",
			},
		},
	},

	{
		id = "first_car_purchase",
		emoji = "ğŸš™",
		title = "Buying Your First Car",
		-- CRITICAL FIX: Don't show if player is broke
		text = "You've been borrowing cars or taking Uber. But you're {{AGE}} now. Time to buy YOUR OWN CAR. You're at the dealership. The salesman has that commission look. 'What's your budget?' he asks. 'Great financing options!' he says. Do you trust him? Should you go used?",
		question = "What do you buy?",
		category = "milestone",
		weight = 7,
		minAge = 22,
		maxAge = 30,
		oneTime = true,
		-- CRITICAL FIX: Only show if player has at least $2000 (for beater) or doesn't already own a car
		eligibility = function(state)
			if state.Flags and (state.Flags.car_owner or state.Flags.has_car) then
				return false -- Already owns a car
			end
			return (state.Money or 0) >= 2000 -- Need at least enough for cheapest option
		end,
		choices = {
		{
			index = 1,
			-- CRITICAL FIX: Show price in choice text
			text = "New car - finance it! ($25,000)",
			effects = { Happiness = 10, Money = -25000, Health = 2 },
			-- CRITICAL FIX: Set ALL car ownership flags for consistency!
			setFlags = { car_owner = true, has_car = true, has_vehicle = true, in_debt = true, nice_car = true },
			feedText = "You drove off the lot in a BRAND NEW car! That new car smell! Monthly payments: $420 for 5 years. You're IN DEBT but you look GOOD!",
			-- CRITICAL FIX: Add eligibility check
			eligibility = function(state)
				if (state.Money or 0) < 25000 then
					return false, "Can't afford a $25,000 car"
				end
				return true
			end,
		},
		{
			index = 2,
			-- CRITICAL FIX: Show price in choice text
			text = "Used car - reliable ($8,000)",
			effects = { Happiness = 7, Money = -8000 },
			-- CRITICAL FIX: Set ALL car ownership flags for consistency!
			setFlags = { car_owner = true, has_car = true, has_vehicle = true, practical = true },
			feedText = "You bought a 2012 Honda Civic with 80,000 miles. Paid cash. No debt. It's not sexy but it RUNS. Smart choice!",
			-- CRITICAL FIX: Add eligibility check
			eligibility = function(state)
				if (state.Money or 0) < 8000 then
					return false, "Can't afford an $8,000 car"
				end
				return true
			end,
		},
		{
			index = 3,
			-- CRITICAL FIX: Show price in choice text
			text = "Cheap beater ($3,000)",
			effects = { Happiness = 4, Money = -3000 },
			-- CRITICAL FIX: Set ALL car ownership flags for consistency!
			setFlags = { car_owner = true, has_car = true, has_vehicle = true, frugal = true, might_break_down = true },
			feedText = "You bought a 2004 Corolla for $3,000 cash. It makes a weird noise. The AC doesn't work. But it's YOURS! Freedom (kinda)!",
			-- CRITICAL FIX: Add eligibility check
			eligibility = function(state)
				if (state.Money or 0) < 3000 then
					return false, "Can't afford a $3,000 car"
				end
				return true
			end,
		},
			{
				index = 4,
				text = "No car - Uber/transit is fine",
				effects = { Happiness = 5, Money = 5000 },
				setFlags = { carless = true, city_dweller = true, environmentally_conscious = true },
				feedText = "You decided cars are overpriced metal death traps. You Uber, bike, and take transit. Saving $500/month! No insurance, gas, or payments! Modern life!",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- ADULT MILESTONES (Ages 30+)
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

	{
		id = "buying_first_home",
		emoji = "ğŸ ",
		title = "Buying Your First Home",
		-- CRITICAL FIX: Removed hardcoded prices - don't mention specific money
		text = "You're {{AGE}} and you've been renting for years. Rent keeps going up. Your real estate agent found a house. 3 bed, 2 bath. Needs work but it could be YOURS. This is it. The biggest purchase of your life. Sign or walk away?",
		question = "Do you buy the house?",
		category = "milestone",
		weight = 6,
		minAge = 28,
		maxAge = 45,
		oneTime = true,
		-- CRITICAL FIX: Only show if player has at least $20000 for down payment
		eligibility = function(state)
			if state.Flags and (state.Flags.homeowner or state.Flags.owns_property) then
				return false -- Already owns a home
			end
			return (state.Money or 0) >= 20000 -- Need at least a down payment
		end,
		choices = {
			{
				index = 1,
				-- CRITICAL FIX: Show price in choice text
				text = "BUY IT - full price! ($70,000)",
				effects = { Happiness = 12, Money = -70000, Health = -2 },
				setFlags = { homeowner = true, mortgage_debt = true, adulting_complete = true },
				feedText = "You signed all the documents. But you got the keys! You OWN A HOUSE! The dream achieved!",
				-- CRITICAL FIX: Add eligibility check for each expensive choice
				eligibility = function(state)
					if (state.Money or 0) < 70000 then
						return false, "Can't afford $70,000 for a house"
					end
					return true
				end,
			},
			{
				index = 2,
				-- CRITICAL FIX: Show price in choice text
				text = "Negotiate for a better price ($60,000)",
				effects = { Happiness = 10, Money = -60000, Smarts = 3 },
				setFlags = { homeowner = true, negotiator = true },
				feedText = "You negotiated! Saved thousands by not accepting the first offer. Smart buyer!",
				-- CRITICAL FIX: Add eligibility check for each expensive choice
				eligibility = function(state)
					if (state.Money or 0) < 60000 then
						return false, "Can't afford $60,000 for a house"
					end
					return true
				end,
			},
			{
				index = 3,
				text = "Keep renting - not ready for this commitment",
				effects = { Happiness = -4, Money = 5000 },
				setFlags = { renter_forever = true, commitment_issues = true },
				feedText = "You walked away. Too scary. Too much debt. Maybe next time.",
			},
			{
				index = 4,
				-- CRITICAL FIX: Show price in choice text
				text = "Buy a condo instead ($50,000)",
				effects = { Happiness = 8, Money = -50000 },
				setFlags = { homeowner = true, condo_owner = true, practical = true },
				feedText = "You bought a condo! HOA fees but someone ELSE does maintenance. You're a homeowner!",
				-- CRITICAL FIX: Add eligibility check for each expensive choice
				eligibility = function(state)
					if (state.Money or 0) < 50000 then
						return false, "Can't afford $50,000 for a condo"
					end
					return true
				end,
			},
		},
	},

	{
		id = "midlife_burnout",
		emoji = "ğŸ˜«",
		title = "Midlife Career Burnout",
		-- CRITICAL FIX: Use dynamic age and salary instead of hardcoded values
		text = "You're {{AGE}}. You've been working nonstop for {{YEARS_AT_JOB}} years at {{COMPANY}}. Same cubicle. Same commute. You're making {{SALARY}} but you're DEAD INSIDE. You fantasize about quitting. Moving somewhere tropical. Opening a small business. {{FAMILY_STATUS}} Walking away means losing everything. But staying means... this. Forever. What do you do?",
		question = "How do you handle this crisis?",
		category = "milestone",
		weight = 4,
		minAge = 35,
		maxAge = 55,
		requiresJob = true,
		blockedByFlags = { in_prison = true, incarcerated = true },
		choices = {
			{
				index = 1,
				text = "Take a sabbatical - step away for 6 months",
				effects = { Happiness = 10, Health = 5 },
				setFlags = { took_sabbatical = true, self_care = true },
				feedText = "Planning a sabbatical...",
				-- CRITICAL FIX: Money validation for $20000 sabbatical
				onResolve = function(state)
					local money = state.Money or 0
					if money >= 20000 then
						state.Money = money - 20000
						if state.AddFeed then
							state:AddFeed("ğŸ˜« You took 6 months off! Traveled. Read books. REFRESHED! Reset achieved!")
						end
					elseif money >= 10000 then
						state.Money = money - 10000
						if state.ModifyStat then state:ModifyStat("Happiness", -2) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« 3-month sabbatical. Shorter but still rejuvenating!")
						end
					elseif money >= 5000 then
						state.Money = money - 5000
						if state.ModifyStat then state:ModifyStat("Happiness", -4) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« One month off. Not much but better than nothing!")
						end
					elseif money >= 1000 then
						state.Money = money - 1000
						if state.ModifyStat then state:ModifyStat("Happiness", -6) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Just a week of staycation. Some rest at least.")
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -8) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Can't afford time off. Using sick days for a mental health break.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Switch careers - it's not too late!",
				effects = { Happiness = 8, Smarts = 5 },
				setFlags = { career_change = true, brave = true, starting_over = true },
				feedText = "Switching careers...",
				-- CRITICAL FIX: Money validation for $10000 career change
				onResolve = function(state)
					local money = state.Money or 0
					if money >= 10000 then
						state.Money = money - 10000
						if state.AddFeed then
							state:AddFeed("ğŸ˜« You quit! Enrolled in bootcamp! Starting over is LIBERATING!")
						end
					elseif money >= 5000 then
						state.Money = money - 5000
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Part-time courses while job hunting. Transition happening!")
						end
					elseif money >= 1000 then
						state.Money = money - 1000
						if state.ModifyStat then state:ModifyStat("Happiness", -3) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Free online courses and self-teaching. Budget career change!")
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Can't afford training but networking for new opportunities!")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Push through - retirement is only 20 years away",
				effects = { Happiness = -8, Health = -5, Money = 5000 },
				setFlags = { burnout = true, resigned_to_misery = true },
				feedText = "You stayed. Counted down the days. 7,300 days until retirement. You're a shell of who you used to be. But the paycheck clears. Is this life?",
			},
			{
				index = 4,
				text = "Start a side hustle - test the waters first",
				effects = { Happiness = 6, Smarts = 4 },
				setFlags = { entrepreneur = true, side_hustle = true },
				feedText = "Starting a side hustle...",
				-- CRITICAL FIX: Money validation for $3000 side business
				onResolve = function(state)
					local money = state.Money or 0
					if money >= 3000 then
						state.Money = money - 3000
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Side business launched! Nights and weekends. Hope restored!")
						end
					elseif money >= 1000 then
						state.Money = money - 1000
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Lean side hustle! Minimal investment, maximum effort!")
						end
					elseif money >= 200 then
						state.Money = money - 200
						if state.ModifyStat then state:ModifyStat("Happiness", -2) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Micro-hustle! Just a domain and some social media. Baby steps!")
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -3) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜« Freelancing with what you have. No investment, just sweat equity!")
						end
					end
				end,
			},
		},
	},

	{
		id = "retirement_decision",
		emoji = "ğŸ–ï¸",
		title = "Retirement: The Big Decision",
		-- CRITICAL FIX: Use dynamic age instead of hardcoded "65"
		text = "You're {{AGE}}. You've worked for decades. Your boss at {{COMPANY}} just asked if you're retiring this year. You have savings and could collect Social Security. Your financial advisor says you're 'set for life.' But retiring means... what? No structure? No purpose? Golf and bingo? Is that IT? Or do you keep working? You're healthy. Sharp. Why stop now?",
		question = "What do you do?",
		category = "milestone",
		weight = 3,
		minAge = 62,
		maxAge = 70,
		oneTime = true,
		requiresJob = true,
		choices = {
			{
				index = 1,
				text = "Retire - enjoy your golden years!",
				effects = { Happiness = 12, Health = 5, Money = 50000 },
				setFlags = { retired = true, golden_years = true, no_more_work = true },
				feedText = "You retired! You sleep in. Travel. Garden. Play with grandkids. Read books. This is what you worked for. FREEDOM! You're loving life!",
			},
			{
				index = 2,
				text = "Work part-time - ease into retirement",
				effects = { Happiness = 8, Health = 3, Money = 20000 },
				setFlags = { semi_retired = true, consultant = true },
				feedText = "You became a part-time consultant! 20 hours a week. Extra income. Still relevant. Best of both worlds! Smart transition!",
			},
			{
				index = 3,
				text = "Keep working - you're not done yet!",
				effects = { Happiness = 5, Health = -2, Money = 40000 },
				setFlags = { workaholic = true, cant_let_go = true },
				-- CRITICAL FIX: Removed hardcoded "wife" - not everyone is married
				feedText = "You stayed full-time. Family asks 'When are you going to RETIRE?!' You don't know. Work gives you purpose.",
			},
			{
				index = 4,
				text = "Retire and volunteer - give back",
				effects = { Happiness = 14, Health = 4 },
				setFlags = { retired = true, volunteer = true, fulfilled = true },
				feedText = "You retired and started volunteering! Homeless shelter. Habitat for Humanity. Mentoring. You're making a DIFFERENCE! Purpose found!",
			},
		},
	},
}

return events
