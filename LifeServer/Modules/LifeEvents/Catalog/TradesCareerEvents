--[[
	TradesCareerEvents.lua
	
	MASSIVE career events for Trades workers:
	- Janitors, Construction Workers, Electricians, Plumbers
	- Mechanics, HVAC Techs, Welders, Carpenters, Truck Drivers
	- Foremen and Supervisors
	
	All events use randomized outcomes for unpredictable gameplay!
	Each playthrough should feel DIFFERENT!
]]

local TradesCareerEvents = {}

local CATEGORY = "career_trades"

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CONSTRUCTION WORKER EVENTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TradesCareerEvents.events = {
	-- Construction: Workplace Safety
	{
		id = "construction_safety_incident",
		title = "âš ï¸ Safety Violation",
		emoji = "âš ï¸",
		text = "OSHA inspector shows up unannounced. Someone left equipment lying around and there's a violation.",
		question = "How do you handle it?",
		category = CATEGORY,
		weight = 15,
		minAge = 18, maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		requiresJobCategory = "trades",
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Own up - it was your equipment",
				effects = {},
				feedText = "Taking responsibility...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 5)
						state.Flags = state.Flags or {}
						state.Flags.honest_worker = true
						state:AddFeed("âš ï¸ Boss appreciated your honesty. No write-up!")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("âš ï¸ You got a formal warning. Watch your equipment!")
					end
				end,
			},
			{
				text = "Stay quiet and blend in",
				effects = { Happiness = -5 },
				feedText = "Playing it safe...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:AddFeed("âš ï¸ Someone else took the blame. You lucked out.")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("âš ï¸ They figured it out anyway. Trust damaged.")
					end
				end,
			},
			{
				text = "Help fix the violations quickly",
				effects = { Health = -3 },
				feedText = "Scrambling to clean up...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 8)
						state.Flags = state.Flags or {}
						state.Flags.team_player = true
						state:AddFeed("âš ï¸ Everyone pitched in! Inspector left satisfied.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("âš ï¸ Too late. Site got fined anyway.")
					end
				end,
			},
		},
	},
	
	-- Construction: Weather Challenge
	{
		id = "construction_bad_weather",
		title = "ğŸŒ§ï¸ Weather Delays",
		emoji = "ğŸŒ§ï¸",
		text = "A massive storm is coming. The foreman asks if anyone wants to push through and finish before it hits.",
		question = "Overtime in dangerous conditions?",
		category = CATEGORY,
		weight = 12,
		minAge = 18, maxAge = 60,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresJob = true,
		requiresJobCategory = "trades",
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Push through for overtime pay",
				effects = {},
				feedText = "Racing against the weather...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						local bonus = math.random(200, 500)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 8)
						state:AddFeed(string.format("ğŸŒ§ï¸ Made it! Got $%d overtime bonus!", bonus))
					elseif roll <= 80 then
						state:ModifyStat("Health", -8)
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸŒ§ï¸ Got caught in the rain. Miserable but done.")
					else
						state:ModifyStat("Health", -15)
						state.Flags = state.Flags or {}
						state.Flags.work_injury = true
						state:AddFeed("ğŸŒ§ï¸ Slipped in the mud. Injured your back!")
					end
				end,
			},
			{
				text = "Play it safe - go home",
				effects = { Happiness = 3 },
				feedText = "ğŸŒ§ï¸ Safety first. Tomorrow's another day.",
			},
			{
				text = "Volunteer to stay as lookout",
				effects = { Happiness = 2 },
				feedText = "ğŸŒ§ï¸ You watched the equipment until the storm passed. Small but appreciated contribution.",
			},
		},
	},
	
	-- Construction: Promotion Opportunity
	{
		id = "construction_foreman_spot",
		title = "ğŸ—ï¸ Foreman Opening",
		emoji = "ğŸ—ï¸",
		text = "The site foreman is retiring. Boss is looking for someone to step up.",
		question = "Do you go for the promotion?",
		category = CATEGORY,
		weight = 10,
		minAge = 25, maxAge = 55,
		baseChance = 0.35,
		cooldown = 5,
		oneTime = true,
		requiresJob = true,
		requiresJobCategory = "trades",
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Apply immediately",
				effects = {},
				feedText = "Putting yourself forward...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local bonus = math.floor(smarts / 10)
					
					if roll + bonus <= 55 then
						state:ModifyStat("Happiness", 15)
						state:ModifyStat("Smarts", 3)
						state.Flags = state.Flags or {}
						state.Flags.site_supervisor = true
						state.Flags.construction_leadership = true
						local raise = math.random(8000, 15000)
						if state.CurrentJob then
							state.CurrentJob.salary = (state.CurrentJob.salary or 45000) + raise
						end
						state:AddFeed(string.format("ğŸ—ï¸ YOU GOT THE FOREMAN JOB! $%d raise!", raise))
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ—ï¸ They gave it to someone with more experience. Keep grinding.")
					end
				end,
			},
			{
				text = "Recommend a coworker instead",
				effects = { Happiness = 3, Smarts = 2 },
				feedText = "ğŸ—ï¸ You put in a good word for Miguel. He got it and owes you one.",
				setFlags = { team_player = true },
			},
			{
				text = "Not ready for that responsibility",
				effects = { Happiness = 2 },
				feedText = "ğŸ—ï¸ Maybe next time. You kept your head down.",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- ELECTRICIAN EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "electrician_dangerous_job",
		title = "âš¡ Dangerous Wiring",
		emoji = "âš¡",
		text = "Client wants you to fix some sketchy DIY wiring. It's dangerous and not up to code.",
		question = "Take the risk for good money?",
		category = CATEGORY,
		weight = 14,
		minAge = 20, maxAge = 60,
		baseChance = 0.45,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresJob = true,
		requiresJobId = { "electrician", "electrician_apprentice" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Do the job but charge extra for hazard",
				effects = {},
				feedText = "Working carefully on the mess...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						local bonus = math.random(300, 800)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 5)
						state:AddFeed(string.format("âš¡ Fixed it safely! Got $%d hazard pay!", bonus))
					elseif roll <= 90 then
						state:ModifyStat("Health", -10)
						state:AddFeed("âš¡ Got a nasty shock but finished the job.")
					else
						state:ModifyStat("Health", -25)
						state.Flags = state.Flags or {}
						state.Flags.work_injury = true
						state:AddFeed("âš¡ SEVERE SHOCK! Had to go to the hospital!")
					end
				end,
			},
			{
				text = "Refuse - report it to the city",
				effects = { Smarts = 3 },
				feedText = "âš¡ You reported the hazard. City inspector will handle it. Ethics over money.",
				setFlags = { ethical_tradesman = true },
			},
			{
				text = "Tell them to hire a licensed contractor",
				effects = { Happiness = 2 },
				feedText = "âš¡ Passed on the liability. Smart move.",
			},
		},
	},
	
	{
		id = "electrician_apprentice_test",
		title = "ğŸ“ Journeyman Exam",
		emoji = "ğŸ“",
		text = "Time to take your journeyman electrician exam. Passing means a big raise and license.",
		question = "How do you prepare?",
		category = CATEGORY,
		weight = 12,
		minAge = 20, maxAge = 40,
		baseChance = 0.5,
		oneTime = true,
		requiresJob = true,
		requiresJobId = { "electrician_apprentice" },
		requiresFlags = { electrical_training = true },
		blockedByFlags = { in_prison = true, licensed_electrician = true },
		
		choices = {
			{
				text = "Study hard for weeks",
				effects = { Happiness = -5, Health = -3 },
				feedText = "Cramming electrical codes...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100)
					local bonus = math.floor(smarts / 5)
					
					if roll + bonus <= 75 then
						state:ModifyStat("Happiness", 20)
						state:ModifyStat("Smarts", 5)
						state.Flags = state.Flags or {}
						state.Flags.licensed_electrician = true
						state.Flags.journeyman_electrician = true
						state:AddFeed("ğŸ“ PASSED! You're now a licensed journeyman electrician!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ“ Failed by 3 points. Can retake in 6 months.")
					end
				end,
			},
			{
				text = "Wing it - you know your stuff",
				effects = {},
				feedText = "Taking the exam...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 20)
						state.Flags = state.Flags or {}
						state.Flags.licensed_electrician = true
						state:AddFeed("ğŸ“ PASSED! Natural talent!")
					else
						state:ModifyStat("Happiness", -12)
						state:AddFeed("ğŸ“ Failed. Should have studied.")
					end
				end,
			},
			{
				text = "Postpone - not ready yet",
				effects = { Happiness = -3 },
				feedText = "ğŸ“ You delayed the exam. More time to prepare.",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PLUMBER EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "plumber_emergency_call",
		title = "ğŸ”§ Emergency Call",
		emoji = "ğŸ”§",
		text = "It's 2 AM. A client has a burst pipe flooding their house. Triple overtime rates.",
		question = "Answer the call?",
		category = CATEGORY,
		weight = 15,
		minAge = 20, maxAge = 60,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresJob = true,
		requiresJobId = { "plumber", "plumber_apprentice" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Get up and go - money's money",
				effects = { Health = -5 },
				feedText = "Racing to the emergency...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 80 then
						local pay = math.random(400, 900)
						state.Money = (state.Money or 0) + pay
						state:ModifyStat("Happiness", 8)
						state.Flags = state.Flags or {}
						state.Flags.reliable_tradesman = true
						state:AddFeed(string.format("ğŸ”§ Saved their house! Got $%d for the emergency call!", pay))
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ”§ Took forever but you fixed it. Exhausted.")
					end
				end,
			},
			{
				text = "Ignore the call - sleep is sacred",
				effects = { Health = 5, Happiness = 3 },
				feedText = "ğŸ”§ You slept through. Someone else got the call.",
			},
			{
				text = "Refer them to another plumber",
				effects = { Happiness = 2 },
				feedText = "ğŸ”§ You passed the job to Dave. He owes you one.",
				setFlags = { networking = true },
			},
		},
	},
	
	{
		id = "plumber_gross_job",
		title = "ğŸš½ The Worst Job",
		emoji = "ğŸš½",
		text = "Restaurant bathroom backed up. It's NASTY. But they're offering double the usual rate.",
		question = "Take the gross job?",
		category = CATEGORY,
		weight = 12,
		minAge = 18, maxAge = 60,
		baseChance = 0.45,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresJob = true,
		requiresJobId = { "plumber", "plumber_apprentice" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Put on the hazmat suit",
				effects = { Happiness = -8, Health = -3 },
				feedText = "Diving into the horror...",
				onResolve = function(state)
					local pay = math.random(500, 1000)
					state.Money = (state.Money or 0) + pay
					state:ModifyStat("Happiness", 5)
					state.Flags = state.Flags or {}
					state.Flags.tough_worker = true
					state:AddFeed(string.format("ğŸš½ It was disgusting but $%d is $%d. Showered for an hour.", pay, pay))
				end,
			},
			{
				text = "Nope. Some jobs aren't worth it.",
				effects = { Happiness = 5 },
				feedText = "ğŸš½ You passed. Self-respect intact.",
			},
			{
				text = "Send the apprentice",
				effects = { Happiness = 3 },
				feedText = "ğŸš½ The new guy handled it. That's what apprentices are for.",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- MECHANIC EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "mechanic_classic_car",
		title = "ğŸš— Classic Car Project",
		emoji = "ğŸš—",
		text = "A customer brings in a rare 1967 Mustang. Restoration job could make your reputation.",
		question = "Take on the prestigious project?",
		category = CATEGORY,
		weight = 12,
		minAge = 20, maxAge = 60,
		baseChance = 0.4,
		cooldown = 4,
		requiresJob = true,
		requiresJobId = { "mechanic" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Absolutely - this is the dream",
				effects = { Happiness = 10 },
				feedText = "Starting the restoration...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						local bonus = math.random(2000, 5000)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.master_mechanic = true
						state.Flags.restoration_expert = true
						state:AddFeed(string.format("ğŸš— BEAUTIFUL WORK! Got $%d and amazing reviews!", bonus))
					elseif roll <= 85 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸš— It took months but the car looks amazing!")
					else
						state:ModifyStat("Happiness", -10)
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 1000)
						state:AddFeed("ğŸš— Hit some complications. Lost money on parts.")
					end
				end,
			},
			{
				text = "Refer to a specialist",
				effects = { Happiness = 2, Smarts = 2 },
				feedText = "ğŸš— You knew your limits. Referred to a restoration shop.",
			},
			{
				text = "Quote double to make it worth it",
				effects = {},
				feedText = "Quoting high...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 12)
						local bonus = math.random(4000, 8000)
						state.Money = (state.Money or 0) + bonus
						state:AddFeed(string.format("ğŸš— They accepted! $%d profit!", bonus))
					else
						state:AddFeed("ğŸš— They went somewhere cheaper.")
					end
				end,
			},
		},
	},
	
	{
		id = "mechanic_scam_customer",
		title = "ğŸ”© Ethical Dilemma",
		emoji = "ğŸ”©",
		text = "Boss wants you to tell a customer their transmission is shot. It's actually fine - easy upsell.",
		question = "Go along with the scam?",
		category = CATEGORY,
		weight = 14,
		minAge = 18, maxAge = 60,
		baseChance = 0.4,
		cooldown = 3,
		requiresJob = true,
		requiresJobId = { "mechanic" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Lie to the customer",
				effects = { Happiness = -10 },
				feedText = "Selling the lie...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						local bonus = math.random(100, 300)
						state.Money = (state.Money or 0) + bonus
						state.Flags = state.Flags or {}
						state.Flags.dishonest = true
						state:AddFeed(string.format("ğŸ”© They bought it. Got $%d commission. Guilt sets in.", bonus))
					else
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ”© They got a second opinion. Shop's reputation damaged.")
					end
				end,
			},
			{
				text = "Tell the truth quietly",
				effects = { Smarts = 3 },
				feedText = "Being honest...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 10)
						state.Flags = state.Flags or {}
						state.Flags.ethical_mechanic = true
						state:AddFeed("ğŸ”© Customer appreciated your honesty. Left a 5-star review!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ”© Boss found out. He's not happy with you.")
					end
				end,
			},
			{
				text = "Quit - you don't work for scammers",
				effects = { Happiness = 5 },
				feedText = "ğŸ”© You walked out. Integrity over income.",
				setFlags = { ethical_tradesman = true },
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- TRUCK DRIVER EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "trucker_long_haul",
		title = "ğŸš› Cross-Country Run",
		emoji = "ğŸš›",
		text = "A lucrative cross-country delivery. 3 days on the road, double pay.",
		question = "Take the long haul?",
		category = CATEGORY,
		weight = 14,
		minAge = 21, maxAge = 65,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresJob = true,
		requiresJobId = { "truck_driver" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Hit the road - adventure awaits",
				effects = { Health = -5, Happiness = 5 },
				feedText = "Driving across America...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						local bonus = math.random(800, 1500)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 10)
						state.Flags = state.Flags or {}
						state.Flags.road_warrior = true
						state:AddFeed(string.format("ğŸš› Delivered on time! Got $%d bonus!", bonus))
					elseif roll <= 90 then
						local bonus = math.random(400, 800)
						state.Money = (state.Money or 0) + bonus
						state:AddFeed(string.format("ğŸš› Hit some traffic but made it. $%d.", bonus))
					else
						state:ModifyStat("Health", -10)
						state:AddFeed("ğŸš› Truck broke down in the desert. Nightmare trip.")
					end
				end,
			},
			{
				text = "Stick to local routes",
				effects = { Happiness = 2 },
				feedText = "ğŸš› You stayed local. Less money, more sleep.",
			},
			{
				text = "Request a partner driver",
				effects = {},
				feedText = "Bringing backup...",
				onResolve = function(state)
					local bonus = math.random(500, 1000)
					state.Money = (state.Money or 0) + bonus
					state:ModifyStat("Happiness", 8)
					state.Flags = state.Flags or {}
					state.Flags.team_trucker = true
					state:AddFeed(string.format("ğŸš› Split the driving, split the pay. $%d each. Made a friend!", bonus))
				end,
			},
		},
	},
	
	{
		id = "trucker_weigh_station",
		title = "âš–ï¸ Weigh Station Trouble",
		emoji = "âš–ï¸",
		text = "Your load is overweight. The weigh station is coming up. Fines are brutal.",
		question = "What do you do?",
		category = CATEGORY,
		weight = 12,
		minAge = 21, maxAge = 65,
		baseChance = 0.4,
		cooldown = 3,
		requiresJob = true,
		requiresJobId = { "truck_driver" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Pull in and face the music",
				effects = {},
				feedText = "Going through inspection...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("âš–ï¸ They waved you through! Lucky day!")
					elseif roll <= 70 then
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 500)
						state:AddFeed("âš–ï¸ $500 fine for being overweight. It happens.")
					else
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 2000)
						state:ModifyStat("Happiness", -10)
						state:AddFeed("âš–ï¸ $2000 fine plus forced to offload. Terrible day.")
					end
				end,
			},
			{
				text = "Take the back roads",
				effects = {},
				feedText = "Dodging the scale...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 8)
						state.Flags = state.Flags or {}
						state.Flags.knows_backroads = true
						state:AddFeed("âš–ï¸ Made it around. Saved hundreds in fines!")
					else
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 3000)
						state:ModifyStat("Happiness", -15)
						state:AddFeed("âš–ï¸ Highway patrol caught you bypassing. MASSIVE fine.")
					end
				end,
			},
			{
				text = "Call dispatch and explain",
				effects = { Smarts = 2 },
				feedText = "âš–ï¸ Dispatch found a nearby drop point. Problem solved professionally.",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- WELDER EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "welder_custom_project",
		title = "ğŸ”¥ Custom Fabrication",
		emoji = "ğŸ”¥",
		text = "An artist wants you to help build a massive metal sculpture for a public installation.",
		question = "Take on the artistic project?",
		category = CATEGORY,
		weight = 10,
		minAge = 20, maxAge = 60,
		baseChance = 0.35,
		cooldown = 4,
		requiresJob = true,
		requiresJobId = { "welder" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "This sounds amazing!",
				effects = { Happiness = 10 },
				feedText = "Creating art from metal...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 65 then
						local bonus = math.random(1500, 4000)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.metal_artist = true
						state:AddFeed(string.format("ğŸ”¥ The sculpture unveiled to applause! $%d and your name on the plaque!", bonus))
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ”¥ Artist was difficult. Project fell through halfway.")
					end
				end,
			},
			{
				text = "Art isn't my thing",
				effects = { Happiness = 2 },
				feedText = "ğŸ”¥ You passed. Industrial work is more your style.",
			},
			{
				text = "Only if they pay upfront",
				effects = { Smarts = 3 },
				feedText = "Negotiating terms...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						local bonus = math.random(2000, 3500)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 12)
						state:AddFeed(string.format("ğŸ”¥ Got paid upfront! Project completed. $%d!", bonus))
					else
						state:AddFeed("ğŸ”¥ They found someone cheaper. No regrets - smart to ask.")
					end
				end,
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- HVAC TECHNICIAN EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "hvac_summer_rush",
		title = "â„ï¸ Summer Heatwave",
		emoji = "â„ï¸",
		text = "Brutal heatwave - every AC in the city is breaking down. 12-hour days for a month straight.",
		question = "How do you handle the rush?",
		category = CATEGORY,
		weight = 14,
		minAge = 20, maxAge = 60,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		requiresJobId = { "hvac_tech" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Maximum overtime - cash in!",
				effects = { Health = -15, Happiness = -5 },
				feedText = "Working non-stop...",
				onResolve = function(state)
					local bonus = math.random(3000, 7000)
					state.Money = (state.Money or 0) + bonus
					state:ModifyStat("Happiness", 10)
					state.Flags = state.Flags or {}
					state.Flags.hvac_hero = true
					state:AddFeed(string.format("â„ï¸ Exhausted but rich! Made $%d in overtime!", bonus))
				end,
			},
			{
				text = "Reasonable hours - health first",
				effects = { Happiness = 3 },
				feedText = "â„ï¸ You worked steady but didn't burn out. Smart.",
			},
			{
				text = "Prioritize elderly and medical cases",
				effects = { Happiness = 8 },
				feedText = "Helping the vulnerable...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.community_hero = true
					state:AddFeed("â„ï¸ You saved lives. Local news did a story on you!")
				end,
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CARPENTER EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "carpenter_custom_furniture",
		title = "ğŸªš Custom Furniture Order",
		emoji = "ğŸªš",
		text = "A wealthy client wants handcrafted bedroom furniture. High pay but tight deadline.",
		question = "Take the custom order?",
		category = CATEGORY,
		weight = 12,
		minAge = 20, maxAge = 65,
		baseChance = 0.4,
		cooldown = 3,
		requiresJob = true,
		requiresJobId = { "carpenter" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Take it - showcase your skills",
				effects = { Health = -5 },
				feedText = "Crafting the furniture...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						local bonus = math.random(2000, 5000)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.master_carpenter = true
						state:AddFeed(string.format("ğŸªš Stunning work! $%d and referrals to wealthy friends!", bonus))
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸªš Missed the deadline. Only got partial payment.")
					end
				end,
			},
			{
				text = "Quote it high with timeline buffer",
				effects = { Smarts = 3 },
				feedText = "Setting expectations...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						local bonus = math.random(3000, 6000)
						state.Money = (state.Money or 0) + bonus
						state:ModifyStat("Happiness", 12)
						state:AddFeed(string.format("ğŸªš They accepted! $%d with comfortable deadline!", bonus))
					else
						state:AddFeed("ğŸªš They went with someone cheaper. Oh well.")
					end
				end,
			},
			{
				text = "Recommend a specialist",
				effects = { Happiness = 2 },
				feedText = "ğŸªš You knew custom furniture needs a specialist. Good call.",
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- JANITOR EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "janitor_promotion_opportunity",
		title = "ğŸ§¹ Head Custodian Opening",
		emoji = "ğŸ§¹",
		text = "The head custodian is retiring. You've been here longest - perfect chance to move up.",
		question = "Apply for the supervisor role?",
		category = CATEGORY,
		weight = 12,
		minAge = 25, maxAge = 60,
		baseChance = 0.4,
		cooldown = 5,
		requiresJob = true,
		requiresJobId = { "janitor" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Apply and interview",
				effects = {},
				feedText = "Going for the promotion...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.facility_supervisor = true
						local raise = math.random(5000, 10000)
						if state.CurrentJob then
							state.CurrentJob.salary = (state.CurrentJob.salary or 28000) + raise
						end
						state:AddFeed(string.format("ğŸ§¹ HEAD CUSTODIAN! $%d raise! You run the show now!", raise))
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ§¹ They gave it to someone with management experience. Next time.")
					end
				end,
			},
			{
				text = "I like working alone",
				effects = { Happiness = 3 },
				feedText = "ğŸ§¹ Supervisors deal with people problems. You prefer the work.",
			},
			{
				text = "Ask for a raise instead",
				effects = {},
				feedText = "Negotiating...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						local raise = math.random(2000, 4000)
						if state.CurrentJob then
							state.CurrentJob.salary = (state.CurrentJob.salary or 28000) + raise
						end
						state:ModifyStat("Happiness", 8)
						state:AddFeed(string.format("ğŸ§¹ Got a $%d raise without the headache of managing people!", raise))
					else
						state:AddFeed("ğŸ§¹ Budget's tight. No raise this year.")
					end
				end,
			},
		},
	},
	
	{
		id = "janitor_found_money",
		title = "ğŸ’µ Money in the Trash",
		emoji = "ğŸ’µ",
		text = "While cleaning, you find an envelope with $500 cash in a trash can.",
		question = "What do you do with it?",
		category = CATEGORY,
		weight = 10,
		minAge = 18, maxAge = 70,
		baseChance = 0.35,
		cooldown = 4,
		requiresJob = true,
		requiresJobId = { "janitor" },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Turn it in to lost and found",
				effects = { Smarts = 2, Happiness = 5 },
				feedText = "Being honest...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state.Money = (state.Money or 0) + 500
						state.Flags = state.Flags or {}
						state.Flags.honest_employee = true
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ’µ Nobody claimed it after 30 days - it's legally yours! Plus a good reputation!")
					else
						state.Flags = state.Flags or {}
						state.Flags.honest_employee = true
						state:AddFeed("ğŸ’µ Owner picked it up. Thanked you profusely. Good karma.")
					end
				end,
			},
			{
				text = "Pocket it - finder's keepers",
				effects = {},
				feedText = "Keeping quiet...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state.Money = (state.Money or 0) + 500
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ’µ Nobody saw. $500 richer.")
					else
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ’µ Camera caught you. Fired. It wasn't worth it.")
					end
				end,
			},
			{
				text = "Ask around if anyone lost money",
				effects = { Happiness = 3 },
				feedText = "ğŸ’µ You found the owner - someone's grandma who was devastated. Her gratitude made your day.",
				setFlags = { kind_hearted = true },
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- FOREMAN/SUPERVISOR EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "foreman_union_negotiations",
		title = "ğŸ—ï¸ Union Talks",
		emoji = "ğŸ—ï¸",
		text = "The workers want better conditions. As foreman, you're caught between management and your crew.",
		question = "Where do your loyalties lie?",
		category = CATEGORY,
		weight = 10,
		minAge = 28, maxAge = 60,
		baseChance = 0.4,
		cooldown = 4,
		requiresJob = true,
		requiresFlags = { site_supervisor = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Advocate for the workers",
				effects = {},
				feedText = "Fighting for your crew...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.workers_champion = true
						state:AddFeed("ğŸ—ï¸ Got them a raise! Crew loves you. Management... less so.")
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ—ï¸ Minor concessions won. Better than nothing.")
					end
				end,
			},
			{
				text = "Side with management",
				effects = {},
				feedText = "Toeing the company line...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						local bonus = math.random(2000, 5000)
						if state.CurrentJob then
							state.CurrentJob.salary = (state.CurrentJob.salary or 72000) + bonus
						end
						state:ModifyStat("Happiness", -5)
						state.Flags = state.Flags or {}
						state.Flags.company_man = true
						state:AddFeed(string.format("ğŸ—ï¸ Got a $%d bonus from upstairs. Crew doesn't trust you now.", bonus))
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ—ï¸ Neither side respects you now. Worst of both worlds.")
					end
				end,
			},
			{
				text = "Mediate a compromise",
				effects = { Smarts = 5 },
				feedText = "Finding middle ground...",
				onResolve = function(state)
					state:ModifyStat("Happiness", 10)
					state.Flags = state.Flags or {}
					state.Flags.skilled_negotiator = true
					state:AddFeed("ğŸ—ï¸ Both sides got something. You're the peacemaker.")
				end,
			},
		},
	},
	
	{
		id = "foreman_safety_cover_up",
		title = "âš ï¸ Injury Cover-Up",
		emoji = "âš ï¸",
		text = "A worker got hurt. Boss wants you to file it as 'off-site injury' to avoid OSHA investigation.",
		question = "Do you falsify the report?",
		category = CATEGORY,
		weight = 12,
		minAge = 28, maxAge = 60,
		baseChance = 0.35,
		cooldown = 4,
		requiresJob = true,
		requiresFlags = { site_supervisor = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "File the honest report",
				effects = { Smarts = 3 },
				feedText = "Doing the right thing...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 10)
						state.Flags = state.Flags or {}
						state.Flags.ethical_leader = true
						state:AddFeed("âš ï¸ OSHA investigation was minor. Your integrity saved the company from worse.")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("âš ï¸ Boss is furious. Your job might be at risk.")
					end
				end,
			},
			{
				text = "Cover it up as requested",
				effects = { Happiness = -10 },
				feedText = "Falsifying records...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						local bonus = math.random(1000, 3000)
						state.Money = (state.Money or 0) + bonus
						state.Flags = state.Flags or {}
						state.Flags.cover_up = true
						state:AddFeed(string.format("âš ï¸ Got a $%d bonus for 'handling it.' Guilt haunts you.", bonus))
					else
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 5000)
						state:ModifyStat("Happiness", -20)
						state:AddFeed("âš ï¸ Worker's wife found out. Lawsuit. You're named personally.")
					end
				end,
			},
			{
				text = "Anonymous tip to OSHA",
				effects = { Smarts = 5 },
				feedText = "Whistleblowing...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 8)
						state.Flags = state.Flags or {}
						state.Flags.whistleblower = true
						state:AddFeed("âš ï¸ Investigation happened. Boss couldn't trace it to you.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("âš ï¸ They suspect you. Workplace tension is high.")
					end
				end,
			},
		},
	},
}

return TradesCareerEvents
