--[[
	NFL Professional Football Career Events
	AAA-quality events for football career progression
	
	Career Path:
	1. Youth football (school_athlete flag)
	2. High school varsity (plays_football flag)
	3. College football / College scout interest  
	4. NFL Draft
	5. NFL Rookie â†’ Starter â†’ Star â†’ Superstar â†’ Legend
	
	CRITICAL: Easier path if player made good early life choices!
]]

local NFLCareerEvents = {}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- HELPER FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function hasFootballBackground(state)
	if not state.Flags then return false end
	local flags = state.Flags
	return flags.plays_football or flags.school_athlete or flags.varsity_athlete
		or flags.football_star or flags.college_football
end

local function isNFLPlayer(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("nfl") or jobId:find("football") or 
		(jobId:find("pro") and state.Flags and state.Flags.nfl_player)
end

local function isNFLStar(state)
	if not state.Flags then return false end
	return state.Flags.nfl_pro_bowl or state.Flags.nfl_mvp or state.Flags.super_bowl_champion
end

local function getDraftBonus(state)
	-- Players with good early choices get HUGE bonus to draft chances
	local bonus = 0
	if not state.Flags then return bonus end
	
	if state.Flags.plays_football then bonus = bonus + 15 end
	if state.Flags.varsity_athlete then bonus = bonus + 10 end
	if state.Flags.state_champion then bonus = bonus + 15 end
	if state.Flags.college_sports_interest then bonus = bonus + 10 end
	if state.Flags.scholarship_likely then bonus = bonus + 10 end
	if state.Flags.sports_legend then bonus = bonus + 20 end
	if state.Flags.football_star then bonus = bonus + 25 end
	if state.Flags.college_football then bonus = bonus + 15 end
	if state.Flags.heisman_winner then bonus = bonus + 30 end
	if state.Flags.overcame_injury then bonus = bonus + 5 end
	if (state.Health or 0) >= 80 then bonus = bonus + 10 end
	
	-- Penalties for late starters
	if (state.Age or 18) > 23 and not hasFootballBackground(state) then
		bonus = bonus - 50 -- VERY hard to make NFL without background
	end
	
	return bonus
end

-- Block non-football players from NFL events
local function isEligibleForNFL(state)
	if not state.Flags then return false end
	
	-- Block royalty/mafia paths
	if state.Flags.is_royalty or state.Flags.in_mob then return false end
	if state.RoyalState and state.RoyalState.isRoyal then return false end
	if state.MobState and state.MobState.inMob then return false end
	
	return true
end

NFLCareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- NFL DRAFT DECLARATION (Age 21-23)
	-- CRITICAL FIX: Requires ACTUAL football background!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_draft_declaration",
		title = "ğŸˆ Declare for NFL Draft?",
		emoji = "ğŸˆ",
		text = "NFL scouts have been watching your college games. Your agent thinks you could be drafted. This is your shot at the league!",
		question = "Do you declare for the NFL Draft?",
		category = "career_nfl",
		weight = 15, -- Lower to reduce spam
		minAge = 21, maxAge = 23,
		baseChance = 0.25, -- Lower base chance
		oneTime = true,
		eligibility = function(state)
			if not isEligibleForNFL(state) then return false end
			if state.Flags and state.Flags.nfl_declared then return false end
			if state.Flags and state.Flags.nfl_player then return false end -- Already in NFL
			-- CRITICAL: MUST have football background!
			if not hasFootballBackground(state) then return false end
			-- Must have college football OR varsity football
			local hasRealBackground = state.Flags and (
				state.Flags.college_football or 
				state.Flags.plays_football
			)
			return hasRealBackground
		end,
		blockedByFlags = { in_prison = true, injured = true, nfl_declared = true, nfl_player = true },
		
		choices = {
			{
				text = "ğŸˆ YES! I'm ready for Sunday!",
				effects = { Happiness = 10 },
				feedText = "Declaring for the draft!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.nfl_declared = true
					
					local roll = math.random(1, 100)
					local bonus = getDraftBonus(state)
					
					if roll + bonus >= 75 then
						-- First round pick!
						local pickNum = math.random(1, 32)
						local signBonus = math.random(8000000, 35000000)
						local salary = math.random(2000000, 8000000)
						
						state.Money = (state.Money or 0) + signBonus
						state.Fame = math.min(100, (state.Fame or 0) + 35)
						state:ModifyStat("Happiness", 30)
						state.Flags.nfl_player = true
						state.Flags.nfl_first_round = true
						state.Flags.nfl_draft_pick = pickNum
						
						-- Set NFL job
						state.CurrentJob = {
							id = "nfl_player",
							title = "NFL Player",
							salary = salary,
							category = "sports",
						}
						
						if pickNum <= 10 then
							state:AddFeed(string.format("ğŸˆ TOP 10 PICK! #%d OVERALL! $%s guaranteed! You're a FRANCHISE PLAYER!", pickNum, signBonus))
						else
							state:AddFeed(string.format("ğŸˆ DRAFTED #%d! $%s signing bonus! Welcome to the NFL!", pickNum, signBonus))
						end
						
					elseif roll + bonus >= 50 then
						-- Mid to late round pick
						local round = math.random(2, 5)
						local pickNum = math.random(33, 200)
						local signBonus = math.random(100000, 1000000)
						local salary = math.random(700000, 1500000)
						
						state.Money = (state.Money or 0) + signBonus
						state.Fame = math.min(100, (state.Fame or 0) + 15)
						state:ModifyStat("Happiness", 20)
						state.Flags.nfl_player = true
						state.Flags.nfl_draft_round = round
						
						state.CurrentJob = {
							id = "nfl_player",
							title = "NFL Player",
							salary = salary,
							category = "sports",
						}
						
						state:AddFeed(string.format("ğŸˆ Round %d pick #%d! Not a star yet but you're IN THE NFL! Time to prove yourself!", round, pickNum))
						
					elseif roll + bonus >= 25 then
						-- Undrafted free agent
						state.Flags.nfl_player = true
						state.Flags.nfl_udfa = true
						state:ModifyStat("Happiness", 8)
						state.Fame = math.min(100, (state.Fame or 0) + 5)
						
						state.CurrentJob = {
							id = "nfl_player",
							title = "NFL Player (UDFA)",
							salary = 600000,
							category = "sports",
						}
						
						state:AddFeed("ğŸˆ Went undrafted but signed as UDFA! Long odds but many legends started here!")
					else
						-- Not signed
						state:ModifyStat("Happiness", -20)
						state.Flags.nfl_dream_crushed = true
						state:AddFeed("ğŸˆ Didn't get drafted or signed. The NFL dream is over... Maybe CFL or XFL?")
					end
				end,
			},
			{
				text = "ğŸ“š Stay in college - get my degree first",
				effects = { Smarts = 5, Happiness = 3 },
				feedText = "Education first...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.stayed_college_football = true
					state:AddFeed("ğŸ“š Another year of college ball. More film, more development!")
				end,
			},
			{
				text = "ğŸˆ Try the CFL/XFL first",
				effects = { Happiness = 5 },
				feedText = "Alternative leagues...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.alt_league_football = true
					state.CurrentJob = {
						id = "alt_league_football",
						title = "CFL/XFL Player",
						salary = math.random(60000, 150000),
						category = "sports",
					}
					state:AddFeed("ğŸˆ Signed with an alternative league! Building experience for an NFL shot!")
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- SUPER BOWL!!!
	-- CRITICAL FIX: Super Bowl is RARE - only for established NFL players!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_super_bowl",
		title = "ğŸ† SUPER BOWL!!!",
		emoji = "ğŸ†",
		text = "YOUR TEAM IS IN THE SUPER BOWL! The biggest game in sports! Over 100 MILLION people watching! THIS IS IT!",
		category = "career_nfl",
		weight = 8, -- Very low - Super Bowl is rare!
		minAge = 22, maxAge = 38,
		baseChance = 0.10, -- Very low base chance
		cooldown = 3, -- Minimum 3 years between Super Bowls
		-- CRITICAL: Must be active NFL player with experience
		eligibility = function(state)
			if not isNFLPlayer(state) then return false end
			if not state.Flags or not state.Flags.nfl_player then return false end
			return true
		end,
		blockedByFlags = { injured = true, nfl_retired = true },
		
		choices = {
			{
				text = "ğŸ”¥ SUPER BOWL OR BUST!",
				effects = { Health = -5 },
				feedText = "The biggest stage!",
				triggerMinigame = "mash",
				minigameOptions = { difficulty = "hard" },
				onResolve = function(state, minigameResult)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					local bonus = (minigameResult and minigameResult.success) and 30 or 0
					
					if state.Flags.nfl_pro_bowl then bonus = bonus + 15 end
					if state.Flags.nfl_first_round then bonus = bonus + 10 end
					
					if roll + bonus >= 50 then
						-- SUPER BOWL CHAMPION!
						local prize = math.random(3000000, 15000000)
						state.Money = (state.Money or 0) + prize
						state.Fame = 100
						state:ModifyStat("Happiness", 50)
						state.Flags.super_bowl_champion = true
						state.Flags.super_bowl_rings = (state.Flags.super_bowl_rings or 0) + 1
						
						local rings = state.Flags.super_bowl_rings
						
						-- Check for Super Bowl MVP
						local mvpRoll = math.random(1, 100)
						if mvpRoll + bonus >= 70 then
							state.Flags.super_bowl_mvp = true
							if rings >= 3 then
								state:AddFeed(string.format("ğŸ† %dx SUPER BOWL CHAMPION + SUPER BOWL MVP!!! DYNASTY! GOAT! $%s! CANTON HERE YOU COME!", rings, prize))
							else
								state:AddFeed(string.format("ğŸ† SUPER BOWL CHAMPION + MVP! Ring #%d! $%s! DISNEY WORLD! YOU'RE A LEGEND!", rings, prize))
							end
						else
							if rings >= 2 then
								state:AddFeed(string.format("ğŸ† %dx SUPER BOWL CHAMPION!!! DYNASTY! $%s bonus! PARADE!!!", rings, prize))
							else
								state:AddFeed(string.format("ğŸ† SUPER BOWL CHAMPION!!! $%s bonus! Confetti falling! Dreams come true!", prize))
							end
						end
					else
						state:ModifyStat("Happiness", -20)
						state:AddFeed("ğŸ† Lost the Super Bowl. So close to glory. The pain will fuel next season.")
					end
				end,
			},
			{
				text = "Stay focused, play my role",
				effects = { Happiness = 5 },
				feedText = "Trust the team...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					
					if roll <= 45 then
						local prize = math.random(1500000, 8000000)
						state.Money = (state.Money or 0) + prize
						state.Fame = math.min(100, (state.Fame or 0) + 35)
						state.Flags.super_bowl_champion = true
						state.Flags.super_bowl_rings = (state.Flags.super_bowl_rings or 0) + 1
						state:ModifyStat("Happiness", 40)
						state:AddFeed(string.format("ğŸ† SUPER BOWL CHAMPION! $%s bonus! YOU DID IT!", prize))
					else
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ† Lost a close Super Bowl. Devastating but we'll be back!")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PRO BOWL VOTING RESULTS
	-- CRITICAL FIX: Not guaranteed selection - requires roll!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_pro_bowl",
		title = "â­ Pro Bowl Voting Results",
		emoji = "â­",
		text = "Pro Bowl voting has concluded. Your season performance is being evaluated...",
		category = "career_nfl",
		weight = 10, -- Lower weight
		minAge = 23, maxAge = 36,
		baseChance = 0.12, -- Lower base chance
		cooldown = 2, -- Every 2 years minimum
		-- CRITICAL: Must be established NFL player
		eligibility = function(state)
			if not isNFLPlayer(state) then return false end
			if not state.Flags or not state.Flags.nfl_player then return false end
			-- Must have at least 2 years in NFL
			return true
		end,
		blockedByFlags = { injured = true, nfl_retired = true },
		
		choices = {
			{
				text = "Check the results...",
				effects = {},
				feedText = "Checking Pro Bowl results...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					
					-- Roll to see if selected (not guaranteed!)
					local roll = math.random(1, 100)
					local bonus = 0
					if state.Flags.nfl_first_round then bonus = bonus + 20 end
					if (state.Fame or 0) >= 60 then bonus = bonus + 15 end
					if state.Flags.nfl_pro_bowl then bonus = bonus + 20 end -- Easier for repeat selections
					
					if roll + bonus >= 55 then
						-- Made it!
						state.Flags.nfl_pro_bowl = true
						state.Flags.nfl_pro_bowl_count = (state.Flags.nfl_pro_bowl_count or 0) + 1
						state.Fame = math.min(100, (state.Fame or 0) + 15)
						
						local bonusMoney = math.random(50000, 150000)
						state.Money = (state.Money or 0) + bonusMoney
						
						local count = state.Flags.nfl_pro_bowl_count
						if count >= 8 then
							state.Flags.nfl_perennial_pro_bowler = true
							state:AddFeed(string.format("â­ %dx PRO BOWLER! Hall of Fame lock! $%s bonus!", count, bonusMoney))
						else
							state:AddFeed(string.format("â­ PRO BOWL SELECTED! #%d selection! $%s bonus!", count, bonusMoney))
						end
						state:ModifyStat("Happiness", 20)
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("â­ Didn't make the Pro Bowl this year. Solid season but not elite.")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- NFL MVP
	-- CRITICAL FIX: MVP is VERY rare - only for Pro Bowl level players!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_mvp_race",
		title = "ğŸ… NFL MVP Race!",
		emoji = "ğŸ…",
		text = "You're in the running for NFL MVP! Your season has been HISTORIC. The whole league is watching!",
		category = "career_nfl",
		weight = 6, -- Very low - MVP is extremely rare
		minAge = 24, maxAge = 35,
		baseChance = 0.06, -- Very low base chance
		cooldown = 2,
		-- CRITICAL: Must have Pro Bowl OR be first rounder with high fame
		eligibility = function(state)
			if not isNFLPlayer(state) then return false end
			if not state.Flags or not state.Flags.nfl_player then return false end
			-- Must have Pro Bowl OR elite credentials
			local hasProBowl = state.Flags.nfl_pro_bowl
			local hasEliteCredentials = state.Flags.nfl_first_round and (state.Fame or 0) >= 65
			return hasProBowl or hasEliteCredentials
		end,
		blockedByFlags = { injured = true, nfl_retired = true },
		
		choices = {
			{
				text = "My stats speak for themselves",
				effects = {},
				feedText = "Awaiting results...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					local bonus = 0
					
					if state.Flags.nfl_pro_bowl then bonus = bonus + 20 end
					if state.Flags.nfl_first_round then bonus = bonus + 10 end
					if (state.Fame or 0) >= 75 then bonus = bonus + 15 end
					
					if roll + bonus >= 60 then
						state.Flags.nfl_mvp = true
						state.Flags.nfl_mvp_count = (state.Flags.nfl_mvp_count or 0) + 1
						state.Fame = 100
						state:ModifyStat("Happiness", 35)
						
						local mvpBonus = math.random(3000000, 10000000)
						state.Money = (state.Money or 0) + mvpBonus
						
						local count = state.Flags.nfl_mvp_count
						if count >= 2 then
							state.Flags.nfl_legend = true
							state:AddFeed(string.format("ğŸ… %dx NFL MVP!!! You're on the GOAT list! $%s bonus!", count, mvpBonus))
						else
							state:AddFeed(string.format("ğŸ… NFL MVP!!! Most Valuable Player in football! $%s bonus!", mvpBonus))
						end
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ… Finished top 5 in MVP voting. Elite season even without the award!")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- HUGE CONTRACT
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_franchise_tag_contract",
		title = "ğŸ’° MASSIVE CONTRACT OFFER!",
		emoji = "ğŸ’°",
		text = "Your contract is up. Teams are evaluating your performance...",
		category = "career_nfl",
		weight = 12,
		minAge = 24, maxAge = 32,
		baseChance = 0.18,
		cooldown = 4,
		-- CRITICAL FIX: Only for proven NFL players
		eligibility = function(state)
			if not isNFLPlayer(state) then return false end
			if not state.Flags or not state.Flags.nfl_player then return false end
			return true
		end,
		blockedByFlags = { nfl_retired = true, nfl_big_contract = true },
		
		choices = {
			{
				text = "ğŸ’° PAY ME! I'm worth every penny!",
				effects = { Happiness = 20 },
				feedText = "Show me the money!",
				onResolve = function(state)
					local years = math.random(4, 6)
					local totalValue = math.random(100000000, 250000000)
					local guaranteed = math.random(50000000, 150000000)
					local perYear = math.floor(totalValue / years)
					
					state.Money = (state.Money or 0) + guaranteed
					state.Fame = math.min(100, (state.Fame or 0) + 10)
					
					if state.CurrentJob then
						state.CurrentJob.salary = perYear
					end
					
					state.Flags = state.Flags or {}
					state.Flags.nfl_big_contract = true
					
					state:AddFeed(string.format("ğŸ’° SIGNED! $%s total, $%s GUARANTEED! Generational wealth!", totalValue, guaranteed))
				end,
			},
			{
				text = "Take team-friendly deal to win",
				effects = { Happiness = 10 },
				feedText = "Championships > Money...",
				onResolve = function(state)
					local salary = math.random(15000000, 30000000)
					state.Money = (state.Money or 0) + salary
					state.Flags = state.Flags or {}
					state.Flags.team_player = true
					state.Flags.championship_focused = true
					
					if state.CurrentJob then
						state.CurrentJob.salary = salary
					end
					
					state:AddFeed(string.format("ğŸ’° Took discount ($%s/year) to chase a Super Bowl! Team player!", salary))
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- NFL INJURY (Football is brutal)
	-- CRITICAL FIX: Reduced frequency - injuries still happen but not constantly
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_major_injury",
		title = "ğŸ¥ Serious Injury!",
		emoji = "ğŸ¥",
		text = "You went down on a routine play. The trainers are rushing out. This doesn't look good...",
		category = "career_nfl",
		weight = 10,
		minAge = 22, maxAge = 36,
		baseChance = 0.20,
		cooldown = 4,
		eligibility = function(state)
			if not isNFLPlayer(state) then return false end
			if not state.Flags or not state.Flags.nfl_player then return false end
			return true
		end,
		blockedByFlags = { nfl_retired = true, injured = true },
		
		choices = {
			{
				text = "Fight through rehab - I'll be back",
				effects = { Health = -15 },
				feedText = "Long road ahead...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					
					if roll <= 60 then
						state.Flags.overcame_injury = true
						state.Flags.comeback_player = true
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ¥ Full recovery! Came back stronger than ever! Comeback story!")
					else
						state.Flags.chronic_injury = true
						state:ModifyStat("Health", -10)
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ¥ Never fully recovered. Playing through pain now. Career might be shorter...")
					end
				end,
			},
			{
				text = "Consider retirement for health",
				effects = { Happiness = -10 },
				feedText = "Health comes first...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.considering_retirement = true
					state:ModifyStat("Health", 5)
					state:AddFeed("ğŸ¥ Taking time to think about the future. Health is wealth.")
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- NFL RETIREMENT
	-- CRITICAL FIX: Only for active NFL players who haven't retired
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nfl_retirement_decision",
		title = "ğŸˆ Time to Hang It Up?",
		emoji = "ğŸˆ",
		text = "Your body has taken a beating. Every hit hurts more. The game is passing you by. Is it time?",
		category = "career_nfl",
		weight = 12,
		minAge = 32, maxAge = 40,
		baseChance = 0.30,
		cooldown = 2,
		eligibility = function(state)
			if not isNFLPlayer(state) then return false end
			if not state.Flags or not state.Flags.nfl_player then return false end
			if state.Flags.nfl_retired then return false end
			return true
		end,
		blockedByFlags = { nfl_retired = true },
		
		choices = {
			{
				text = "One more ride - I'm not finished",
				effects = { Health = -5 },
				feedText = "One more year...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸˆ Proved everyone wrong! Still got it!")
					else
						state:ModifyStat("Health", -10)
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸˆ The game is too fast now. This might really be it...")
					end
				end,
			},
			{
				text = "ğŸ¤ Retire on my own terms",
				effects = { Happiness = 15 },
				feedText = "A warrior's farewell...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.nfl_retired = true
					state.Fame = math.min(100, (state.Fame or 0) + 15)
					
					local rings = state.Flags.super_bowl_rings or 0
					local mvps = state.Flags.nfl_mvp_count or 0
					local probowls = state.Flags.nfl_pro_bowl_count or 0
					
					state:ModifyStat("Happiness", 20)
					
					if rings >= 2 or mvps >= 1 then
						state.Flags.hall_of_fame_lock = true
						state:AddFeed(string.format("ğŸˆ LEGENDARY CAREER! %d rings, %dx MVP, %dx Pro Bowl! CANTON BOUND! First ballot!", rings, mvps, probowls))
					elseif rings >= 1 or probowls >= 5 then
						state.Flags.hall_of_fame_consideration = true
						state:AddFeed(string.format("ğŸˆ Great career! %d ring(s), %dx Pro Bowl. Hall of Fame consideration! Respect!", rings, probowls))
					else
						state:AddFeed(string.format("ğŸˆ Solid NFL career. %d Pro Bowls. Made it in the league longer than most!", probowls))
					end
					
					-- Remove job
					state.CurrentJob = nil
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- COLLEGE FOOTBALL SCHOLARSHIP
	-- CRITICAL FIX: Requires actual high school football experience
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "college_football_scholarship",
		title = "ğŸ“ College Football Scholarship!",
		emoji = "ğŸ“",
		text = "A D1 college football program wants YOU! Full ride scholarship plus NIL deals! Your path to the NFL!",
		category = "career_nfl",
		weight = 12,
		minAge = 17, maxAge = 18,
		baseChance = 0.30,
		oneTime = true,
		eligibility = function(state)
			if not isEligibleForNFL(state) then return false end
			if state.Flags and state.Flags.college_football then return false end -- Already have it
			-- MUST have played football in high school
			if not state.Flags then return false end
			return state.Flags.plays_football or state.Flags.varsity_athlete
		end,
		blockedByFlags = { college_football = true },
		
		choices = {
			{
				text = "ğŸˆ Let's GO! Time to ball out!",
				effects = { Happiness = 15, Health = 5 },
				feedText = "College football here I come!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.college_football = true
					state.Flags.college_athlete = true
					state.Flags.scholarship_athlete = true
					state.Education = "University (Athletic Scholarship)"
					
					-- NIL deal
					local nilMoney = math.random(50000, 500000)
					state.Money = (state.Money or 0) + nilMoney
					
					state:AddFeed(string.format("ğŸ“ Full scholarship + $%s NIL deal! On the path to the NFL!", nilMoney))
				end,
			},
			{
				text = "ğŸ“š Focus on academics instead",
				effects = { Smarts = 10 },
				feedText = "Brain over brawn...",
				onResolve = function(state)
					state:AddFeed("ğŸ“š Passed on football. Different dreams to chase!")
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- HEISMAN TROPHY (College)
	-- CRITICAL FIX: Much stricter - requires college football AND performance
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "college_heisman_race",
		title = "ğŸ† Heisman Trophy Race!",
		emoji = "ğŸ†",
		text = "You're a finalist for the HEISMAN TROPHY! The most prestigious award in college football!",
		category = "career_nfl",
		weight = 8, -- Lower weight - Heisman is rare
		minAge = 20, maxAge = 22,
		baseChance = 0.12, -- Lower base chance
		oneTime = true,
		eligibility = function(state)
			if not state.Flags then return false end
			if not state.Flags.college_football then return false end
			if state.Flags.heisman_winner then return false end -- Already won
			-- Must have some fame from college performance
			return (state.Fame or 0) >= 30
		end,
		blockedByFlags = { heisman_winner = true },
		
		choices = {
			{
				text = "This would mean everything to me",
				effects = {},
				feedText = "The envelope please...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					local bonus = 0
					
					if state.Flags.state_champion then bonus = bonus + 15 end
					if state.Flags.sports_legend then bonus = bonus + 20 end
					if (state.Health or 0) >= 80 then bonus = bonus + 10 end
					
					if roll + bonus >= 60 then
						state.Flags.heisman_winner = true
						state.Fame = math.min(100, (state.Fame or 0) + 40)
						state:ModifyStat("Happiness", 30)
						
						-- NIL boost
						local nilBonus = math.random(500000, 2000000)
						state.Money = (state.Money or 0) + nilBonus
						
						state:AddFeed(string.format("ğŸ† HEISMAN TROPHY WINNER!!! College football immortality! $%s NIL bonus!", nilBonus))
					else
						state.Flags.heisman_finalist = true
						state.Fame = math.min(100, (state.Fame or 0) + 15)
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ† Finished top 3 for the Heisman. Still incredible! NFL scouts are very interested!")
					end
				end,
			},
		},
	},
}

return NFLCareerEvents
