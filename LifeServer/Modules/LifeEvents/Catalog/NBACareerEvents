--[[
	NBA Professional Basketball Career Events
	AAA-quality events for basketball career progression
	
	Career Path:
	1. Youth basketball (school_athlete flag)
	2. High school varsity (plays_basketball flag) 
	3. College basketball / College scout interest
	4. NBA Draft
	5. NBA Rookie â†’ Starter â†’ Star â†’ Superstar â†’ Legend
	
	CRITICAL: Easier path if player made good early life choices!
]]

local NBACareerEvents = {}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- HELPER FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function hasBasketballBackground(state)
	if not state.Flags then return false end
	local flags = state.Flags
	return flags.plays_basketball or flags.school_athlete or flags.varsity_athlete
		or flags.basketball_prodigy or flags.college_basketball
end

local function isNBAPlayer(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("nba") or jobId:find("basketball") or 
		(jobId:find("pro") and state.Flags and state.Flags.nba_player)
end

local function isNBAStar(state)
	if not state.Flags then return false end
	return state.Flags.nba_allstar or state.Flags.nba_mvp or state.Flags.nba_champion
end

local function getDraftBonus(state)
	-- Players with good early choices get HUGE bonus to draft chances
	local bonus = 0
	if not state.Flags then return bonus end
	
	if state.Flags.plays_basketball then bonus = bonus + 15 end
	if state.Flags.varsity_athlete then bonus = bonus + 10 end
	if state.Flags.state_champion then bonus = bonus + 15 end
	if state.Flags.college_sports_interest then bonus = bonus + 10 end
	if state.Flags.scholarship_likely then bonus = bonus + 10 end
	if state.Flags.sports_legend then bonus = bonus + 20 end
	if state.Flags.basketball_prodigy then bonus = bonus + 25 end
	if state.Flags.college_basketball then bonus = bonus + 15 end
	if state.Flags.overcame_injury then bonus = bonus + 5 end
	if (state.Health or 0) >= 80 then bonus = bonus + 10 end
	
	-- Penalties for late starters
	if (state.Age or 18) > 22 and not hasBasketballBackground(state) then
		bonus = bonus - 40 -- Very hard to make NBA without background
	end
	
	return bonus
end

-- Block non-basketball players from NBA events
local function isEligibleForNBA(state)
	if not state.Flags then return false end
	
	-- Block royalty/mafia paths
	if state.Flags.is_royalty or state.Flags.in_mob then return false end
	if state.RoyalState and state.RoyalState.isRoyal then return false end
	if state.MobState and state.MobState.inMob then return false end
	
	return true
end

NBACareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- NBA DRAFT DECLARATION (Age 18-22)
	-- CRITICAL FIX: Requires ACTUAL basketball background, not just being healthy!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "nba_draft_declaration",
		title = "ğŸ€ Declare for NBA Draft?",
		emoji = "ğŸ€",
		text = "You've been getting attention from NBA scouts. Your agent thinks you could get drafted. This is a HUGE decision that will change your life forever!",
		question = "Do you declare for the NBA Draft?",
		category = "career_nba",
		weight = 15, -- Lower to reduce spam
		minAge = 19, maxAge = 22,
		baseChance = 0.25, -- Lower base chance
		oneTime = true,
		eligibility = function(state)
			if not isEligibleForNBA(state) then return false end
			if state.Flags and state.Flags.nba_declared then return false end
			if state.Flags and state.Flags.nba_player then return false end -- Already in NBA
			-- CRITICAL: MUST have basketball background - no random healthy people getting drafted!
			if not hasBasketballBackground(state) then return false end
			-- Must have college basketball OR varsity basketball
			local hasRealBackground = state.Flags and (
				state.Flags.college_basketball or 
				state.Flags.plays_basketball or
				state.Flags.basketball_prodigy
			)
			return hasRealBackground
		end,
		blockedByFlags = { in_prison = true, injured = true, nba_declared = true, nba_player = true },
		
		choices = {
			{
				text = "ğŸ€ YES! I'm ready for the NBA!",
				effects = { Happiness = 10 },
				feedText = "Declaring for the draft!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.nba_declared = true
					
					local roll = math.random(1, 100)
					local bonus = getDraftBonus(state)
					
					if roll + bonus >= 70 then
						-- First round pick!
						local pickNum = math.random(1, 14)
						local signBonus = math.random(5000000, 15000000)
						local salary = math.random(3000000, 8000000)
						
						state.Money = (state.Money or 0) + signBonus
						state.Fame = math.min(100, (state.Fame or 0) + 40)
						state:ModifyStat("Happiness", 30)
						state.Flags.nba_player = true
						state.Flags.nba_first_round = true
						state.Flags.nba_draft_pick = pickNum
						
						-- Set NBA job
						state.CurrentJob = {
							id = "nba_player",
							title = "NBA Player",
							salary = salary,
							category = "sports",
						}
						
						state:AddFeed(string.format("ğŸ€ DRAFTED #%d OVERALL! $%s signing bonus! $%s/year salary! YOU'RE IN THE NBA!!!", pickNum, signBonus, salary))
						
					elseif roll + bonus >= 45 then
						-- Second round pick
						local pickNum = math.random(31, 60)
						local signBonus = math.random(500000, 2000000)
						local salary = math.random(800000, 2000000)
						
						state.Money = (state.Money or 0) + signBonus
						state.Fame = math.min(100, (state.Fame or 0) + 20)
						state:ModifyStat("Happiness", 20)
						state.Flags.nba_player = true
						state.Flags.nba_second_round = true
						state.Flags.nba_draft_pick = pickNum
						
						state.CurrentJob = {
							id = "nba_player",
							title = "NBA Player",
							salary = salary,
							category = "sports",
						}
						
						state:AddFeed(string.format("ğŸ€ Second round pick #%d! Not lottery but you're IN THE NBA! Prove yourself!", pickNum))
						
					elseif roll + bonus >= 25 then
						-- Undrafted but signed
						state.Flags.nba_player = true
						state.Flags.nba_undrafted = true
						state:ModifyStat("Happiness", 10)
						state.Fame = math.min(100, (state.Fame or 0) + 10)
						
						state.CurrentJob = {
							id = "nba_player",
							title = "NBA Player (Undrafted)",
							salary = 500000,
							category = "sports",
						}
						
						state:AddFeed("ğŸ€ Went undrafted but signed a two-way contract! Long shot but you're in!")
					else
						-- Not drafted
						state:ModifyStat("Happiness", -20)
						state.Flags.nba_dream_crushed = true
						state:AddFeed("ğŸ€ Didn't get drafted. The NBA dream is over... for now. Maybe overseas?")
					end
				end,
			},
			{
				text = "ğŸ“š Stay in college another year",
				effects = { Smarts = 5, Happiness = 3 },
				feedText = "More development time...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.stayed_college_basketball = true
					state:AddFeed("ğŸ“š Staying in college to develop your game more. Smart move!")
				end,
			},
			{
				text = "ğŸŒ Try overseas first",
				effects = { Happiness = 5 },
				feedText = "International basketball...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.overseas_basketball = true
					state.CurrentJob = {
						id = "overseas_basketball",
						title = "International Basketball Player",
						salary = math.random(200000, 800000),
						category = "sports",
					}
					state:AddFeed("ğŸŒ Signed with an overseas team! Building experience for an NBA shot later!")
				end,
			},
		},
	},
	
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NBA ALL-STAR SELECTION
-- CRITICAL FIX: Only for ESTABLISHED NBA players with high performance!
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
	id = "nba_allstar_selection",
	title = "â­ NBA All-Star Voting Results",
	emoji = "â­",
	text = "The NBA All-Star voting results are in! Your performance this season is being evaluated...",
	category = "career_nba",
	weight = 12, -- Lower weight to reduce spam
	minAge = 21, maxAge = 38,
	baseChance = 0.15, -- MUCH lower base chance
	cooldown = 2, -- Can only happen every 2 years
	-- CRITICAL: Strict eligibility - must be ACTIVE NBA player with years in league
	eligibility = function(state)
		if not isNBAPlayer(state) then return false end
		if not state.Flags then return false end
		-- Must have been in NBA for at least 2 years
		if not state.Flags.nba_player then return false end
		-- Block if already got this event recently (spam prevention)
		if state.Flags._last_allstar_check and (state.Age or 0) - state.Flags._last_allstar_check < 2 then
			return false
		end
		-- Must have high fame OR first round pick to even be considered
		local hasCredentials = state.Flags.nba_first_round or (state.Fame or 0) >= 50
		return hasCredentials
	end,
	blockedByFlags = { injured = true, nba_retired = true },
	
	choices = {
		{
			text = "Check the results...",
			effects = {},
			feedText = "Checking All-Star results...",
			onResolve = function(state)
				state.Flags = state.Flags or {}
				state.Flags._last_allstar_check = state.Age or 0
				
				-- Roll to see if actually selected (not guaranteed!)
				local roll = math.random(1, 100)
				local bonus = 0
				if state.Flags.nba_first_round then bonus = bonus + 20 end
				if (state.Fame or 0) >= 70 then bonus = bonus + 15 end
				if state.Flags.nba_allstar then bonus = bonus + 25 end -- Repeat All-Stars easier
				
				if roll + bonus >= 60 then
					-- Made it!
					state.Flags.nba_allstar = true
					state.Flags.nba_allstar_count = (state.Flags.nba_allstar_count or 0) + 1
					state.Fame = math.min(100, (state.Fame or 0) + 20)
					
					local bonusMoney = math.random(100000, 400000)
					state.Money = (state.Money or 0) + bonusMoney
					
					local count = state.Flags.nba_allstar_count
					if count >= 10 then
						state.Flags.nba_legend = true
						state:AddFeed(string.format("â­ %dx ALL-STAR! You're officially a LEGEND! $%s bonus!", count, bonusMoney))
					else
						state:AddFeed(string.format("â­ ALL-STAR SELECTED! Selection #%d! $%s bonus!", count, bonusMoney))
					end
					state:ModifyStat("Happiness", 25)
				else
					state:ModifyStat("Happiness", -5)
					state:AddFeed("â­ Didn't make the All-Star team this year. Keep grinding!")
				end
			end,
		},
	},
},
	
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NBA CHAMPIONSHIP RUN
-- CRITICAL FIX: Much stricter - only established players on good teams
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
	id = "nba_championship_finals",
	title = "ğŸ† NBA FINALS!",
	emoji = "ğŸ†",
	text = "YOUR TEAM MADE THE NBA FINALS! This is what you've worked your whole life for. Championship or bust!",
	category = "career_nba",
	weight = 10, -- Lower weight
	minAge = 21, maxAge = 40,
	baseChance = 0.12, -- Much lower - Finals are rare!
	cooldown = 3, -- Can only happen every 3 years minimum
	oneTime = false, -- Can happen multiple times but with cooldown
	-- CRITICAL: Strict eligibility
	eligibility = function(state)
		if not isNBAPlayer(state) then return false end
		if not state.Flags or not state.Flags.nba_player then return false end
		-- Must have played at least 2 years in NBA
		if state.Flags.nba_draft_pick and (state.Age or 0) < 22 then return false end
		return true
	end,
	blockedByFlags = { injured = true, nba_retired = true },
		
		choices = {
			{
				text = "ğŸ”¥ I was BORN for this moment!",
				effects = { Health = -5 },
				feedText = "Everything on the line!",
				triggerMinigame = "mash",
				minigameOptions = { difficulty = "hard" },
				onResolve = function(state, minigameResult)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					local bonus = (minigameResult and minigameResult.success) and 30 or 0
					
					if state.Flags.nba_allstar then bonus = bonus + 15 end
					
					if roll + bonus >= 50 then
						-- NBA CHAMPION!
						local prize = math.random(2000000, 10000000)
						state.Money = (state.Money or 0) + prize
						state.Fame = 100
						state:ModifyStat("Happiness", 40)
						state.Flags.nba_champion = true
						state.Flags.nba_rings = (state.Flags.nba_rings or 0) + 1
						
						local rings = state.Flags.nba_rings
						if rings >= 3 then
							state.Flags.nba_dynasty = true
							state:AddFeed(string.format("ğŸ† %dx NBA CHAMPION!!! DYNASTY!!! $%s bonus! GOAT STATUS!!!", rings, prize))
						else
							state:AddFeed(string.format("ğŸ† NBA CHAMPION!!! Ring #%d! $%s bonus! PARADE THROUGH THE CITY!!!", rings, prize))
						end
					else
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ† Lost in the Finals. Heartbreaking. So close to glory...")
					end
				end,
			},
			{
				text = "Just play my game, stay calm",
				effects = { Happiness = 5 },
				feedText = "Trust the process...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					
					if roll <= 40 then
						local prize = math.random(1000000, 5000000)
						state.Money = (state.Money or 0) + prize
						state.Fame = math.min(100, (state.Fame or 0) + 30)
						state.Flags.nba_champion = true
						state.Flags.nba_rings = (state.Flags.nba_rings or 0) + 1
						state:ModifyStat("Happiness", 30)
						state:AddFeed(string.format("ğŸ† NBA CHAMPION! Your calm leadership won the day! $%s bonus!", prize))
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ† Close series but came up short. Next year!")
					end
				end,
			},
		},
	},
	
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NBA MVP AWARD
-- CRITICAL FIX: MVP is VERY rare - only for elite players!
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
	id = "nba_mvp_race",
	title = "ğŸ… NBA MVP Race!",
	emoji = "ğŸ…",
	text = "You're in the running for NBA MVP! Your stats this season have been INCREDIBLE. The voting is close!",
	category = "career_nba",
	weight = 8, -- Very low weight - MVP race is rare
	minAge = 23, maxAge = 35,
	baseChance = 0.08, -- Very low - MVP candidates are rare
	cooldown = 2,
	-- CRITICAL: Must be All-Star level OR first round pick with high fame
	eligibility = function(state)
		if not isNBAPlayer(state) then return false end
		if not state.Flags or not state.Flags.nba_player then return false end
		-- Must have either: All-Star selection OR (first round pick + high fame)
		local hasAllStar = state.Flags.nba_allstar
		local hasEliteCredentials = state.Flags.nba_first_round and (state.Fame or 0) >= 70
		return hasAllStar or hasEliteCredentials
	end,
	blockedByFlags = { injured = true, nba_retired = true },
		
		choices = {
			{
				text = "My numbers speak for themselves",
				effects = {},
				feedText = "Awaiting the results...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					local roll = math.random(1, 100)
					local bonus = 0
					
					if state.Flags.nba_allstar then bonus = bonus + 20 end
					if state.Flags.nba_first_round then bonus = bonus + 10 end
					if (state.Fame or 0) >= 80 then bonus = bonus + 15 end
					
					if roll + bonus >= 65 then
						state.Flags.nba_mvp = true
						state.Flags.nba_mvp_count = (state.Flags.nba_mvp_count or 0) + 1
						state.Fame = 100
						state:ModifyStat("Happiness", 35)
						
						local mvpBonus = math.random(5000000, 15000000)
						state.Money = (state.Money or 0) + mvpBonus
						
						local count = state.Flags.nba_mvp_count
						if count >= 2 then
							state:AddFeed(string.format("ğŸ… %dx NBA MVP!!! You're the BEST PLAYER IN THE WORLD! $%s bonus!", count, mvpBonus))
						else
							state:AddFeed(string.format("ğŸ… NBA MVP!!! The most valuable player in basketball! $%s bonus!", mvpBonus))
						end
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ… Finished top 3 in MVP voting. Not quite there but elite company!")
					end
				end,
			},
		},
	},
	
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NBA MAX CONTRACT
-- CRITICAL FIX: Only for proven stars
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
	id = "nba_max_contract_offer",
	title = "ğŸ’° Contract Negotiations",
	emoji = "ğŸ’°",
	text = "Your contract is up for renewal. Teams are evaluating your performance...",
	category = "career_nba",
	weight = 12,
	minAge = 24, maxAge = 34,
	baseChance = 0.20,
	cooldown = 4,
	-- CRITICAL: Must be proven NBA player with credentials
	eligibility = function(state)
		if not isNBAPlayer(state) then return false end
		if not state.Flags or not state.Flags.nba_player then return false end
		-- Must have at least 3 years in NBA
		return true
	end,
	blockedByFlags = { nba_retired = true, nba_max_contract = true },
		
	choices = {
		{
			text = "ğŸ’° Demand the max I deserve!",
			effects = {},
			feedText = "Negotiating hard...",
			onResolve = function(state)
				state.Flags = state.Flags or {}
				-- Roll to see what contract you actually get based on performance
				local roll = math.random(1, 100)
				local bonus = 0
				if state.Flags.nba_allstar then bonus = bonus + 30 end
				if state.Flags.nba_mvp then bonus = bonus + 40 end
				if state.Flags.nba_first_round then bonus = bonus + 15 end
				if state.Flags.nba_champion then bonus = bonus + 20 end
				
				local years = math.random(3, 5)
				local totalValue, perYear
				
				if roll + bonus >= 80 then
					-- MAX CONTRACT!
					totalValue = math.random(150000000, 250000000)
					perYear = math.floor(totalValue / years)
					state.Flags.nba_max_contract = true
					state:AddFeed(string.format("ğŸ’° MAX CONTRACT! $%s over %d years! SUPERSTAR MONEY!", totalValue, years))
					state:ModifyStat("Happiness", 30)
				elseif roll + bonus >= 50 then
					-- Good contract but not max
					totalValue = math.random(60000000, 120000000)
					perYear = math.floor(totalValue / years)
					state:AddFeed(string.format("ğŸ’° Solid contract! $%s over %d years. Not max but great!", totalValue, years))
					state:ModifyStat("Happiness", 15)
				else
					-- Average contract
					totalValue = math.random(20000000, 50000000)
					perYear = math.floor(totalValue / years)
					state:AddFeed(string.format("ğŸ’° Signed for $%s over %d years. Could be better, could be worse.", totalValue, years))
					state:ModifyStat("Happiness", 5)
				end
				
				state.Money = (state.Money or 0) + perYear
				if state.CurrentJob then
					state.CurrentJob.salary = perYear
				end
			end,
		},
		{
			text = "Take team-friendly deal for championships",
			effects = { Happiness = 5 },
			feedText = "Prioritizing winning...",
			onResolve = function(state)
				local salary = math.random(8000000, 20000000)
				state.Money = (state.Money or 0) + salary
				state.Flags = state.Flags or {}
				state.Flags.team_player = true
				
				if state.CurrentJob then
					state.CurrentJob.salary = salary
				end
				
				state:AddFeed(string.format("ğŸ’° Team-friendly $%s/year deal. Teammates love you!", salary))
			end,
		},
	},
},
	
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NBA RETIREMENT
-- CRITICAL FIX: Only for active NBA players
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
	id = "nba_retirement_decision",
	title = "ğŸ€ Time to Retire?",
	emoji = "ğŸ€",
	text = "Your body isn't what it used to be. The game is getting harder. Maybe it's time to hang it up...",
	category = "career_nba",
	weight = 15,
	minAge = 34, maxAge = 42,
	baseChance = 0.35,
	cooldown = 2,
	eligibility = function(state)
		if not isNBAPlayer(state) then return false end
		if not state.Flags or not state.Flags.nba_player then return false end
		if state.Flags.nba_retired then return false end
		return true
	end,
	blockedByFlags = { nba_retired = true },
		
		choices = {
			{
				text = "One more year - I'm not done yet",
				effects = { Health = -5 },
				feedText = "Pushing through...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ€ Still got it! Proved the doubters wrong for another year!")
					else
						state:ModifyStat("Health", -10)
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ€ The body is breaking down. This might really be the end...")
					end
				end,
			},
			{
				text = "ğŸ¤ Retire with dignity",
				effects = { Happiness = 15 },
				feedText = "A legendary career ends...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.nba_retired = true
					state.Fame = math.min(100, (state.Fame or 0) + 20)
					
					local rings = state.Flags.nba_rings or 0
					local mvps = state.Flags.nba_mvp_count or 0
					local allstars = state.Flags.nba_allstar_count or 0
					
					state:ModifyStat("Happiness", 20)
					
					if rings >= 3 or mvps >= 2 then
						state.Flags.hall_of_fame_lock = true
						state:AddFeed(string.format("ğŸ€ LEGENDARY CAREER! %d rings, %dx MVP, %dx All-Star! HALL OF FAME LOCK! Jersey retired!", rings, mvps, allstars))
					elseif rings >= 1 or allstars >= 3 then
						state:AddFeed(string.format("ğŸ€ Great career! %d ring(s), %dx All-Star. Standing ovation. Respect!", rings, allstars))
					else
						state:AddFeed("ğŸ€ Solid NBA career. Not a star but you made it! That's more than 99.9% of players!")
					end
					
					-- Remove job
					state.CurrentJob = nil
				end,
			},
		},
	},
	
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- COLLEGE BASKETBALL OFFER (for those who didn't go straight to NBA)
-- CRITICAL FIX: Requires ACTUAL varsity basketball experience
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
	id = "college_basketball_scholarship",
	title = "ğŸ“ College Basketball Scholarship!",
	emoji = "ğŸ“",
	text = "A college basketball program is offering you a FULL SCHOLARSHIP! Free education AND a chance to develop for the NBA!",
	category = "career_nba",
	weight = 12,
	minAge = 17, maxAge = 18,
	baseChance = 0.30,
	oneTime = true,
	eligibility = function(state)
		if not isEligibleForNBA(state) then return false end
		if state.Flags and state.Flags.college_basketball then return false end -- Already have it
		-- MUST have played basketball in high school
		if not state.Flags then return false end
		return state.Flags.plays_basketball or state.Flags.varsity_athlete
	end,
	blockedByFlags = { college_basketball = true },
		
		choices = {
			{
				text = "ğŸ€ Accept! Ball is life!",
				effects = { Happiness = 15, Health = 5 },
				feedText = "College basketball here I come!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.college_basketball = true
					state.Flags.college_athlete = true
					state.Flags.scholarship_athlete = true
					state.Education = "University (Athletic Scholarship)"
					state:AddFeed("ğŸ“ Full scholarship to play college basketball! Path to the NBA!")
				end,
			},
			{
				text = "ğŸ“š Focus on academics instead",
				effects = { Smarts = 10 },
				feedText = "Education first...",
				onResolve = function(state)
					state:AddFeed("ğŸ“š Passed on basketball to focus on studies. Different path!")
				end,
			},
		},
	},
}

return NBACareerEvents
