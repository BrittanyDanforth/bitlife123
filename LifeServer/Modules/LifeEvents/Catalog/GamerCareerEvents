--[[
	Pro Gamer / Esports Career Events
	AAA-quality events with random BitLife-style outcomes
	User CANNOT control outcomes - everything is randomized
	
	Careers covered:
	- Pro Gamer
	- Esports Champion
	- Streamer
	- Gaming Legend
	- Esports Team Owner
	
	CRITICAL FIX #RVS-10: Premium path blocking for royalty/mafia players
]]

local GamerCareerEvents = {}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX #RVS-GAMER-1: Premium path blocking
-- Gamer/esports events should NOT fire for royalty or mafia players
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function isBlockedByPremiumPath(state)
	if not state.Flags then return false end
	local flags = state.Flags
	
	-- If player is already a gamer/streamer, allow
	if flags.gaming_streamer or flags.pro_gamer or flags.esports_player then
		return false
	end
	
	-- Block if player chose royalty path
	if flags.primary_wish_type == "royalty" then return true end
	if flags.is_royalty or flags.royal_birth or flags.dating_royalty then return true end
	if state.RoyalState and state.RoyalState.isRoyal then return true end
	
	-- Block if player chose mafia path
	if flags.primary_wish_type == "mafia" then return true end
	if flags.in_mob then return true end
	if state.MobState and state.MobState.inMob then return true end
	
	return false
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX #29: Enhanced helper functions for gaming careers
-- CRITICAL FIX #GAMER-2: Made eligibility MORE permissive so events actually trigger!
-- User complaint: "GAMER CAREER DOESN'T EVEN CALL SOMETIMES"
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function hasGamingJob(state)
	-- CRITICAL FIX #RVS-GAMER-2: Check premium path blocking first
	if isBlockedByPremiumPath(state) then return false end
	
	-- CRITICAL FIX #GAMER-3: Also check for gaming FLAGS even without a formal job!
	-- This lets players who are pursuing gaming get events before landing a job
	-- CRITICAL FIX: Added childhood passion flags for personalization!
	if state.Flags then
		local flags = state.Flags
		if flags.pro_gamer or flags.esports_player or flags.gaming_streamer or
		   flags.signed_to_org or flags.competitive_player or flags.tournament_champion or
		   flags.pursuing_esports or flags.gamer_career or
		   -- NEW: Childhood passion flags that lead to gaming career!
		   flags.passionate_gamer or flags.gaming_interest or flags.esports_potential or
		   flags.future_streamer or flags.likes_gaming then
			return true
		end
	end
	
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local jobCat = (state.CurrentJob.category or ""):lower()
	local jobName = (state.CurrentJob.name or ""):lower()
	
	-- CRITICAL FIX #30: Exclude non-gaming content creators
	if jobId:find("youtuber") and not jobId:find("gam") and not jobName:find("gam") then
		return false
	end
	if jobId:find("influencer") and not jobId:find("gam") and not jobName:find("gam") then
		return false
	end
	
	-- CRITICAL FIX #GAMER-4: Also check job name, not just id and category
	return jobId:find("gamer") or jobId:find("esports") or jobId:find("streamer") or 
		   jobId:find("gaming") or jobCat == "gaming" or jobCat == "esports" or
		   jobName:find("gamer") or jobName:find("esports") or jobName:find("gaming")
end

local function hasProGamerJob(state)
	-- CRITICAL FIX: Also check flags for pro status
	if state.Flags then
		if state.Flags.signed_to_org or state.Flags.pro_gamer or 
		   state.Flags.esports_champion or state.Flags.tournament_champion then
			return true
		end
	end
	
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local jobName = (state.CurrentJob.name or ""):lower()
	return jobId:find("pro_gamer") or jobId:find("esports") or jobId:find("champion") or
		   jobName:find("pro") or jobName:find("professional")
end

-- CRITICAL FIX #31: Check if player is a streamer specifically
local function isGamingStreamer(state)
	-- Check flags first
	if state.Flags and state.Flags.gaming_streamer then
		return true
	end
	
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local jobName = (state.CurrentJob.name or ""):lower()
	return (jobId:find("streamer") and (jobId:find("gam") or jobName:find("gam"))) or
		   (jobName:find("streamer") and jobName:find("gam"))
end

-- CRITICAL FIX #32: Check if player is in competitive gaming vs casual streaming
local function isCompetitiveGamer(state)
	-- Check flags first for competitive status
	if state.Flags and state.Flags.competitive_player then
		return true
	end
	return hasProGamerJob(state)
end

-- CRITICAL FIX #33: Check gaming career level
local function getGamingLevel(state)
	if not hasGamingJob(state) then return "none" end
	if state.Flags and state.Flags.esports_legend then return "legend" end
	if state.Flags and state.Flags.tournament_champion then return "champion" end
	if hasProGamerJob(state) then return "pro" end
	if isGamingStreamer(state) then return "streamer" end
	return "amateur"
end

-- CRITICAL FIX #GAMER-5: Helper to check if any gaming condition is met
local function hasAnyGamingActivity(state)
	return hasGamingJob(state) or hasProGamerJob(state) or isGamingStreamer(state)
end

GamerCareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PRO GAMER / ESPORTS EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "gamer_major_tournament",
		title = "ğŸ† Major Tournament Finals!",
		emoji = "ğŸ†",
		text = "Your team made it to the grand finals of a major esports tournament! The prize pool is $1,000,000 and millions are watching live!",
		category = "career_gaming",
		weight = 18,
		minAge = 16, maxAge = 35,
		baseChance = 0.5,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasProGamerJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Stay calm and trust your training",
				effects = {},
				feedText = "Deep breaths. You've done this before...",
				triggerMinigame = "qte",
				minigameOptions = { difficulty = "hard" },
				onResolve = function(state, minigameResult)
					local roll = math.random(1, 100)
					local minigameBonus = (minigameResult and minigameResult.success) and 20 or 0
					
					if roll + minigameBonus >= 60 then
						local prize = math.random(200000, 500000)
						state.Money = (state.Money or 0) + prize
						state:ModifyStat("Happiness", 25)
						state.Flags = state.Flags or {}
						state.Flags.tournament_champion = true
						state.Fame = math.min(100, (state.Fame or 0) + 50) -- CRITICAL FIX: Cap fame at 100
						state:AddFeed(string.format("ğŸ† WORLD CHAMPIONS! $%s prize money! Your name goes down in esports history!", prize))
					elseif roll + minigameBonus >= 30 then
						local prize = math.random(50000, 100000)
						state.Money = (state.Money or 0) + prize
						state:ModifyStat("Happiness", 8)
						state:AddFeed(string.format("ğŸ† Second place isn't bad! $%s consolation prize.", prize))
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ† Choked in the finals. Devastating loss. Internet won't let you forget.")
					end
				end,
			},
			{
				text = "Go aggressive - all or nothing!",
				effects = {},
				feedText = "Time to make plays!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 35 then
						local prize = math.random(300000, 600000)
						state.Money = (state.Money or 0) + prize
						state:ModifyStat("Happiness", 30)
						state.Fame = math.min(100, (state.Fame or 0) + 60) -- CRITICAL FIX: Cap fame at 100
						state.Flags = state.Flags or {}
						state.Flags.esports_legend = true
						state:AddFeed(string.format("ğŸ† LEGENDARY PERFORMANCE! $%s! That final play will be clipped forever!", prize))
					else
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ† Aggressive plays backfired. You threw the finals. Team is furious.")
					end
				end,
			},
		},
	},
	
	{
		id = "gamer_stream_blowup",
		title = "Stream Going Viral!",
		emoji = "ğŸ“º",
		text = "One of your stream clips went mega viral! Millions of views and your follower count is exploding!",
		category = "career_gaming",
		weight = 15,
		minAge = 14, maxAge = 40,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasGamingJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Stream non-stop to capitalize!",
				effects = { Health = -5 },
				feedText = "24-hour stream incoming!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						local subs = math.random(5000, 50000)
						state.Money = (state.Money or 0) + (subs * 3)
						state:ModifyStat("Happiness", 15)
						state.Fame = math.min(100, (state.Fame or 0) + 20) -- CRITICAL FIX: Cap fame at 100
						state.Flags = state.Flags or {}
						state.Flags.viral_streamer = true
						state:AddFeed(string.format("ğŸ“º Gained %d new subscribers! The algorithm loves you!", subs))
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ“º Burned out trying to keep up. Lost momentum.")
					end
				end,
			},
			{
				text = "Post more clips and ride the wave",
				effects = { Happiness = 5 },
				feedText = "Content machine mode activated...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						local subs = math.random(2000, 15000)
						state.Money = (state.Money or 0) + (subs * 3)
						state:ModifyStat("Happiness", 10)
						state.Fame = math.min(100, (state.Fame or 0) + 10) -- CRITICAL FIX: Cap fame at 100
						state:AddFeed(string.format("ğŸ“º Steady growth! +%d new followers from the clips!", subs))
					else
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ“º Viral moment passed. Back to normal growth.")
					end
				end,
			},
		},
	},
	
	{
		id = "gamer_sponsorship_deal",
		title = "Big Sponsorship Offer!",
		emoji = "ğŸ’°",
		text = "A major gaming peripheral company wants to sponsor you! They're offering money and free gear.",
		category = "career_gaming",
		weight = 14,
		minAge = 16, maxAge = 40,
		baseChance = 0.5,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasGamingJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Sign the deal immediately!",
				effects = { Happiness = 10 },
				feedText = "Free stuff AND money!",
				onResolve = function(state)
					local deal = math.random(10000, 50000)
					state.Money = (state.Money or 0) + deal
					state.Flags = state.Flags or {}
					state.Flags.sponsored_gamer = true
					state:AddFeed(string.format("ğŸ’° Sponsorship secured! $%s/year plus free gear!", deal))
				end,
			},
			{
				text = "Negotiate for a better deal",
				effects = {},
				feedText = "Know your worth...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						local deal = math.random(50000, 150000)
						state.Money = (state.Money or 0) + deal
						state:ModifyStat("Happiness", 15)
						state:AddFeed(string.format("ğŸ’° They REALLY want you! $%s/year deal!", deal))
					elseif roll <= 75 then
						local deal = math.random(15000, 40000)
						state.Money = (state.Money or 0) + deal
						state:ModifyStat("Happiness", 8)
						state:AddFeed(string.format("ğŸ’° Got a bit more. $%s/year.", deal))
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ’° They went with a different creator. Overplayed your hand.")
					end
				end,
			},
			{
				text = "Decline - don't want to sell out",
				effects = { Happiness = 3 },
				setFlags = { authentic_creator = true },
				feedText = "Keeping it real with the community.",
			},
		},
	},
	
	{
		id = "gamer_teammate_drama",
		title = "Team Drama Explodes",
		emoji = "ğŸ˜¤",
		text = "Your teammate is publicly accusing you of intentionally throwing matches! The gaming community is going wild!",
		category = "career_gaming",
		weight = 12,
		minAge = 16, maxAge = 35,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasProGamerJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Post evidence proving innocence",
				effects = { Smarts = 2 },
				feedText = "Time to expose the lies...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 12)
						state.Fame = math.min(100, (state.Fame or 0) + 10) -- CRITICAL FIX: Cap fame at 100
						state:AddFeed("ğŸ˜¤ Evidence was undeniable! Community sided with you! Teammate kicked from team!")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ˜¤ Drama just made it worse. Nobody knows what to believe anymore.")
					end
				end,
			},
			{
				text = "Stay silent - don't engage",
				effects = { Happiness = -3 },
				feedText = "Not feeding the trolls...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ˜¤ Drama died down. People moved on to the next thing.")
					else
						state:ModifyStat("Happiness", -10)
						state.Fame = math.max(0, (state.Fame or 0) - 15) -- CRITICAL FIX: Prevent negative Fame
						state:AddFeed("ğŸ˜¤ Silence was seen as guilt. Lost followers and sponsors.")
					end
				end,
			},
			{
				text = "Fire back with personal attacks",
				effects = {},
				feedText = "They started it!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
					state:ModifyStat("Happiness", 8)
					state.Fame = math.min(100, (state.Fame or 0) + 5) -- CRITICAL FIX: Cap fame at 100
					state:AddFeed("ğŸ˜¤ Your clap-back went viral! Entertainment value saved your image!")
					else
						state:ModifyStat("Happiness", -15)
						state.Fame = math.max(0, (state.Fame or 0) - 20) -- CRITICAL FIX: Prevent negative Fame
						state.Flags = state.Flags or {}
						state.Flags.toxic_player_rep = true
						state:AddFeed("ğŸ˜¤ Both look terrible now. Sponsors dropping you both.")
					end
				end,
			},
		},
	},
	
	{
		id = "gamer_burnout",
		title = "Gaming Burnout",
		emoji = "ğŸ˜´",
		text = "You've been grinding so hard that gaming doesn't feel fun anymore. Everything is content and practice - the joy is gone.",
		category = "career_gaming",
		weight = 15,
		minAge = 18, maxAge = 35,
		baseChance = 0.5,
		cooldown = 4,
		requiresJob = true,
		eligibility = hasGamingJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Take a break from streaming",
				effects = { Health = 5, Happiness = 8 },
				feedText = "Mental health matters...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ˜´ Needed that break! Came back refreshed and viewers understood!")
					else
						state:ModifyStat("Happiness", -5)
						state.Fame = math.max(0, (state.Fame or 0) - 10) -- CRITICAL FIX: Prevent negative Fame
						state:AddFeed("ğŸ˜´ Lost momentum during break. Algorithm forgot about you.")
					end
				end,
			},
			{
				text = "Push through - can't lose momentum",
				effects = { Health = -8, Happiness = -5 },
				feedText = "The grind never stops...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 35 then
						state.Money = (state.Money or 0) + math.random(5000, 15000)
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ˜´ Powered through! Somehow still performing well!")
					else
						state:ModifyStat("Happiness", -15)
						state:ModifyStat("Health", -10)
						state.Flags = state.Flags or {}
						state.Flags.severe_burnout = true
						state:AddFeed("ğŸ˜´ Complete breakdown on stream. Forced to take extended leave.")
					end
				end,
			},
		},
	},
	
	{
		id = "gamer_org_signing",
		title = "Pro Org Wants to Sign You!",
		emoji = "ğŸ“",
		text = "A top esports organization wants to sign you to their roster! This is the big leagues!",
		category = "career_gaming",
		weight = 12,
		minAge = 16, maxAge = 30,
		baseChance = 0.4,
		cooldown = 4,
		oneTime = true,
		requiresJob = true,
		eligibility = hasGamingJob,
		blockedByFlags = { in_prison = true, signed_to_org = true },
		
		choices = {
			{
				text = "Sign with the org!",
				effects = { Happiness = 15 },
				feedText = "Welcome to the team!",
				onResolve = function(state)
					local salary = math.random(50000, 200000)
					state.Money = (state.Money or 0) + salary
					state.Flags = state.Flags or {}
					state.Flags.signed_to_org = true
					state.Flags.pro_player = true
					state.Fame = math.min(100, (state.Fame or 0) + 25) -- CRITICAL FIX: Cap fame at 100
					state:AddFeed(string.format("ğŸ“ Signed! $%s/year salary plus housing and benefits!", salary))
				end,
			},
			{
				text = "Stay independent",
				effects = { Happiness = 5 },
				setFlags = { independent_player = true },
				feedText = "Freedom is worth more than money.",
			},
		},
	},
	
	{
		id = "gamer_retire_coaching",
		title = "Transition to Coaching",
		emoji = "ğŸ“",
		text = "Your reflexes aren't what they used to be. A team has offered you a coaching position.",
		category = "career_gaming",
		weight = 10,
		minAge = 28, maxAge = 45,
		baseChance = 0.45,
		cooldown = 5,
		requiresJob = true,
		eligibility = hasProGamerJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Accept the coaching role",
				effects = { Happiness = 8, Smarts = 5 },
				setFlags = { esports_coach = true },
				feedText = "New chapter begins. Teaching the next generation.",
				onResolve = function(state)
					state.Money = (state.Money or 0) + math.random(40000, 100000)
					state:AddFeed("ğŸ“ Coaching career begins! Your game knowledge is invaluable!")
				end,
			},
			{
				text = "Keep competing - not done yet!",
				effects = { Happiness = 5, Health = -3 },
				feedText = "Still got it!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ“ Proved the doubters wrong! Still competing at the top!")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ“ Performance declining. Maybe should have taken that offer...")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #GAMER-6: ADDED NEW GAMER EVENTS FOR MORE VARIETY!
	-- User complaint: "GAMER CAREER DOESN'T EVEN CALL SOMETIMES"
	-- Adding more events increases chances of something triggering
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	
	{
		id = "gamer_hardware_upgrade",
		title = "ğŸ–¥ï¸ New Gaming Setup!",
		emoji = "ğŸ–¥ï¸",
		text = "Your current setup is holding you back. Time to upgrade! Better hardware could improve your performance.",
		category = "career_gaming",
		weight = 14,
		minAge = 14, maxAge = 40,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		eligibility = hasAnyGamingActivity,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Full RGB beast mode setup ($5,000)",
				effects = { Happiness = 15 },
				feedText = "Time to build the dream machine!",
				onResolve = function(state)
					if (state.Money or 0) >= 5000 then
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 5000)
						state.Flags = state.Flags or {}
						state.Flags.elite_setup = true
						state:AddFeed("ğŸ–¥ï¸ BEAST MODE PC! RTX 4090, 4K 240Hz monitor, everything RGB! Game at maximum settings!")
					else
						state:AddFeed("ğŸ–¥ï¸ Can't afford the dream setup right now. Maybe next time.")
					end
				end,
			},
			{
				text = "Smart upgrades only ($1,500)",
				effects = { Happiness = 10 },
				feedText = "Targeting the bottlenecks...",
				onResolve = function(state)
					if (state.Money or 0) >= 1500 then
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 1500)
						state:AddFeed("ğŸ–¥ï¸ Smart upgrades! New GPU and monitor. Performance noticeably better!")
					else
						state:AddFeed("ğŸ–¥ï¸ Can't afford upgrades right now. The grind continues on old hardware.")
					end
				end,
			},
			{
				text = "Keep the current setup",
				effects = { Happiness = -3 },
				feedText = "If it ain't broke...",
			},
		},
	},
	
	{
		id = "gamer_online_toxicity",
		title = "ğŸ”¥ Toxic Chat Encounter",
		emoji = "ğŸ”¥",
		text = "Someone in your match is being incredibly toxic. Slurs, threats, the works. Your whole team is tilted.",
		category = "career_gaming",
		weight = 12,
		minAge = 14, maxAge = 35,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		eligibility = hasAnyGamingActivity,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Mute and focus on winning",
				effects = { Happiness = 3, Smarts = 3 },
				feedText = "Mental fortitude activated.",
				onResolve = function(state)
					if math.random(1, 100) <= 60 then
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ”¥ Muted the troll, carried the game. Best revenge is winning!")
					else
						state:AddFeed("ğŸ”¥ Stayed focused but still lost. At least you kept your dignity.")
					end
				end,
			},
			{
				text = "Fire back with a devastating clapback",
				effects = {},
				feedText = "Violence is not the answer... but words can be.",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
					state:ModifyStat("Happiness", 12)
					state.Fame = math.min(100, (state.Fame or 0) + 5) -- CRITICAL FIX: Cap fame at 100
					state:AddFeed("ğŸ”¥ Your clapback went VIRAL! Clip is everywhere! W!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ”¥ Got into a flame war. Nobody won but it felt good.")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ”¥ Got reported. Temporary chat restriction. Worth it?")
					end
				end,
			},
			{
				text = "Report and move on",
				effects = { Happiness = 5, Smarts = 2 },
				feedText = "Let the system handle it.",
			},
		},
	},
	
	{
		id = "gamer_lan_party",
		title = "ğŸ® LAN Party Invite!",
		emoji = "ğŸ®",
		text = "Your gaming friends want to have an old-school LAN party! All night gaming, pizza, energy drinks. Classic vibes.",
		category = "career_gaming",
		weight = 12,
		minAge = 14, maxAge = 35,
		baseChance = 0.45,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		eligibility = hasAnyGamingActivity,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Host it at your place",
				effects = { Happiness = 18, Health = -3 },
				feedText = "Let's GOOOO!",
				onResolve = function(state)
					state.Money = math.max(0, (state.Money or 0) - math.random(100, 300))
					state.Flags = state.Flags or {}
					state.Flags.gaming_social = true
					state:AddFeed("ğŸ® EPIC LAN PARTY! Stayed up until 6AM. Made memories that'll last forever!")
				end,
			},
			{
				text = "Attend but leave early",
				effects = { Happiness = 10 },
				feedText = "Responsible gaming.",
				onResolve = function(state)
					state:AddFeed("ğŸ® Had a great time but left at a reasonable hour. Balance!")
				end,
			},
			{
				text = "Skip it - need to practice",
				effects = { Happiness = -5, Smarts = 3 },
				feedText = "The grind never stops.",
			},
		},
	},
	
	{
		id = "gamer_content_opportunity",
		title = "ğŸ“± Content Creator Opportunity",
		emoji = "ğŸ“±",
		text = "A gaming channel wants to feature you in their content! Could be good exposure for your brand.",
		category = "career_gaming",
		weight = 12,
		minAge = 16, maxAge = 40,
		baseChance = 0.4,
		cooldown = 3,
		eligibility = hasAnyGamingActivity,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Collab and create content together",
				effects = { Happiness = 12 },
				feedText = "Growing the brand!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						local followers = math.random(1000, 10000)
						state.Fame = math.min(100, (state.Fame or 0) + 10) -- CRITICAL FIX: Cap fame at 100
						state:AddFeed(string.format("ğŸ“± COLLAB SUCCESS! Gained %d new followers! Growing audience!", followers))
					else
						state:AddFeed("ğŸ“± Collab was okay. Didn't blow up but got some new eyes on your content.")
					end
				end,
			},
			{
				text = "Negotiate for payment",
				effects = {},
				feedText = "Know your worth...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						local payment = math.random(500, 2000)
						state.Money = (state.Money or 0) + payment
						state:AddFeed(string.format("ğŸ“± They paid you $%d for the collab! Professional!", payment))
					else
						state:AddFeed("ğŸ“± They went with someone cheaper. Missed opportunity?")
					end
				end,
			},
			{
				text = "Decline - staying independent",
				effects = { Happiness = 2 },
				feedText = "Building your own thing.",
			},
		},
	},
	
	{
		id = "gamer_carpal_tunnel",
		title = "âš ï¸ Wrist Pain Warning",
		emoji = "âš ï¸",
		text = "Your wrists have been aching after long gaming sessions. Could be early signs of carpal tunnel syndrome.",
		category = "career_gaming",
		weight = 10,
		minAge = 18, maxAge = 40,
		baseChance = 0.35,
		cooldown = 4,
		eligibility = hasAnyGamingActivity,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "See a specialist immediately",
				effects = { Health = 5, Happiness = -3 },
				feedText = "Health comes first.",
				onResolve = function(state)
					state.Money = math.max(0, (state.Money or 0) - math.random(200, 500))
					state.Flags = state.Flags or {}
					state.Flags.health_conscious_gamer = true
					state:AddFeed("âš ï¸ Doctor caught it early. Physical therapy and ergonomic setup recommended. Crisis averted!")
				end,
			},
			{
				text = "Try stretches and take breaks",
				effects = { Health = 3 },
				feedText = "Self-care mode.",
				onResolve = function(state)
					if math.random(1, 100) <= 70 then
						state:AddFeed("âš ï¸ Stretching routine helped! Wrists feeling better. Keep it up!")
					else
						state:ModifyStat("Health", -5)
						state:AddFeed("âš ï¸ Still having issues. Might need to see a doctor after all.")
					end
				end,
			},
			{
				text = "Push through - grindset",
				effects = { Health = -8 },
				feedText = "Pain is temporary, rank is forever.",
				onResolve = function(state)
					if math.random(1, 100) <= 30 then
						state:AddFeed("âš ï¸ Somehow got better on its own. Lucky!")
					else
						state:ModifyStat("Health", -10)
						state.Flags = state.Flags or {}
						state.Flags.chronic_wrist_pain = true
						state:AddFeed("âš ï¸ Made it worse. Now dealing with chronic pain. Should have listened...")
					end
				end,
			},
		},
	},
	
	{
		id = "gamer_rank_grind",
		title = "ğŸ“ˆ Rank Up Opportunity",
		emoji = "ğŸ“ˆ",
		text = "You're one win away from reaching the next rank! The pressure is on. One more game...",
		category = "career_gaming",
		weight = 14,
		minAge = 14, maxAge = 35,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		eligibility = hasAnyGamingActivity,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Queue up and give it everything!",
				effects = { Happiness = 5 },
				feedText = "This is it!",
				triggerMinigame = "qte",
				minigameOptions = { difficulty = "medium" },
				onResolve = function(state, minigameResult)
					local roll = math.random(1, 100)
					local bonus = (minigameResult and minigameResult.success) and 20 or 0
					
					if roll + bonus >= 45 then
						state:ModifyStat("Happiness", 20)
						state.Flags = state.Flags or {}
						state.Flags.ranked_up = true
						state:AddFeed("ğŸ“ˆ NEW RANK ACHIEVED! LETS GOOOO! Time to screenshot and flex!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ“ˆ Lost the promo game... back to the grind. Tilt incoming.")
					end
				end,
			},
			{
				text = "Wait until you're in peak form",
				effects = { Happiness = 2, Smarts = 2 },
				feedText = "Smart players wait for the right moment.",
				onResolve = function(state)
					state:AddFeed("ğŸ“ˆ Good call. Take a break, come back fresh. The rank will still be there.")
				end,
			},
		},
	},
}

return GamerCareerEvents
