--[[
	StreetHustlerEvents.lua
	
	Career events for Street Hustler / Underground Dealer career path.
	This is the "Illegal Dealer" / "Street Vendor" / "Product Seller" career.
	Roblox-friendly language - no explicit drug references.
	
	Features:
	- Selling "product" on the streets
	- Risk of getting caught by police
	- Building a territory/reputation
	- Gang interactions
	- Working up from street seller to supplier
	
	CRITICAL FIX #RVS-8: Premium path blocking for royalty/celebrity players
]]

local RANDOM = Random.new()

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX #RVS-HUSTLER-1: Premium path blocking
-- Street hustler events should NEVER fire for royalty or celebrity players
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function isBlockedByPremiumPath(state)
	if not state.Flags then return false end
	local flags = state.Flags
	
	-- If player is already a hustler, allow
	if flags.street_hustler or flags.dealer then
		return false
	end
	
	-- Block if player chose royalty path
	if flags.primary_wish_type == "royalty" then return true end
	if flags.is_royalty or flags.royal_birth or flags.dating_royalty then return true end
	if state.RoyalState and state.RoyalState.isRoyal then return true end
	
	-- Block if player chose celebrity path
	if flags.primary_wish_type == "celebrity" then return true end
	if flags.fame_career or flags.is_famous then return true end
	if state.FameState and state.FameState.careerPath then return true end
	
	return false
end

-- Helper: Jail the player
local function jailPlayer(state, yearsMin, yearsMax, reason)
	-- CRITICAL FIX: Use NextInteger, not NextNumber!
	-- NextNumber() returns 0-1 float, NextInteger(min, max) returns proper integer range
	local years = RANDOM:NextInteger(yearsMin, yearsMax)
	state.InJail = true
	state.JailYearsLeft = years
	state.Flags = state.Flags or {}
	state.Flags.in_prison = true
	state.Flags.incarcerated = true
	state.Flags.criminal_record = true
	
	if state.CurrentJob then
		state.CareerInfo = state.CareerInfo or {}
		state.CareerInfo.lastJobBeforeJail = state.CurrentJob
		state.CurrentJob = nil
		state.Flags.employed = nil
	end
	
	return years
end

-- Helper: Check if can be hustler
local function canBeHustler(state)
	if isBlockedByPremiumPath(state) then return false end
	return true
end

local events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- STARTING OUT - STREET HUSTLER CAREER ENTRY
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "street_hustle_opportunity",
		emoji = "ğŸ’¼",
		title = "Street Opportunity",
		text = "Someone approaches you with a 'business opportunity' selling product on the streets. It's risky but the money is good.",
		question = "What do you do?",
		category = "career",
		weight = 6,
		minAge = 16,
		maxAge = 35,
		baseChance = 0.45,
		cooldown = 4,
		oneTime = true,
		requiresNoJob = true,
		-- CRITICAL FIX #RVS-HUSTLER-2: Add eligibility check and extended blocking
		eligibility = canBeHustler,
		blockedByFlags = { street_hustler = true, in_prison = true, is_royalty = true, dating_royalty = true, fame_career = true },
		
		choices = {
			{
				index = 1,
				text = "Take the opportunity - I need money",
				effects = { Happiness = 5, Money = 500 },
				setFlags = { street_hustler = true, dealer = true, criminal_career = true },
				feedText = "You've entered the underground economy. The money's good but the risks are real.",
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = 10
					state.CareerInfo.hustlerLevel = "street_seller"
					state.Flags.has_illegal_income = true
				end,
			},
			{
				index = 2,
				text = "Decline - too risky for me",
				effects = { Happiness = 2 },
				feedText = "You turned down the offer. Maybe there's a legal path forward.",
			},
			{
				index = 3,
				text = "Report it to the police",
				effects = { Happiness = -2 },
				setFlags = { snitch = true, helpful_citizen = true },
				feedText = "You informed the authorities. Some would call you a good citizen, others a snitch.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- DAILY HUSTLE EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "street_sales_day",
		emoji = "ğŸ’µ",
		title = "Working the Corner",
		text = "Another day working your territory. Customers are coming by and you're moving product.",
		question = "How do you handle today?",
		category = "career",
		weight = 8,
		minAge = 16,
		maxAge = 60,
		baseChance = 0.25, -- FIXED: Further lowered to prevent spam
		cooldown = 4, -- FIXED: Further increased
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Play it safe - small sales only",
				effects = { Happiness = 2 },
				feedText = "You made some money keeping it low-key.",
				onResolve = function(state)
					local earnings = RANDOM:NextInteger(100, 400)
					state.Money = (state.Money or 0) + earnings
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ’° Made $%d today keeping it safe.", earnings))
					end
				end,
			},
			{
				index = 2,
				text = "Push harder - maximize profits",
				effects = { Happiness = 3 },
				feedText = "You pushed for bigger sales...",
				onResolve = function(state)
					local risk = RANDOM:NextNumber()
					if risk < 0.25 then -- 25% chance of trouble
						local years = jailPlayer(state, 1, 3, "Street dealing")
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” BUSTED! Cops caught you. %d years in prison.", math.floor(years)))
						end
					else
						local earnings = RANDOM:NextInteger(400, 1200)
						state.Money = (state.Money or 0) + earnings
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 5
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’° BIG day! Made $%d pushing hard.", earnings))
						end
					end
				end,
			},
			{
				index = 3,
				text = "Take the day off",
				effects = { Happiness = 5, Health = 2 },
				feedText = "Everyone needs a break sometimes.",
			},
		},
	},
	
	{
		id = "rival_dealer_confrontation",
		emoji = "ğŸ˜ ",
		title = "Rival Hustler",
		text = "Another dealer is working your territory. This is YOUR corner. They're cutting into your profits.",
		question = "How do you handle this?",
		category = "career",
		weight = 6,
		minAge = 16,
		maxAge = 50,
		baseChance = 0.4,
		cooldown = 3,
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Confront them aggressively",
				effects = { Happiness = 3 },
				feedText = "You confronted the rival...",
				onResolve = function(state)
					local outcome = RANDOM:NextNumber()
					if outcome < 0.3 then
						-- Fight escalates
						state.Stats = state.Stats or {}
						local healthLoss = RANDOM:NextInteger(-15, -5)
						if state.ModifyStat then
							state:ModifyStat("Health", healthLoss)
						end
						if state.AddFeed then
							state:AddFeed("ğŸ¤• The confrontation got violent. You're hurt but held your ground.")
						end
					elseif outcome < 0.6 then
						-- They back off
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 10
						if state.AddFeed then
							state:AddFeed("ğŸ’ª They backed down. Your reputation grows.")
						end
					else
						-- Cops show up
						if RANDOM:NextNumber() < 0.3 then
							jailPlayer(state, 0.5, 2, "Street fighting")
							if state.AddFeed then
								state:AddFeed("ğŸš” Cops showed up during the fight. You're arrested!")
							end
						else
							if state.AddFeed then
								state:AddFeed("ğŸš¨ Cops showed up but you both ran. Close call!")
							end
						end
					end
				end,
			},
			{
				index = 2,
				text = "Talk it out - split the territory",
				effects = { Happiness = 5, Smarts = 2 },
				feedText = "You negotiated a peace deal.",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.diplomatic_hustler = true
					if state.AddFeed then
						state:AddFeed("ğŸ¤ You split the territory. Less money but less drama.")
					end
				end,
			},
			{
				index = 3,
				text = "Find a new corner",
				effects = { Happiness = -3 },
				feedText = "You moved to a less profitable area.",
			},
			{
				index = 4,
				text = "Report them anonymously",
				effects = { Happiness = 2 },
				setFlags = { snitch = true },
				feedText = "You tipped off the cops about your rival.",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.7 then
						if state.AddFeed then
							state:AddFeed("ğŸš” The cops busted your rival. Territory is all yours now!")
						end
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 5
					else
						if state.AddFeed then
							state:AddFeed("ğŸ˜¬ Your rival found out you snitched. Watch your back...")
						end
						state.Flags.marked_by_rivals = true
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CAREER PROGRESSION
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "supplier_opportunity",
		emoji = "ğŸ“¦",
		title = "Supplier Opportunity",
		text = "Your connect is impressed with your work. They're offering to make you a supplier - you'd manage other sellers.",
		question = "Do you move up?",
		category = "career",
		weight = 5,
		minAge = 20,
		maxAge = 50,
		baseChance = 0.55,
		cooldown = 5,
		oneTime = true,
		requiresFlags = { street_hustler = true },
		blockedByFlags = { supplier = true, in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Accept the promotion",
				effects = { Happiness = 10, Money = 5000 },
				setFlags = { supplier = true },
				feedText = "You're moving up! More money, more risk.",
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerLevel = "supplier"
					state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 30
					if state.AddFeed then
						state:AddFeed("ğŸ“ˆ You're now a supplier. Big leagues now.")
					end
				end,
			},
			{
				index = 2,
				text = "Decline - too much heat",
				effects = { Happiness = 5 },
				feedText = "You decided to stay at your current level. Less money but safer.",
			},
			{
				index = 3,
				text = "This is my chance to get out",
				effects = { Happiness = 8 },
				feedText = "You used this moment to exit the game.",
				onResolve = function(state)
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.former_hustler = true
					state.Flags.out_of_the_game = true
					if state.AddFeed then
						state:AddFeed("ğŸš¶ You walked away from the life. Time to go legit.")
					end
				end,
			},
		},
	},
	
	{
		id = "big_score",
		emoji = "ğŸ’",
		title = "The Big Score",
		text = "A massive opportunity comes up. High risk, huge reward. One big deal that could set you up for life.",
		question = "Do you take the risk?",
		category = "career",
		weight = 4,
		minAge = 22,
		maxAge = 50,
		baseChance = 0.4,
		cooldown = 6,
		requiresFlags = { supplier = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Go all in",
				effects = { Happiness = 5 },
				feedText = "You went for the big score...",
				onResolve = function(state)
					local outcome = RANDOM:NextNumber()
					if outcome < 0.35 then -- 35% chance of success
						local earnings = RANDOM:NextInteger(50000, 200000)
						state.Money = (state.Money or 0) + earnings
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 50
						state.Flags.big_score_winner = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’°ğŸ’°ğŸ’° THE SCORE! You made $%d! Life changing money!", earnings))
						end
					elseif outcome < 0.65 then -- 30% chance of getting caught
						local years = jailPlayer(state, 5, 15, "Major smuggling")
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” FEDERAL AGENTS! You're looking at %d years!", math.floor(years)))
						end
					else -- 35% chance deal falls through
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(5000, 15000))
						if state.AddFeed then
							state:AddFeed("âŒ The deal went bad. You lost your investment.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Pass - not worth the risk",
				effects = { Happiness = 3, Smarts = 5 },
				feedText = "You passed on the opportunity. Live to hustle another day.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- HEAT / POLICE ATTENTION
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "police_investigation",
		emoji = "ğŸ”",
		title = "Under Investigation",
		text = "Word on the street is the police are looking into your activities. The heat is on.",
		question = "What do you do?",
		category = "career",
		weight = 7,
		minAge = 18,
		maxAge = 60,
		baseChance = 0.55,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true, laying_low = true },
		
		choices = {
			{
				index = 1,
				text = "Lay low for a while",
				effects = { Happiness = -5 },
				setFlags = { laying_low = true },
				feedText = "You're keeping a low profile until the heat dies down.",
				onResolve = function(state)
					-- No income while laying low, but safe
					if state.AddFeed then
						state:AddFeed("ğŸ™ˆ Going dark for a while. No business, no problems.")
					end
				end,
			},
			{
				index = 2,
				text = "Business as usual - I'm careful",
				effects = { Happiness = 2 },
				feedText = "You kept working...",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.4 then
						local years = jailPlayer(state, 2, 5, "Dealing charges")
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” They got you! %d years.", math.floor(years)))
						end
					else
						local earnings = RANDOM:NextInteger(300, 800)
						state.Money = (state.Money or 0) + earnings
						if state.AddFeed then
							state:AddFeed("ğŸ˜ Dodged the heat and made money. Living dangerously.")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Move to a new city ($500)",
				effects = { Money = -500, Happiness = -4 },
				setFlags = { relocated = true },
				eligibility = function(state) return (state.Money or 0) >= 500, "ğŸ’¸ Need $500 to relocate" end,
				feedText = "ğŸƒ Relocated to a new city. Fresh start!",
			},
			{
				index = 4,
				text = "Lay low here",
				effects = { Happiness = -6 },
				setFlags = { laying_low = true },
				feedText = "ğŸƒ Can't afford to move. Laying low instead...",
			},
			{
				index = 4,
				text = "Turn informant for immunity",
				effects = { Happiness = -10 },
				setFlags = { informant = true, snitch = true },
				feedText = "You cooperated with the police in exchange for immunity.",
				onResolve = function(state)
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.supplier = nil
					state.Flags.protected_witness = true
					if state.AddFeed then
						state:AddFeed("ğŸ•µï¸ You're now a protected informant. Your old life is over.")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- GOING LEGIT
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "exit_the_game",
		emoji = "ğŸšª",
		title = "Time to Go Legit?",
		text = "You've saved up some money. Maybe it's time to leave the street life behind and start a legitimate business.",
		question = "What do you do?",
		category = "career",
		weight = 4,
		minAge = 25,
		maxAge = 50,
		baseChance = 0.45,
		cooldown = 4,
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return (state.Money or 0) >= 10000
		end,
		
		choices = {
		{
			index = 1,
			text = "Open a legitimate business ($10K)",
			effects = { Happiness = 15, Money = -10000 },
			setFlags = { went_legit = true, entrepreneur = true },
			feedText = "You invested your money into a legit business!",
			eligibility = function(state) return (state.Money or 0) >= 10000, "ğŸ’¸ Need $10K for business" end,
			onResolve = function(state)
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.supplier = nil
					state.Flags.former_hustler = true
					if state.AddFeed then
						state:AddFeed("ğŸª You opened a business! The street life is behind you.")
					end
				end,
			},
			{
				index = 2,
				text = "Keep hustling - the money's too good",
				effects = { Happiness = 5 },
				feedText = "You're too deep in the game to leave now.",
			},
			{
				index = 3,
				text = "Save more first",
				effects = { Happiness = 2 },
				feedText = "You'll think about it when you have more saved up.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- ADDITIONAL STREET HUSTLER EVENTS - EXPANDED CONTENT
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "street_rep_challenge",
		emoji = "ğŸ’ª",
		title = "Rep on the Line",
		text = "Someone is questioning your rep in the streets. Word's getting around that you're soft.",
		question = "How do you respond?",
		category = "career",
		weight = 6,
		minAge = 16,
		maxAge = 50,
		baseChance = 0.4,
		cooldown = 3,
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Make an example - show strength",
				effects = {},
				feedText = "You decided to make a statement...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.35 then
						-- Success - rep restored
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 20
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ’ª You made your point. Nobody's questioning you now.")
					elseif roll < 0.65 then
						-- Things got messy
						state:ModifyStat("Health", -8)
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 10
						state:AddFeed("ğŸ’ª Got into a scrap. You're hurt but your rep is intact.")
					else
						-- Cops involved
						if RANDOM:NextNumber() < 0.5 then
							local years = jailPlayer(state, 1, 3, "Assault")
							state:AddFeed(string.format("ğŸš” Things escalated. %d years for assault.", math.floor(years)))
						else
							state:AddFeed("ğŸš” Cops came but you got away. Close call.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Let it slide - not worth the trouble",
				effects = { Happiness = -3 },
				feedText = "You ignored the disrespect...",
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = math.max(0, (state.CareerInfo.hustlerRep or 0) - 10)
					state:AddFeed("ğŸ’ª Your rep took a hit but you avoided trouble.")
				end,
			},
			{
				index = 3,
				text = "Handle it through connections ($200)",
				effects = { Money = -200 },
				feedText = "You had someone else handle it...",
				eligibility = function(state) return (state.Money or 0) >= 200, "ğŸ’¸ Need $200 to pay off connections" end,
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 5
					state:AddFeed("ğŸ’ª Problem solved through channels. Smart move.")
				end,
			},
		},
	},
	
	{
		id = "street_loyalty_test",
		emoji = "ğŸ¤”",
		title = "Loyalty Test",
		text = "Your connect wants you to prove your loyalty. They're asking you to do something risky.",
		question = "What do you do?",
		category = "career",
		weight = 5,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.3, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true, trusted_in_the_game = true },
		
		choices = {
			{
				index = 1,
				text = "Do what they ask - prove yourself",
				effects = {},
				feedText = "You agreed to prove your loyalty...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.50 then
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 25
						state.Money = (state.Money or 0) + RANDOM:NextInteger(500, 1500)
						state.Flags = state.Flags or {}
						state.Flags.trusted_in_the_game = true
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ¤ You proved your loyalty. You're trusted now.")
					elseif roll < 0.80 then
						state:ModifyStat("Health", -5)
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ˜° It was risky but you pulled it off. Never again though.")
					else
						local years = jailPlayer(state, 2, 5, "Illegal activity")
						state:AddFeed(string.format("ğŸš” The loyalty test was a setup or went wrong. %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 2,
				text = "Refuse - this feels like a trap",
				effects = { Happiness = 3 },
				feedText = "You refused the test...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.30 then
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = math.max(0, (state.CareerInfo.hustlerRep or 0) - 20)
						state.Flags = state.Flags or {}
						state.Flags.untrusted = true
						state:AddFeed("ğŸ¤” They think you might be a snitch now. Trust is broken.")
					else
						state:AddFeed("ğŸ¤” They respected your caution. Maybe it was a test of your judgment.")
					end
				end,
			},
			{
				index = 3,
				text = "Cut ties with this connect",
				effects = { Happiness = -5 },
				feedText = "You decided to find a new connect...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.looking_for_new_connect = true
					state:AddFeed("ğŸš¶ You walked away from that crew. Starting fresh is hard.")
				end,
			},
		},
	},
	
	{
		id = "street_customer_problems",
		emoji = "ğŸ˜¤",
		title = "Problem Customer",
		text = "A customer is causing problems. They're short on money and getting aggressive.",
		question = "How do you handle this situation?",
		category = "career",
		weight = 7,
		minAge = 16,
		maxAge = 55,
		baseChance = 0.5,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "No product without full payment",
				effects = { Happiness = 3 },
				feedText = "You stood firm on payment...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.70 then
						state:AddFeed("ğŸ’µ They came back with the money. Business is business.")
					else
						state:ModifyStat("Health", -3)
						state:AddFeed("ğŸ’µ They got aggressive. Small scuffle but you held your ground.")
					end
				end,
			},
			{
				index = 2,
				text = "Front them this once - build loyalty",
				effects = {},
				feedText = "You gave them credit this time...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(50, 150)
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 5
						state:AddFeed("ğŸ’µ They paid you back plus extra. Loyalty earned.")
					else
						state.Money = math.max(0, (state.Money or 0) - 100)
						state:AddFeed("ğŸ’µ They ghosted you. Never front again.")
					end
				end,
			},
			{
				index = 3,
				text = "Things get physical",
				effects = {},
				feedText = "The situation escalated...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state:ModifyStat("Health", -10)
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 15
						state:AddFeed("ğŸ¤• You got hurt but sent a message. Rep up, health down.")
					elseif roll < 0.70 then
						state:ModifyStat("Health", -5)
						state:AddFeed("ğŸ¤• Quick scuffle. You're fine but shaken.")
					else
						local years = jailPlayer(state, 1, 2, "Battery")
						state:AddFeed(string.format("ğŸš” Someone called the cops. %d years for battery.", math.floor(years)))
					end
				end,
			},
			{
				index = 4,
				text = "Walk away - not worth the trouble",
				effects = { Happiness = 2 },
				feedText = "You let this one go. Smart.",
			},
		},
	},
	
	{
		id = "street_territory_expansion",
		emoji = "ğŸ“",
		title = "Territory Expansion",
		text = "There's an opportunity to expand to a new neighborhood. More customers, but it's someone else's turf.",
		question = "Do you make a move?",
		category = "career",
		weight = 5,
		minAge = 20,
		maxAge = 45,
		baseChance = 0.25, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true, laying_low = true, expanded_territory = true },
		
		choices = {
			{
				index = 1,
				text = "Move in aggressively",
				effects = {},
				feedText = "You made your move on new territory...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.25 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(2000, 5000)
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 30
						state.Flags = state.Flags or {}
						state.Flags.expanded_territory = true
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ“ Hostile takeover successful! You're running two corners now.")
					elseif roll < 0.55 then
						state:ModifyStat("Health", -15)
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ“ War broke out. You're hurt bad. Not worth it.")
					else
						local years = jailPlayer(state, 3, 8, "Turf war violence")
						state:AddFeed(string.format("ğŸš” The turf war brought heat. %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 2,
				text = "Negotiate - split the new area",
				effects = { Smarts = 2 },
				feedText = "You tried diplomacy...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.50 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(500, 1500)
						state.Flags = state.Flags or {}
						state.Flags.diplomatic_hustler = true
						state:AddFeed("ğŸ“ You negotiated a deal. Shared territory, shared profits.")
					else
						state:AddFeed("ğŸ“ They weren't interested in sharing. Stayed on your corner.")
					end
				end,
			},
			{
				index = 3,
				text = "Stay in your lane",
				effects = { Happiness = 2 },
				feedText = "You kept to your own territory. Smart.",
			},
		},
	},
	
	{
		id = "street_supplier_issue",
		emoji = "ğŸ“¦",
		title = "Supply Problems",
		text = "Your supplier is having issues. Product is late and customers are getting impatient.",
		question = "What do you do?",
		category = "career",
		weight = 6,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.4,
		cooldown = 3,
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Wait it out - loyalty to your connect",
				effects = { Happiness = -3 },
				feedText = "You waited for your regular supplier...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.60 then
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(200, 500))
						state:AddFeed("ğŸ“¦ Lost some customers but your connect came through eventually.")
					else
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(500, 1000))
						state:AddFeed("ğŸ“¦ Long dry spell. Major losses. Your connect owes you.")
					end
				end,
			},
			{
				index = 2,
				text = "Find a new temporary supplier",
				effects = {},
				feedText = "You looked for alternative supply...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(300, 800)
						state:AddFeed("ğŸ“¦ Found another source. Kept the customers happy.")
					elseif roll < 0.75 then
						state.Money = math.max(0, (state.Money or 0) - 200)
						state:AddFeed("ğŸ“¦ New supplier's product was garbage. Reputation hit.")
					else
						state.Flags = state.Flags or {}
						state.Flags.burned_by_supplier = true
						state.Money = math.max(0, (state.Money or 0) - 500)
						state:AddFeed("ğŸ“¦ Got robbed by the new 'supplier'. Never trust randoms.")
					end
				end,
			},
			{
				index = 3,
				text = "Take a break from the game",
				effects = { Happiness = 3, Health = 3 },
				setFlags = { taking_break = true },
				feedText = "You used this as an excuse to lay low for a bit.",
			},
		},
	},
	
	{
		id = "street_family_finds_out",
		emoji = "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§",
		title = "Family Discovers Truth",
		text = "Your family just found out what you really do for money. They're upset.",
		question = "How do you handle this confrontation?",
		category = "career",
		weight = 4,
		minAge = 16,
		maxAge = 40,
		baseChance = 0.45,
		cooldown = 4,
		oneTime = true,
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Promise to quit and go legit",
				effects = { Happiness = -5 },
				feedText = "You promised to change...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.30 then
						state.Flags = state.Flags or {}
						state.Flags.street_hustler = nil
						state.Flags.dealer = nil
						state.Flags.supplier = nil
						state.Flags.former_hustler = true
						state.Flags.family_intervention = true
						state:AddFeed("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ You actually quit. Family support helped you go straight.")
					else
						state:AddFeed("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ You promised but didn't follow through. Living a double life.")
					end
				end,
			},
			{
				index = 2,
				text = "Defend your choices",
				effects = { Happiness = -8 },
				feedText = "You stood by your decisions...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.family_rift = true
					state:AddFeed("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Major family rift. They don't approve and you don't care.")
				end,
			},
			{
				index = 3,
				text = "Lie and deny everything",
				effects = { Happiness = -3 },
				feedText = "You tried to cover it up...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state:AddFeed("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ They believed you... for now. Walking on eggshells.")
					else
						state.Flags = state.Flags or {}
						state.Flags.family_trust_broken = true
						state:AddFeed("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ They didn't believe you. Trust is broken.")
					end
				end,
			},
			{
				index = 4,
				text = "Ask for help getting out",
				effects = { Happiness = 5 },
				feedText = "You asked for support...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.family_support_to_quit = true
					state:ModifyStat("Smarts", 2)
					state:AddFeed("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ They're helping you find a way out. Not easy but possible.")
				end,
			},
		},
	},
	
	{
		id = "street_close_call_raid",
		emoji = "ğŸš¨",
		title = "Raid Alert",
		text = "You hear through the grapevine that cops are planning a big bust in your area!",
		question = "What do you do?",
		category = "career",
		weight = 6,
		minAge = 18,
		maxAge = 55,
		baseChance = 0.3, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true, laying_low = true },
		
		choices = {
			{
				index = 1,
				text = "Disappear completely for a while ($500)",
				effects = { Happiness = -5, Money = -500 },
				setFlags = { laying_low = true },
				feedText = "You vanished...",
				onResolve = function(state)
					state:AddFeed("ğŸš¨ You laid low. Lost money but avoided the bust.")
				end,
			},
			{
				index = 2,
				text = "Move all product to a safe location",
				effects = {},
				feedText = "You tried to secure everything...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.65 then
						state:AddFeed("ğŸš¨ Everything hidden safely. The raid missed you entirely.")
					elseif roll < 0.85 then
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(500, 1500))
						state:AddFeed("ğŸš¨ Lost some product in the move. Still better than jail.")
					else
						local years = jailPlayer(state, 2, 5, "Possession with intent")
						state:AddFeed(string.format("ğŸš” Caught moving product! %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 3,
				text = "Ignore the warning - could be fake",
				effects = {},
				feedText = "You gambled on it being false...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state:AddFeed("ğŸš¨ False alarm! Nothing happened. Business as usual.")
					elseif roll < 0.70 then
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(200, 800))
						state:AddFeed("ğŸš¨ Raid was real but you got lucky. Lost some cash running.")
					else
						local years = jailPlayer(state, 3, 8, "Major bust")
						state:AddFeed(string.format("ğŸš” The raid was real. You got caught! %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 4,
				text = "Warn others and spread the word",
				effects = { Happiness = 5 },
				feedText = "You looked out for the community...",
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 15
					state.Flags = state.Flags or {}
					state.Flags.loyal_to_community = true
					state:AddFeed("ğŸš¨ You warned everyone. Your rep in the community is solid.")
				end,
			},
		},
	},
	
	{
		id = "street_money_opportunity",
		emoji = "ğŸ’°",
		title = "Quick Money Opportunity",
		text = "Someone approaches you with a quick money opportunity. It's outside your usual hustle.",
		question = "What kind of opportunity is it?",
		category = "career",
		weight = 5,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.25, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "A delivery job - big payout",
				effects = {},
				feedText = "You took the delivery job...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.50 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(2000, 5000)
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ’° Easy money! Delivery went smooth.")
					elseif roll < 0.75 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(500, 1500)
						state:AddFeed("ğŸ’° Got paid but it was sketchy. Not worth the stress.")
					else
						local years = jailPlayer(state, 3, 7, "Smuggling")
						state:AddFeed(string.format("ğŸš” It was a setup! %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 2,
				text = "Moving stolen goods",
				effects = {},
				feedText = "You dealt in stolen property...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.55 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(1000, 3000)
						state:AddFeed("ğŸ’° Quick flip. Made good money moving the merchandise.")
					elseif roll < 0.80 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(300, 800)
						state:AddFeed("ğŸ’° Couldn't move everything. Made some money at least.")
					else
						local years = jailPlayer(state, 1, 4, "Receiving stolen property")
						state:AddFeed(string.format("ğŸš” Caught with hot goods! %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 3,
				text = "Stick to what you know",
				effects = { Happiness = 2, Smarts = 2 },
				feedText = "You passed on the opportunity. Staying in your lane.",
			},
			{
				index = 4,
				text = "It's a scam - walk away",
				effects = { Smarts = 3 },
				feedText = "Your instincts said no. You walked away.",
			},
		},
	},
	
	{
		id = "street_getting_older",
		emoji = "â°",
		title = "Getting Too Old For This",
		text = "You're getting older. The street life is wearing on you. Younger hustlers are everywhere.",
		question = "What do you do?",
		category = "career",
		weight = 4,
		minAge = 35,
		maxAge = 55,
		baseChance = 0.4,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		requiresFlags = { street_hustler = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				index = 1,
				text = "Become a mentor/OG - less street work",
				effects = { Happiness = 5, Smarts = 3 },
				feedText = "You transitioned to an advisory role...",
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerLevel = "og_advisor"
					state.Flags = state.Flags or {}
					state.Flags.street_og = true
					state:AddFeed("â° You're the OG now. Less risk, still respected.")
				end,
			},
			{
				index = 2,
				text = "Invest savings to go legit ($5,000)",
				effects = { Money = -5000, Happiness = 12 },
				eligibility = function(state) return (state.Money or 0) >= 5000, "ğŸ’¸ Need $5,000 to start legit business" end,
				feedText = "â° Invested your savings in a legit business. You made it out!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.supplier = nil
					state.Flags.former_hustler = true
					state.Flags.went_legit = true
				end,
			},
			{
				index = 3,
				text = "Keep hustling until you can't",
				effects = { Health = -5, Happiness = -3 },
				feedText = "You're grinding until the wheels fall off...",
				onResolve = function(state)
					state:AddFeed("â° You're still in the game. Body and mind are wearing down.")
				end,
			},
			{
				index = 4,
				text = "Train the next generation",
				effects = { Happiness = 3 },
				feedText = "You're teaching the young ones...",
				onResolve = function(state)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 20
					state.Flags = state.Flags or {}
					state.Flags.street_mentor = true
					state:AddFeed("â° Passing down knowledge. They look up to you.")
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- FLAG-LINKED CONSEQUENCE EVENTS - PROPER WIRING!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	
	{
		id = "street_snitch_consequence",
		emoji = "ğŸ¯",
		title = "Word Got Around",
		text = "Someone found out you snitched on that rival dealer. There's a target on your back now.",
		question = "What do you do?",
		category = "career",
		weight = 6,
		minAge = 16,
		maxAge = 55,
		baseChance = 0.35, -- LOWERED
		cooldown = 5, -- INCREASED
		oneTime = true, -- Only happens once!
		-- CRITICAL LINKAGE: Only triggers if you snitched
		requiresFlags = { snitch = true, street_hustler = true },
		blockedByFlags = { in_prison = true, got_revenge_on_snitch = true, relocated_for_safety = true },
		
		choices = {
		{
			index = 1,
			text = "Leave town immediately ($3K)",
			effects = { Money = -3000, Happiness = -10 },
			feedText = "Running for your life...",
			eligibility = function(state) return (state.Money or 0) >= 3000, "ğŸ’¸ Need $3K to leave town" end,
			onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.snitch = nil -- Fresh start
					state.Flags.relocated_for_safety = true
					state.Flags.street_hustler = nil -- Have to start over
					state:AddFeed("ğŸ¯ Left everything behind. New city. New name. Starting from scratch.")
				end,
			},
		{
			index = 2,
			text = "Hire protection ($5K)",
			effects = { Money = -5000 },
			feedText = "Bodyguards 24/7...",
			eligibility = function(state) return (state.Money or 0) >= 5000, "ğŸ’¸ Need $5K for protection" end,
			onResolve = function(state)
				state.Flags = state.Flags or {}
				state.Flags.has_protection = true
				state:AddFeed("ğŸ¯ Got serious muscle watching your back. Expensive but alive.")
			end,
		},
			{
				index = 3,
				text = "Go to the police for witness protection",
				effects = { Happiness = -15 },
				feedText = "Asking the cops for help...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.protected_witness = true
					state.Flags.snitch = nil
					state:AddFeed("ğŸ¯ In witness protection now. Old life completely erased.")
				end,
			},
			{
				index = 4,
				text = "Face them head on",
				effects = {},
				feedText = "Not running from anyone...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.30 then
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 30
						state.Flags = state.Flags or {}
						state.Flags.survived_street_beef = true
						state:AddFeed("ğŸ¯ Stood your ground. They respected that. Peace established.")
					elseif roll < 0.60 then
						state:ModifyStat("Health", -25)
						state:AddFeed("ğŸ¯ Bad fight. Survived but barely. Scars for life.")
					else
						local years = jailPlayer(state, 3, 10, "Violent confrontation")
						state:AddFeed(string.format("ğŸ¯ Things got out of control. %d years for the violence.", math.floor(years)))
					end
				end,
			},
		},
	},
	
	{
		id = "street_marked_by_rivals_consequence",
		emoji = "âš ï¸",
		title = "Rivals Make a Move",
		text = "Remember when you snitched on your rival and they found out? They've been planning something.",
		question = "How do you respond?",
		category = "career",
		weight = 6,
		minAge = 16,
		maxAge = 50,
		baseChance = 0.3, -- LOWERED
		cooldown = 5, -- INCREASED
		oneTime = true, -- Only once!
		-- CRITICAL LINKAGE: Only triggers if marked by rivals
		requiresFlags = { marked_by_rivals = true, street_hustler = true },
		blockedByFlags = { in_prison = true, escaped_the_life = true },
		
		choices = {
			{
				index = 1,
				text = "Strike first",
				effects = {},
				feedText = "Best defense is offense...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.35 then
						state.Flags = state.Flags or {}
						state.Flags.marked_by_rivals = nil
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 25
						state:AddFeed("âš ï¸ Caught them off guard. Problem eliminated. You're safe for now.")
					elseif roll < 0.65 then
						state:ModifyStat("Health", -15)
						state:AddFeed("âš ï¸ Won the fight but took damage. They got the message.")
						state.Flags.marked_by_rivals = nil
					else
						local years = jailPlayer(state, 5, 15, "Aggravated assault")
						state:AddFeed(string.format("ğŸš” Things escalated. %d years. Heavy charges.", math.floor(years)))
					end
				end,
			},
			{
				index = 2,
				text = "Pay them off ($3,000)",
				effects = { Money = -3000 },
				eligibility = function(state) return (state.Money or 0) >= 3000, "ğŸ’¸ Need $3,000 for payoff" end,
				feedText = "âš ï¸ Paid $3,000 to squash the beef. Peace bought, not earned.",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.marked_by_rivals = nil
				end,
			},
			{
				index = 3,
				text = "Get out of the game entirely",
				effects = { Happiness = 8 },
				feedText = "This life isn't worth dying for...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.supplier = nil
					state.Flags.marked_by_rivals = nil
					state.Flags.former_hustler = true
					state.Flags.escaped_the_life = true
					state:AddFeed("âš ï¸ Walked away from everything. Clean break. New chapter begins.")
				end,
			},
		},
	},
	
	{
		id = "street_trusted_payoff",
		emoji = "ğŸ¤",
		title = "Trust Pays Off",
		text = "Remember when you proved your loyalty? Your connect is rewarding you with a bigger territory.",
		question = "How do you handle this opportunity?",
		category = "career",
		weight = 5,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.25, -- LOWERED
		cooldown = 6, -- INCREASED
		oneTime = true, -- Only once!
		-- CRITICAL LINKAGE: Only triggers if trusted
		requiresFlags = { trusted_in_the_game = true, street_hustler = true },
		blockedByFlags = { in_prison = true, supplier = true, expanded_territory = true },
		
		choices = {
			{
				index = 1,
				text = "Accept and expand operations",
				effects = { Happiness = 10 },
				feedText = "Moving up!",
				onResolve = function(state)
					state.Money = (state.Money or 0) + RANDOM:NextInteger(5000, 15000)
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 40
					state.CareerInfo.hustlerLevel = "territory_boss"
					state.Flags = state.Flags or {}
					state.Flags.expanded_territory = true
					state:AddFeed("ğŸ¤ Running multiple corners now! Income tripled! Big time.")
				end,
			},
			{
				index = 2,
				text = "Stay small - less heat",
				effects = { Happiness = 5, Smarts = 3 },
				feedText = "Staying humble...",
				onResolve = function(state)
					state.Money = (state.Money or 0) + RANDOM:NextInteger(1000, 3000)
					state:AddFeed("ğŸ¤ Turned down the expansion. Connect respects your caution.")
				end,
			},
		},
	},
	
	{
		id = "street_diplomatic_advantage",
		emoji = "ğŸ•Šï¸",
		title = "Diplomatic Reputation Benefits",
		text = "Your reputation for being diplomatic is spreading. A neutral party wants to negotiate a major deal through you.",
		question = "Do you become a broker?",
		category = "career",
		weight = 4,
		minAge = 22,
		maxAge = 50,
		baseChance = 0.2, -- LOWERED
		cooldown = 6, -- INCREASED
		oneTime = true, -- Only once!
		-- CRITICAL LINKAGE: Only triggers if you've been diplomatic
		requiresFlags = { diplomatic_hustler = true, street_hustler = true },
		blockedByFlags = { in_prison = true, street_broker = true },
		
		choices = {
			{
				index = 1,
				text = "Become a broker - take a cut",
				effects = { Smarts = 5 },
				feedText = "The art of the deal...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.60 then
						local cut = RANDOM:NextInteger(5000, 20000)
						state.Money = (state.Money or 0) + cut
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 30
						state.Flags = state.Flags or {}
						state.Flags.street_broker = true
						state:AddFeed(string.format("ğŸ•Šï¸ Deal done! $%d commission! You're the trusted middleman now.", cut))
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ•Šï¸ Deal fell through. Both sides blame you. Reputation damaged.")
					end
				end,
			},
			{
				index = 2,
				text = "Stay out of it - not your problem",
				effects = { Happiness = 3 },
				feedText = "Not getting involved...",
				onResolve = function(state)
					state:AddFeed("ğŸ•Šï¸ Stayed out of it. Sometimes the safest play is no play.")
				end,
			},
		},
	},
	
	{
		id = "street_og_respect",
		emoji = "ğŸ‘‘",
		title = "OG Status Recognition",
		text = "The young hustlers are coming to you for advice. Your OG status is paying off.",
		question = "How do you use this influence?",
		category = "career",
		weight = 4,
		minAge = 30,
		maxAge = 60,
		baseChance = 0.2, -- LOWERED
		cooldown = 6, -- INCREASED
		-- CRITICAL LINKAGE: Only triggers if you're an OG
		requiresFlags = { street_og = true },
		blockedByFlags = { in_prison = true, runs_organization = true, receiving_tribute = true },
		
		choices = {
			{
				index = 1,
				text = "Take a percentage of their earnings",
				effects = { Money = 3000, Happiness = 5 },
				feedText = "Passive income...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.receiving_tribute = true
					state:AddFeed("ğŸ‘‘ Getting a cut without the risk. This is how you do it.")
				end,
			},
			{
				index = 2,
				text = "Guide them to go legit eventually",
				effects = { Happiness = 10, Smarts = 3 },
				feedText = "Paying it forward...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.positive_mentor = true
					state:AddFeed("ğŸ‘‘ Helping the next generation avoid your mistakes. That's real OG behavior.")
				end,
			},
			{
				index = 3,
				text = "Build a proper organization",
				effects = {},
				feedText = "Going corporate...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(20000, 50000)
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerLevel = "organization_leader"
						state.Flags = state.Flags or {}
						state.Flags.runs_organization = true
						state:AddFeed("ğŸ‘‘ Built a proper operation. Money flowing in regularly. Boss status.")
					else
						local years = jailPlayer(state, 8, 20, "RICO charges")
						state:AddFeed(string.format("ğŸš” Feds noticed. RICO charges. %d years.", math.floor(years)))
					end
				end,
			},
		},
	},
	
	{
		id = "street_family_intervention_success",
		emoji = "ğŸ’",
		title = "Family Support Helps",
		text = "Your family's support to quit is making a difference. They found you a job opportunity.",
		question = "Do you take it?",
		category = "career",
		weight = 5,
		minAge = 18,
		maxAge = 45,
		baseChance = 0.3, -- LOWERED
		cooldown = 5, -- INCREASED
		oneTime = true,
		-- CRITICAL LINKAGE: Only triggers if family is helping
		requiresFlags = { family_support_to_quit = true, street_hustler = true },
		blockedByFlags = { in_prison = true, family_saved_me = true, disappointed_family = true },
		
		choices = {
			{
				index = 1,
				text = "Take the legit job - new start",
				effects = { Happiness = 15 },
				feedText = "Fresh start...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.supplier = nil
					state.Flags.former_hustler = true
					state.Flags.family_saved_me = true
					state.CurrentJob = {
						id = "warehouse_worker",
						name = "Warehouse Associate",
						company = "Distribution Co",
						salary = 35000,
						category = "entry"
					}
					state.Flags.employed = true
					state:AddFeed("ğŸ’ New job! Honest work! Family so proud! You made it out!")
				end,
			},
			{
				index = 2,
				text = "Can't give up the money yet",
				effects = { Happiness = -10 },
				feedText = "Not ready...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.family_support_to_quit = nil
					state.Flags.disappointed_family = true
					state:AddFeed("ğŸ’ Family is devastated. They tried to help. Door might be closed now.")
				end,
			},
		},
	},
	
	{
		id = "street_laying_low_outcome",
		emoji = "ğŸ™ˆ",
		title = "Heat Dies Down",
		text = "You've been laying low for a while. The police attention seems to have moved on.",
		question = "What now?",
		category = "career",
		weight = 6,
		minAge = 18,
		maxAge = 55,
		baseChance = 0.35, -- LOWERED
		cooldown = 4, -- INCREASED
		-- CRITICAL LINKAGE: Only triggers if laying low
		requiresFlags = { laying_low = true },
		blockedByFlags = { in_prison = true, clean_exit = true },
		
		choices = {
			{
				index = 1,
				text = "Get back in the game",
				effects = { Happiness = 5 },
				feedText = "Back to business...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.laying_low = nil
					state.Flags.street_hustler = true
					state.Money = (state.Money or 0) + RANDOM:NextInteger(500, 2000)
					state:AddFeed("ğŸ™ˆ Back in action. Customers missed you. Money flowing again.")
				end,
			},
			{
				index = 2,
				text = "Stay out - use this as exit opportunity",
				effects = { Happiness = 8 },
				feedText = "Perfect time to quit...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.laying_low = nil
					state.Flags.street_hustler = nil
					state.Flags.dealer = nil
					state.Flags.former_hustler = true
					state.Flags.clean_exit = true
					state:AddFeed("ğŸ™ˆ Used the break to get out clean. No drama. Smart exit.")
				end,
			},
			{
				index = 3,
				text = "Test the waters carefully",
				effects = {},
				feedText = "One small deal first...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.70 then
						state.Flags = state.Flags or {}
						state.Flags.laying_low = nil
						state.Flags.street_hustler = true
						state.Money = (state.Money or 0) + RANDOM:NextInteger(300, 800)
						state:AddFeed("ğŸ™ˆ Test deal went smooth. Looks safe to continue.")
					else
						local years = jailPlayer(state, 1, 4, "They were waiting")
						state:AddFeed(string.format("ğŸš” They were watching the whole time! %d years.", math.floor(years)))
					end
				end,
			},
		},
	},
	
	{
		id = "street_big_score_aftermath",
		emoji = "ğŸ°",
		title = "Life After The Big Score",
		text = "That huge score changed everything. Now everyone knows you're sitting on serious cash.",
		question = "How do you protect your wealth?",
		category = "career",
		weight = 5,
		minAge = 22,
		maxAge = 55,
		baseChance = 0.25, -- LOWERED
		cooldown = 6, -- INCREASED
		oneTime = true, -- Only once!
		-- CRITICAL LINKAGE: Only triggers after a big score
		requiresFlags = { big_score_winner = true },
		blockedByFlags = { in_prison = true, has_legitimate_investments = true, paranoid_rich = true },
		
		choices = {
			{
				index = 1,
				text = "Invest in legitimate businesses",
				effects = { Smarts = 5 },
				feedText = "Cleaning the money...",
				onResolve = function(state)
					local investment = math.min((state.Money or 0) * 0.5, 100000)
					if investment >= 10000 then
						state.Money = (state.Money or 0) - investment
						state.Flags = state.Flags or {}
						state.Flags.has_legitimate_investments = true
						state:ModifyStat("Happiness", 10)
						state:AddFeed(string.format("ğŸ° Invested $%d in businesses. Building legit wealth now.", math.floor(investment)))
					else
						state:AddFeed("ğŸ° Not enough to invest properly. Still in the game.")
					end
				end,
			},
			{
				index = 2,
				text = "Hide it and lay extremely low",
				effects = { Happiness = -5 },
				setFlags = { laying_low = true },
				feedText = "Paranoid but safe...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.paranoid_rich = true
					state:AddFeed("ğŸ° Living modest, cash hidden. No one knows what you have. Smart.")
				end,
			},
			{
				index = 3,
				text = "Flex your wealth",
				effects = { Happiness = 10 },
				feedText = "YOLO!",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state.Fame = (state.Fame or 0) + 10
						state:AddFeed("ğŸ° Living large! Everyone sees you winning! Feels good!")
					else
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(10000, 50000))
						state:AddFeed("ğŸ° Too much attention. Got robbed. People knew you were rich.")
					end
				end,
			},
		},
	},
	
	{
		id = "street_went_legit_consequence",
		emoji = "ğŸª",
		title = "Legit Business Challenges",
		text = "Running a legit business is HARD. Taxes, permits, employees... it's a lot.",
		question = "How do you handle the pressure?",
		category = "career",
		weight = 5,
		minAge = 20,
		maxAge = 55,
		baseChance = 0.25, -- LOWERED
		cooldown = 5, -- INCREASED
		-- CRITICAL LINKAGE: Only triggers if you went legit
		requiresFlags = { went_legit = true },
		blockedByFlags = { in_prison = true, street_hustler = true, successful_business_owner = true },
		
		choices = {
			{
				index = 1,
				text = "Grind through it - this is the hard part",
				effects = { Happiness = -5, Smarts = 5 },
				feedText = "Legal hustle is still hustle...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.55 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(20000, 60000)
						state.Flags = state.Flags or {}
						state.Flags.successful_business_owner = true
						state:ModifyStat("Happiness", 15)
						state:AddFeed("ğŸª Business is thriving! First profitable year! You made it!")
					else
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(5000, 15000))
						state:AddFeed("ğŸª Tough year. Lost money. But still legit. Keep pushing.")
					end
				end,
			},
			{
				index = 2,
				text = "Return to what you know",
				effects = { Money = 5000, Happiness = 3 },
				feedText = "Old habits...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.street_hustler = true
					state.Flags.dealer = true
					state.Flags.went_legit = nil
					state.Flags.relapsed_to_crime = true
					state:AddFeed("ğŸª Couldn't hack it. Back in the game. The streets always call.")
				end,
			},
			{
				index = 3,
				text = "Get a business mentor",
				effects = { Smarts = 8 },
				feedText = "Learning from the pros...",
				onResolve = function(state)
					local money = state.Money or 0
					if money >= 2000 then
						state.Money = money - 2000
						state.Flags = state.Flags or {}
						state.Flags.has_business_mentor = true
						state:AddFeed("ğŸª Found a mentor! Learning real business skills. Investment in yourself.")
					else
						state:AddFeed("ğŸª Can't afford a mentor right now. Figure it out yourself.")
					end
				end,
			},
		},
	},
	
	{
		id = "street_untrusted_consequence",
		emoji = "ğŸ˜°",
		title = "Lost Trust Problems",
		text = "Word spread that you refused a loyalty test. Now you're getting cut out of deals.",
		question = "How do you handle this isolation?",
		category = "career",
		weight = 6,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.3, -- LOWERED
		cooldown = 5, -- INCREASED
		oneTime = true, -- Only once!
		-- CRITICAL LINKAGE: Only triggers if untrusted
		requiresFlags = { untrusted = true, street_hustler = true },
		blockedByFlags = { in_prison = true, redeemed = true, new_crew = true, solo_hustler = true },
		
		choices = {
			{
				index = 1,
				text = "Prove yourself with a big move",
				effects = {},
				feedText = "Redemption time...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.40 then
						state.Flags = state.Flags or {}
						state.Flags.untrusted = nil
						state.Flags.redeemed = true
						state.CareerInfo = state.CareerInfo or {}
						state.CareerInfo.hustlerRep = (state.CareerInfo.hustlerRep or 0) + 20
						state:AddFeed("ğŸ˜° Big risk paid off! Trust restored! Back in the fold.")
					elseif roll < 0.70 then
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ˜° Move didn't impress anyone. Still on the outside.")
					else
						local years = jailPlayer(state, 2, 6, "Trying too hard")
						state:AddFeed(string.format("ğŸš” Overreached and got caught. %d years.", math.floor(years)))
					end
				end,
			},
			{
				index = 2,
				text = "Find a new crew",
				effects = { Happiness = -5 },
				feedText = "Starting over with new people...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.untrusted = nil
					state.Flags.new_crew = true
					state.CareerInfo = state.CareerInfo or {}
					state.CareerInfo.hustlerRep = 10 -- Reset rep with new crew
					state:AddFeed("ğŸ˜° Found a new crew. Starting from the bottom again. Fresh start.")
				end,
			},
			{
				index = 3,
				text = "Go solo",
				effects = {},
				feedText = "Independent operator...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.untrusted = nil
					state.Flags.solo_hustler = true
					state:AddFeed("ğŸ˜° Working alone now. No protection but no politics either.")
				end,
			},
		},
	},
}

return events
