--[[
	Education Career Events
	AAA-quality events with random BitLife-style outcomes
	User CANNOT control outcomes - everything is randomized
	
	Careers covered:
	- Teaching Assistant
	- Teacher
	- Department Head
	- Principal
	- Professor
	- Dean
]]

local EducationCareerEvents = {}

local function hasEducationJob(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local category = (state.CurrentJob.category or ""):lower()
	return category == "education" or jobId:find("teacher") or jobId:find("professor") 
		or jobId:find("principal") or jobId:find("dean") or jobId:find("superintendent")
end

local function isTeacher(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("teacher") or jobId:find("teaching")
end

local function isProfessor(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("professor") or jobId:find("dean")
end

EducationCareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- TEACHER EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "edu_difficult_student",
		title = "Challenging Student",
		emoji = "ğŸ˜¤",
		text = "One student is constantly disrupting your class. Other students can't learn, and you're at your wit's end.",
		category = "career_education",
		weight = 18,
		minAge = 22, maxAge = 65,
		baseChance = 0.55,
		cooldown = 2,
		requiresJob = true,
		-- CRITICAL FIX: Added requiresJobCategory as PRIMARY check
		requiresJobCategory = "education",
		eligibility = isTeacher,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Have a private conversation with them",
				effects = { Smarts = 3 },
				feedText = "Trying to understand what's going on...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 15) end
						state.Flags = state.Flags or {}
						state.Flags.mentor_teacher = true
						if state.AddFeed then state:AddFeed("ğŸ˜¤ Breakthrough! They were struggling at home. With support, they turned around completely!") end
					elseif roll <= 80 then
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						if state.AddFeed then state:AddFeed("ğŸ˜¤ Some improvement. Building trust takes time.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then state:AddFeed("ğŸ˜¤ They shut down. At least you tried.") end
					end
				end,
			},
			{
				text = "Involve parents and administration",
				effects = {},
				feedText = "Following proper channels...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 10) end
						if state.AddFeed then state:AddFeed("ğŸ˜¤ Parents were supportive. Behavior improved significantly.") end
					elseif roll <= 70 then
						if state.ModifyStat then state:ModifyStat("Happiness", 3) end
						if state.AddFeed then state:AddFeed("ğŸ˜¤ Parents blamed you. Admin was no help. Typical.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -8) end
						if state.AddFeed then state:AddFeed("ğŸ˜¤ Student was removed from your class. Feels like failure.") end
					end
				end,
			},
			{
				text = "Send them out every time",
				effects = { Happiness = -3 },
				feedText = "Can't teach if they're disrupting...",
				onResolve = function(state)
					-- AAA FIX: Nil check for all state methods
					if state.ModifyStat then state:ModifyStat("Happiness", -5) end
					if state.AddFeed then state:AddFeed("ğŸ˜¤ Class is calmer but you're just passing the problem around.") end
				end,
			},
		},
	},
	
	{
		id = "edu_student_success",
		title = "Student Success Story",
		emoji = "â­",
		text = "A former student reached out to thank you. They said you changed their life and inspired them to pursue their dreams!",
		category = "career_education",
		weight = 15,
		minAge = 25, maxAge = 70,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "This is why you teach!",
				effects = { Happiness = 20 },
				setFlags = { inspired_students = true },
				feedText = "â­ The best feeling. Making a difference one student at a time. THIS is teaching.",
			},
		},
	},
	
	{
		id = "edu_standardized_testing",
		title = "Testing Pressure",
		emoji = "ğŸ“",
		text = "Administration is pushing hard for better standardized test scores. They want you to 'teach to the test.'",
		category = "career_education",
		weight = 14,
		minAge = 22, maxAge = 60,
		baseChance = 0.5,
		cooldown = 2,
		requiresJob = true,
		eligibility = isTeacher,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Focus on test prep",
				effects = {},
				feedText = "Teaching to the test...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						state.Flags = state.Flags or {}
						state.Flags.good_test_scores = true
						if state.AddFeed then state:AddFeed("ğŸ“ Scores went up! Admin is happy. Students? Bored.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -8) end
						if state.AddFeed then state:AddFeed("ğŸ“ Scores barely moved. All that stress for nothing.") end
					end
				end,
			},
			{
				text = "Keep teaching your way",
				effects = { Smarts = 2 },
				feedText = "Real learning over test scores...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 12) end
						if state.AddFeed then state:AddFeed("ğŸ“ Scores were fine AND students actually learned! Win-win!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then state:AddFeed("ğŸ“ Scores dipped. Getting heat from admin. Standing by your methods.") end
					end
				end,
			},
		},
	},
	
	{
		id = "edu_parent_conflict",
		title = "Angry Parent",
		emoji = "ğŸ˜¡",
		text = "A parent is furious about their child's grade. They're demanding you change it and threatening to go to the school board!",
		category = "career_education",
		weight = 14,
		minAge = 22, maxAge = 65,
		baseChance = 0.5,
		cooldown = 2,
		requiresJob = true,
		eligibility = isTeacher,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Explain your grading objectively",
				effects = { Smarts = 2 },
				feedText = "Showing them the rubric and assignments...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 8) end
						if state.AddFeed then state:AddFeed("ğŸ˜¡ Parent understood once they saw the evidence. Crisis averted.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						if state.AddFeed then state:AddFeed("ğŸ˜¡ They still went to the board. Exhausting meetings ahead...") end
					end
				end,
			},
			{
				text = "Offer extra credit opportunity",
				effects = {},
				feedText = "Meeting them halfway...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						if state.AddFeed then state:AddFeed("ğŸ˜¡ Compromise accepted. Student earned a better grade legitimately.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -3) end
						if state.AddFeed then state:AddFeed("ğŸ˜¡ Now every parent expects special treatment. Precedent set.") end
					end
				end,
			},
			{
				text = "Stand firm - the grade stands",
				effects = { Happiness = -5 },
				feedText = "Integrity matters...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 10) end
						state.Flags = state.Flags or {}
						state.Flags.principled_teacher = true
						if state.AddFeed then state:AddFeed("ğŸ˜¡ Board backed you up. Your integrity was recognized!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -15) end
						if state.AddFeed then state:AddFeed("ğŸ˜¡ Political pressure. Grade was overturned anyway. Demoralizing.") end
					end
				end,
			},
		},
	},
	
	{
		id = "edu_budget_cuts",
		title = "Budget Cuts",
		emoji = "ğŸ’¸",
		text = "District budget cuts are hitting hard. Programs are being eliminated and class sizes are increasing.",
		category = "career_education",
		weight = 12,
		minAge = 22, maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Buy supplies with your own money",
				effects = { Happiness = 3 },
				feedText = "Because kids need supplies...",
				-- CRITICAL FIX: Add eligibility check to ensure player can afford supplies
				eligibility = function(state)
					if (state.Money or 0) < 200 then
						return false, "Can't afford supplies right now"
					end
					return true
				end,
				onResolve = function(state)
					local spent = math.random(200, 800)
					-- CRITICAL FIX: Prevent negative money
					spent = math.min(spent, state.Money or 0)
					state.Money = math.max(0, (state.Money or 0) - spent)
					-- AAA FIX: Nil check for all state methods
					if state.ModifyStat then state:ModifyStat("Happiness", 5) end
					if state.AddFeed then state:AddFeed(string.format("ğŸ’¸ Spent $%d on classroom supplies. Tax write-off at least?", spent)) end
				end,
			},
			{
				text = "Advocate for better funding",
				effects = { Smarts = 3 },
				feedText = "Attending school board meetings...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 15) end
						if state.AddFeed then state:AddFeed("ğŸ’¸ Your advocacy helped! Some funding was restored!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then state:AddFeed("ğŸ’¸ Spoke at board meetings. Nothing changed. System is broken.") end
					end
				end,
			},
			{
				text = "Start a fundraiser",
				effects = {},
				feedText = "GoFundMe for classroom needs...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						local raised = math.random(500, 2000)
						state.Money = (state.Money or 0) + raised
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 10) end
						if state.AddFeed then state:AddFeed(string.format("ğŸ’¸ Community stepped up! Raised $%d for classroom!", raised)) end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -3) end
						if state.AddFeed then state:AddFeed("ğŸ’¸ Fundraiser didn't take off. Teachers shouldn't have to do this.") end
					end
				end,
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PROFESSOR/UNIVERSITY EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "edu_publish_or_perish",
		title = "Publish or Perish",
		emoji = "ğŸ“š",
		text = "Tenure review is coming up. You need publications, but teaching is consuming all your time.",
		category = "career_education",
		weight = 14,
		minAge = 28, maxAge = 55,
		baseChance = 0.5,
		cooldown = 3,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Focus on research - students can wait",
				effects = { Health = -5 },
				feedText = "Writing papers day and night...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 15) end
						state.Flags = state.Flags or {}
						state.Flags.published_researcher = true
						if state.AddFeed then state:AddFeed("ğŸ“š Paper accepted in top journal! Tenure looking likely!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						if state.AddFeed then state:AddFeed("ğŸ“š Paper rejected. Teaching reviews tanked. Worst of both worlds.") end
					end
				end,
			},
			{
				text = "Balance both - somehow",
				effects = { Health = -8 },
				feedText = "24/7 grind mode...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 20) end
						state.Money = (state.Money or 0) + math.random(5000, 15000)
						if state.AddFeed then state:AddFeed("ğŸ“š Published AND great student reviews! Exhausted but successful!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then state:AddFeed("ğŸ“š Did both mediocrely. Jack of all trades, master of none.") end
					end
				end,
			},
			{
				text = "Prioritize teaching",
				effects = { Happiness = 5 },
				feedText = "Students come first...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 35 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 12) end
						if state.AddFeed then state:AddFeed("ğŸ“š Teaching awards! But tenure committee wants publications...") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -8) end
						if state.AddFeed then state:AddFeed("ğŸ“š Tenure denied. 'Insufficient research output.' Teaching doesn't count?") end
					end
				end,
			},
		},
	},
	
	{
		id = "edu_grad_student_drama",
		title = "Graduate Student Crisis",
		emoji = "ğŸ˜°",
		text = "Your graduate student is struggling badly. Their thesis is a mess and they're clearly not cut out for academia.",
		category = "career_education",
		weight = 12,
		minAge = 32, maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Work intensively to save them",
				effects = { Health = -5, Smarts = 3 },
				feedText = "Investing massive time in mentorship...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 15) end
						state.Flags = state.Flags or {}
						state.Flags.great_mentor = true
						if state.AddFeed then state:AddFeed("ğŸ˜° They turned it around! Defended successfully! You saved a career!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						if state.AddFeed then state:AddFeed("ğŸ˜° Despite everything, they quit. Sometimes it's not meant to be.") end
					end
				end,
			},
			{
				text = "Have an honest conversation about their future",
				effects = { Smarts = 2 },
				feedText = "Hard truths...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 8) end
						if state.AddFeed then state:AddFeed("ğŸ˜° They appreciated the honesty. Found a non-academic path they love.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then state:AddFeed("ğŸ˜° They were devastated. Called you unsupportive. Awkward now.") end
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX: Tenure Decision requires PROFESSOR job!
	-- User complaint: "TENURE DECISION POPPED UP BUT IM JUST A JANITOR"
	-- Added stricter eligibility check and careerPath requirement
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "edu_tenure_decision",
		title = "Tenure Decision",
		emoji = "ğŸ“",
		text = "The tenure committee has made their decision. Your entire career has led to this moment.",
		category = "career_education",
		careerPath = "professor",  -- CRITICAL: Only for professors!
		weight = 8,
		minAge = 32, maxAge = 55,
		baseChance = 0.35,
		cooldown = 10,
		oneTime = true,
		requiresJob = true,
		-- CRITICAL FIX: Much stricter eligibility - must be professor/academia
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			local jobCat = (state.CurrentJob.category or ""):lower()
			
			-- MUST be a professor, dean, or academic position
			local isAcademic = jobId:find("professor") or jobId:find("dean") 
				or jobId:find("lecturer") or jobId:find("academic")
				or jobId:find("faculty") or jobId:find("researcher")
				or (jobCat == "education" and jobId:find("university"))
			
			-- Explicitly NOT a janitor, custodian, etc.
			if jobId:find("janitor") or jobId:find("custodian") or jobId:find("maintenance")
				or jobId:find("cleaner") or jobId:find("groundskeeper") then
				return false
			end
			
			return isAcademic == true
		end,
		blockedByFlags = { in_prison = true, has_tenure = true },
		
		choices = {
			{
				text = "Open the letter...",
				effects = {},
				feedText = "Heart pounding...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					local performance = (state.CareerInfo and state.CareerInfo.performance) or 60
					local bonus = (performance - 50) / 2 -- Up to +25% from performance
					
					if roll + bonus <= 65 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 30) end
						state.Money = (state.Money or 0) + math.random(10000, 30000)
						state.Flags = state.Flags or {}
						state.Flags.has_tenure = true
						state.Flags.tenured_professor = true
						if state.AddFeed then state:AddFeed("ğŸ“ TENURE GRANTED! Job security for life! Everything paid off!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -30) end
						if state.AddFeed then state:AddFeed("ğŸ“ Tenure denied. Years of work... Have to find another position.") end
					end
				end,
			},
		},
	},
	
	{
		id = "edu_research_breakthrough",
		title = "Research Breakthrough!",
		emoji = "ğŸ”¬",
		text = "Your research has led to a major breakthrough! This could be career-defining!",
		category = "career_education",
		weight = 10,
		minAge = 28, maxAge = 70,
		baseChance = 0.35,
		cooldown = 5,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Publish immediately",
				effects = { Happiness = 15 },
				feedText = "Getting this out there!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state.Money = (state.Money or 0) + math.random(20000, 80000)
						state.Fame = (state.Fame or 0) + 30
						state.Flags = state.Flags or {}
						state.Flags.renowned_researcher = true
						-- AAA FIX: Nil check for all state methods
						if state.AddFeed then state:AddFeed("ğŸ”¬ Paper went viral in academic circles! Invitations to speak everywhere!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						if state.AddFeed then state:AddFeed("ğŸ”¬ Published but didn't make the splash you hoped. Still good work.") end
					end
				end,
			},
			{
				text = "Patent it first",
				effects = { Smarts = 3 },
				feedText = "Protecting intellectual property...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						local licensing = math.random(50000, 200000)
						state.Money = (state.Money or 0) + licensing
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 25) end
						if state.AddFeed then state:AddFeed(string.format("ğŸ”¬ Patent granted! Licensing deal worth $%d!", licensing)) end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						if state.AddFeed then state:AddFeed("ğŸ”¬ Patent process is slow. Someone else published similar findings first.") end
					end
				end,
			},
		},
	},
	
	{
		id = "edu_inspiring_lecture",
		title = "Standing Ovation",
		emoji = "ğŸ‘",
		text = "You just delivered the lecture of a lifetime. Students are standing and applauding!",
		category = "career_education",
		weight = 12,
		minAge = 22, maxAge = 70,
		baseChance = 0.4,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Take it in - you've earned this",
				effects = { Happiness = 20 },
				setFlags = { legendary_educator = true },
				feedText = "ğŸ‘ THIS is why you became an educator. Moments like this make everything worth it.",
			},
		},
	},
	
	{
		id = "edu_burnout",
		title = "Teacher Burnout",
		emoji = "ğŸ˜©",
		text = "You're exhausted. The emotional labor, the paperwork, the parents, the administration... Is this sustainable?",
		category = "career_education",
		weight = 15,
		minAge = 25, maxAge = 60,
		baseChance = 0.5,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Take a mental health day",
				effects = { Health = 8, Happiness = 5 },
				feedText = "Self-care isn't selfish...",
			},
			{
				text = "Push through - students need you",
				effects = { Health = -8, Happiness = -5 },
				feedText = "Martyrdom isn't healthy...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						-- AAA FIX: Nil check for all state methods
						if state.ModifyStat then state:ModifyStat("Happiness", 10) end
						if state.AddFeed then state:AddFeed("ğŸ˜© Made it through. Second wind found.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						state.Flags = state.Flags or {}
						state.Flags.severe_burnout = true
						if state.AddFeed then state:AddFeed("ğŸ˜© Crashed hard. Need extended leave. System is broken.") end
					end
				end,
			},
			{
				text = "Consider leaving the profession",
				effects = { Smarts = 2 },
				setFlags = { considering_career_change = true },
				feedText = "ğŸ˜© Sometimes the best thing for students is teachers who aren't burnt out...",
			},
		},
	},
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- COACH EVENTS - User requested "COACH JOB DOSENT HAVE ANY LIFEEVNTS"
-- Sports coaches at schools and pro teams
-- CRITICAL FIX: Moved return statement to END of file so these events load!
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CoachCareerEvents = {
	{
		id = "coach_team_tryouts",
		title = "Team Tryouts",
		emoji = "ğŸ“‹",
		text = "It's tryout season! You have to make some tough cuts to build your roster.",
		category = "career_coach",
		weight = 16,
		minAge = 25, maxAge = 65,
		baseChance = 0.55,
		cooldown = 2,
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("coach")
		end,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Select purely on talent",
				effects = { Smarts = 2 },
				feedText = "Making tough decisions...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						if state.ModifyStat then state:ModifyStat("Happiness", 10) end
						if state.AddFeed then state:AddFeed("ğŸ“‹ Built a championship-caliber roster! Team chemistry is electric!") end
						state.Flags = state.Flags or {}
						state.Flags.strong_team = true
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -5) end
						if state.AddFeed then state:AddFeed("ğŸ“‹ Some angry parents. Cut a donor's kid. Politics incoming...") end
					end
				end,
			},
			{
				text = "Consider character and work ethic too",
				effects = { Happiness = 3, Smarts = 3 },
				feedText = "ğŸ“‹ Balanced approach. Got some good kids who'll work hard.",
			},
			{
				text = "Let everyone make the team",
				effects = { Happiness = 2 },
				feedText = "ğŸ“‹ No cuts this year. Everyone plays. Development over winning.",
			},
		},
	},
	{
		id = "coach_big_game",
		title = "Championship Game!",
		emoji = "ğŸ†",
		text = "Your team made it to the championship! The whole school/city is watching. Pressure is INTENSE.",
		category = "career_coach",
		weight = 14,
		minAge = 25, maxAge = 65,
		baseChance = 0.35,
		cooldown = 3,
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("coach")
		end,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Stick to our game plan",
				effects = {},
				feedText = "Trust in the preparation...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						if state.ModifyStat then state:ModifyStat("Happiness", 25) end
						state.Money = (state.Money or 0) + 5000
						state.Flags = state.Flags or {}
						state.Flags.championship_coach = true
						if state.AddFeed then state:AddFeed("ğŸ† CHAMPIONS! Your team won it all! You're carried off the field!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						if state.AddFeed then state:AddFeed("ğŸ† Lost the big game. So close. They played their hearts out.") end
					end
				end,
			},
			{
				text = "Make bold halftime adjustments",
				effects = { Smarts = 3 },
				feedText = "Rolling the dice...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						if state.ModifyStat then state:ModifyStat("Happiness", 30) end
						state.Money = (state.Money or 0) + 8000
						state.Flags = state.Flags or {}
						state.Flags.genius_coach = true
						if state.AddFeed then state:AddFeed("ğŸ† BRILLIANT! Your adjustments won the game! You're a genius!") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -15) end
						if state.AddFeed then state:AddFeed("ğŸ† Adjustments backfired. Crushed. Second-guessing everything.") end
					end
				end,
			},
			{
				text = "Focus on motivating the players",
				effects = { Happiness = 5 },
				feedText = "It's about the kids...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						if state.ModifyStat then state:ModifyStat("Happiness", 20) end
						state.Flags = state.Flags or {}
						state.Flags.players_coach = true
						if state.AddFeed then state:AddFeed("ğŸ† They played their best game ever. Win or lose, you're proud.") end
					else
						if state.AddFeed then state:AddFeed("ğŸ† Heart wasn't enough today. Better team won.") end
					end
				end,
			},
		},
	},
	{
		id = "coach_injured_star",
		title = "Star Player Injured!",
		emoji = "ğŸ¤•",
		text = "Your star player went down with an injury right before the big game. Team morale is shaken.",
		category = "career_coach",
		weight = 15,
		minAge = 25, maxAge = 65,
		baseChance = 0.45,
		cooldown = 2,
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("coach")
		end,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Rally the team - next player up!",
				effects = { Happiness = 3, Smarts = 2 },
				feedText = "ğŸ¤• Adversity reveals character. Team stepped up!",
			},
			{
				text = "Adjust the entire game plan",
				effects = { Smarts = 4 },
				feedText = "ğŸ¤• Complete scheme overhaul. Pulling all-nighters.",
			},
			{
				text = "Let the backup know they're ready",
				effects = { Happiness = 5 },
				feedText = "ğŸ¤• Building confidence in the backup. Their time to shine!",
			},
		},
	},
	{
		id = "coach_parent_complaint",
		title = "Angry Sports Parent",
		emoji = "ğŸ˜ ",
		text = "A parent is livid that their kid isn't getting enough playing time. They're threatening to go to the athletic director.",
		category = "career_coach",
		weight = 16,
		minAge = 25, maxAge = 65,
		baseChance = 0.50,
		cooldown = 2,
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("coach")
		end,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Explain your rotation decisions",
				effects = { Smarts = 2 },
				feedText = "Calmly walking through the reasons...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						if state.AddFeed then state:AddFeed("ğŸ˜  Parent understood. Crisis averted. Professionalism wins.") end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -8) end
						if state.AddFeed then state:AddFeed("ğŸ˜  They went to the AD anyway. Now you have meetings.") end
					end
				end,
			},
			{
				text = "Stand firm - playing time is earned",
				effects = { Happiness = -3 },
				setFlags = { tough_coach = true },
				feedText = "ğŸ˜  You don't negotiate with helicopter parents.",
			},
			{
				text = "Give the kid a chance to prove themselves",
				effects = { Happiness = 2 },
				feedText = "ğŸ˜  Put them in during practice. Let their play do the talking.",
			},
		},
	},
	{
		id = "coach_recruit_talent",
		title = "Recruiting Opportunity",
		emoji = "ğŸ¯",
		text = "A talented athlete is considering joining your program. They're also talking to rival schools.",
		category = "career_coach",
		weight = 12,
		minAge = 25, maxAge = 65,
		baseChance = 0.40,
		cooldown = 3,
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("coach")
		end,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Sell them on your program's culture",
				effects = { Smarts = 3, Happiness = 3 },
				feedText = "Building something special...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state.Flags = state.Flags or {}
						state.Flags.great_recruiter = true
						if state.ModifyStat then state:ModifyStat("Happiness", 10) end
						if state.AddFeed then state:AddFeed("ğŸ¯ They committed! Next year's roster is looking STACKED!") end
					else
						if state.AddFeed then state:AddFeed("ğŸ¯ They chose the rival. Hurts, but you'll build without them.") end
					end
				end,
			},
			{
				text = "Focus on development opportunities",
				effects = { Smarts = 2 },
				feedText = "ğŸ¯ Showed them how you develop players. Let results speak.",
			},
			{
				text = "Don't oversell - let them decide",
				effects = { Happiness = 2 },
				feedText = "ğŸ¯ Honest approach. If it's meant to be, they'll come.",
			},
		},
	},
}

-- Merge coach events into main table
for _, event in ipairs(CoachCareerEvents) do
	table.insert(EducationCareerEvents, event)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- TEACHER QUIZ/LESSON CHOICE EVENTS
-- User requested: "IF IM A TEACHER I CAN DECIDE WHAT I WANNA QUIZ THE KIDS IM TEACHING ON"
-- Interactive teaching events where player makes curriculum decisions
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

table.insert(EducationCareerEvents, {
	id = "teacher_quiz_choice",
	emoji = "ğŸ“",
	title = "Pop Quiz Time!",
	textVariants = {
		"Your students look TERRIFIED. You're holding a stack of blank quiz papers and a devious smile.",
		"Friday afternoon. Perfect time for a surprise quiz. Your students groan as you pass out papers.",
		"The class has been slacking. Time to remind them you're serious. Quiz time!",
	},
	text = "Time for a quiz! What do you test them on?",
	category = "career_education",
	weight = 15,
	minAge = 23, maxAge = 65,
	baseChance = 0.55,
	cooldown = 2,
	requiresJob = true,
	eligibility = hasEducationJob,
	blockedByFlags = { in_prison = true },
	
	choices = {
		{
			text = "ğŸ“– Core curriculum - by the book",
			effects = { Smarts = 2 },
			feedText = "Testing the basics...",
			onResolve = function(state)
				local roll = math.random(1, 100)
				if roll <= 60 then
					if state.ModifyStat then state:ModifyStat("Happiness", 5) end
					if state.AddFeed then state:AddFeed("ğŸ“ Most students passed! Your teaching is working!") end
				else
					if state.ModifyStat then state:ModifyStat("Happiness", -3) end
					if state.AddFeed then state:AddFeed("ğŸ“ Results were... disappointing. Need to review the material.") end
				end
			end,
		},
		{
			text = "ğŸ§  Critical thinking - make them THINK",
			effects = { Smarts = 4 },
			feedText = "Testing their reasoning...",
			onResolve = function(state)
				local roll = math.random(1, 100)
				if roll <= 40 then
					if state.ModifyStat then state:ModifyStat("Happiness", 10) end
					state.Flags = state.Flags or {}
					state.Flags.great_teacher = true
					if state.AddFeed then state:AddFeed("ğŸ“ Some brilliant answers! You're developing real thinkers!") end
				else
					if state.ModifyStat then state:ModifyStat("Happiness", 2) end
					if state.AddFeed then state:AddFeed("ğŸ“ Students struggled but they're learning to think deeper.") end
				end
			end,
		},
		{
			text = "ğŸ¯ Current events - keep it relevant",
			effects = { Smarts = 3, Happiness = 3 },
			feedText = "ğŸ“ Testing on what matters today. Students were engaged!",
		},
		{
			text = "ğŸ¤£ Trick questions - have some fun",
			effects = { Happiness = 5 },
			feedText = "Testing their attention to detail...",
			onResolve = function(state)
				local roll = math.random(1, 100)
				if roll <= 50 then
					if state.ModifyStat then state:ModifyStat("Happiness", 8) end
					if state.AddFeed then state:AddFeed("ğŸ“ Students laughed at the tricks. Learning can be fun!") end
				else
					if state.ModifyStat then state:ModifyStat("Happiness", -5) end
					if state.AddFeed then state:AddFeed("ğŸ“ Parents complained about 'unfair questions.' Oops.") end
				end
			end,
		},
	},
})

table.insert(EducationCareerEvents, {
	id = "teacher_lesson_plan",
	emoji = "ğŸ“š",
	title = "Lesson Planning",
	text = "You're preparing tomorrow's lesson. What approach do you take?",
	category = "career_education",
	weight = 14,
	minAge = 23, maxAge = 65,
	baseChance = 0.50,
	cooldown = 2,
	requiresJob = true,
	eligibility = hasEducationJob,
	blockedByFlags = { in_prison = true },
	
	choices = {
		{
			text = "ğŸ“– Traditional lecture style",
			effects = { Smarts = 2 },
			feedText = "ğŸ“š Classic approach. Some students tuned out, others took great notes.",
		},
		{
			text = "ğŸ® Interactive games and activities",
			effects = { Happiness = 5, Smarts = 1 },
			feedText = "ğŸ“š Students had fun! Did they learn? Time will tell.",
		},
		{
			text = "ğŸ’» Technology-based learning",
			effects = { Smarts = 3 },
			feedText = "ğŸ“š iPads and computers kept students engaged. Modern teaching!",
		},
		{
			text = "ğŸ¬ Show a documentary",
			effects = { Happiness = 3 },
			feedText = "ğŸ“š Easy day for you. Students learned... maybe? At least it was peaceful.",
		},
		{
			text = "ğŸ‘¥ Group projects and discussions",
			effects = { Smarts = 3, Happiness = 2 },
			feedText = "ğŸ“š Collaborative learning! Some groups thrived, others argued. Normal day.",
		},
	},
})

table.insert(EducationCareerEvents, {
	id = "teacher_student_question",
	emoji = "â“",
	title = "Tough Student Question",
	textVariants = {
		"A student raises their hand: 'Why do we have to learn this? When will I ever use this in real life?'",
		"A curious student asks a question you weren't prepared for. The class is watching your response.",
		"'That's a great question!' you say, while internally panicking because you don't know the answer.",
	},
	text = "How do you handle this?",
	category = "career_education",
	weight = 13,
	minAge = 23, maxAge = 65,
	baseChance = 0.45,
	cooldown = 2,
	requiresJob = true,
	eligibility = hasEducationJob,
	blockedByFlags = { in_prison = true },
	
	choices = {
		{
			text = "Give a thoughtful, inspiring answer",
			effects = { Smarts = 4, Happiness = 5 },
			feedText = "â“ Your response actually made the student think differently. Teaching win!",
		},
		{
			text = "Admit you don't know and research it together",
			effects = { Smarts = 3, Happiness = 3 },
			feedText = "â“ Honesty impressed them. 'Even teachers are always learning!' Great lesson.",
		},
		{
			text = "Deflect - 'We'll cover that later'",
			effects = { Happiness = -2 },
			feedText = "â“ Student saw through that. You've lost some credibility.",
		},
		{
			text = "Make up an answer confidently",
			effects = {},
			feedText = "Winging it...",
			onResolve = function(state)
				local roll = math.random(1, 100)
				if roll <= 30 then
					if state.ModifyStat then state:ModifyStat("Happiness", 5) end
					if state.AddFeed then state:AddFeed("â“ They bought it! Confidence is key. (You should probably actually look it up later.)") end
				else
					if state.ModifyStat then state:ModifyStat("Happiness", -8) end
					state.Flags = state.Flags or {}
					state.Flags.caught_lying = true
					if state.AddFeed then state:AddFeed("â“ A student Googled it and called you out. Embarrassing!") end
				end
			end,
		},
	},
})

table.insert(EducationCareerEvents, {
	id = "teacher_field_trip",
	emoji = "ğŸšŒ",
	title = "Field Trip!",
	text = "You're organizing a field trip. Where do you take the class?",
	category = "career_education",
	weight = 10,
	minAge = 23, maxAge = 65,
	baseChance = 0.40,
	cooldown = 4,
	requiresJob = true,
	eligibility = hasEducationJob,
	blockedByFlags = { in_prison = true },
	
	choices = {
		{
			text = "ğŸ›ï¸ Museum - educational and classic",
			effects = { Smarts = 5, Happiness = 3 },
			feedText = "ğŸšŒ Students learned a lot! Only one kid got lost. Success!",
		},
		{
			text = "ğŸŒ³ Nature park - hands-on learning",
			effects = { Health = 3, Smarts = 3, Happiness = 4 },
			feedText = "ğŸšŒ Fresh air and nature! Everyone had fun and learned something.",
		},
		{
			text = "ğŸ­ Factory tour - see how things are made",
			effects = { Smarts = 4 },
			feedText = "ğŸšŒ Industrial learning! A few students found future career interests.",
		},
		{
			text = "ğŸ­ Theater or concert - arts appreciation",
			effects = { Happiness = 6, Smarts = 2 },
			feedText = "ğŸšŒ Cultural experience! Some students discovered a love for the arts.",
		},
		{
			text = "Cancel - too much paperwork",
			effects = { Happiness = -3 },
			feedText = "ğŸšŒ Students were disappointed. You avoided the stress though.",
		},
	},
})

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX: Return at END of file so ALL events above get loaded properly
-- The previous return was at line 646 making CoachCareerEvents and table.inserts unreachable!
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
return EducationCareerEvents
