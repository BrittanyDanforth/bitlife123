--[[
	Education Career Events
	AAA-quality events with random BitLife-style outcomes
	User CANNOT control outcomes - everything is randomized
	
	Careers covered:
	- Teaching Assistant
	- Teacher
	- Department Head
	- Principal
	- Professor
	- Dean
]]

local EducationCareerEvents = {}

local function hasEducationJob(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local category = (state.CurrentJob.category or ""):lower()
	return category == "education" or jobId:find("teacher") or jobId:find("professor") 
		or jobId:find("principal") or jobId:find("dean") or jobId:find("superintendent")
end

local function isTeacher(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("teacher") or jobId:find("teaching")
end

local function isProfessor(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("professor") or jobId:find("dean")
end

EducationCareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- TEACHER EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "edu_difficult_student",
		title = "Challenging Student",
		emoji = "ğŸ˜¤",
		text = "One student is constantly disrupting your class. Other students can't learn, and you're at your wit's end.",
		category = "career_education",
		weight = 18,
		minAge = 22, maxAge = 65,
		baseChance = 0.55,
		cooldown = 2,
		requiresJob = true,
		eligibility = isTeacher,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Have a private conversation with them",
				effects = { Smarts = 3 },
				feedText = "Trying to understand what's going on...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.mentor_teacher = true
						state:AddFeed("ğŸ˜¤ Breakthrough! They were struggling at home. With support, they turned around completely!")
					elseif roll <= 80 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ˜¤ Some improvement. Building trust takes time.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ˜¤ They shut down. At least you tried.")
					end
				end,
			},
			{
				text = "Involve parents and administration",
				effects = {},
				feedText = "Following proper channels...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ˜¤ Parents were supportive. Behavior improved significantly.")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ˜¤ Parents blamed you. Admin was no help. Typical.")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ˜¤ Student was removed from your class. Feels like failure.")
					end
				end,
			},
			{
				text = "Send them out every time",
				effects = { Happiness = -3 },
				feedText = "Can't teach if they're disrupting...",
				onResolve = function(state)
					state:ModifyStat("Happiness", -5)
					state:AddFeed("ğŸ˜¤ Class is calmer but you're just passing the problem around.")
				end,
			},
		},
	},
	
	{
		id = "edu_student_success",
		title = "Student Success Story",
		emoji = "â­",
		text = "A former student reached out to thank you. They said you changed their life and inspired them to pursue their dreams!",
		category = "career_education",
		weight = 15,
		minAge = 25, maxAge = 70,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "This is why you teach!",
				effects = { Happiness = 20 },
				setFlags = { inspired_students = true },
				feedText = "â­ The best feeling. Making a difference one student at a time. THIS is teaching.",
			},
		},
	},
	
	{
		id = "edu_standardized_testing",
		title = "Testing Pressure",
		emoji = "ğŸ“",
		text = "Administration is pushing hard for better standardized test scores. They want you to 'teach to the test.'",
		category = "career_education",
		weight = 14,
		minAge = 22, maxAge = 60,
		baseChance = 0.5,
		cooldown = 2,
		requiresJob = true,
		eligibility = isTeacher,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Focus on test prep",
				effects = {},
				feedText = "Teaching to the test...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 5)
						state.Flags = state.Flags or {}
						state.Flags.good_test_scores = true
						state:AddFeed("ğŸ“ Scores went up! Admin is happy. Students? Bored.")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ“ Scores barely moved. All that stress for nothing.")
					end
				end,
			},
			{
				text = "Keep teaching your way",
				effects = { Smarts = 2 },
				feedText = "Real learning over test scores...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						state:ModifyStat("Happiness", 12)
						state:AddFeed("ğŸ“ Scores were fine AND students actually learned! Win-win!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ“ Scores dipped. Getting heat from admin. Standing by your methods.")
					end
				end,
			},
		},
	},
	
	{
		id = "edu_parent_conflict",
		title = "Angry Parent",
		emoji = "ğŸ˜¡",
		text = "A parent is furious about their child's grade. They're demanding you change it and threatening to go to the school board!",
		category = "career_education",
		weight = 14,
		minAge = 22, maxAge = 65,
		baseChance = 0.5,
		cooldown = 2,
		requiresJob = true,
		eligibility = isTeacher,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Explain your grading objectively",
				effects = { Smarts = 2 },
				feedText = "Showing them the rubric and assignments...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ˜¡ Parent understood once they saw the evidence. Crisis averted.")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ˜¡ They still went to the board. Exhausting meetings ahead...")
					end
				end,
			},
			{
				text = "Offer extra credit opportunity",
				effects = {},
				feedText = "Meeting them halfway...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ˜¡ Compromise accepted. Student earned a better grade legitimately.")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ˜¡ Now every parent expects special treatment. Precedent set.")
					end
				end,
			},
			{
				text = "Stand firm - the grade stands",
				effects = { Happiness = -5 },
				feedText = "Integrity matters...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 10)
						state.Flags = state.Flags or {}
						state.Flags.principled_teacher = true
						state:AddFeed("ğŸ˜¡ Board backed you up. Your integrity was recognized!")
					else
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ˜¡ Political pressure. Grade was overturned anyway. Demoralizing.")
					end
				end,
			},
		},
	},
	
	{
		id = "edu_budget_cuts",
		title = "Budget Cuts",
		emoji = "ğŸ’¸",
		text = "District budget cuts are hitting hard. Programs are being eliminated and class sizes are increasing.",
		category = "career_education",
		weight = 12,
		minAge = 22, maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Buy supplies with your own money",
				effects = { Happiness = 3 },
				feedText = "Because kids need supplies...",
				onResolve = function(state)
					local spent = math.random(200, 800)
					state.Money = (state.Money or 0) - spent
					state:ModifyStat("Happiness", 5)
					state:AddFeed(string.format("ğŸ’¸ Spent $%d on classroom supplies. Tax write-off at least?", spent))
				end,
			},
			{
				text = "Advocate for better funding",
				effects = { Smarts = 3 },
				feedText = "Attending school board meetings...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 15)
						state:AddFeed("ğŸ’¸ Your advocacy helped! Some funding was restored!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ’¸ Spoke at board meetings. Nothing changed. System is broken.")
					end
				end,
			},
			{
				text = "Start a fundraiser",
				effects = {},
				feedText = "GoFundMe for classroom needs...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						local raised = math.random(500, 2000)
						state.Money = (state.Money or 0) + raised
						state:ModifyStat("Happiness", 10)
						state:AddFeed(string.format("ğŸ’¸ Community stepped up! Raised $%d for classroom!", raised))
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ’¸ Fundraiser didn't take off. Teachers shouldn't have to do this.")
					end
				end,
			},
		},
	},

	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PROFESSOR/UNIVERSITY EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "edu_publish_or_perish",
		title = "Publish or Perish",
		emoji = "ğŸ“š",
		text = "Tenure review is coming up. You need publications, but teaching is consuming all your time.",
		category = "career_education",
		weight = 14,
		minAge = 28, maxAge = 55,
		baseChance = 0.5,
		cooldown = 3,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Focus on research - students can wait",
				effects = { Health = -5 },
				feedText = "Writing papers day and night...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.published_researcher = true
						state:AddFeed("ğŸ“š Paper accepted in top journal! Tenure looking likely!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ“š Paper rejected. Teaching reviews tanked. Worst of both worlds.")
					end
				end,
			},
			{
				text = "Balance both - somehow",
				effects = { Health = -8 },
				feedText = "24/7 grind mode...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 20)
						state.Money = (state.Money or 0) + math.random(5000, 15000)
						state:AddFeed("ğŸ“š Published AND great student reviews! Exhausted but successful!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ“š Did both mediocrely. Jack of all trades, master of none.")
					end
				end,
			},
			{
				text = "Prioritize teaching",
				effects = { Happiness = 5 },
				feedText = "Students come first...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 35 then
						state:ModifyStat("Happiness", 12)
						state:AddFeed("ğŸ“š Teaching awards! But tenure committee wants publications...")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ“š Tenure denied. 'Insufficient research output.' Teaching doesn't count?")
					end
				end,
			},
		},
	},
	
	{
		id = "edu_grad_student_drama",
		title = "Graduate Student Crisis",
		emoji = "ğŸ˜°",
		text = "Your graduate student is struggling badly. Their thesis is a mess and they're clearly not cut out for academia.",
		category = "career_education",
		weight = 12,
		minAge = 32, maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Work intensively to save them",
				effects = { Health = -5, Smarts = 3 },
				feedText = "Investing massive time in mentorship...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 15)
						state.Flags = state.Flags or {}
						state.Flags.great_mentor = true
						state:AddFeed("ğŸ˜° They turned it around! Defended successfully! You saved a career!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ˜° Despite everything, they quit. Sometimes it's not meant to be.")
					end
				end,
			},
			{
				text = "Have an honest conversation about their future",
				effects = { Smarts = 2 },
				feedText = "Hard truths...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ˜° They appreciated the honesty. Found a non-academic path they love.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ˜° They were devastated. Called you unsupportive. Awkward now.")
					end
				end,
			},
		},
	},
	
	{
		id = "edu_tenure_decision",
		title = "Tenure Decision",
		emoji = "ğŸ“",
		text = "The tenure committee has made their decision. Your entire career has led to this moment.",
		category = "career_education",
		weight = 8,
		minAge = 32, maxAge = 55,
		baseChance = 0.35,
		cooldown = 10,
		oneTime = true,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true, has_tenure = true },
		
		choices = {
			{
				text = "Open the letter...",
				effects = {},
				feedText = "Heart pounding...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					local performance = (state.CareerInfo and state.CareerInfo.performance) or 60
					local bonus = (performance - 50) / 2 -- Up to +25% from performance
					
					if roll + bonus <= 65 then
						state:ModifyStat("Happiness", 30)
						state.Money = (state.Money or 0) + math.random(10000, 30000)
						state.Flags = state.Flags or {}
						state.Flags.has_tenure = true
						state.Flags.tenured_professor = true
						state:AddFeed("ğŸ“ TENURE GRANTED! Job security for life! Everything paid off!")
					else
						state:ModifyStat("Happiness", -30)
						state:AddFeed("ğŸ“ Tenure denied. Years of work... Have to find another position.")
					end
				end,
			},
		},
	},
	
	{
		id = "edu_research_breakthrough",
		title = "Research Breakthrough!",
		emoji = "ğŸ”¬",
		text = "Your research has led to a major breakthrough! This could be career-defining!",
		category = "career_education",
		weight = 10,
		minAge = 28, maxAge = 70,
		baseChance = 0.35,
		cooldown = 5,
		requiresJob = true,
		eligibility = isProfessor,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Publish immediately",
				effects = { Happiness = 15 },
				feedText = "Getting this out there!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state.Money = (state.Money or 0) + math.random(20000, 80000)
						state.Fame = (state.Fame or 0) + 30
						state.Flags = state.Flags or {}
						state.Flags.renowned_researcher = true
						state:AddFeed("ğŸ”¬ Paper went viral in academic circles! Invitations to speak everywhere!")
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ”¬ Published but didn't make the splash you hoped. Still good work.")
					end
				end,
			},
			{
				text = "Patent it first",
				effects = { Smarts = 3 },
				feedText = "Protecting intellectual property...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						local licensing = math.random(50000, 200000)
						state.Money = (state.Money or 0) + licensing
						state:ModifyStat("Happiness", 25)
						state:AddFeed(string.format("ğŸ”¬ Patent granted! Licensing deal worth $%d!", licensing))
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ”¬ Patent process is slow. Someone else published similar findings first.")
					end
				end,
			},
		},
	},
	
	{
		id = "edu_inspiring_lecture",
		title = "Standing Ovation",
		emoji = "ğŸ‘",
		text = "You just delivered the lecture of a lifetime. Students are standing and applauding!",
		category = "career_education",
		weight = 12,
		minAge = 22, maxAge = 70,
		baseChance = 0.4,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Take it in - you've earned this",
				effects = { Happiness = 20 },
				setFlags = { legendary_educator = true },
				feedText = "ğŸ‘ THIS is why you became an educator. Moments like this make everything worth it.",
			},
		},
	},
	
	{
		id = "edu_burnout",
		title = "Teacher Burnout",
		emoji = "ğŸ˜©",
		text = "You're exhausted. The emotional labor, the paperwork, the parents, the administration... Is this sustainable?",
		category = "career_education",
		weight = 15,
		minAge = 25, maxAge = 60,
		baseChance = 0.5,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasEducationJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Take a mental health day",
				effects = { Health = 8, Happiness = 5 },
				feedText = "Self-care isn't selfish...",
			},
			{
				text = "Push through - students need you",
				effects = { Health = -8, Happiness = -5 },
				feedText = "Martyrdom isn't healthy...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ˜© Made it through. Second wind found.")
					else
						state:ModifyStat("Happiness", -10)
						state.Flags = state.Flags or {}
						state.Flags.severe_burnout = true
						state:AddFeed("ğŸ˜© Crashed hard. Need extended leave. System is broken.")
					end
				end,
			},
			{
				text = "Consider leaving the profession",
				effects = { Smarts = 2 },
				setFlags = { considering_career_change = true },
				feedText = "ğŸ˜© Sometimes the best thing for students is teachers who aren't burnt out...",
			},
		},
	},
}

return EducationCareerEvents
