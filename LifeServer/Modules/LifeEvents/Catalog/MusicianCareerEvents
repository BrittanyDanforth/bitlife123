--[[
	Musician / Music Industry Career Events
	AAA-quality events with random BitLife-style outcomes
	User CANNOT control outcomes - everything is randomized
	
	Careers covered:
	- Signed Musician
	- Recording Artist
	- Popstar
	- Rock Star
	- Music Producer
	- DJ
	
	CRITICAL FIX #RVS-6: Premium path blocking for royalty/mafia players
]]

local MusicianCareerEvents = {}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX #RVS-MUSIC-1: Premium path blocking
-- Music career events should NOT fire for royalty or mafia players (unless already famous)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function isBlockedByPremiumPath(state)
	if not state.Flags then return false end
	local flags = state.Flags
	
	-- If player is already a musician/famous, allow
	if flags.fame_career or flags.signed_artist or flags.signed_musician then
		return false
	end
	
	-- Block if player chose royalty path
	if flags.primary_wish_type == "royalty" then return true end
	if flags.is_royalty or flags.royal_birth or flags.dating_royalty then return true end
	if state.RoyalState and state.RoyalState.isRoyal then return true end
	
	-- Block if player chose mafia path
	if flags.primary_wish_type == "mafia" then return true end
	if flags.in_mob then return true end
	if state.MobState and state.MobState.inMob then return true end
	
	return false
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX #22: Enhanced helper functions for musician careers
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function hasMusicJob(state)
	-- CRITICAL FIX #RVS-MUSIC-2: Check premium path blocking first
	if isBlockedByPremiumPath(state) then return false end
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local jobCat = (state.CurrentJob.category or ""):lower()
	-- CRITICAL FIX #23: Exclude rappers - they have their own event file!
	if jobId:find("rapper") or jobId:find("hip.?hop") then
		return false
	end
	-- CRITICAL FIX #24: Exclude non-musician entertainment careers
	if jobId:find("actor") or jobId:find("athlete") or jobId:find("streamer")
	   or jobId:find("youtuber") or jobId:find("influencer") then
		return false
	end
	return jobId:find("musician") or jobId:find("singer") or jobId:find("band") or 
		   jobId:find("producer") or jobId:find("dj") or jobId:find("composer") or
		   jobId:find("popstar") or jobId:find("rock_star") or jobCat == "music"
end

local function isSignedArtist(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("signed") or jobId:find("recording") or jobId:find("popstar") or
		   jobId:find("rock_star") or (state.Flags and state.Flags.signed_artist)
end

-- CRITICAL FIX #25: Check for DJ specifically
local function isDJ(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("dj") or jobId:find("disc_jockey") or jobId:find("edm")
end

-- CRITICAL FIX #26: Check for producer role
local function isMusicProducer(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	return jobId:find("producer") and not jobId:find("film") and not jobId:find("tv")
end

-- CRITICAL FIX #27: Check for touring musician
local function isOnTour(state)
	return state.Flags and state.Flags.on_tour == true
end

-- CRITICAL FIX #28: Check for music genre
local function getMusicGenre(state)
	if not state.Flags then return "pop" end
	if state.Flags.rock_musician then return "rock" end
	if state.Flags.country_musician then return "country" end
	if state.Flags.edm_artist then return "edm" end
	if state.Flags.rnb_artist then return "rnb" end
	if state.Flags.indie_artist then return "indie" end
	return "pop"
end

MusicianCareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- SIGNED MUSICIAN EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "musician_album_release",
		title = "ğŸµ Album Release Day!",
		emoji = "ğŸµ",
		text = "Your new album drops at midnight! The entire industry is watching to see if you'll succeed or flop!",
		category = "career_music",
		weight = 18,
		minAge = 16, maxAge = 70,
		baseChance = 0.3, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Promote heavily on social media",
				effects = { Health = -3 },
				feedText = "Going live at midnight...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						local sales = math.random(500000, 2000000)
						state.Money = (state.Money or 0) + sales
						state:ModifyStat("Happiness", 25)
						state.Fame = (state.Fame or 0) + 50
						state.Flags = state.Flags or {}
						state.Flags.platinum_album = true
						state:AddFeed(string.format("ğŸµ PLATINUM ALBUM! %d streams in first week! You're a superstar!", sales * 100))
					elseif roll <= 70 then
						local sales = math.random(100000, 400000)
						state.Money = (state.Money or 0) + sales
						state:ModifyStat("Happiness", 10)
						state.Fame = (state.Fame or 0) + 15
						state:AddFeed("ğŸµ Solid numbers! Critics liked it, fans loved it!")
					else
						state:ModifyStat("Happiness", -15)
						state.Fame = (state.Fame or 0) - 10
						state:AddFeed("ğŸµ Album flopped. Only die-hard fans streamed it. Label is 'disappointed'.")
					end
				end,
			},
			{
				text = "Let the music speak for itself",
				effects = { Happiness = 3 },
				feedText = "Real ones know...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						local sales = math.random(300000, 1000000)
						state.Money = (state.Money or 0) + sales
						state:ModifyStat("Happiness", 20)
						state.Fame = (state.Fame or 0) + 30
						state:AddFeed("ğŸµ Word of mouth went CRAZY! Album is a sleeper hit!")
					elseif roll <= 65 then
						local sales = math.random(50000, 200000)
						state.Money = (state.Money or 0) + sales
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸµ Modest sales. Core fans appreciate it. Not mainstream though.")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸµ Nobody knew it came out. Should have promoted it!")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX: Label Demands requires SIGNED MUSIC CAREER
	-- User complaint: "RECORD LABEL PRESSURING ME BUT IM NOT A SONG MAKER?!??!"
	-- Added strict eligibility check and careerPath requirement
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "musician_label_pressure",
		title = "Label Demands Hit Song",
		emoji = "ğŸ’¼",
		text = "Your record label is pressuring you to make a 'radio-friendly' single. They want a guaranteed hit, not your artistic vision.",
		category = "career_music",
		careerPath = "musician",  -- CRITICAL: Only for musicians!
		weight = 15,
		minAge = 18, maxAge = 50,
		baseChance = 0.25, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresJob = true,
		eligibility = function(state)
			-- CRITICAL: Must have a music career to receive label demands
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			local jobCat = (state.CurrentJob.category or ""):lower()
			
			-- Must be in music industry
			local isMusicCareer = jobId:find("musician") or jobId:find("singer") or 
				jobId:find("band") or jobId:find("popstar") or jobId:find("rock") or
				jobId:find("signed") or jobId:find("recording") or jobCat == "music" or
				jobCat == "career_music"
			
			-- Must also have signed_artist flag or be explicitly signed
			local isSigned = (state.Flags and state.Flags.signed_artist) or 
				jobId:find("signed") or jobId:find("recording_artist")
			
			return isMusicCareer and isSigned
		end,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Give them what they want",
				effects = { Happiness = -5 },
				feedText = "It's just one song...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						local money = math.random(100000, 500000)
						state.Money = (state.Money or 0) + money
						state:ModifyStat("Happiness", 15)
						state.Fame = (state.Fame or 0) + 25
						state:AddFeed(string.format("ğŸ’¼ Song went #1! $%s in royalties! Label loves you!", money))
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ’¼ Song flopped anyway. Sold out AND failed. Worst outcome.")
					end
				end,
			},
			{
				text = "Fight for your artistic vision",
				effects = { Smarts = 3 },
				feedText = "My music, my way!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 35 then
						local money = math.random(200000, 800000)
						state.Money = (state.Money or 0) + money
						state:ModifyStat("Happiness", 20)
						state.Fame = (state.Fame or 0) + 35
						state.Flags = state.Flags or {}
						state.Flags.artistic_integrity = true
						state:AddFeed("ğŸ’¼ Your vision was RIGHT! Critically acclaimed AND commercial success!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 5)
						state.Flags = state.Flags or {}
						state.Flags.artistic_integrity = true
						state:AddFeed("ğŸ’¼ Compromise reached. Both sides somewhat happy.")
					else
						state:ModifyStat("Happiness", -12)
						state.Flags = state.Flags or {}
						state.Flags.label_conflict = true
						state:AddFeed("ğŸ’¼ Label dropped you. 'Creative differences.' Starting over...")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_grammy_nomination",
		title = "ğŸ† Grammy Nomination!",
		emoji = "ğŸ†",
		text = "You've been nominated for a Grammy Award! The biggest night in music is approaching!",
		category = "career_music",
		weight = 10,
		minAge = 18, maxAge = 80,
		baseChance = 0.35,
		cooldown = 5,
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true, grammy_winner = true },
		
		choices = {
			{
				text = "Prepare an acceptance speech",
				effects = { Happiness = 10 },
				feedText = "I want to thank...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state.Money = (state.Money or 0) + math.random(200000, 1000000)
						state:ModifyStat("Happiness", 30)
						state.Fame = (state.Fame or 0) + 70
						state.Flags = state.Flags or {}
						state.Flags.grammy_winner = true
						state:AddFeed("ğŸ† AND THE GRAMMY GOES TO... YOU! Grammy winner! Dreams come true!")
					else
						state:ModifyStat("Happiness", 8)
						state.Fame = (state.Fame or 0) + 20
						state:AddFeed("ğŸ† Didn't win, but what an honor! Career boost from the exposure!")
					end
				end,
			},
			{
				text = "Try not to think about it",
				effects = { Happiness = 5 },
				feedText = "Managing expectations...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state.Money = (state.Money or 0) + math.random(150000, 500000)
						state:ModifyStat("Happiness", 25)
						state.Fame = (state.Fame or 0) + 60
						state.Flags = state.Flags or {}
						state.Flags.grammy_winner = true
						state:AddFeed("ğŸ† SURPRISE! You won! The most genuine reaction on TV!")
					else
						state:ModifyStat("Happiness", 5)
						state.Fame = (state.Fame or 0) + 15
						state:AddFeed("ğŸ† Didn't win. Kept composure. Everyone respects a good loser.")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_tour_offer",
		title = "World Tour Opportunity!",
		emoji = "ğŸŒ",
		text = "A promoter is offering you a massive world tour! 50 cities across 6 continents!",
		category = "career_music",
		weight = 14,
		minAge = 18, maxAge = 60,
		baseChance = 0.45,
		cooldown = 4,
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Book the full tour!",
				effects = { Health = -10, Happiness = 5 },
				feedText = "Life on the road!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						local tourMoney = math.random(500000, 3000000)
						state.Money = (state.Money or 0) + tourMoney
						state:ModifyStat("Happiness", 20)
						state.Fame = (state.Fame or 0) + 40
						state.Flags = state.Flags or {}
						state.Flags.world_toured = true
						state:AddFeed(string.format("ğŸŒ Tour was LEGENDARY! $%s grossed! Memories for life!", tourMoney))
					elseif roll <= 80 then
						local tourMoney = math.random(100000, 400000)
						state.Money = (state.Money or 0) + tourMoney
						state:ModifyStat("Happiness", 8)
						state:AddFeed(string.format("ğŸŒ Tour was good but exhausting. $%s earned.", tourMoney))
					else
						state:ModifyStat("Happiness", -15)
						state:ModifyStat("Health", -15)
						state.Flags = state.Flags or {}
						state.Flags.tour_burnout = true
						state:AddFeed("ğŸŒ Tour was a disaster. Illness, cancelled shows, barely broke even.")
					end
				end,
			},
			{
				text = "Do a smaller tour instead",
				effects = { Health = -3, Happiness = 3 },
				feedText = "Quality over quantity...",
				onResolve = function(state)
					local tourMoney = math.random(50000, 200000)
					state.Money = (state.Money or 0) + tourMoney
					state:ModifyStat("Happiness", 10)
					state.Fame = (state.Fame or 0) + 15
					state:AddFeed(string.format("ğŸŒ Intimate tour was perfect! $%s and no burnout!", tourMoney))
				end,
			},
			{
				text = "Stay home and work on new music",
				effects = { Happiness = 5, Smarts = 2 },
				feedText = "Studio time is valuable.",
			},
		},
	},
	
	{
		id = "musician_song_stolen",
		title = "Someone Stole Your Song!",
		emoji = "ğŸ˜¡",
		text = "A major artist just released a song that sounds EXACTLY like your unreleased track! They must have heard your demo!",
		category = "career_music",
		weight = 12,
		minAge = 18, maxAge = 60,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = hasMusicJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Sue for copyright infringement",
				effects = { Money = -20000, Happiness = -5 },
				feedText = "See you in court!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						local settlement = math.random(200000, 1000000)
						state.Money = (state.Money or 0) + settlement
						state:ModifyStat("Happiness", 15)
						state.Fame = (state.Fame or 0) + 20
						state:AddFeed(string.format("ğŸ˜¡ Won the lawsuit! $%s settlement! Justice served!", settlement))
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ˜¡ Settled out of court. Some money, but no public admission of guilt.")
					else
						state:ModifyStat("Happiness", -15)
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - 50000)
						state:AddFeed("ğŸ˜¡ Lost the case. 'Musical ideas aren't copyrightable.' Brutal legal fees.")
					end
				end,
			},
			{
				text = "Call them out on social media",
				effects = {},
				feedText = "Everyone needs to know!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						state:ModifyStat("Happiness", 10)
						state.Fame = (state.Fame or 0) + 15
						state:AddFeed("ğŸ˜¡ Fans took your side! The other artist got cancelled! Justice!")
					elseif roll <= 75 then
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ˜¡ 'He said, she said' situation. Nobody knows who to believe.")
					else
						state:ModifyStat("Happiness", -12)
						state.Fame = (state.Fame or 0) - 10
						state:AddFeed("ğŸ˜¡ Backfired! You look jealous and petty. Their song still charting.")
					end
				end,
			},
			{
				text = "Let it go - best revenge is success",
				effects = { Happiness = 3, Smarts = 3 },
				feedText = "Taking the high road.",
			},
		},
	},
	
	{
		id = "musician_collab_offer",
		title = "Dream Collaboration!",
		emoji = "ğŸ¤",
		text = "Your musical idol wants to collaborate on a track with you! This is a once-in-a-lifetime opportunity!",
		category = "career_music",
		weight = 12,
		minAge = 18, maxAge = 70,
		baseChance = 0.4,
		cooldown = 4,
		oneTime = true,
		requiresJob = true,
		eligibility = hasMusicJob,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Accept immediately!",
				effects = { Happiness = 20 },
				feedText = "Dreams do come true!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state.Money = (state.Money or 0) + math.random(100000, 500000)
						state.Fame = (state.Fame or 0) + 35
						state.Flags = state.Flags or {}
						state.Flags.legendary_collab = true
						state:AddFeed("ğŸ¤ The collab was FIRE! Charted in multiple countries! Legendary!")
					else
						state:ModifyStat("Happiness", 8)
						state.Fame = (state.Fame or 0) + 15
						state:AddFeed("ğŸ¤ Song was good but didn't quite hit. Still, worked with your idol!")
					end
				end,
			},
			{
				text = "Negotiate for equal credit",
				effects = {},
				feedText = "Making sure it's fair...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state.Money = (state.Money or 0) + math.random(150000, 600000)
						state:ModifyStat("Happiness", 18)
						state.Fame = (state.Fame or 0) + 40
						state:AddFeed("ğŸ¤ Equal billing! Song was a smash! They respect your hustle!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ¤ They went with someone else. Don't look a gift horse in the mouth!")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_voice_problem",
		title = "Voice Problems!",
		emoji = "ğŸ¤",
		text = "Your doctor says you've damaged your vocal cords from overuse. You need to rest your voice for 3 months or risk permanent damage.",
		category = "career_music",
		weight = 12,
		minAge = 20, maxAge = 60,
		baseChance = 0.4,
		cooldown = 4,
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true, voice_damage = true },
		
		choices = {
			{
				text = "Take the medical leave",
				effects = { Health = 10, Happiness = -5 },
				feedText = "Voice is everything...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 80 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ¤ Voice recovered fully! Ready to sing again!")
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ¤ Voice mostly recovered. Some high notes harder now.")
					end
				end,
			},
			{
				text = "Keep performing - the show must go on",
				effects = { Health = -5 },
				feedText = "Can't let fans down...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state.Money = (state.Money or 0) + math.random(50000, 150000)
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ¤ Pushed through! Voice held up somehow!")
					else
						state:ModifyStat("Happiness", -20)
						state:ModifyStat("Health", -10)
						state.Flags = state.Flags or {}
						state.Flags.voice_damage = true
						state:AddFeed("ğŸ¤ Permanent voice damage. Career as a singer might be over...")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_one_hit_wonder",
		title = "One-Hit Wonder Fear",
		emoji = "ğŸ˜°",
		text = "Your first hit was HUGE but your follow-up singles aren't performing. People are calling you a one-hit wonder!",
		category = "career_music",
		weight = 14,
		minAge = 18, maxAge = 45,
		baseChance = 0.45,
		cooldown = 3,
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Completely reinvent your sound",
				effects = { Smarts = 3 },
				feedText = "New era, new me!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state.Money = (state.Money or 0) + math.random(200000, 700000)
						state:ModifyStat("Happiness", 20)
						state.Fame = (state.Fame or 0) + 30
						state.Flags = state.Flags or {}
						state.Flags.comeback_king = true
						state:AddFeed("ğŸ˜° COMEBACK! New sound was revolutionary! Critics love the evolution!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ˜° Mixed reception. Some love the new direction, others don't.")
					else
						state:ModifyStat("Happiness", -12)
						state.Fame = (state.Fame or 0) - 15
						state:AddFeed("ğŸ˜° Fans hated the change. 'We want the old you back!' Rough.")
					end
				end,
			},
			{
				text = "Double down on what worked",
				effects = {},
				feedText = "Give the people what they want!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 35 then
						state.Money = (state.Money or 0) + math.random(100000, 400000)
						state:ModifyStat("Happiness", 15)
						state:AddFeed("ğŸ˜° Formula still works! Another hit! Not a one-hit wonder!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ˜° Sounds too similar. 'Boring, repetitive' - the reviews are brutal.")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- NEW EVENTS - FLAG-LINKED CONSEQUENCES & VARIETY
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	
	{
		id = "musician_platinum_followup",
		title = "ğŸµ Platinum Pressure",
		emoji = "ğŸµ",
		text = "After your platinum album success, everyone expects your next release to be even BIGGER. The pressure is immense!",
		category = "career_music",
		weight = 8,
		minAge = 18, maxAge = 55,
		baseChance = 0.3, -- LOWERED to prevent spam
		cooldown = 6, -- INCREASED
		oneTime = true, -- Only happens once!
		requiresJob = true,
		eligibility = isSignedArtist,
		-- LINKAGE: Only triggers if you had a platinum album
		requiresFlags = { platinum_album = true },
		blockedByFlags = { in_prison = true, multi_platinum = true },
		
		choices = {
			{
				text = "Take time to craft a masterpiece",
				effects = { Happiness = -5 },
				feedText = "Perfectionism mode engaged...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						local earnings = math.random(800000, 2500000)
						state.Money = (state.Money or 0) + earnings
						state:ModifyStat("Happiness", 30)
						state.Fame = (state.Fame or 0) + 60
						state.Flags = state.Flags or {}
						state.Flags.multi_platinum = true
						state.Flags.music_legend = true
						state:AddFeed(string.format("ğŸµ DOUBLE PLATINUM! Critics call it your best work! $%d earned!", earnings))
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸµ Took 3 years but it didn't match expectations. 'Sophomore slump' they call it.")
					end
				end,
			},
			{
				text = "Rush something out while you're hot",
				effects = {},
				feedText = "Strike while the iron is hot!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state.Money = (state.Money or 0) + math.random(300000, 700000)
						state:ModifyStat("Happiness", 12)
						state:AddFeed("ğŸµ Quick turnaround worked! Another hit in the making!")
					else
						state:ModifyStat("Happiness", -15)
						state.Fame = (state.Fame or 0) - 20
						state:AddFeed("ğŸµ 'Clearly rushed' - reviews are harsh. Should have taken more time.")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_tour_burnout_consequence",
		title = "ğŸ¥ Exhaustion Catches Up",
		emoji = "ğŸ¥",
		text = "Remember that brutal world tour? The months of no sleep are catching up. You collapsed during a show.",
		category = "career_music",
		weight = 10,
		minAge = 20, maxAge = 50,
		baseChance = 0.45,
		cooldown = 5,
		oneTime = true,
		requiresJob = true,
		eligibility = isSignedArtist,
		-- LINKAGE: Only triggers if tour_burnout flag is set
		requiresFlags = { tour_burnout = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Check into rehab/wellness center",
				effects = { Health = 15, Happiness = 5 },
				feedText = "Taking care of yourself...",
				onResolve = function(state)
					state.Money = math.max(0, (state.Money or 0) - 50000)
					state.Flags = state.Flags or {}
					state.Flags.tour_burnout = nil
					state.Flags.recovered_artist = true
					state:AddFeed("ğŸ¥ Spent 60 days in a wellness retreat. Your body and mind are healed. Ready to return.")
				end,
			},
			{
				text = "Cancel remaining shows",
				effects = { Happiness = -10, Health = 5 },
				feedText = "Health first...",
				onResolve = function(state)
					state.Money = math.max(0, (state.Money or 0) - 200000)
					state:AddFeed("ğŸ¥ Cancelled 15 shows. Lost money but saved your health. Fans are understanding.")
				end,
			},
			{
				text = "Power through - the show must go on",
				effects = { Health = -20, Happiness = -5 },
				feedText = "Can't let fans down...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state.Money = (state.Money or 0) + math.random(100000, 300000)
						state:AddFeed("ğŸ¥ Somehow finished the tour. You're a warrior! (But please rest now)")
					else
						state:ModifyStat("Health", -15)
						state.Flags = state.Flags or {}
						state.Flags.chronic_health_issues = true
						state:AddFeed("ğŸ¥ Permanent damage. Chronic fatigue syndrome. Career may be over...")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_artistic_integrity_payoff",
		title = "ğŸ¨ Your Vision Validated",
		emoji = "ğŸ¨",
		text = "Remember when you fought the label for artistic control? Your album just won Album of the Year!",
		category = "career_music",
		weight = 8,
		minAge = 20, maxAge = 60,
		baseChance = 0.4,
		cooldown = 5,
		oneTime = true,
		requiresJob = true,
		eligibility = isSignedArtist,
		-- LINKAGE: Only triggers if you maintained artistic integrity
		requiresFlags = { artistic_integrity = true },
		blockedByFlags = { in_prison = true, grammy_winner = true },
		
		choices = {
			{
				text = "Thank everyone who believed",
				effects = { Happiness = 25 },
				feedText = "Giving credit...",
				onResolve = function(state)
					state.Money = (state.Money or 0) + math.random(500000, 1500000)
					state.Fame = (state.Fame or 0) + 80
					state.Flags = state.Flags or {}
					state.Flags.grammy_winner = true
					state.Flags.critically_acclaimed = true
					state:AddFeed("ğŸ¨ Standing ovation! Your artistic vision proved correct! Legend status achieved!")
				end,
			},
			{
				text = "Call out the label that doubted you",
				effects = { Happiness = 15 },
				feedText = "Sweet vindication...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state.Money = (state.Money or 0) + math.random(400000, 1000000)
						state.Fame = (state.Fame or 0) + 50
						state.Flags = state.Flags or {}
						state.Flags.grammy_winner = true
						state:AddFeed("ğŸ¨ Mic drop moment! 'They said no one would listen!' Viral speech!")
					else
						state.Fame = (state.Fame or 0) + 30
						state:AddFeed("ğŸ¨ Came off as bitter. Still won though!")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_label_conflict_consequence",
		title = "ğŸ’” Label Drama Escalates",
		emoji = "ğŸ’”",
		text = "The 'creative differences' with your label have turned ugly. They're threatening to shelve your album and sue you!",
		category = "career_music",
		weight = 10,
		minAge = 20, maxAge = 50,
		baseChance = 0.5,
		cooldown = 4,
		requiresJob = true,
		eligibility = hasMusicJob,
		-- LINKAGE: Only triggers if you had label conflict
		requiresFlags = { label_conflict = true },
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Buy out your contract",
				effects = { Happiness = 10 },
				feedText = "Freedom has a price...",
				onResolve = function(state)
					local buyout = math.random(500000, 2000000)
					if (state.Money or 0) >= buyout then
						-- CRITICAL FIX: Prevent negative money
						state.Money = math.max(0, (state.Money or 0) - buyout)
						state.Flags = state.Flags or {}
						state.Flags.label_conflict = nil
						state.Flags.independent_artist = true
						state.Flags.free_from_contract = true
						state:AddFeed(string.format("ğŸ’” Paid $%d to be free! Now independent! Your music, your rules!", buyout))
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed(string.format("ğŸ’” Can't afford the $%d buyout. Still trapped.", buyout))
					end
				end,
			},
			{
				text = "Leak the album online yourself",
				effects = { Happiness = 5 },
				feedText = "Fans need to hear this...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state.Fame = (state.Fame or 0) + 40
						state.Flags = state.Flags or {}
						state.Flags.cult_following = true
						state:AddFeed("ğŸ’” Leaked it! Went viral! Fans LOVE you for the rebellion! Label can't contain it!")
					else
						state.Money = math.max(0, (state.Money or 0) - math.random(200000, 800000))
						state:ModifyStat("Happiness", -15)
						state:AddFeed("ğŸ’” Sued for breach of contract. Massive legal fees. Was it worth it?")
					end
				end,
			},
			{
				text = "Apologize and play by their rules",
				effects = { Happiness = -15 },
				feedText = "Swallowing pride...",
				onResolve = function(state)
					state.Money = (state.Money or 0) + math.random(50000, 150000)
					state.Flags = state.Flags or {}
					state.Flags.label_conflict = nil
					state.Flags.sellout = true
					state:AddFeed("ğŸ’” Apologized publicly. Made the album they wanted. It feels hollow.")
				end,
			},
		},
	},
	
	{
		id = "musician_studio_session",
		title = "ğŸ™ï¸ Studio Session Magic",
		emoji = "ğŸ™ï¸",
		text = "You're in the studio and something magical is happening. The track is coming together perfectly!",
		category = "career_music",
		weight = 10,
		minAge = 18, maxAge = 65,
		baseChance = 0.25, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresJob = true,
		eligibility = hasMusicJob,
		blockedByFlags = { in_prison = true, hit_song_recorded = true },
		
		choices = {
			{
				text = "Keep recording - ride the wave!",
				effects = { Happiness = 8 },
				feedText = "Catching lightning in a bottle...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						state.Flags = state.Flags or {}
						state.Flags.hit_song_recorded = true
						state.Money = (state.Money or 0) + math.random(50000, 200000)
						state:AddFeed("ğŸ™ï¸ Recorded something SPECIAL! This track could be THE ONE!")
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ™ï¸ Great session! Maybe not a hit but solid work.")
					end
				end,
			},
			{
				text = "Bring in a guest feature",
				effects = { Money = -20000 },
				feedText = "Calling in a favor...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state.Money = (state.Money or 0) + math.random(100000, 400000)
						state.Fame = (state.Fame or 0) + 25
						state.Flags = state.Flags or {}
						state.Flags.collab_success = true
						state:AddFeed("ğŸ™ï¸ The feature artist CRUSHED it! Instant chemistry! Hit incoming!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ™ï¸ The collab didn't gel. Wasted studio time and money.")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_fan_encounter",
		title = "ğŸ‘¥ Crazy Fan Encounter",
		emoji = "ğŸ‘¥",
		text = "A fan waited outside your studio for 8 HOURS just to meet you. They're crying and shaking.",
		category = "career_music",
		weight = 8,
		minAge = 18, maxAge = 70,
		baseChance = 0.2, -- LOWERED to prevent spam
		cooldown = 5, -- INCREASED
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true, stalker_issues = true },
		
		choices = {
			{
				text = "Spend 30 minutes with them - make their day",
				effects = { Happiness = 10 },
				feedText = "They seem harmless...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 75 then
						state.Fame = (state.Fame or 0) + 15
						state.Flags = state.Flags or {}
						state.Flags.beloved_by_fans = true
						state:AddFeed("ğŸ‘¥ They posted everything online! 'NICEST ARTIST EVER!' Going viral for being KIND!")
					else
						state:ModifyStat("Happiness", -5)
						state.Flags = state.Flags or {}
						state.Flags.stalker_issues = true
						state:AddFeed("ğŸ‘¥ They started showing up everywhere. Might need to call security...")
					end
				end,
			},
			{
				text = "Quick photo and autograph only",
				effects = { Happiness = 3 },
				feedText = "Boundaries matter...",
				onResolve = function(state)
					state:AddFeed("ğŸ‘¥ Quick interaction. They're happy. You're safe. Professional.")
				end,
			},
			{
				text = "Have security escort them away",
				effects = { Happiness = -3 },
				feedText = "Safety first...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:AddFeed("ğŸ‘¥ They understood. No drama. Good call.")
					else
						state.Fame = (state.Fame or 0) - 10
						state:AddFeed("ğŸ‘¥ They posted about it. 'Cold and rude!' Bad PR.")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_industry_party",
		title = "ğŸ‰ Industry Party Invitation",
		emoji = "ğŸ‰",
		text = "You're invited to THE party of the year. Every major artist, producer, and exec will be there!",
		category = "career_music",
		weight = 8,
		minAge = 18, maxAge = 55,
		baseChance = 0.2, -- LOWERED
		cooldown = 6, -- INCREASED
		requiresJob = true,
		eligibility = hasMusicJob,
		blockedByFlags = { in_prison = true, industry_connections = true },
		
		choices = {
			{
				text = "Work the room - network aggressively",
				effects = { Happiness = 5 },
				feedText = "All about connections...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state.Money = (state.Money or 0) + math.random(10000, 50000)
						state.Fame = (state.Fame or 0) + 20
						state.Flags = state.Flags or {}
						state.Flags.industry_connections = true
						state:AddFeed("ğŸ‰ Exchanged numbers with 3 major producers! New opportunities coming!")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ‰ Came off as desperate. People were polite but distant.")
					end
				end,
			},
			{
				text = "Just have fun and be yourself",
				effects = { Happiness = 8, Health = -2 },
				feedText = "YOLO!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state.Fame = (state.Fame or 0) + 15
						state.Flags = state.Flags or {}
						state.Flags.party_animal = true
						state:AddFeed("ğŸ‰ Had an AMAZING time! People loved your energy! Organic connections!")
					else
						state.Fame = (state.Fame or 0) - 5
						state:AddFeed("ğŸ‰ Might have had TOO much fun. Embarrassing videos circulating...")
					end
				end,
			},
			{
				text = "Skip it - parties aren't your thing",
				effects = { Health = 3, Happiness = 2 },
				feedText = "Staying home...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.mysterious_artist = true
					state:AddFeed("ğŸ‰ Stayed home. People asked where you were. Maybe mystery is good for the brand?")
				end,
			},
		},
	},
	
	{
		id = "musician_remix_request",
		title = "ğŸ”Š Hot Remix Request",
		emoji = "ğŸ”Š",
		text = "A chart-topping DJ wants to remix your latest track. It could blow up in clubs worldwide!",
		category = "career_music",
		weight = 8,
		minAge = 18, maxAge = 50,
		baseChance = 0.2, -- LOWERED
		cooldown = 6, -- INCREASED
		requiresJob = true,
		eligibility = hasMusicJob,
		blockedByFlags = { in_prison = true, remix_success = true },
		
		choices = {
			{
				text = "Let them do whatever they want",
				effects = { Happiness = 5 },
				feedText = "Trust the artist...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						state.Money = (state.Money or 0) + math.random(80000, 300000)
						state.Fame = (state.Fame or 0) + 25
						state:AddFeed("ğŸ”Š The remix is FIRE! Charting globally! Playing in every club!")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ”Š They butchered it. Unrecognizable. Your fans hate it.")
					end
				end,
			},
			{
				text = "Stay involved in the creative process",
				effects = { Smarts = 3 },
				feedText = "Quality control...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 65 then
						state.Money = (state.Money or 0) + math.random(100000, 250000)
						state.Fame = (state.Fame or 0) + 20
						state.Flags = state.Flags or {}
						state.Flags.remix_success = true
						state:AddFeed("ğŸ”Š Collaboration was perfect! Best of both worlds! Hit remix!")
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ”Š Solid remix. Not a smash but respectable.")
					end
				end,
			},
			{
				text = "Decline - protect the original",
				effects = { Happiness = 2 },
				setFlags = { purist = true },
				feedText = "The original stands alone.",
				onResolve = function(state)
					state:AddFeed("ğŸ”Š Declined the remix. Some fans appreciate your artistic integrity.")
				end,
			},
		},
	},
	
	{
		id = "musician_viral_moment",
		title = "ğŸ“± Viral Video Opportunity",
		emoji = "ğŸ“±",
		text = "A clip of you doing something unexpected is going viral on TikTok! Millions of views already!",
		category = "career_music",
		weight = 6,
		minAge = 18, maxAge = 50,
		baseChance = 0.15, -- LOWERED - viral moments are rare
		cooldown = 8, -- INCREASED
		oneTime = true, -- Only once per career
		requiresJob = true,
		eligibility = hasMusicJob,
		blockedByFlags = { in_prison = true, social_media_star = true },
		
		choices = {
			{
				text = "Lean into it - make more content",
				effects = { Happiness = 8 },
				feedText = "Riding the wave...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state.Fame = (state.Fame or 0) + 40
						state.Money = (state.Money or 0) + math.random(50000, 200000)
						state.Flags = state.Flags or {}
						state.Flags.social_media_star = true
						state:AddFeed("ğŸ“± Embraced the meme! New fans pouring in! Streams through the ROOF!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ“± Tried too hard. Cringe follow-up. Moment passed.")
					end
				end,
			},
			{
				text = "Ignore it and focus on music",
				effects = { Smarts = 3 },
				feedText = "Stay focused...",
				onResolve = function(state)
					state:AddFeed("ğŸ“± Didn't engage. Some respect your seriousness. Others think you're no fun.")
				end,
			},
			{
				text = "Ask them to take it down",
				effects = { Happiness = -5 },
				feedText = "Damage control...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:AddFeed("ğŸ“± They removed it. Crisis averted maybe?")
					else
						state.Fame = (state.Fame or 0) - 10
						state:AddFeed("ğŸ“± Streisand effect! Trying to remove it made it MORE viral!")
					end
				end,
			},
		},
	},
	
	{
		id = "musician_comeback_opportunity",
		title = "ğŸ”¥ Career Revival Chance",
		emoji = "ğŸ”¥",
		text = "A hot new producer wants to work with you! They think they can bring you back to the charts!",
		category = "career_music",
		weight = 6,
		minAge = 30, maxAge = 60,
		baseChance = 0.2, -- LOWERED
		cooldown = 6, -- INCREASED
		oneTime = true, -- Only once per career
		requiresJob = true,
		eligibility = hasMusicJob,
		-- LINKAGE: More likely if you've had setbacks
		boostedByFlags = { voice_damage = true, label_conflict = true, bad_advice = true },
		blockedByFlags = { in_prison = true, comeback_king = true },
		
		choices = {
			{
				text = "Go all in on the new sound",
				effects = { Happiness = 10 },
				feedText = "Reinvention time!",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 45 then
						state.Money = (state.Money or 0) + math.random(200000, 800000)
						state.Fame = (state.Fame or 0) + 45
						state.Flags = state.Flags or {}
						state.Flags.comeback_king = true
						state.Flags.voice_damage = nil -- Recovery!
						state:AddFeed("ğŸ”¥ LEGENDARY COMEBACK! Critics are calling it a 'career resurrection'!")
					elseif roll <= 75 then
						state.Money = (state.Money or 0) + math.random(50000, 150000)
						state.Fame = (state.Fame or 0) + 15
						state:AddFeed("ğŸ”¥ Decent comeback! Not chart-topping but respectable return!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸ”¥ The new sound didn't connect. Critics: 'Trying too hard.'")
					end
				end,
			},
			{
				text = "Collaborate on a nostalgia project",
				effects = { Happiness = 6 },
				feedText = "Play the hits...",
				onResolve = function(state)
					state.Money = (state.Money or 0) + math.random(80000, 250000)
					state.Fame = (state.Fame or 0) + 20
					state:AddFeed("ğŸ”¥ 'Greatest Hits Reimagined' album! Fans love the nostalgia!")
				end,
			},
		},
	},
	
	{
		id = "musician_documentary_offer",
		title = "ğŸ¬ Documentary Offer",
		emoji = "ğŸ¬",
		text = "A streaming service wants to make a documentary about your life and career! Full access!",
		category = "career_music",
		weight = 8,
		minAge = 25, maxAge = 70,
		baseChance = 0.35,
		cooldown = 6,
		oneTime = true,
		requiresJob = true,
		eligibility = isSignedArtist,
		blockedByFlags = { in_prison = true },
		
		choices = {
			{
				text = "Let them tell the REAL story",
				effects = { Happiness = -5 },
				feedText = "Vulnerable but authentic...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 55 then
						state.Money = (state.Money or 0) + math.random(300000, 1000000)
						state.Fame = (state.Fame or 0) + 50
						state.Flags = state.Flags or {}
						state.Flags.documentary_star = true
						state:AddFeed("ğŸ¬ 'Raw and honest' - Critics LOVED it! Emmy nominated! Career peak!")
					else
						state:ModifyStat("Happiness", -15)
						state.Fame = (state.Fame or 0) - 20
						state:AddFeed("ğŸ¬ They exposed things you wish stayed buried. Regrets.")
					end
				end,
			},
			{
				text = "Maintain editorial control",
				effects = { Money = 100000, Happiness = 5 },
				feedText = "Protect your image...",
				onResolve = function(state)
					state.Fame = (state.Fame or 0) + 25
					state:AddFeed("ğŸ¬ Polished documentary. Critics say 'sanitized' but fans loved it!")
				end,
			},
			{
				text = "Decline - some things are private",
				effects = { Happiness = 8 },
				setFlags = { values_privacy = true },
				feedText = "Not ready to share everything.",
				onResolve = function(state)
					state:AddFeed("ğŸ¬ Turned it down. Your story stays your own.")
				end,
			},
		},
	},
}

return MusicianCareerEvents
