--[[
	Office Career Events
	Events for general corporate/office jobs
	All events use randomized outcomes - NO god mode
	
	Covers: Data Entry, Secretary, HR, Management, Marketing, Accounting, etc.
]]

local OfficeCareerEvents = {}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CRITICAL FIX: Helper to detect entertainment careers that should NOT receive
-- generic office events (commute, meetings, coworker drama, etc.)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function isEntertainmentCareer(state)
	if not state.CurrentJob then return false end
	local jobId = (state.CurrentJob.id or ""):lower()
	local jobName = (state.CurrentJob.name or ""):lower()
	local jobCat = (state.CurrentJob.category or ""):lower()
	
	-- Check for entertainment/influencer keywords
	if jobId:find("influencer") or jobId:find("streamer") or jobId:find("youtuber")
	   or jobId:find("content_creator") or jobId:find("rapper") or jobId:find("actor")
	   or jobId:find("athlete") or jobId:find("musician") or jobId:find("celebrity")
	   or jobId:find("pro_gamer") or jobId:find("esports") then
		return true
	end
	
	if jobName:find("influencer") or jobName:find("streamer") or jobName:find("youtuber")
	   or jobName:find("content creator") or jobName:find("rapper") or jobName:find("actor")
	   or jobName:find("athlete") or jobName:find("musician") then
		return true
	end
	
	-- Check job category
	if jobCat == "entertainment" or jobCat == "celebrity" or jobCat == "sports" 
	   or jobCat == "music" or jobCat == "acting" or jobCat == "gaming" then
		return true
	end
	
	-- Check for entertainment flags
	local flags = state.Flags or {}
	if flags.isInfluencer or flags.isStreamer or flags.isRapper 
	   or flags.isAthlete or flags.isActor or flags.isFameCareer then
		return true
	end
	
	return false
end

local function hasOfficeJob(state)
	if not state.CurrentJob then return false end
	
	-- CRITICAL FIX: Entertainment careers should NOT get office events!
	if isEntertainmentCareer(state) then return false end
	
	local jobCat = (state.CurrentJob.category or ""):lower()
	local jobId = (state.CurrentJob.id or ""):lower()
	
	-- Check for office-related categories and job IDs
	return jobCat == "office" or jobCat == "corporate" or jobCat == "finance" 
	   or jobCat == "tech" or jobCat == "admin"
	   or jobId:find("manager") or jobId:find("secretary") or jobId:find("assistant")
	   or jobId:find("hr_") or jobId:find("accounting") or jobId:find("data_entry")
	   or jobId:find("analyst") or jobId:find("executive")
end

OfficeCareerEvents.events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- GENERAL OFFICE EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "office_morning_commute",
		title = "Morning Commute",
		emoji = "ğŸš—",
		textVariants = {
			"The morning commute is brutal today!",
			"Traffic is terrible on the way to work!",
			"Your commute hits a snag this morning.",
		},
		text = "The morning commute is brutal today!",
		question = "How does it go?",
		minAge = 18, maxAge = 70,
		baseChance = 0.5,
		cooldown = 3,
		category = "career_office",
		requiresJob = true,
		-- CRITICAL FIX: Must have office job, not entertainment career
		eligibility = hasOfficeJob,
		requiresJobCategory = {"office", "finance", "tech", "corporate"},
		
		choices = {
			{
				text = "Leave extra early",
				effects = {},
				feedText = "You beat the traffic...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸš— Made it on time! Even got coffee first!")
					elseif roll <= 85 then
						state:ModifyStat("Happiness", 1)
						state:AddFeed("ğŸš— Still got stuck in traffic. But not late!")
					else
						state:ModifyStat("Happiness", -2)
						state:AddFeed("ğŸš— Unexpected road closure! Still late!")
					end
				end,
			},
			{
				text = "Work from home today",
				effects = {},
				feedText = "You message your boss...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 5)
						state:ModifyStat("Health", 2)
						state:AddFeed("ğŸš— Remote work approved! Productive AND comfortable!")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸš— Boss said no. Had to go in anyway. Ugh.")
					end
				end,
			},
		},
	},
	{
		id = "office_meeting_marathon",
		title = "Meeting Marathon",
		emoji = "ğŸ“…",
		textVariants = {
			"Your calendar is packed with meetings today!",
			"Back-to-back meetings scheduled all day!",
			"Meeting overload incoming!",
		},
		text = "Your calendar is packed with meetings today!",
		question = "How do you survive?",
		minAge = 18, maxAge = 70,
		baseChance = 0.6,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		category = "career_office",
		requiresJob = true,
		-- CRITICAL FIX: Must have office job, not entertainment career
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Participate actively",
				effects = {},
				feedText = "You engage in every meeting...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Smarts", 3)
						state.Flags = state.Flags or {}
						state.Flags.noticed_by_management = true
						state:AddFeed("ğŸ“… Great input! Leadership noticed your contributions!")
					elseif roll <= 75 then
						state:ModifyStat("Happiness", -2)
						state:AddFeed("ğŸ“… Productive but exhausted. So many meetings...")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("ğŸ“… Said something dumb in front of the VP. Oof.")
					end
				end,
			},
			{
				text = "Zone out and multitask",
				effects = {},
				feedText = "You pretend to pay attention...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ“… Got other work done while nodding along. Efficient!")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("ğŸ“… 'What do you think?' Called out! No idea what they asked!")
					end
				end,
			},
		},
	},
	{
		id = "office_email_overload",
		title = "Email Overload",
		emoji = "ğŸ“§",
		textVariants = {
			"Your inbox is overflowing with emails!",
			"200+ unread emails await you this morning!",
			"Email chaos! Your inbox is out of control!",
		},
		text = "Your inbox is overflowing with emails!",
		question = "How do you handle it?",
		minAge = 18, maxAge = 70,
		baseChance = 0.6,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Declare email bankruptcy - delete all",
				effects = {},
				feedText = "You select all and delete...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ“§ Fresh start! Nothing important was missed!")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("ğŸ“§ Missed an important email from the CEO. Oops!")
					end
				end,
			},
			{
				text = "Power through and respond to all",
				effects = {},
				feedText = "You start typing replies...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Smarts", 2)
						state:ModifyStat("Happiness", 2)
						state:AddFeed("ğŸ“§ Inbox zero achieved! Feeling accomplished!")
					else
						state:ModifyStat("Happiness", -3)
						state:ModifyStat("Health", -1)
						state:AddFeed("ğŸ“§ Took all day. Eyes hurt. Worth it?")
					end
				end,
			},
		},
	},
	{
		id = "office_coworker_conflict",
		title = "Coworker Conflict",
		emoji = "ğŸ˜¤",
		textVariants = {
			"A coworker is really getting on your nerves!",
			"Tension is building between you and a colleague.",
			"Office drama alert! Someone is causing problems!",
		},
		text = "A coworker is really getting on your nerves!",
		question = "How do you handle it?",
		minAge = 18, maxAge = 70,
		baseChance = 0.4,
		cooldown = 3,
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Talk it out professionally",
				effects = {},
				feedText = "You ask them to chat...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 5)
						state:ModifyStat("Smarts", 2)
						state.Flags = state.Flags or {}
						state.Flags.conflict_resolution_skills = true
						state:AddFeed("ğŸ˜¤ Cleared the air! Actually became friends!")
					elseif roll <= 80 then
						state:ModifyStat("Happiness", 2)
						state:AddFeed("ğŸ˜¤ Awkward but things are better now.")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ˜¤ They got defensive. Now it's worse. HR here we come.")
					end
				end,
			},
			{
				text = "Go straight to HR",
				effects = {},
				feedText = "You file a complaint...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 4)
						state:AddFeed("ğŸ˜¤ HR took it seriously! Problem solved!")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("ğŸ˜¤ HR did nothing. Now labeled as 'that person'.")
					end
				end,
			},
			{
				text = "Just avoid them",
				effects = {},
				feedText = "You keep your distance...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 2)
						state:AddFeed("ğŸ˜¤ Out of sight, out of mind. Peaceful.")
					else
						state:ModifyStat("Happiness", -2)
						state:AddFeed("ğŸ˜¤ Hard to avoid them. The tension lingers.")
					end
				end,
			},
		},
	},
	{
		id = "office_lunch_break",
		title = "Lunch Break Dilemma",
		emoji = "ğŸ±",
		textVariants = {
			"It's lunch time! Where do you eat?",
			"Your stomach is growling. Lunch break!",
			"Time for the daily lunch decision!",
		},
		text = "It's lunch time! Where do you eat?",
		question = "What's for lunch?",
		minAge = 18, maxAge = 70,
		baseChance = 0.6,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Eat at desk - working lunch",
				effects = {},
				feedText = "You eat while typing...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Smarts", 2)
						state:AddFeed("ğŸ± Got a lot done! Very productive!")
					else
						state:ModifyStat("Happiness", -2)
						state:ModifyStat("Health", -1)
						state:AddFeed("ğŸ± No real break. Feeling burnt out.")
					end
				end,
			},
			{
				text = "Join coworkers at a restaurant",
				effects = { Money = -20 },
				feedText = "You head out with the team...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ± Great bonding time! Learned some office gossip!")
					else
						state:ModifyStat("Happiness", 2)
						state:AddFeed("ğŸ± Nice break but kinda pricey.")
					end
				end,
			},
			{
				text = "Healthy packed lunch",
				effects = {},
				feedText = "You grab your meal prep...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Health", 3)
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ± Healthy AND saved money! Winning!")
					else
						state:ModifyStat("Happiness", 1)
						state:AddFeed("ğŸ± Healthy but kind of boring...")
					end
				end,
			},
		},
	},
	{
		id = "office_performance_review",
		title = "Performance Review",
		emoji = "ğŸ“Š",
		textVariants = {
			"Performance review time! Your manager wants to meet.",
			"Annual review is scheduled with your boss.",
			"Your work evaluation is coming up!",
		},
		text = "Performance review time! Your manager wants to meet.",
		question = "How does it go?",
		minAge = 18, maxAge = 70,
		baseChance = 0.3,
		cooldown = 4,
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Be confident about your work",
				effects = {},
				feedText = "You walk in with your head high...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100) - math.floor(smarts / 10)
					if roll <= 35 then
						state:ModifyStat("Happiness", 10)
						state.Money = (state.Money or 0) + math.random(500, 1500)
						state.Flags = state.Flags or {}
						state.Flags.great_review = true
						state:AddFeed("ğŸ“Š EXCELLENT REVIEW! Raise incoming!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ“Š Good review! 'Meets expectations' - stable!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ“Š 'Needs improvement.' That stings.")
					end
				end,
			},
			{
				text = "Ask for specific feedback",
				effects = {},
				feedText = "You want to improve...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Smarts", 3)
						state:ModifyStat("Happiness", 4)
						state:AddFeed("ğŸ“Š Constructive feedback! Now you know what to work on!")
					else
						state:ModifyStat("Happiness", 2)
						state:AddFeed("ğŸ“Š Vague feedback but at least you tried to grow.")
					end
				end,
			},
		},
	},
	{
		id = "office_project_deadline",
		title = "Project Deadline",
		emoji = "â°",
		textVariants = {
			"Big project deadline is tomorrow! Are you ready?",
			"Crunch time! Major deliverable due!",
			"The project you've been working on is due!",
		},
		text = "Big project deadline is tomorrow! Are you ready?",
		question = "How do you handle the pressure?",
		minAge = 18, maxAge = 70,
		baseChance = 0.5,
		cooldown = 3,
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Work overtime to finish",
				effects = {},
				feedText = "You stay late at the office...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Smarts", 4)
						state:ModifyStat("Happiness", 5)
						state.Flags = state.Flags or {}
						state.Flags.reliable_worker = true
						state:AddFeed("â° Delivered on time! Leadership impressed!")
					elseif roll <= 80 then
						state:ModifyStat("Happiness", 2)
						state:ModifyStat("Health", -2)
						state:AddFeed("â° Got it done but exhausted. Weekend ruined.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("â° Still couldn't finish. Had to ask for extension.")
					end
				end,
			},
			{
				text = "Ask for an extension",
				effects = {},
				feedText = "You explain the situation...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 4)
						state:AddFeed("â° Extension granted! Breathing room!")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("â° Denied! Now under even more pressure!")
					end
				end,
			},
		},
	},
	{
		id = "office_new_software",
		title = "New Software Rollout",
		emoji = "ğŸ’»",
		textVariants = {
			"The company is rolling out new software!",
			"Time to learn a new system at work!",
			"IT is implementing new tools you need to learn.",
		},
		text = "The company is rolling out new software you need to learn!",
		question = "How quickly do you adapt?",
		minAge = 18, maxAge = 70,
		baseChance = 0.4,
		cooldown = 4,
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Embrace it and learn fast",
				effects = {},
				feedText = "You dive into the training...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100) - math.floor(smarts / 10)
					if roll <= 40 then
						state:ModifyStat("Smarts", 4)
						state.Flags = state.Flags or {}
						state.Flags.tech_savvy = true
						state:AddFeed("ğŸ’» Mastered it quickly! Now helping others learn!")
					elseif roll <= 70 then
						state:ModifyStat("Smarts", 2)
						state:AddFeed("ğŸ’» Getting the hang of it. Just takes practice.")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ’» Struggling with it. Feeling left behind.")
					end
				end,
			},
			{
				text = "Resist the change",
				effects = {},
				feedText = "You complain to anyone who'll listen...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ’» Found workarounds! Old ways still work!")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("ğŸ’» Forced to learn anyway. Wasted energy complaining.")
					end
				end,
			},
		},
	},
	{
		id = "office_team_building",
		title = "Team Building Event",
		emoji = "ğŸ¯",
		textVariants = {
			"HR organized a team building activity!",
			"Mandatory fun! Team building day!",
			"Your department is doing a team bonding event!",
		},
		text = "HR organized a team building activity!",
		question = "How do you approach it?",
		minAge = 18, maxAge = 70,
		baseChance = 0.4,
		cooldown = 4,
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Participate enthusiastically",
				effects = {},
				feedText = "You give it your all...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 6)
						state.Flags = state.Flags or {}
						state.Flags.team_player = true
						state:AddFeed("ğŸ¯ Actually fun! Made some real connections!")
					elseif roll <= 80 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ¯ Not bad! Free food at least!")
					else
						state:ModifyStat("Happiness", -2)
						state:AddFeed("ğŸ¯ Awkward activities. Would rather be working.")
					end
				end,
			},
			{
				text = "Find an excuse to skip",
				effects = {},
				feedText = "You claim to have a meeting...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 4)
						state:AddFeed("ğŸ¯ Escaped! Productive day instead!")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ¯ Got caught. Now labeled as 'not a team player'.")
					end
				end,
			},
		},
	},
	{
		id = "office_promotion_opportunity",
		title = "Promotion Opportunity",
		emoji = "ğŸ“ˆ",
		textVariants = {
			"A senior position just opened up!",
			"Your manager is leaving - will you apply for their role?",
			"There's a chance to move up in the company!",
		},
		text = "A senior position just opened up! Should you apply?",
		question = "What do you do?",
		minAge = 22, maxAge = 60,
		baseChance = 0.2,
		cooldown = 5,
		category = "career_office",
		requiresJob = true,
		eligibility = hasOfficeJob,
		
		choices = {
			{
				text = "Apply with confidence",
				effects = {},
				feedText = "You submit your application...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100) - math.floor(smarts / 10)
					if roll <= 35 then
						state:ModifyStat("Happiness", 15)
						state.Money = (state.Money or 0) + math.random(5000, 15000)
						state.Flags = state.Flags or {}
						state.Flags.promoted = true
						state:AddFeed("ğŸ“ˆ YOU GOT IT! Promoted! Big raise incoming!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ“ˆ Didn't get it, but impressed leadership. Next time!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ“ˆ Rejected. That hurt. Someone less experienced got it.")
					end
				end,
			},
			{
				text = "Wait for the right moment",
				effects = {},
				feedText = "You decide to bide your time...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 4)
						state:AddFeed("ğŸ“ˆ Smart choice. Better opportunity came later.")
					else
						state:ModifyStat("Happiness", -2)
						state:AddFeed("ğŸ“ˆ Missed your shot. The position was filled.")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- ACCOUNTANT-SPECIFIC EVENTS
	-- More engaging events for accounting/finance careers
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "accountant_audit_crisis",
		title = "Audit Emergency",
		emoji = "ğŸ“Š",
		textVariants = {
			"A major client's books don't add up. The audit is tomorrow!",
			"The IRS is investigating one of your biggest clients!",
			"You found a $500,000 discrepancy in a client's financials!",
		},
		text = "A major client's books don't add up. The audit is tomorrow!",
		question = "How do you handle this crisis?",
		minAge = 22, maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("account") or jobId:find("cpa") or jobId:find("auditor")
				or jobId:find("finance") or jobId:find("bookkeeper")
		end,
		
		choices = {
			{
				text = "Pull an all-nighter to fix it",
				effects = { Health = -3 },
				feedText = "You won't sleep until this is solved...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100) - math.floor(smarts / 10)
					if roll <= 40 then
						state:ModifyStat("Happiness", 12)
						state.Money = (state.Money or 0) + math.random(2000, 5000)
						state.Flags = state.Flags or {}
						state.Flags.crisis_solver = true
						state:AddFeed("ğŸ“Š Found the error at 4am! Client saved! Bonus incoming!")
					elseif roll <= 75 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ“Š Fixed most issues. Client barely passed audit. Exhausted.")
					else
						state:ModifyStat("Happiness", -8)
						state.Flags = state.Flags or {}
						state.Flags.audit_failure = true
						state:AddFeed("ğŸ“Š Couldn't fix it in time. Client got fined. They're furious.")
					end
				end,
			},
			{
				text = "Report the discrepancy honestly",
				effects = { Smarts = 2 },
				feedText = "You document everything properly...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ“Š Client appreciated your honesty. They fixed the issue.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ“Š Client blamed you for not catching it sooner. Unfair!")
					end
				end,
			},
			{
				text = "Escalate to senior partner",
				effects = {},
				feedText = "Not your problem alone...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ“Š Partner handled it. Crisis averted. Team effort!")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ“Š Partner threw you under the bus. Should've handled it yourself.")
					end
				end,
			},
		},
	},
	{
		id = "accountant_tax_season",
		title = "Tax Season Madness",
		emoji = "ğŸ’°",
		textVariants = {
			"It's tax season! Your workload just tripled!",
			"April is coming... the deadline looms!",
			"Your desk is buried in 1099s and W-2s!",
		},
		text = "It's tax season! The deadline is approaching fast!",
		question = "How do you survive?",
		minAge = 22, maxAge = 65,
		baseChance = 0.55,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("account") or jobId:find("cpa") or jobId:find("tax")
				or jobId:find("finance") or jobId:find("bookkeeper")
		end,
		
		choices = {
			{
				text = "Work 80-hour weeks",
				effects = { Health = -5, Happiness = -3 },
				feedText = "Living at the office...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					state.Money = (state.Money or 0) + math.random(3000, 8000) -- Overtime pay
					if roll <= 50 then
						state.Flags = state.Flags or {}
						state.Flags.tax_season_hero = true
						state:AddFeed("ğŸ’° Survived tax season! Overtime pay: $" .. math.random(3000, 8000) .. "!")
					else
						state:ModifyStat("Health", -3)
						state:AddFeed("ğŸ’° Made it through but you're running on fumes. Need a vacation.")
					end
				end,
			},
		{
			text = "Hire temp help ($1K)",
			effects = { Money = -1000 },
			feedText = "Can't do this alone...",
			eligibility = function(state) return (state.Money or 0) >= 1000, "ğŸ’¸ Need $1K for temp help" end,
			onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 65 then
						state:ModifyStat("Happiness", 6)
						state:AddFeed("ğŸ’° Temps saved you! Manageable workload. Smart move!")
					else
						state:ModifyStat("Happiness", -4)
						state:AddFeed("ğŸ’° Temps made mistakes. Had to redo their work. Wasted money.")
					end
				end,
			},
			{
				text = "Set client expectations early",
				effects = { Smarts = 2 },
				feedText = "Communication is key...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸ’° Clients were understanding. Extensions filed. Stress managed!")
					else
						state:ModifyStat("Happiness", -2)
						state:AddFeed("ğŸ’° Some clients were upset. But you're not burned out at least.")
					end
				end,
			},
		},
	},
	{
		id = "accountant_embezzlement_discovery",
		title = "Suspicious Activity",
		emoji = "ğŸš¨",
		textVariants = {
			"You've discovered irregularities in a coworker's accounts!",
			"Someone's been cooking the books... you have proof!",
			"There's money missing and you know where it went!",
		},
		text = "You've discovered evidence that someone is embezzling funds!",
		question = "This is serious. What do you do?",
		minAge = 22, maxAge = 65,
		baseChance = 0.25,
		cooldown = 5,
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("account") or jobId:find("cpa") or jobId:find("auditor")
				or jobId:find("finance") or jobId:find("controller")
		end,
		
		choices = {
			{
				text = "Report to authorities immediately",
				effects = {},
				feedText = "Doing the right thing...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 15)
						state.Money = (state.Money or 0) + math.random(5000, 20000) -- Whistleblower reward
						state.Flags = state.Flags or {}
						state.Flags.whistleblower_hero = true
						state:AddFeed("ğŸš¨ HERO! Embezzler caught! Whistleblower reward: $" .. math.random(5000, 20000) .. "!")
					else
						state:ModifyStat("Happiness", 5)
						state:AddFeed("ğŸš¨ Right thing done but investigation dragged on. Stressful process.")
					end
				end,
			},
			{
				text = "Confront the person privately",
				effects = {},
				feedText = "Maybe there's an explanation...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸš¨ It was an accounting error! Crisis averted. Phew!")
					elseif roll <= 60 then
						state:ModifyStat("Happiness", -5)
						state.Flags = state.Flags or {}
						state.Flags.threatened_at_work = true
						state:AddFeed("ğŸš¨ They threatened you to keep quiet. Now what?!")
					else
						state:ModifyStat("Happiness", -10)
						state:AddFeed("ğŸš¨ They tried to frame YOU! Had to fight to clear your name!")
					end
				end,
			},
			{
				text = "Document everything and wait",
				effects = { Smarts = 3 },
				feedText = "Building your case...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.has_embezzlement_evidence = true
					state:AddFeed("ğŸš¨ Evidence documented. Waiting for the right moment to act.")
				end,
			},
		},
	},
	{
		id = "accountant_client_dispute",
		title = "Client Dispute",
		emoji = "ğŸ’¢",
		textVariants = {
			"A client is disputing your work on their taxes!",
			"Someone claims you made a costly mistake!",
			"A client is threatening to sue over their audit!",
		},
		text = "A client is disputing your work and threatening legal action!",
		question = "How do you respond?",
		minAge = 22, maxAge = 65,
		baseChance = 0.35,
		cooldown = 4,
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("account") or jobId:find("cpa") or jobId:find("auditor")
				or jobId:find("finance")
		end,
		
		choices = {
			{
				text = "Review your work thoroughly",
				effects = { Smarts = 2 },
				feedText = "Checking everything...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 40 then
						state:ModifyStat("Happiness", 10)
						state:AddFeed("ğŸ’¢ Your work was perfect! Client backed down. Vindicated!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", -3)
						state.Money = (state.Money or 0) - math.random(500, 2000)
						state:AddFeed("ğŸ’¢ Small error found. Fixed it. Client satisfied but you paid a fee.")
					else
						state:ModifyStat("Happiness", -10)
						state.Money = (state.Money or 0) - math.random(2000, 10000)
						state:AddFeed("ğŸ’¢ Major mistake discovered. Malpractice insurance kicked in. Ouch.")
					end
				end,
			},
		{
			text = "Offer a settlement ($2K)",
			effects = { Money = -2000 },
			feedText = "Sometimes paying is easier...",
			eligibility = function(state) return (state.Money or 0) >= 2000, "ğŸ’¸ Need $2K for settlement" end,
			onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ’¢ They accepted the settlement. Expensive lesson learned.")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ’¢ They rejected settlement! Going to arbitration now.")
					end
				end,
			},
			{
				text = "Stand your ground",
				effects = {},
				feedText = "You did nothing wrong...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 8)
						state.Flags = state.Flags or {}
						state.Flags.stood_ground = true
						state:AddFeed("ğŸ’¢ Client was bluffing! They dropped the case. Integrity intact!")
					else
						state:ModifyStat("Happiness", -8)
						state.Money = (state.Money or 0) - math.random(3000, 8000)
						state:AddFeed("ğŸ’¢ They sued anyway. Legal fees piling up. Stressful!")
					end
				end,
			},
		},
	},
	{
		id = "accountant_certification_opportunity",
		title = "Certification Opportunity",
		emoji = "ğŸ“œ",
		textVariants = {
			"There's a chance to get an advanced certification!",
			"Your firm will pay for your CPA exam!",
			"A certification program could boost your career!",
		},
		text = "You have an opportunity to pursue an advanced certification!",
		question = "Do you go for it?",
		minAge = 22, maxAge = 50,
		baseChance = 0.35,
		cooldown = 5,
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			local flags = state.Flags or {}
			return (jobId:find("account") or jobId:find("finance") or jobId:find("bookkeeper"))
				and not flags.cpa_certified
		end,
		
		choices = {
			{
				text = "Study hard and take the exam",
				effects = { Smarts = 3 },
				feedText = "Hitting the books...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100) - math.floor(smarts / 10)
					if roll <= 45 then
						state:ModifyStat("Happiness", 15)
						state:ModifyStat("Smarts", 5)
						state.Money = (state.Money or 0) + math.random(5000, 15000) -- Raise with certification
						state.Flags = state.Flags or {}
						state.Flags.cpa_certified = true
						state.Flags.certified_professional = true
						state:AddFeed("ğŸ“œ PASSED! You're now a Certified Public Accountant! Big raise incoming!")
					elseif roll <= 70 then
						state:ModifyStat("Happiness", -5)
						state.Flags = state.Flags or {}
						state.Flags.cpa_attempt = true
						state:AddFeed("ğŸ“œ Failed the exam. Can retake it. Don't give up!")
					else
						state:ModifyStat("Happiness", -8)
						state:AddFeed("ğŸ“œ Bombed the exam badly. Need more study time. Humiliating.")
					end
				end,
			},
			{
				text = "Wait until you're more prepared",
				effects = { Happiness = -2 },
				feedText = "Maybe next year...",
				onResolve = function(state)
					state:AddFeed("ğŸ“œ Opportunity passed. Maybe next time you'll feel ready.")
				end,
			},
		},
	},
	{
		id = "accountant_big_client",
		title = "Landing a Big Fish",
		emoji = "ğŸ‹",
		textVariants = {
			"A Fortune 500 company wants you to handle their account!",
			"A celebrity approached you for financial management!",
			"A major corporation is interested in your services!",
		},
		text = "A major client wants to hire you! This could be huge!",
		question = "How do you approach this opportunity?",
		minAge = 25, maxAge = 60,
		baseChance = 0.25,
		cooldown = 5,
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("account") or jobId:find("cpa") or jobId:find("finance")
				or jobId:find("controller") or jobId:find("cfo")
		end,
		
		choices = {
			{
				text = "Pitch your best presentation",
				effects = {},
				feedText = "This is your shot...",
				onResolve = function(state)
					local smarts = (state.Stats and state.Stats.Smarts) or 50
					local roll = math.random(1, 100) - math.floor(smarts / 8)
					if roll <= 35 then
						state:ModifyStat("Happiness", 20)
						state.Money = (state.Money or 0) + math.random(10000, 50000)
						state.Flags = state.Flags or {}
						state.Flags.has_major_client = true
						state.Flags.high_profile_accountant = true
						state:AddFeed("ğŸ‹ LANDED THE WHALE! Your career just skyrocketed! Massive bonus!")
					elseif roll <= 65 then
						state:ModifyStat("Happiness", 5)
						state.Money = (state.Money or 0) + math.random(2000, 8000)
						state:AddFeed("ğŸ‹ Got a smaller contract. Not the big one, but still great!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ‹ They went with a competitor. So close! Next time.")
					end
				end,
			},
			{
				text = "Partner with a colleague",
				effects = {},
				feedText = "Strength in numbers...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 12)
						state.Money = (state.Money or 0) + math.random(5000, 15000)
						state:AddFeed("ğŸ‹ Team effort paid off! Split the commission but landed the client!")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ‹ Partner took credit for your work. Won the client but you got less.")
					end
				end,
			},
		},
	},
	{
		id = "accountant_work_life_balance",
		title = "Burnout Warning",
		emoji = "ğŸ˜°",
		textVariants = {
			"You haven't taken a vacation in 2 years...",
			"Your family says they never see you anymore...",
			"The spreadsheets are haunting your dreams...",
		},
		text = "Work is consuming your life. You're burning out.",
		question = "Something needs to change. What do you do?",
		minAge = 25, maxAge = 60,
		baseChance = 0.4,
		cooldown = 3,
		category = "career_finance",
		requiresJob = true,
		eligibility = function(state)
			if not state.CurrentJob then return false end
			local jobId = (state.CurrentJob.id or ""):lower()
			return jobId:find("account") or jobId:find("cpa") or jobId:find("finance")
		end,
		
		choices = {
			{
				text = "Take a mental health day",
				effects = { Happiness = 5, Health = 3 },
				feedText = "You need this...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 70 then
						state:ModifyStat("Happiness", 8)
						state:AddFeed("ğŸ˜° Much needed rest! Feel human again. Back at it tomorrow.")
					else
						state:ModifyStat("Happiness", -3)
						state:AddFeed("ğŸ˜° Couldn't stop thinking about work. Didn't really rest.")
					end
				end,
			},
			{
				text = "Request to work from home",
				effects = {},
				feedText = "Flexibility might help...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 60 then
						state:ModifyStat("Happiness", 10)
						state.Flags = state.Flags or {}
						state.Flags.remote_worker = true
						state:AddFeed("ğŸ˜° Approved! Work from home 3 days a week now. Life changing!")
					else
						state:ModifyStat("Happiness", -5)
						state:AddFeed("ğŸ˜° Denied. The firm needs 'butts in seats'. Old school.")
					end
				end,
			},
			{
				text = "Push through - it'll get better",
				effects = { Happiness = -5, Health = -5 },
				feedText = "Just keep grinding...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 30 then
						state:AddFeed("ğŸ˜° Eventually found your rhythm. The hustle never stops.")
					else
						state:ModifyStat("Health", -5)
						state.Flags = state.Flags or {}
						state.Flags.burned_out = true
						state:AddFeed("ğŸ˜° Burned out badly. Doctor says you need to slow down. Seriously.")
					end
				end,
			},
			{
				text = "Look for a new job",
				effects = {},
				feedText = "Fresh start needed...",
				onResolve = function(state)
					local roll = math.random(1, 100)
					if roll <= 50 then
						state:ModifyStat("Happiness", 12)
						state.Flags = state.Flags or {}
						state.Flags.job_hunting = true
						state:AddFeed("ğŸ˜° Started interviewing. Some promising leads! Excited again!")
					else
						state:ModifyStat("Happiness", 3)
						state:AddFeed("ğŸ˜° Market is tough but you're exploring options. Hope on the horizon.")
					end
				end,
			},
		},
	},
}

return OfficeCareerEvents
