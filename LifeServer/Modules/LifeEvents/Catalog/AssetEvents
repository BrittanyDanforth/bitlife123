--[[
	AssetEvents.lua
	
	Events related to owning and enjoying assets (cars, properties, luxury items).
	These events trigger based on what the player owns.
	
	Features:
	- Car enjoyment (racing, road trips, crashes)
	- Property events (parties, renovations, rental issues)
	- Luxury item events (showing off, theft, appreciation)
	- Risk events (accidents, depreciation, maintenance)
]]

local RANDOM = Random.new()

-- Helper to check if player has specific type of asset
local function hasAssetType(state, assetType)
	if not state.Assets then return false end
	local assets = state.Assets[assetType]
	if not assets then return false end
	return #assets > 0
end

-- Helper to get player's most valuable vehicle
local function getBestVehicle(state)
	if not state.Assets or not state.Assets.Vehicles then return nil end
	local best = nil
	local bestValue = 0
	for _, vehicle in ipairs(state.Assets.Vehicles) do
		if (vehicle.price or vehicle.value or 0) > bestValue then
			best = vehicle
			bestValue = vehicle.price or vehicle.value or 0
		end
	end
	return best
end

local events = {
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- VEHICLE ENJOYMENT EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "joyride_your_car",
		emoji = "ğŸš—",
		title = "Weekend Joyride",
		text = "Beautiful day outside. Your car is calling to you. Time for a drive.",
		question = "How do you enjoy your ride?",
		category = "assets",
		weight = 7,
		minAge = 16,
		maxAge = 80,
		baseChance = 0.20,  -- CRITICAL FIX: Reduced from 0.4 to prevent spam
		cooldown = 5,  -- CRITICAL FIX: Increased to space out joyride events
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not hasAssetType(state, "Vehicles") then
				return false, "ğŸš— You don't own a vehicle to drive!"
			end
			return true
		end,
		
		choices = {
			{
				index = 1,
				text = "Cruise around town - windows down",
				effects = { Happiness = 10, Health = 2 },
				feedText = "You cruised around town enjoying your ride.",
			},
			{
				index = 2,
				text = "Hit the open highway - feel the speed",
				effects = { Happiness = 12 },
				feedText = "You hit the highway...",
				onResolve = function(state)
					local risk = RANDOM:NextNumber()
					-- CRITICAL FIX: Reordered conditions - check smaller range first!
					if risk < 0.05 then -- 5% chance of minor accident (most severe first)
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-10, -3))
						end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(500, 2000))
						if state.AddFeed then
							state:AddFeed("ğŸ’¥ Minor fender bender! Repairs needed.")
						end
					elseif risk < 0.20 then -- 15% chance of speeding ticket (5-20% range)
						local fine = RANDOM:NextInteger(150, 400)
						state.Money = math.max(0, (state.Money or 0) - fine)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš¨ Speeding ticket! $%d fine.", fine))
						end
					end
				end,
			},
			{
				index = 3,
				text = "Take a scenic route - relax and enjoy",
				effects = { Happiness = 8, Health = 5 },
				feedText = "You took the scenic route and cleared your head.",
			},
		},
	},
	
	{
		id = "street_race_invitation",
		emoji = "ğŸï¸",
		title = "Street Race Challenge",
		text = "Someone at a red light revs their engine at you and gestures a challenge. They want to race.",
		question = "Do you accept the street race?",
		category = "assets",
		weight = 5,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.18,  -- CRITICAL FIX: Reduced from 0.455 to prevent spam
		cooldown = 6, -- CRITICAL FIX: Increased to space out racing events
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Must FIRST check if player owns ANY car, THEN check car value
		eligibility = function(state)
			-- Must own at least one vehicle
			if not hasAssetType(state, "Vehicles") then
				return false, "You don't own a car"
			end
			-- Must have a decent car worth at least $30,000
			local vehicle = getBestVehicle(state)
			if not vehicle then
				return false, "You don't own a car"
			end
			return (vehicle.price or vehicle.value or 0) >= 30000, "Need a better car to race"
		end,
		
		choices = {
			{
				index = 1,
				text = "RACE! Show them what my car can do!",
				effects = { Happiness = 10 },
				feedText = "You accepted the challenge...",
				onResolve = function(state)
					local outcome = RANDOM:NextNumber()
					if outcome < 0.35 then -- Win
						local winnings = RANDOM:NextInteger(500, 2000)
						state.Money = (state.Money or 0) + winnings
						state.Flags = state.Flags or {}
						state.Flags.street_racer = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ† You WON! Earned $%d and respect!", winnings))
						end
					elseif outcome < 0.65 then -- Lose
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(200, 1000))
						if state.AddFeed then
							state:AddFeed("ğŸ˜¤ You lost the race! They were faster.")
						end
					elseif outcome < 0.85 then -- Cops show up
						local fine = RANDOM:NextInteger(500, 2000)
						state.Money = math.max(0, (state.Money or 0) - fine)
						state.Flags = state.Flags or {}
						state.Flags.reckless_driving = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” COPS! Ticket for reckless driving: $%d", fine))
						end
					else -- Crash
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-30, -10))
						end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(5000, 15000))
						if state.AddFeed then
							state:AddFeed("ğŸ’¥ CRASH! You wrecked your car and got hurt!")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Ignore them - I'm not risking my car",
				effects = { Happiness = 2, Smarts = 3 },
				feedText = "You played it safe. Your car is too valuable to risk.",
			},
			{
				index = 3,
				text = "Call them out for being childish",
				effects = { Happiness = 5 },
				feedText = "You rolled down your window and told them to grow up.",
			},
		},
	},
	
	{
		id = "car_show_off",
		emoji = "âœ¨",
		title = "Show Off Your Ride",
		text = "There's a car meetup in town. People are showing off their rides and yours would definitely turn heads.",
		question = "Do you go show off?",
		category = "assets",
		weight = 5,
		minAge = 18,
		maxAge = 60,
		baseChance = 0.15,  -- CRITICAL FIX: Reduced from 0.45 to prevent spam (VehicleEvents has car_show)
		cooldown = 7,  -- CRITICAL FIX: Increased to space out car show events
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Must FIRST check if player owns ANY car, THEN check car value
		eligibility = function(state)
			-- Must own at least one vehicle
			if not hasAssetType(state, "Vehicles") then
				return false, "You don't own a car"
			end
			-- Must have a nice car worth at least $50,000
			local vehicle = getBestVehicle(state)
			if not vehicle then
				return false, "You don't own a car"
			end
			return (vehicle.price or vehicle.value or 0) >= 50000, "Need a nicer car to show off"
		end,
		
		choices = {
			{
				index = 1,
				text = "Show up and show off!",
				effects = { Happiness = 15 },
				feedText = "You showed off your ride!",
				onResolve = function(state)
					local vehicle = getBestVehicle(state)
					local vehicleName = vehicle and vehicle.name or "your car"
					if RANDOM:NextNumber() < 0.3 then
						state.Flags = state.Flags or {}
						state.Flags.car_enthusiast = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ† %s won 'Best in Show'! Everyone's jealous.", vehicleName))
						end
					else
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ˜ Everyone loved %s! Made some car friends.", vehicleName))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Nah, I don't need to show off",
				effects = { Happiness = 3 },
				feedText = "You stayed home. Your car knows it's special.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- HIGH-SPEED CAR RISK EVENTS (CRITICAL FIX: Random outcomes, real consequences!)
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "highway_speed_demon",
		emoji = "ğŸï¸",
		title = "Need for Speed",
		text = "You're on an empty highway late at night. Your speedometer is climbing... 80... 90... 100 mph. The adrenaline is pumping.",
		question = "How far do you push it?",
		category = "assets",
		weight = 4,
		minAge = 18,
		maxAge = 55,
		baseChance = 0.15,  -- CRITICAL FIX: Reduced from 0.45 to prevent spam
		cooldown = 6,  -- CRITICAL FIX: Increased to space out high-risk events
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Must FIRST check if player owns ANY car, THEN check car value
		eligibility = function(state)
			-- Must own at least one vehicle
			if not hasAssetType(state, "Vehicles") then
				return false, "You don't own a car"
			end
			-- Must have a fast car worth at least $25,000
			local vehicle = getBestVehicle(state)
			if not vehicle then
				return false, "You don't own a car"
			end
			return (vehicle.price or vehicle.value or 0) >= 25000, "Need a faster car"
		end,
		choices = {
			{
				index = 1,
				text = "FLOOR IT! See what this beast can do!",
				effects = {},
				feedText = "You pushed the pedal to the metal...",
				onResolve = function(state)
					-- CRITICAL FIX: Added nil checks for all method calls
					local outcome = RANDOM:NextNumber()
					local vehicle = getBestVehicle(state)
					local vehicleName = vehicle and vehicle.name or "your car"
					
					if outcome < 0.30 then -- Pure thrill!
						if state.ModifyStat then state:ModifyStat("Happiness", 20) end
						state.Flags = state.Flags or {}
						state.Flags.speed_demon = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸï¸ Hit 140 mph in %s! INCREDIBLE rush!", vehicleName))
						end
					elseif outcome < 0.50 then -- Cops!
						local fine = RANDOM:NextInteger(800, 3000)
						state.Money = math.max(0, (state.Money or 0) - fine)
						state.Flags = state.Flags or {}
						state.Flags.criminal_record = true
						state.Flags.reckless_driving = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” BUSTED! Reckless endangerment: $%d fine, license suspended!", fine))
						end
					elseif outcome < 0.70 then -- Car trouble at high speed
						local repairCost = RANDOM:NextInteger(2000, 8000)
						state.Money = math.max(0, (state.Money or 0) - repairCost)
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ”§ Engine blew at 130 mph! $%d in repairs. Lucky to be alive.", repairCost))
						end
					elseif outcome < 0.90 then -- Near miss
						if state.ModifyStat then state:ModifyStat("Happiness", 5) end
						if state.ModifyStat then state:ModifyStat("Health", -5) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜° Nearly hit a deer at 120 mph. Heart almost stopped. Never again.")
						end
					else -- CRASH
						if state.ModifyStat then state:ModifyStat("Health", RANDOM:NextInteger(-40, -20)) end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(10000, 30000))
						state.Flags = state.Flags or {}
						state.Flags.hospitalized = true
						-- Destroy the car
						if state.Assets and state.Assets.Vehicles then
							for i, v in ipairs(state.Assets.Vehicles) do
								if v == vehicle then
									table.remove(state.Assets.Vehicles, i)
									break
								end
							end
						end
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’¥ TOTALED %s at 140 mph! Hospitalized for weeks. Lucky to survive.", vehicleName))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Keep it at 90 - fast but reasonable",
				effects = { Happiness = 8 },
				feedText = "You enjoyed the speed responsibly.",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.15 then
						local fine = RANDOM:NextInteger(200, 500)
						state.Money = math.max(0, (state.Money or 0) - fine)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš¨ Speeding ticket: $%d. Still worth it.", fine))
						end
					end
				end,
			},
			{
				index = 3,
				text = "Slow down - not worth the risk",
				effects = { Happiness = 2, Smarts = 3 },
				feedText = "Smart choice. You've got too much to lose.",
			},
		},
	},
	
	{
		id = "car_vandalized",
		emoji = "ğŸ˜¡",
		title = "Car Vandalized!",
		text = "You come outside to find your car has been vandalized! Scratches, broken windows, the works.",
		question = "How do you react?",
		category = "assets",
		weight = 3,
		minAge = 18,
		maxAge = 70,
		baseChance = 0.1,
		cooldown = 5,
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Must FIRST check if player owns ANY car
		eligibility = function(state)
			-- Must own at least one vehicle
			if not hasAssetType(state, "Vehicles") then
				return false, "You don't own a car"
			end
			local vehicle = getBestVehicle(state)
			if not vehicle then
				return false, "You don't own a car"
			end
			return (vehicle.price or vehicle.value or 0) >= 20000, "No car to vandalize"
		end,
		choices = {
			{
				index = 1,
				text = "File a police report and insurance claim",
				effects = { Happiness = -10 },
				feedText = "You reported it...",
				onResolve = function(state)
					local deductible = RANDOM:NextInteger(500, 1500)
					state.Money = math.max(0, (state.Money or 0) - deductible)
					if RANDOM:NextNumber() < 0.2 then
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” Police caught them! Got $%d restitution.", deductible + RANDOM:NextInteger(500, 1000)))
						end
						state.Money = (state.Money or 0) + deductible + RANDOM:NextInteger(500, 1000)
					else
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ“ Insurance covered it. $%d deductible.", deductible))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Hunt down whoever did this",
				effects = { Happiness = -5 },
				feedText = "You went looking for the culprits...",
				onResolve = function(state)
					local outcome = RANDOM:NextNumber()
					if outcome < 0.3 then
						state:ModifyStat("Happiness", 10)
						if state.AddFeed then
							state:AddFeed("ğŸ‘Š Found them! They paid for repairs AND apologized. Justice!")
						end
					elseif outcome < 0.6 then
						state:ModifyStat("Happiness", -10)
						if state.AddFeed then
							state:AddFeed("ğŸ˜” Never found them. Frustrating.")
						end
					else
						state:ModifyStat("Health", RANDOM:NextInteger(-15, -5))
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(1000, 3000))
						if state.AddFeed then
							state:AddFeed("ğŸ‘Š Confrontation went badly. Got hurt and car still damaged.")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Just pay for repairs myself ($2,000)",
				effects = { Happiness = -8, Money = -2000 },
				feedText = "You paid out of pocket. Life goes on.",
				-- CRITICAL FIX #8: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 2000, "ğŸ’¸ Need $2,000 for repairs" end,
			},
		},
	},
	
	{
		id = "exotic_car_attention",
		emoji = "ğŸ‘€",
		title = "All Eyes on You",
		text = "Everywhere you go, people stare at your exotic car. Someone wants to take a photo with it.",
		question = "How do you handle the attention?",
		category = "assets",
		weight = 4,
		minAge = 21,
		maxAge = 65,
		baseChance = 0.20,  -- CRITICAL FIX: Reduced from 0.455 to prevent spam
		cooldown = 6, -- CRITICAL FIX: Increased to space out exotic car events
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Must FIRST check if player owns ANY car, THEN check car value
		eligibility = function(state)
			-- Must own at least one vehicle
			if not hasAssetType(state, "Vehicles") then
				return false, "You don't own a car"
			end
			-- Must have an exotic car worth at least $100,000
			local vehicle = getBestVehicle(state)
			if not vehicle then
				return false, "You don't own a car"
			end
			return (vehicle.price or vehicle.value or 0) >= 100000, "Need an exotic car"
		end,
		choices = {
			{
				index = 1,
				text = "Let them take photos - share the joy",
				effects = { Happiness = 12 },
				feedText = "You posed with fans...",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.car_celebrity = true
					if RANDOM:NextNumber() < 0.3 then
						if state.AddFeed then
							state:AddFeed("ğŸ“± Photo went viral! You're car-famous now!")
						end
						state.Flags.viral = true
					else
						if state.AddFeed then
							state:AddFeed("ğŸ“¸ Made someone's day. Feels good to share the dream.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Tell them to back off - this is MY car",
				effects = { Happiness = 3 },
				feedText = "You shooed them away.",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.2 then
						state:ModifyStat("Happiness", -10)
						if state.AddFeed then
							state:AddFeed("ğŸ˜¤ They keyed your car as revenge. Karma.")
						end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(1000, 3000))
					end
				end,
			},
			{
				index = 3,
				text = "Offer to let them sit in it",
				effects = { Happiness = 8 },
				feedText = "You made a kid's dream come true.",
				onResolve = function(state)
					state:ModifyStat("Happiness", 5)
					state.Flags = state.Flags or {}
					state.Flags.generous = true
					if state.AddFeed then
						state:AddFeed("ğŸ˜Š Their face lit up! Generosity feels good.")
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PROPERTY ENJOYMENT EVENTS  
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "house_party",
		emoji = "ğŸ‰",
		title = "House Party",
		text = "You've got a nice place. Perfect for throwing a party!",
		question = "Do you host a party?",
		category = "assets",
		weight = 6,
		minAge = 18,
		maxAge = 50,
		baseChance = 0.5, -- CRITICAL FIX: Reduced from 0.55 to prevent spam
		cooldown = 5, -- CRITICAL FIX: Increased from 4 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not hasAssetType(state, "Properties") then
				return false, "ğŸ  You need to own property to host a party!"
			end
			return true
		end,
		
		choices = {
			{
				index = 1,
				text = "Small gathering - close friends only ($200)",
				effects = { Happiness = 12, Money = -200 },
				feedText = "You hosted an intimate get-together.",
				-- CRITICAL FIX #5: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 200, "ğŸ’¸ Need $200 for party" end,
				onResolve = function(state)
					if state.AddFeed then
						state:AddFeed("ğŸ¥‚ Great party! Good times with good friends.")
					end
				end,
			},
			{
				index = 2,
				text = "RAGER! Invite everyone! ($1,000)",
				effects = { Happiness = 20, Money = -1000 },
				feedText = "You threw a MASSIVE party...",
				-- CRITICAL FIX #6: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 1000, "ğŸ’¸ Need $1,000 for epic party" end,
				onResolve = function(state)
					local outcome = RANDOM:NextNumber()
					if outcome < 0.2 then
						-- Party gets out of hand
						local damage = RANDOM:NextInteger(500, 3000)
						state.Money = math.max(0, (state.Money or 0) - damage)
						state.Flags = state.Flags or {}
						state.Flags.party_animal = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ”¥ WILD night! $%d in damages but legendary party!", damage))
						end
					elseif outcome < 0.35 then
						-- Cops called
						local fine = RANDOM:NextInteger(200, 500)
						state.Money = math.max(0, (state.Money or 0) - fine)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” Noise complaint! $%d fine. Worth it?", fine))
						end
					else
						state.Flags = state.Flags or {}
						state.Flags.party_legend = true
						if state.AddFeed then
							state:AddFeed("ğŸŠ LEGENDARY PARTY! Everyone's talking about it!")
						end
					end
				end,
			},
			{
				index = 3,
				text = "I prefer peace and quiet",
				effects = { Happiness = 5, Health = 2 },
				feedText = "You enjoyed a quiet evening at home.",
			},
		},
	},
	
	{
		-- CRITICAL FIX: Renamed from "home_renovation" to avoid duplicate ID conflict
		-- Adult.lua has another version
		id = "home_renovation_asset",
		emoji = "ğŸ ",
		title = "Home Improvement",
		text = "Your place could use some upgrades. Time to renovate?",
		question = "What do you improve?",
		category = "assets",
		weight = 4,
		minAge = 21,
		maxAge = 70,
		baseChance = 0.45,
		cooldown = 6,
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Must own a property AND have enough money for cheapest option
		eligibility = function(state)
			if not hasAssetType(state, "Properties") then
				return false, "You don't own property to renovate"
			end
			local money = state.Money or 0
			if money < 5000 then
				return false, "Can't afford renovations right now"
			end
			return true
		end,
		
		choices = {
			{
				index = 1,
				text = "Kitchen remodel - modern and sleek ($15,000)",
				effects = { Happiness = 10, Money = -15000 },
				setFlags = { renovated_home = true },
				feedText = "You upgraded your kitchen! Property value increased.",
				-- CRITICAL FIX: Per-choice affordability check
				eligibility = function(state)
					if (state.Money or 0) < 15000 then
						return false, "Can't afford a $15,000 kitchen remodel"
					end
					return true
				end,
				onResolve = function(state)
					-- Increase property value
					if state.Assets and state.Assets.Properties then
						for _, prop in ipairs(state.Assets.Properties) do
							prop.value = (prop.value or prop.price or 100000) * 1.1
						end
					end
				end,
			},
			{
				index = 2,
				text = "Add a pool/hot tub ($25,000)",
				effects = { Happiness = 15, Money = -25000 },
				setFlags = { has_pool = true },
				feedText = "Pool installed! Summer's going to be great.",
				-- CRITICAL FIX: Per-choice affordability check
				eligibility = function(state)
					if (state.Money or 0) < 25000 then
						return false, "Can't afford a $25,000 pool installation"
					end
					return true
				end,
			},
			{
				index = 3,
				text = "New furniture and decor ($5,000)",
				effects = { Happiness = 8, Money = -5000 },
				feedText = "Your place looks amazing now!",
				-- CRITICAL FIX: Per-choice affordability check
				eligibility = function(state)
					if (state.Money or 0) < 5000 then
						return false, "Can't afford $5,000 for furniture"
					end
					return true
				end,
			},
			{
				index = 4,
				text = "Save my money - it's fine as is",
				effects = { Happiness = 2, Money = 500 },
				feedText = "Smart financial decision. Function over form.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- LUXURY/SHOWOFF EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "wealth_envy",
		emoji = "ğŸ’",
		title = "Jealousy from Others",
		text = "You notice people staring at your nice things. Some with admiration, others with envy.",
		question = "How do you handle the attention?",
		category = "assets",
		weight = 5,
		minAge = 18,
		maxAge = 70,
		baseChance = 0.455,
		cooldown = 3,
		blockedByFlags = { in_prison = true, incarcerated = true },
		-- CRITICAL FIX: Verify player actually HAS assets before checking value
		eligibility = function(state)
			-- First check if player has ANY assets at all
			if not state.Assets then
				return false, "You don't own any valuable assets"
			end
			
			local totalValue = 0
			local hasAnyAssets = false
			
			for assetType, assets in pairs(state.Assets) do
				if type(assets) == "table" and #assets > 0 then
					hasAnyAssets = true
					for _, asset in ipairs(assets) do
						totalValue = totalValue + (asset.value or asset.price or 0)
					end
				end
			end
			
			if not hasAnyAssets then
				return false, "You don't own any valuable assets"
			end
			
			return totalValue >= 100000, "Need more valuable assets to attract envy"
		end,
		
		choices = {
			{
				index = 1,
				text = "Flex harder - they should be jealous",
				effects = { Happiness = 8, Looks = 2 },
				feedText = "You showed off even more. Life's good when you've got it!",
			},
			{
				index = 2,
				text = "Stay humble - money isn't everything",
				effects = { Happiness = 5, Smarts = 3 },
				feedText = "You kept a low profile. Class move.",
			},
		{
			index = 3,
			text = "Help others - share your fortune ($5,000)",
			effects = { Happiness = 15, Money = -5000 },
			setFlags = { generous = true, philanthropist = true },
			feedText = "You helped someone in need. That's real wealth.",
			eligibility = function(state) return (state.Money or 0) >= 5000, "ğŸ’¸ Need $5,000 to donate" end,
		},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- RISK EVENTS - Things that can go wrong with assets
	-- CRITICAL FIX: Accidents are NOT god-mode - injuries are random!
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "car_accident_owner",
		emoji = "ğŸ’¥",
		title = "Car Accident!",
		text = "You were driving your car when another driver ran a red light and hit you! The ambulance is on the way.",
		question = "What happens next?",
		category = "assets",
		weight = 4,
		minAge = 16,
		maxAge = 80,
		baseChance = 0.25, -- CRITICAL FIX: Reduced from 0.32 - accidents shouldn't be too common
		cooldown = 6, -- CRITICAL FIX: Increased from 5 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not hasAssetType(state, "Vehicles") then
				return false, "ğŸš— You don't own a vehicle!"
			end
			return true
		end,
		
		-- CRITICAL FIX: NO CHOICES - outcome is random like BitLife!
		choices = {
			{
				index = 1,
				text = "Wait for the ambulance...",
				effects = { Happiness = -5 },
				feedText = "The paramedics arrive...",
				onResolve = function(state)
					local severity = RANDOM:NextNumber()
					local vehicle = getBestVehicle(state)
					local vehicleName = vehicle and vehicle.name or "your car"
					
					if severity < 0.4 then
						-- Minor accident - just shaken up
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(500, 2000))
						if state.AddFeed then
							state:AddFeed("ğŸš— Minor fender bender! " .. vehicleName .. " has some scratches. You're okay though.")
						end
					elseif severity < 0.75 then
						-- Moderate - injured but okay
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-20, -8))
						end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(2000, 8000))
						state.Flags = state.Flags or {}
						state.Flags.recovering_from_accident = true
						if state.AddFeed then
							state:AddFeed("ğŸ¥ You're injured but will recover. " .. vehicleName .. " needs repairs.")
						end
					elseif severity < 0.95 then
						-- Serious - hospitalized
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-40, -20))
						end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(5000, 15000))
						state.Flags = state.Flags or {}
						state.Flags.hospitalized = true
						state.Flags.car_accident_survivor = true
						-- Car might be totaled
						if state.Assets and state.Assets.Vehicles and #state.Assets.Vehicles > 0 then
							table.remove(state.Assets.Vehicles, 1)
							if state.AddFeed then
								state:AddFeed("ğŸ¥ Serious crash! " .. vehicleName .. " is totaled. You're in the hospital.")
							end
						end
					else
						-- Critical - life threatening
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-60, -40))
						end
						state.Flags = state.Flags or {}
						state.Flags.in_icu = true
						state.Flags.near_death = true
						if state.AddFeed then
							state:AddFeed("âš ï¸ CRITICAL CONDITION! You're in the ICU fighting for your life!")
						end
					end
				end,
			},
		},
	},
	
	-- CRITICAL FIX: Separate event for people WITHOUT cars (uber/taxi/bus)
	{
		id = "transit_accident",
		emoji = "ğŸš•",
		title = "Accident While Traveling!",
		text = "You were in an Uber when the driver got into a collision with another vehicle! You're shaken up.",
		question = "What happens?",
		category = "random",
		weight = 3,
		minAge = 16,
		maxAge = 80,
		baseChance = 0.25,
		cooldown = 6,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			-- Only for people WITHOUT their own vehicle
			return not hasAssetType(state, "Vehicles")
		end,
		
		choices = {
			{
				index = 1,
				text = "Check if you're okay...",
				effects = { Happiness = -3 },
				feedText = "Checking for injuries...",
				onResolve = function(state)
					local severity = RANDOM:NextNumber()
					
					if severity < 0.6 then
						-- Just shaken up
						if state.AddFeed then
							state:AddFeed("ğŸ˜° Scary moment but you're okay! Just some bruises.")
						end
					elseif severity < 0.85 then
						-- Minor injuries
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-12, -5))
						end
						if state.AddFeed then
							state:AddFeed("ğŸ¤• You got hurt but nothing serious. Might sue the driver...")
						end
						-- Chance to get settlement
						if RANDOM:NextNumber() < 0.4 then
							local settlement = RANDOM:NextInteger(2000, 10000)
							state.Money = (state.Money or 0) + settlement
							if state.AddFeed then
								state:AddFeed(string.format("ğŸ’° Insurance settlement: $%d!", settlement))
							end
						end
					else
						-- Serious injuries
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-30, -15))
						end
						state.Flags = state.Flags or {}
						state.Flags.hospitalized = true
						if state.AddFeed then
							state:AddFeed("ğŸ¥ You're hospitalized from the crash injuries.")
						end
					end
				end,
			},
		},
	},
	
	{
		id = "car_stolen",
		emoji = "ğŸš—âŒ",
		title = "Car Stolen!",
		text = "You come outside and your car is GONE. It's been stolen!",
		question = "What do you do?",
		category = "assets",
		weight = 3,
		minAge = 16,
		maxAge = 80,
		baseChance = 0.2, -- CRITICAL FIX: Reduced from 0.25 - car theft is rare
		cooldown = 40, -- CRITICAL FIX: Increased from 30 - shouldn't repeat often
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not hasAssetType(state, "Vehicles") then
				return false, "ğŸš— You don't own a vehicle to be stolen!"
			end
			return true
		end,
		
		choices = {
			{
				index = 1,
				text = "File a police report",
				effects = { Happiness = -10 },
				feedText = "You reported it stolen...",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.3 then
						if state.AddFeed then
							state:AddFeed("ğŸš” Police found your car! Minor damage but it's back.")
						end
					else
						-- Remove a vehicle
						if state.Assets and state.Assets.Vehicles and #state.Assets.Vehicles > 0 then
							local removed = table.remove(state.Assets.Vehicles, 1)
							if state.AddFeed then
								state:AddFeed("ğŸ˜¢ Your " .. (removed.name or "car") .. " is gone forever.")
							end
						end
					end
				end,
			},
			{
				index = 2,
				text = "Insurance claim",
				effects = { Happiness = -5, Money = 10000 },
				feedText = "Insurance paid out. Time to buy a new ride.",
				onResolve = function(state)
					if state.Assets and state.Assets.Vehicles and #state.Assets.Vehicles > 0 then
						table.remove(state.Assets.Vehicles, 1)
					end
				end,
			},
			{
				index = 3,
				text = "Track it down myself",
				effects = { Happiness = 5 },
				feedText = "You went looking for your car...",
				onResolve = function(state)
					local outcome = RANDOM:NextNumber()
					if outcome < 0.2 then
						-- Found it, confrontation
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-15, -5))
						end
						if state.AddFeed then
							state:AddFeed("ğŸ‘Š Found the thief! Got in a fight but got your car back!")
						end
					elseif outcome < 0.4 then
						-- Found it abandoned
						if state.AddFeed then
							state:AddFeed("ğŸš— Found your car abandoned! It's trashed but drivable.")
						end
					else
						-- Never found
						if state.Assets and state.Assets.Vehicles and #state.Assets.Vehicles > 0 then
							local removed = table.remove(state.Assets.Vehicles, 1)
							if state.AddFeed then
								state:AddFeed("ğŸ˜¤ Couldn't find it. " .. (removed.name or "Your car") .. " is gone.")
							end
						end
					end
				end,
			},
		},
	},
	
	{
		id = "property_damage",
		emoji = "ğŸšï¸",
		title = "Property Damage",
		text = "Bad news! Your property has sustained damage. A pipe burst / tree fell / vandalism occurred.",
		question = "How do you handle it?",
		category = "assets",
		weight = 4,
		minAge = 18,
		maxAge = 80,
		baseChance = 0.1,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "Fix it properly - hire professionals ($8,000)",
				effects = { Happiness = -3, Money = -8000 },
				feedText = "You had it properly repaired. Good as new.",
				-- CRITICAL FIX #9: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 8000, "ğŸ’¸ Need $8,000 for professional repairs" end,
			},
			{
				index = 2,
				text = "Cheap fix - patch it up ($2,000)",
				effects = { Happiness = -5, Money = -2000 },
				feedText = "You did a temporary fix. Might need more work later.",
				-- CRITICAL FIX #10: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 2000, "ğŸ’¸ Need $2,000 for basic repairs" end,
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.property_needs_repair = true
				end,
			},
			{
				index = 3,
				text = "Insurance claim",
				effects = { Happiness = -2 },
				feedText = "You filed an insurance claim...",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.7 then
						state.Money = (state.Money or 0) + RANDOM:NextInteger(5000, 10000)
						if state.AddFeed then
							state:AddFeed("âœ… Insurance covered most of the repairs!")
						end
					else
						state.Money = math.max(0, (state.Money or 0) - 3000)
						if state.AddFeed then
							state:AddFeed("âŒ Insurance denied the claim. Paying out of pocket.")
						end
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- PROPERTY SPECIFIC EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "property_flood_damage",
		emoji = "ğŸŒŠ",
		title = "Flood Damage!",
		text = "Heavy rains caused flooding in your home! Water is seeping through the basement. Furniture is ruined. This is a disaster.",
		question = "How do you handle it?",
		category = "assets",
		weight = 6,
		minAge = 21,
		maxAge = 90,
		baseChance = 0.4,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "File insurance claim",
				effects = { Happiness = -5 },
				feedText = "You filed a claim...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.7 then
						state.Money = (state.Money or 0) + 8000
						if state.AddFeed then
							state:AddFeed("âœ… Insurance covered most of the damage. $8,000 payout.")
						end
					else
						if state.AddFeed then
							state:AddFeed("âŒ Claim denied. 'Act of God' exclusion. You're on your own.")
						end
					end
				end,
			},
		{
			index = 2,
			-- CRITICAL FIX: Show price and add eligibility check
			text = "Fix it yourself ($3,000 in materials)",
			effects = { Health = -5, Happiness = -5, Money = -3000 },
			feedText = "You spent weekends repairing flood damage. Exhausting but saved money.",
			eligibility = function(state)
				if (state.Money or 0) < 3000 then
					return false, "Can't afford $3,000 for repair materials"
				end
				return true
			end,
		},
		{
			index = 3,
			-- CRITICAL FIX: Show price and add eligibility check
			text = "Hire professional restoration ($8,000)",
			effects = { Money = -8000 },
			feedText = "Professionals fixed everything. Expensive but quick.",
			eligibility = function(state)
				if (state.Money or 0) < 8000 then
					return false, "Can't afford $8,000 for professional restoration"
				end
				return true
			end,
		},
		},
	},
	{
		id = "property_appreciation",
		emoji = "ğŸ“ˆ",
		title = "Property Value Increase!",
		text = "Great news! The area around your property has developed significantly. New restaurants, shops, better schools. Your property value has INCREASED!",
		question = "What's your reaction?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 90,
		baseChance = 0.45,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "Consider selling for profit",
				effects = { Happiness = 8, Smarts = 2 },
				feedText = "Your real estate investment paid off!",
				onResolve = function(state)
					-- Just a happy event - not forcing a sale
					if state.AddFeed then
						local appreciation = RANDOM:NextInteger(15000, 50000)
						state:AddFeed(string.format("ğŸ  Property appreciated $%d! Smart investment!", appreciation))
					end
				end,
			},
		},
	},
	{
		id = "property_bad_neighbors",
		emoji = "ğŸ ",
		title = "Terrible Neighbors",
		text = "Your new neighbors are AWFUL. Loud parties every night. Their dog barks constantly. They park in your spot. This is affecting your quality of life.",
		question = "How do you handle this?",
		category = "assets",
		weight = 6,
		minAge = 21,
		maxAge = 80,
		baseChance = 0.455,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "Talk to them directly",
				effects = {},
				feedText = "You went over to talk...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.5 then
						if state.ModifyStat then
							state:ModifyStat("Happiness", 8)
						end
						if state.AddFeed then
							state:AddFeed("ğŸ¤ They apologized! Things got better.")
						end
					elseif roll < 0.8 then
						if state.AddFeed then
							state:AddFeed("ğŸ˜¤ They told you to mind your business. No improvement.")
						end
					else
						if state.ModifyStat then
							state:ModifyStat("Happiness", -5)
							state:ModifyStat("Health", -3)
						end
						if state.AddFeed then
							state:AddFeed("ğŸ‘Š It escalated into an argument. Now there's a feud.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Call the police about noise",
				effects = { Happiness = 2 },
				feedText = "You called the authorities...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.6 then
						if state.AddFeed then
							state:AddFeed("ğŸš” Police gave them a warning. Quiet... for now.")
						end
					else
						state.Flags = state.Flags or {}
						state.Flags.neighbor_enemies = true
						if state.AddFeed then
							state:AddFeed("ğŸ˜¬ They know you called. Now they hate you.")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Invest in soundproofing ($2,000)",
				effects = { Money = -2000, Happiness = 5 },
				feedText = "You soundproofed your place. Problem solved with money.",
				-- CRITICAL FIX #11: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 2000, "ğŸ’¸ Need $2,000 for soundproofing" end,
			},
		},
	},
	{
		id = "property_rental_opportunity",
		emoji = "ğŸ˜ï¸",
		title = "Rental Income Opportunity",
		text = "Someone wants to rent a room in your property! Extra income could be nice. But sharing your space with a stranger...",
		question = "Do you rent it out?",
		category = "assets",
		weight = 5,
		minAge = 25,
		maxAge = 70,
		baseChance = 0.45,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "Yes, rent it out",
				effects = { Happiness = -2 },
				setFlags = { landlord = true },
				feedText = "You became a landlord...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.7 then
						local rent = RANDOM:NextInteger(800, 1500)
						state.Money = (state.Money or 0) + rent * 12
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ  Great tenant! $%d/month income.", rent))
						end
					else
						state.Money = math.max(0, (state.Money or 0) - 2000)
						if state.AddFeed then
							state:AddFeed("ğŸ˜¤ Terrible tenant! Caused damage. Never again.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "No, I value my privacy",
				effects = { Happiness = 3 },
				feedText = "Your space is yours alone. That's worth something.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- LUXURY ITEM SPECIFIC EVENTS
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "luxury_item_stolen",
		emoji = "ğŸ’",
		title = "Valuable Item Stolen!",
		text = "Someone broke into your place and stole one of your valuable items! You come home to find it GONE.",
		question = "What do you do?",
		category = "assets",
		weight = 5,
		minAge = 21,
		maxAge = 90,
		baseChance = 0.12,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Items")
		end,
		
		choices = {
			{
				index = 1,
				text = "File a police report",
				effects = { Happiness = -8 },
				feedText = "You reported the theft...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.3 then
						if state.AddFeed then
							state:AddFeed("ğŸš” Police recovered your item! Lucky!")
						end
					else
						if state.Assets and state.Assets.Items and #state.Assets.Items > 0 then
							local stolen = table.remove(state.Assets.Items, 1)
							if state.AddFeed then
								state:AddFeed("ğŸ˜” Never recovered. " .. (stolen.name or "Your item") .. " is gone.")
							end
						end
					end
				end,
			},
			{
				index = 2,
				text = "Insurance claim",
				effects = { Happiness = -5, Money = 5000 },
				feedText = "Insurance partially covered the loss.",
				onResolve = function(state)
					if state.Assets and state.Assets.Items and #state.Assets.Items > 0 then
						table.remove(state.Assets.Items, 1)
					end
				end,
			},
		},
	},
	{
		id = "luxury_item_appreciate",
		emoji = "ğŸ“ˆ",
		title = "Collectible Value Surge!",
		text = "One of your items has become a sought-after collectible! Collectors are offering CRAZY money for it.",
		question = "What do you do?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 90,
		baseChance = 0.1,
		cooldown = 3,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Items")
		end,
		
		choices = {
			{
				index = 1,
				text = "Sell it now!",
				effects = { Happiness = 10 },
				feedText = "You sold it...",
				onResolve = function(state)
					local profit = RANDOM:NextInteger(10000, 50000)
					state.Money = (state.Money or 0) + profit
					if state.Assets and state.Assets.Items and #state.Assets.Items > 0 then
						table.remove(state.Assets.Items, 1)
					end
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ’° SOLD for $%d! Great return on investment!", profit))
					end
				end,
			},
			{
				index = 2,
				text = "Hold onto it - might go higher",
				effects = { Smarts = 3 },
				setFlags = { collector = true },
				feedText = "You're holding out for more. Risky but could pay off.",
			},
		},
	},
	{
		id = "show_off_luxury",
		emoji = "âœ¨",
		title = "Showing Off",
		text = "Friends are coming over. They're going to see your new luxury purchases. Time to show off a little!",
		question = "How do you present your success?",
		category = "assets",
		weight = 5,
		minAge = 21,
		maxAge = 70,
		baseChance = 0.55,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true, incarcerated = true, homeless = true },
		-- CRITICAL FIX: Ensure player actually owns something worth showing off
		eligibility = function(state)
			local hasItems = hasAssetType(state, "Items")
			local hasVehicles = hasAssetType(state, "Vehicles")
			local hasProperties = hasAssetType(state, "Properties")
			
			if not (hasItems or hasVehicles or hasProperties) then
				return false, "You don't have anything to show off"
			end
			return true
		end,
		
		choices = {
			{
				index = 1,
				text = "Casually show everything off",
				effects = { Happiness = 8 },
				feedText = "You gave the grand tour...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.6 then
						if state.AddFeed then
							state:AddFeed("ğŸ˜ Friends impressed! You're living the dream!")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸ™„ Some friends seemed jealous. Tension in the air.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Stay humble about it",
				effects = { Happiness = 5, Smarts = 2 },
				feedText = "You downplayed your success. Classy move.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #3: YACHT & BOAT EVENTS
	-- Player owns luxury marine vessels - parties, sailing, repairs
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "yacht_party",
		emoji = "ğŸ›¥ï¸",
		title = "Yacht Party Time!",
		textVariants = {
			"The weather is perfect. Your yacht is docked and ready. Time to throw an epic party!",
			"Perfect sailing weather! You could host an incredible party on your yacht today!",
			"Your yacht captain says conditions are ideal. Party time?",
			"Friends are asking if you're throwing a yacht party this weekend!",
		},
		text = "The weather is perfect. Your yacht is docked and ready. Time to throw an epic party!",
		question = "What kind of party do you throw?",
		category = "assets",
		weight = 6,
		minAge = 25,
		maxAge = 75,
		baseChance = 0.5,
		cooldown = 3,
		blockedByFlags = { in_prison = true, incarcerated = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			for _, v in ipairs(state.Assets.Vehicles) do
				local name = (v.name or ""):lower()
				if name:find("yacht") or name:find("boat") or name:find("cruiser") then
					return true
				end
			end
			return false, "You need a yacht for this event"
		end,
		
		choices = {
			{
				index = 1,
				text = "Exclusive VIP party - only the elite",
				effects = { Happiness = 20 },
				feedText = "You threw an exclusive VIP yacht party!",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(10000, 50000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					state.Flags = state.Flags or {}
					if RANDOM:NextNumber() < 0.4 then
						state.Flags.yacht_famous = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ›¥ï¸ Your VIP yacht party cost $%d but made headlines! LEGENDARY!", cost))
						end
					else
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ›¥ï¸ Epic yacht party! Spent $%d but worth every penny!", cost))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Casual boat day with close friends",
				effects = { Happiness = 15, Health = 5 },
				feedText = "You enjoyed a relaxing day on the water with friends.",
				onResolve = function(state)
					state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(500, 2000))
					if state.AddFeed then
						state:AddFeed("â›µ Perfect day on the water! Good vibes, good friends!")
					end
				end,
			},
			{
				index = 3,
				text = "Solo sunset cruise - peace and quiet",
				effects = { Happiness = 12, Health = 8 },
				feedText = "You enjoyed a peaceful sunset cruise alone.",
			},
		},
	},
	{
		id = "yacht_maintenance",
		emoji = "ğŸ”§",
		title = "Yacht Needs Maintenance",
		textVariants = {
			"Your yacht captain informs you that significant maintenance is overdue.",
			"The marina called - your yacht needs some serious work.",
			"It's time for your yacht's annual maintenance check.",
		},
		text = "Your yacht captain informs you that significant maintenance is overdue.",
		question = "How do you handle it?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 80,
		baseChance = 0.35,
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			for _, v in ipairs(state.Assets.Vehicles) do
				local name = (v.name or ""):lower()
				if name:find("yacht") or name:find("boat") or name:find("cruiser") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Full restoration - make her pristine",
				effects = { Happiness = 5 },
				feedText = "You spared no expense...",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(50000, 150000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ›¥ï¸ Full yacht restoration: $%d. She's like new!", cost))
					end
				end,
			},
			{
				index = 2,
				text = "Just the essentials",
				effects = {},
				feedText = "Basic maintenance done.",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(10000, 30000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ”§ Essential repairs: $%d. Good enough for now.", cost))
					end
				end,
			},
			{
				index = 3,
				text = "Ignore it - she's fine",
				effects = { Happiness = -5 },
				feedText = "You put it off...",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.4 then
						local damageCost = RANDOM:NextInteger(80000, 200000)
						state.Money = math.max(0, (state.Money or 0) - damageCost)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’¥ Engine failure at sea! Emergency repairs: $%d!", damageCost))
						end
					end
				end,
			},
		},
	},
	{
		id = "yacht_charter_offer",
		emoji = "ğŸ’°",
		title = "Charter Your Yacht?",
		text = "A charter company wants to rent your yacht for luxury cruises. Big money opportunity!",
		question = "Do you let strangers use your yacht?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 75,
		baseChance = 0.3,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			for _, v in ipairs(state.Assets.Vehicles) do
				local name = (v.name or ""):lower()
				if name:find("yacht") or name:find("boat") or name:find("cruiser") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Accept the offer - cha-ching!",
				effects = { Happiness = 8 },
				feedText = "You signed the charter agreement...",
				onResolve = function(state)
					local income = RANDOM:NextInteger(50000, 200000)
					if RANDOM:NextNumber() < 0.2 then
						-- Damage!
						local damage = RANDOM:NextInteger(10000, 50000)
						state.Money = (state.Money or 0) + income - damage
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ›¥ï¸ Made $%d from charter but $%d in damages! Still profit.", income, damage))
						end
					else
						state.Money = (state.Money or 0) + income
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’° Yacht charter earned you $%d! Easy money!", income))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Decline - my yacht, my rules",
				effects = { Happiness = 3 },
				feedText = "You kept your yacht private. Smart.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #4: PRIVATE JET EVENTS
	-- Player owns private aircraft - travel, parties, emergencies
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "jet_spontaneous_trip",
		emoji = "âœˆï¸",
		title = "Spontaneous Getaway",
		textVariants = {
			"Your private jet is fueled and ready. Where do you want to go?",
			"The pilot calls - perfect flying weather. Time for a spontaneous trip!",
			"You're feeling adventurous. Your jet awaits!",
			"Life is short. Your private jet can take you anywhere!",
		},
		text = "Your private jet is fueled and ready. Where do you want to go?",
		question = "What spontaneous trip do you take?",
		category = "assets",
		weight = 6,
		minAge = 30,
		maxAge = 75,
		baseChance = 0.55,
		cooldown = 4, -- CRITICAL FIX: Increased from 2 to reduce spam
		blockedByFlags = { in_prison = true, incarcerated = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			for _, v in ipairs(state.Assets.Vehicles) do
				local name = (v.name or ""):lower()
				if name:find("jet") or name:find("private.*plane") or name:find("aircraft") or name:find("gulfstream") or name:find("cessna") then
					return true
				end
			end
			return false, "You need a private jet for this event"
		end,
		
		choices = {
			{
				index = 1,
				text = "Vegas weekend - hit the casinos!",
				effects = { Happiness = 25 },
				feedText = "You flew to Vegas!",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(5000, 20000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if RANDOM:NextNumber() < 0.3 then
						local winnings = RANDOM:NextInteger(10000, 100000)
						state.Money = (state.Money or 0) + winnings
						if state.AddFeed then
							state:AddFeed(string.format("âœˆï¸ Vegas trip: spent $%d but won $%d! What a weekend!", cost, winnings))
						end
					else
						if state.AddFeed then
							state:AddFeed(string.format("âœˆï¸ Vegas was wild! Spent $%d but made memories!", cost))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Beach paradise - need some sun",
				effects = { Happiness = 20, Health = 10 },
				feedText = "You flew to paradise!",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(3000, 15000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if state.AddFeed then
						state:AddFeed(string.format("ğŸï¸ Private island getaway! Spent $%d for pure bliss.", cost))
					end
				end,
			},
			{
				index = 3,
				text = "Romantic surprise for partner",
				effects = { Happiness = 15 },
				feedText = "You planned a romantic surprise...",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(10000, 40000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					state.Flags = state.Flags or {}
					state.Flags.romantic_gesture = true
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ’• Whisked your partner away on your jet! Spent $%d but priceless!", cost))
					end
				end,
			},
			{
				index = 4,
				text = "Stay home - save the fuel",
				effects = { Happiness = 2, Money = 5000 },
				feedText = "You decided to stay grounded. Saved some money.",
			},
		},
	},
	{
		id = "jet_emergency_use",
		emoji = "ğŸš¨",
		title = "Family Emergency!",
		text = "A family member across the country needs you urgently! Your private jet can get you there in hours instead of days.",
		question = "How do you respond?",
		category = "assets",
		weight = 5,
		minAge = 30,
		maxAge = 80,
		baseChance = 0.25,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			for _, v in ipairs(state.Assets.Vehicles) do
				local name = (v.name or ""):lower()
				if name:find("jet") or name:find("private.*plane") or name:find("aircraft") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Fly immediately - family first!",
				effects = { Happiness = 10 },
				feedText = "You dropped everything and flew...",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(5000, 15000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					state.Flags = state.Flags or {}
					state.Flags.family_first = true
					if RANDOM:NextNumber() < 0.7 then
						if state.AddFeed then
							state:AddFeed(string.format("âœˆï¸ Made it just in time! Your jet saved the day. Cost $%d but worth it.", cost))
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", -15) end
						if state.AddFeed then
							state:AddFeed("âœˆï¸ You arrived... but it was already too late. At least you tried.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Book a commercial flight instead",
				effects = { Happiness = -5 },
				feedText = "You decided to save the jet fuel...",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.3 then
						if state.ModifyStat then state:ModifyStat("Happiness", -10) end
						if state.AddFeed then
							state:AddFeed("ğŸ˜” Commercial flights were delayed. You arrived too late.")
						end
					else
						if state.AddFeed then
							state:AddFeed("âœˆï¸ Made it on a commercial flight. Everything worked out.")
						end
					end
				end,
			},
		},
	},
	{
		id = "jet_celeb_invite",
		emoji = "ğŸŒŸ",
		title = "Celebrity Wants Your Jet!",
		text = "A famous celebrity wants to charter your private jet for their world tour. They're offering serious money!",
		question = "Do you rent out your jet?",
		category = "assets",
		weight = 4,
		minAge = 30,
		maxAge = 70,
		baseChance = 0.2,
		cooldown = 6,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			for _, v in ipairs(state.Assets.Vehicles) do
				local name = (v.name or ""):lower()
				if name:find("jet") or name:find("private.*plane") or name:find("aircraft") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Rent it out - let's make bank!",
				effects = { Happiness = 15 },
				feedText = "You signed the contract...",
				onResolve = function(state)
					local income = RANDOM:NextInteger(200000, 500000)
					state.Money = (state.Money or 0) + income
					state.Flags = state.Flags or {}
					state.Flags.celeb_connected = true
					if RANDOM:NextNumber() < 0.15 then
						-- Damage
						local damage = RANDOM:NextInteger(50000, 100000)
						state.Money = math.max(0, (state.Money or 0) - damage)
						if state.AddFeed then
							state:AddFeed(string.format("âœˆï¸ Made $%d from celebrity charter but they trashed it! $%d damages!", income, damage))
						end
					else
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’° Celebrity charter: $%d! They even gave you VIP concert tickets!", income))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Decline - it's my jet, not Uber Air",
				effects = { Happiness = 5 },
				feedText = "You kept your jet for yourself. Can't put a price on that.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #5: SUPERCAR & EXOTIC EVENTS
	-- Player owns exotic supercars - track days, attention, repairs
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "supercar_track_day",
		emoji = "ğŸï¸",
		title = "Track Day Invitation",
		textVariants = {
			"There's a supercar track day at the local circuit. Time to unleash your beast!",
			"An exclusive track event for exotic car owners - you're invited!",
			"The racing track is rented out for supercar owners. You're on the list!",
		},
		text = "There's a supercar track day at the local circuit. Time to unleash your beast!",
		question = "Do you hit the track?",
		category = "assets",
		weight = 5,
		minAge = 21,
		maxAge = 60,
		baseChance = 0.45,
		cooldown = 3,
		blockedByFlags = { in_prison = true, incarcerated = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			local vehicle = getBestVehicle(state)
			if not vehicle then return false end
			local name = (vehicle.name or ""):lower()
			local isExotic = name:find("ferrari") or name:find("lambo") or name:find("mclaren") 
				or name:find("porsche") or name:find("bugatti") or name:find("koenigsegg")
				or name:find("pagani") or name:find("aston") or (vehicle.price or 0) >= 150000
			return isExotic, "Need a supercar for track day"
		end,
		
		choices = {
			{
				index = 1,
				text = "Go all out - push the limits!",
				effects = { Happiness = 25 },
				feedText = "You pushed your car to the limit!",
				onResolve = function(state)
					local vehicle = getBestVehicle(state)
					local name = vehicle and vehicle.name or "your supercar"
					local outcome = RANDOM:NextNumber()
					if outcome < 0.5 then
						state.Flags = state.Flags or {}
						state.Flags.track_warrior = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸï¸ Set the fastest lap in %s! Everyone was impressed!", name))
						end
					elseif outcome < 0.85 then
						if state.AddFeed then
							state:AddFeed(string.format("ğŸï¸ Amazing track day! %s handled like a dream!", name))
						end
					else
						local cost = RANDOM:NextInteger(5000, 20000)
						state.Money = math.max(0, (state.Money or 0) - cost)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’¥ Pushed too hard! Minor damage to %s: $%d in repairs.", name, cost))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Take it easy - enjoy the experience",
				effects = { Happiness = 15, Health = 3 },
				feedText = "You enjoyed a relaxed track day.",
				onResolve = function(state)
					if state.AddFeed then
						state:AddFeed("ğŸï¸ Smooth laps, no drama. Perfect day at the track!")
					end
				end,
			},
			{
				index = 3,
				text = "Skip it - track days are risky",
				effects = { Happiness = 2 },
				feedText = "You stayed home. Your car stays pristine.",
			},
		},
	},
	{
		id = "supercar_paparazzi",
		emoji = "ğŸ“¸",
		title = "Paparazzi Frenzy!",
		text = "Your exotic car is attracting paparazzi! They're snapping photos of you everywhere you go!",
		question = "How do you handle the attention?",
		category = "assets",
		weight = 4,
		minAge = 21,
		maxAge = 65,
		baseChance = 0.35,
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Vehicles then return false end
			local vehicle = getBestVehicle(state)
			return vehicle and (vehicle.price or 0) >= 200000
		end,
		
		choices = {
			{
				index = 1,
				text = "Strike a pose - I'm famous!",
				effects = { Happiness = 15, Looks = 3 },
				feedText = "You embraced the fame!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.car_celebrity = true
					if state.AddFeed then
						state:AddFeed("ğŸ“¸ Photos everywhere! You're becoming car-famous!")
					end
				end,
			},
			{
				index = 2,
				text = "Speed away - lose them!",
				effects = { Happiness = 10 },
				feedText = "You escaped the paparazzi...",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.25 then
						local fine = RANDOM:NextInteger(500, 2000)
						state.Money = math.max(0, (state.Money or 0) - fine)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš” Speeding ticket while escaping: $%d. Worth it though!", fine))
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸï¸ Lost them in style! Nobody catches you in YOUR car!")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Cover your face - stay anonymous",
				effects = { Happiness = 3 },
				feedText = "You avoided the spotlight.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #6: DESIGNER & LUXURY ITEM EVENTS  
	-- Events for owning designer bags, watches, sneakers, gaming PCs
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "designer_bag_compliment",
		emoji = "ğŸ‘œ",
		title = "Bag Gets Noticed!",
		textVariants = {
			"Someone on the street stops to compliment your designer bag!",
			"A fashionista asks where you got your amazing bag!",
			"Your designer bag is turning heads everywhere you go!",
		},
		text = "Someone on the street stops to compliment your designer bag!",
		question = "How do you respond?",
		category = "assets",
		weight = 4,
		minAge = 18,
		maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Items then return false end
			for _, item in ipairs(state.Assets.Items) do
				local name = (item.name or ""):lower()
				if name:find("bag") or name:find("purse") or name:find("birkin") or name:find("louis") or name:find("gucci") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Tell them all about it!",
				effects = { Happiness = 10, Looks = 2 },
				feedText = "You shared your fashion knowledge!",
				onResolve = function(state)
					if RANDOM:NextNumber() < 0.3 then
						state.Flags = state.Flags or {}
						state.Flags.fashion_icon = true
						if state.AddFeed then
							state:AddFeed("ğŸ‘œ They asked for your Instagram! You're a fashion influencer now!")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸ‘œ They loved hearing about your collection! Fashion friends!")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Just smile and say thanks",
				effects = { Happiness = 5 },
				feedText = "You graciously accepted the compliment.",
			},
		},
	},
	{
		id = "sneaker_resale",
		emoji = "ğŸ‘Ÿ",
		title = "Sneaker Resale Opportunity!",
		text = "A collector is offering SERIOUS money for your rare sneakers. They're desperate to complete their collection!",
		question = "Do you sell your kicks?",
		category = "assets",
		weight = 4,
		minAge = 16,
		maxAge = 50,
		baseChance = 0.3,
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Items then return false end
			for _, item in ipairs(state.Assets.Items) do
				local name = (item.name or ""):lower()
				if name:find("sneaker") or name:find("jordan") or name:find("yeezy") or name:find("dunk") or name:find("air max") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Sell them - take the profit!",
				effects = { Happiness = 8 },
				feedText = "You sold your rare sneakers...",
				onResolve = function(state)
					local profit = RANDOM:NextInteger(2000, 15000)
					state.Money = (state.Money or 0) + profit
					-- Remove sneakers from inventory
					if state.Assets and state.Assets.Items then
						for i, item in ipairs(state.Assets.Items) do
							local name = (item.name or ""):lower()
							if name:find("sneaker") or name:find("jordan") or name:find("yeezy") then
								table.remove(state.Assets.Items, i)
								break
							end
						end
					end
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ‘Ÿ Sold your rare kicks for $%d! Profit!", profit))
					end
				end,
			},
			{
				index = 2,
				text = "Never - these are grails!",
				effects = { Happiness = 5 },
				feedText = "You kept your precious sneakers. Some things money can't buy.",
			},
		},
	},
	{
		id = "gaming_pc_upgrade",
		emoji = "ğŸ–¥ï¸",
		title = "Time to Upgrade Your Rig!",
		textVariants = {
			"New GPUs just dropped. Your gaming PC is feeling outdated...",
			"There's a new generation of gaming hardware. Upgrade time?",
			"Your gaming PC could use some new parts!",
		},
		text = "New GPUs just dropped. Your gaming PC is feeling outdated...",
		question = "Do you upgrade?",
		category = "assets",
		weight = 4,
		minAge = 14,
		maxAge = 45,
		baseChance = 0.45,
		cooldown = 3,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Items then return false end
			for _, item in ipairs(state.Assets.Items) do
				local name = (item.name or ""):lower()
				if name:find("gaming") or name:find("pc") or name:find("computer") or name:find("setup") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Full upgrade - go all out!",
				effects = { Happiness = 20 },
				feedText = "You upgraded everything!",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(3000, 8000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					state.Flags = state.Flags or {}
					state.Flags.elite_gamer = true
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ–¥ï¸ BEAST MODE! Spent $%d on the ultimate gaming rig!", cost))
					end
				end,
			},
			{
				index = 2,
				text = "Just the GPU - biggest bang for buck",
				effects = { Happiness = 12 },
				feedText = "You upgraded your graphics card.",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(800, 2000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ–¥ï¸ New GPU installed! $%d well spent. Smooth 4K gaming!", cost))
					end
				end,
			},
			{
				index = 3,
				text = "Wait for prices to drop",
				effects = { Happiness = 2, Smarts = 3 },
				feedText = "You'll wait for a better deal. Smart.",
			},
		},
	},
	{
		id = "luxury_watch_flex",
		emoji = "âŒš",
		title = "Watch Gets Recognized!",
		text = "A fellow watch enthusiast notices your timepiece and wants to talk horology!",
		question = "Do you geek out?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 70,
		baseChance = 0.4,
		cooldown = 3,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Items then return false end
			for _, item in ipairs(state.Assets.Items) do
				local name = (item.name or ""):lower()
				if name:find("watch") or name:find("rolex") or name:find("patek") or name:find("omega") or name:find("audemars") then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Talk watches for hours!",
				effects = { Happiness = 12 },
				feedText = "You bonded over horology!",
				onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.watch_collector = true
					if RANDOM:NextNumber() < 0.3 then
						if state.AddFeed then
							state:AddFeed("âŒš Made a new friend! They invited you to an exclusive watch collectors' event!")
						end
					else
						if state.AddFeed then
							state:AddFeed("âŒš Great conversation! Watch enthusiasts understand each other.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Brief chat and move on",
				effects = { Happiness = 5 },
				feedText = "Nice brief exchange between collectors.",
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #ASSET-7: MORE VARIETY EVENTS
	-- User complaint: "ASSET EVENTS BARELY WAS UPDATED IT HASNT BEEN TOUCHED INA WHILE"
	-- Adding more diverse asset interaction events
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	
	{
		id = "car_road_trip",
		emoji = "ğŸ›£ï¸",
		title = "Epic Road Trip",
		text = "Perfect weather for a road trip! Your car is itching to hit the open road. Where to?",
		question = "What kind of road trip?",
		category = "assets",
		weight = 6,
		minAge = 18,
		maxAge = 65,
		baseChance = 0.45,
		cooldown = 3,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Vehicles")
		end,
		
		choices = {
			{
				index = 1,
				text = "Cross-country adventure!",
				effects = { Happiness = 25, Health = 5 },
				feedText = "You set out on an epic journey!",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(1000, 4000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					local roll = RANDOM:NextNumber()
					if roll < 0.6 then
						state.Flags = state.Flags or {}
						state.Flags.road_warrior = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ›£ï¸ INCREDIBLE journey! Spent $%d but made memories for a lifetime!", cost))
						end
					elseif roll < 0.85 then
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ›£ï¸ Great road trip! Minor car trouble but nothing major. Spent $%d.", cost))
						end
					else
						local repair = RANDOM:NextInteger(500, 2000)
						state.Money = math.max(0, (state.Money or 0) - repair)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ›£ï¸ Car broke down mid-trip! $%d in repairs. Still worth it.", repair))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Scenic mountain drive",
				effects = { Happiness = 18, Health = 8 },
				feedText = "You drove through breathtaking scenery.",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(100, 500)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if state.AddFeed then
						state:AddFeed("ğŸ”ï¸ Stunning views! Perfect day for a mountain drive.")
					end
				end,
			},
			{
				index = 3,
				text = "Coastal cruise",
				effects = { Happiness = 15, Health = 5 },
				feedText = "You cruised along the coast.",
				onResolve = function(state)
					if state.AddFeed then
						state:AddFeed("ğŸŒŠ Ocean breeze, beautiful sunsets. Perfect coastal drive!")
					end
				end,
			},
		},
	},
	
	{
		id = "property_value_tank",
		emoji = "ğŸ“‰",
		title = "Property Value Crash!",
		text = "Bad news! The area around your property has deteriorated. Crime is up, businesses are closing, and property values are TANKING.",
		question = "What do you do?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 80,
		baseChance = 0.25,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "Sell now - cut losses!",
				effects = { Happiness = -15 },
				feedText = "You sold at a loss...",
				onResolve = function(state)
					local loss = RANDOM:NextInteger(20000, 100000)
					state.Money = (state.Money or 0) + RANDOM:NextInteger(50000, 150000)
					if state.Assets and state.Assets.Properties and #state.Assets.Properties > 0 then
						table.remove(state.Assets.Properties, 1)
					end
					if state.AddFeed then
						state:AddFeed(string.format("ğŸ“‰ Sold the property at a $%d loss. Better than losing more.", loss))
					end
				end,
			},
			{
				index = 2,
				text = "Hold and wait it out",
				effects = { Happiness = -8 },
				feedText = "You're riding out the downturn...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.4 then
						if state.AddFeed then
							state:AddFeed("ğŸ“‰ Smart call! The neighborhood eventually recovered. Patience paid off!")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸ“‰ Still waiting for the turnaround. Hope it comes soon...")
						end
					end
				end,
			},
		{
			index = 3,
			text = "Invest in improvements ($30K)",
			effects = { Money = -30000, Happiness = 5 },
			feedText = "You're trying to improve the area yourself!",
			eligibility = function(state) return (state.Money or 0) >= 30000, "ğŸ’¸ Need $30K for improvements" end,
			onResolve = function(state)
					state.Flags = state.Flags or {}
					state.Flags.community_investor = true
					if RANDOM:NextNumber() < 0.5 then
						if state.AddFeed then
							state:AddFeed("ğŸ“ˆ Your investment started a revitalization trend! Property value recovering!")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸ“‰ Nice try but one person can't fix everything. At least you tried.")
						end
					end
				end,
			},
		},
	},
	
	{
		id = "valet_disaster",
		emoji = "ğŸš—",
		title = "Valet Nightmare!",
		text = "You let a valet park your expensive car and when it comes back... there's a HUGE scratch on the side!",
		question = "How do you handle this?",
		category = "assets",
		weight = 5,
		minAge = 21,
		maxAge = 70,
		baseChance = 0.25,
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not hasAssetType(state, "Vehicles") then return false end
			local vehicle = getBestVehicle(state)
			return vehicle and (vehicle.price or 0) >= 50000
		end,
		
		choices = {
			{
				index = 1,
				text = "Demand they pay for repairs!",
				effects = { Happiness = -5 },
				feedText = "You confronted the valet company...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.6 then
						if state.AddFeed then
							state:AddFeed("ğŸš— Valet company covered the repairs! Justice served!")
						end
					else
						local cost = RANDOM:NextInteger(2000, 8000)
						state.Money = math.max(0, (state.Money or 0) - cost)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸš— They denied everything! Had to pay $%d for repairs yourself.", cost))
						end
					end
				end,
			},
			{
				index = 2,
				text = "Sue them! ($5,000 lawyer fees)",
				effects = { Happiness = -8, Money = -5000 },
				feedText = "You're taking legal action...",
				-- CRITICAL FIX #12: Add eligibility check!
				eligibility = function(state) return (state.Money or 0) >= 5000, "ğŸ’¸ Need $5,000 for lawyer fees" end,
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.5 then
						local settlement = RANDOM:NextInteger(15000, 50000)
						state.Money = (state.Money or 0) + settlement
						if state.AddFeed then
							state:AddFeed(string.format("âš–ï¸ Won the lawsuit! $%d settlement! Worth the hassle.", settlement))
						end
					else
						if state.AddFeed then
							state:AddFeed("âš–ï¸ Lost the case. Expensive lesson about valet parking.")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Just get it fixed and move on",
				effects = { Happiness = -10, Smarts = 2 },
				feedText = "You took the high road.",
				onResolve = function(state)
					local cost = RANDOM:NextInteger(1500, 5000)
					state.Money = math.max(0, (state.Money or 0) - cost)
					if state.AddFeed then
						state:AddFeed(string.format("ğŸš— Paid $%d for repairs. Never using that valet again.", cost))
					end
				end,
			},
		},
	},
	
	{
		id = "home_security_breach",
		emoji = "ğŸš¨",
		title = "Security Alert!",
		text = "Your home security system detected motion at 3 AM! The cameras show someone in your backyard!",
		question = "What do you do?",
		category = "assets",
		weight = 5,
		minAge = 21,
		maxAge = 80,
		baseChance = 0.3,
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Properties")
		end,
		
		choices = {
			{
				index = 1,
				text = "Call the police immediately",
				effects = { Happiness = -5 },
				feedText = "You dialed 911...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.5 then
						if state.AddFeed then
							state:AddFeed("ğŸš” Police arrived quickly. It was just a deer. False alarm!")
						end
					elseif roll < 0.8 then
						if state.AddFeed then
							state:AddFeed("ğŸš” Police caught a prowler! They were casing houses. Good call!")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸš” Police took too long. Whoever it was is gone. Installing better security.")
						end
						state.Money = math.max(0, (state.Money or 0) - RANDOM:NextInteger(500, 2000))
					end
				end,
			},
			{
				index = 2,
				text = "Confront them yourself",
				effects = { Happiness = 5 },
				feedText = "You grabbed a flashlight and went outside...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.4 then
						if state.AddFeed then
							state:AddFeed("ğŸ¦ Just raccoons in your trash! Crisis averted. Heart still racing.")
						end
					elseif roll < 0.7 then
						if state.AddFeed then
							state:AddFeed("ğŸ‘¤ They ran when they saw you! Cowards. Security upgraded after this.")
						end
						state.Flags = state.Flags or {}
						state.Flags.home_security = true
					else
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-15, -5))
						end
						if state.AddFeed then
							state:AddFeed("ğŸ‘Š Confrontation went badly! Got hurt defending your home!")
						end
					end
				end,
			},
			{
				index = 3,
				text = "Watch from inside and record",
				effects = { Happiness = -3, Smarts = 3 },
				feedText = "You stayed safe and documented everything.",
				onResolve = function(state)
					if state.AddFeed then
						state:AddFeed("ğŸ“¹ Got clear footage. Gave it to police. Smart and safe approach.")
					end
				end,
			},
		},
	},
	
	{
		id = "luxury_investment_offer",
		emoji = "ğŸ’",
		title = "Art Investment Opportunity",
		text = "An art dealer offers you a 'once in a lifetime' investment opportunity. A painting that could triple in value!",
		question = "Do you invest?",
		category = "assets",
		weight = 4,
		minAge = 30,
		maxAge = 80,
		baseChance = 0.3,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return (state.Money or 0) >= 50000
		end,
		
	choices = {
		{
			index = 1,
			text = "Invest big ($50,000)",
			effects = { Happiness = 5 },
			feedText = "You bought the artwork...",
			-- CRITICAL FIX: Add per-choice eligibility check
			eligibility = function(state) return (state.Money or 0) >= 50000, "ğŸ’¸ Need $50,000 to invest in art" end,
			onResolve = function(state)
				-- CRITICAL FIX: Prevent negative money
				state.Money = math.max(0, (state.Money or 0) - 50000)
				local roll = RANDOM:NextNumber()
					if roll < 0.25 then
						local profit = RANDOM:NextInteger(100000, 250000)
						state.Money = (state.Money or 0) + profit
						state.Flags = state.Flags or {}
						state.Flags.art_collector = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ’ JACKPOT! The painting sold for $%d! Art investment genius!", profit))
						end
					elseif roll < 0.5 then
						state.Money = (state.Money or 0) + 60000
						if state.AddFeed then
							state:AddFeed("ğŸ’ Made a small profit! The painting appreciated nicely.")
						end
					elseif roll < 0.75 then
						state.Money = (state.Money or 0) + 30000
						if state.AddFeed then
							state:AddFeed("ğŸ’ Lost money on the art. It didn't appreciate as promised.")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸ’ IT WAS A FAKE! Lost the entire investment! Scammed!")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Pass - too risky",
				effects = { Happiness = 2, Smarts = 3 },
				feedText = "You declined the opportunity.",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.3 then
						if state.AddFeed then
							state:AddFeed("ğŸ’ Heard later it was a scam! Dodged a bullet!")
						end
					else
						if state.AddFeed then
							state:AddFeed("ğŸ’ The art actually did appreciate. FOMO hitting hard.")
						end
					end
				end,
			},
		},
	},
	
	{
		id = "car_celebrity_encounter",
		emoji = "ğŸŒŸ",
		title = "Celebrity Wants Your Car!",
		text = "A famous celebrity saw your car and LOVES it! They want to buy it from you on the spot!",
		question = "Do you sell?",
		category = "assets",
		weight = 4,
		minAge = 21,
		maxAge = 65,
		baseChance = 0.2,
		cooldown = 6,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not hasAssetType(state, "Vehicles") then return false end
			local vehicle = getBestVehicle(state)
			return vehicle and (vehicle.price or 0) >= 75000
		end,
		
		choices = {
			{
				index = 1,
				text = "Sell it - that's big money!",
				effects = { Happiness = 15 },
				feedText = "You sold your car to a celebrity!",
				onResolve = function(state)
					local vehicle = getBestVehicle(state)
					local value = vehicle and (vehicle.price or 100000) or 100000
					local premium = RANDOM:NextInteger(20000, 100000)
					state.Money = (state.Money or 0) + value + premium
					if state.Assets and state.Assets.Vehicles then
						for i, v in ipairs(state.Assets.Vehicles) do
							if v == vehicle then
								table.remove(state.Assets.Vehicles, i)
								break
							end
						end
					end
					state.Flags = state.Flags or {}
					state.Flags.sold_to_celeb = true
					if state.AddFeed then
						state:AddFeed(string.format("ğŸŒŸ Sold your car for $%d ABOVE market value! Now it's famous!", premium))
					end
				end,
			},
			{
				index = 2,
				text = "No deal - this is MY car",
				effects = { Happiness = 10 },
				feedText = "You turned down a celebrity!",
				onResolve = function(state)
					if state.AddFeed then
						state:AddFeed("ğŸŒŸ Kept your car. Some things aren't for sale, even to celebrities!")
					end
				end,
			},
		},
	},
	
	{
		id = "mansion_movie_set",
		emoji = "ğŸ¬",
		title = "Hollywood Wants Your House!",
		text = "A movie production company wants to use your property as a filming location! They'll pay handsomely.",
		question = "Do you let them film?",
		category = "assets",
		weight = 4,
		minAge = 25,
		maxAge = 75,
		baseChance = 0.2,
		cooldown = 6,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			if not state.Assets or not state.Assets.Properties then return false end
			for _, prop in ipairs(state.Assets.Properties) do
				if (prop.price or prop.value or 0) >= 500000 then
					return true
				end
			end
			return false
		end,
		
		choices = {
			{
				index = 1,
				text = "Let them film - easy money!",
				effects = { Happiness = 15 },
				feedText = "Your home became a movie set!",
				onResolve = function(state)
					local payment = RANDOM:NextInteger(20000, 100000)
					state.Money = (state.Money or 0) + payment
					local roll = RANDOM:NextNumber()
					if roll < 0.7 then
						state.Flags = state.Flags or {}
						state.Flags.movie_mansion = true
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ¬ Earned $%d! Met movie stars! Your house is famous now!", payment))
						end
					else
						local damage = RANDOM:NextInteger(5000, 20000)
						state.Money = math.max(0, (state.Money or 0) - damage)
						if state.AddFeed then
							state:AddFeed(string.format("ğŸ¬ Got paid $%d but they caused $%d in damages! Still profit though.", payment, damage))
						end
					end
				end,
			},
			{
				index = 2,
				text = "No way - this is my private home",
				effects = { Happiness = 3 },
				feedText = "You value your privacy.",
			},
		},
	},
	
	{
		id = "vehicle_recall",
		emoji = "âš ï¸",
		title = "Vehicle Recall Notice!",
		text = "Your car manufacturer issued a recall for your vehicle! There's a safety defect that needs to be fixed.",
		question = "How do you handle this?",
		category = "assets",
		weight = 5,
		minAge = 18,
		maxAge = 80,
		baseChance = 0.3,
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			return hasAssetType(state, "Vehicles")
		end,
		
		choices = {
			{
				index = 1,
				text = "Get it fixed immediately - safety first!",
				effects = { Happiness = 3, Smarts = 3 },
				feedText = "You took your car in for the recall fix.",
				onResolve = function(state)
					if state.AddFeed then
						state:AddFeed("âš ï¸ Recall fix complete! Free of charge. Your car is safe now.")
					end
				end,
			},
			{
				index = 2,
				text = "Wait - it's probably nothing serious",
				effects = { Happiness = 2 },
				feedText = "You put it off...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
					if roll < 0.85 then
						if state.AddFeed then
							state:AddFeed("âš ï¸ Got around to it eventually. No problems in the meantime.")
						end
					else
						if state.ModifyStat then
							state:ModifyStat("Health", RANDOM:NextInteger(-20, -5))
						end
						local repair = RANDOM:NextInteger(1000, 5000)
						state.Money = math.max(0, (state.Money or 0) - repair)
						if state.AddFeed then
							state:AddFeed(string.format("âš ï¸ The defect caused an incident! You got hurt and it cost $%d!", repair))
						end
					end
				end,
			},
		},
	},
	
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	-- CRITICAL FIX #982: SNEAKER/SHOE EVENTS - Make shoes actually matter!
	-- These ONLY trigger if player owns sneakers (stylish or sneakerhead flag)
	-- One-time celebration already handled in handleAssetPurchase
	-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
	{
		id = "sneaker_compliment",
		emoji = "ğŸ‘Ÿ",
		title = "Nice Kicks!",
		text = "Someone stops you to compliment your sneakers!",
		question = "How do you respond?",
		category = "assets",
		weight = 6,
		minAge = 10,
		maxAge = 50,
		baseChance = 0.25,  -- Common for sneaker owners
		cooldown = 4,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			local flags = state.Flags or {}
			-- Only trigger if player has sneakers
			if not (flags.stylish or flags.sneakerhead or flags.got_fresh_kicks) then
				return false, "No sneakers"
			end
			return true
		end,
		oneTime = true, -- Only show once per playthrough!
		
		choices = {
			{
				index = 1,
				text = "Thanks! Just got them!",
				effects = { Happiness = 8, Looks = 2 },
				feedText = "ğŸ‘Ÿ You flex your new kicks proudly! They're impressed!",
			},
			{
				index = 2,
				text = "You know good style when you see it!",
				effects = { Happiness = 6 },
				feedText = "ğŸ‘Ÿ They laugh and you have a brief chat about sneaker culture.",
			},
			{
				index = 3,
				text = "Awkwardly say thanks and walk away",
				effects = { Happiness = 3 },
				feedText = "ğŸ‘Ÿ Compliments are nice but socializing is hard sometimes.",
			},
		},
	},
	
	{
		id = "gaming_pc_stream",
		emoji = "ğŸ®",
		title = "Stream Setup Ready!",
		text = "Your gaming PC is powerful enough to stream! People keep asking if you stream games.",
		question = "Do you try streaming?",
		category = "assets",
		weight = 5,
		minAge = 13,
		maxAge = 45,
		baseChance = 0.30,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			local flags = state.Flags or {}
			if not (flags.gamer or flags.has_computer or flags.gaming_setup) then
				return false, "No gaming PC"
			end
			return true
		end,
		oneTime = true,
		
		choices = {
			{
				index = 1,
				text = "Start streaming! Let's go viral!",
				effects = {},
				feedText = "You set up streaming software...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
				if roll < 0.2 then
					state.Fame = math.min(100, (state.Fame or 0) + 5) -- CRITICAL FIX: Cap fame at 100
					state.Money = (state.Money or 0) + RANDOM:NextInteger(100, 500)
						state.Flags = state.Flags or {}
						state.Flags.streamer = true
						state.Flags.content_creator = true
						if state.AddFeed then
							state:AddFeed("ğŸ® Your stream blew up! You've got followers! People love watching you play!")
						end
					elseif roll < 0.6 then
						state.Flags = state.Flags or {}
						state.Flags.streamer = true
						if state.ModifyStat then state:ModifyStat("Happiness", 8) end
						if state.AddFeed then
							state:AddFeed("ğŸ® Got a few viewers! Streaming is fun! Building a small community.")
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", 2) end
						if state.AddFeed then
							state:AddFeed("ğŸ® Streamed to nobody for 3 hours. But it was still kinda fun!")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Nah, just want to game for fun",
				effects = { Happiness = 5 },
				feedText = "ğŸ® Gaming is better without an audience. Just vibing.",
			},
		},
	},
	
	{
		id = "piano_discovered",
		emoji = "ğŸ¹",
		title = "Hidden Musical Talent!",
		text = "You've been practicing piano. Someone overheard you playing!",
		question = "What happens next?",
		category = "assets",
		weight = 5,
		minAge = 18,
		maxAge = 75,
		baseChance = 0.30,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			local flags = state.Flags or {}
			if not (flags.piano_owner or flags.musician or flags.plays_instrument) then
				return false, "No piano"
			end
			return true
		end,
		oneTime = true,
		
		choices = {
			{
				index = 1,
				text = "Perform for them! Show off!",
				effects = {},
				feedText = "You play your heart out...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
				if roll < 0.4 then
					state.Fame = math.min(100, (state.Fame or 0) + 3) -- CRITICAL FIX: Cap fame at 100
					state.Flags = state.Flags or {}
						state.Flags.talented_pianist = true
						if state.ModifyStat then state:ModifyStat("Happiness", 15) end
						if state.AddFeed then
							state:AddFeed("ğŸ¹ They were AMAZED! Word spread about your piano skills!")
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", 8) end
						if state.AddFeed then
							state:AddFeed("ğŸ¹ They enjoyed it! Music brings people together.")
						end
					end
				end,
			},
			{
				index = 2,
				text = "Stop playing - I'm shy about it",
				effects = { Happiness = 2 },
				feedText = "ğŸ¹ You stopped playing. But they said you sounded great anyway!",
			},
		},
	},
	
	{
		id = "jewelry_attention",
		emoji = "ğŸ’",
		title = "Your Bling Gets Noticed!",
		text = "Your jewelry is catching eyes everywhere you go!",
		question = "How do you feel about the attention?",
		category = "assets",
		weight = 5,
		minAge = 16,
		maxAge = 80,
		baseChance = 0.25,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			local flags = state.Flags or {}
			if not (flags.bling_owner or flags.jewelry_owner or flags.diamond_owner or flags.watch_collector) then
				return false, "No jewelry"
			end
			return true
		end,
		oneTime = true,
		
		choices = {
			{
				index = 1,
				text = "Love it! I dressed to impress!",
				effects = { Happiness = 10, Looks = 3 },
				feedText = "ğŸ’ You feel like a million bucks! The attention is validating!",
			},
			{
				index = 2,
				text = "A bit uncomfortable honestly",
				effects = { Happiness = 3 },
				feedText = "ğŸ’ Nice things, but you're not about the attention.",
			},
			{
				index = 3,
				text = "Starting to worry about theft...",
				effects = { Happiness = -3, Smarts = 3 },
				feedText = "ğŸ’ Maybe showing off expensive jewelry isn't the smartest...",
				setFlags = { paranoid_about_theft = true },
			},
		},
	},
	
	{
		id = "designer_bag_flex",
		emoji = "ğŸ‘œ",
		title = "Fashion Statement!",
		text = "Your designer bag is turning heads! A fashion blogger wants a photo!",
		question = "Do you pose with your bag?",
		category = "assets",
		weight = 5,
		minAge = 16,
		maxAge = 60,
		baseChance = 0.25,
		cooldown = 5,
		blockedByFlags = { in_prison = true },
		eligibility = function(state)
			local flags = state.Flags or {}
			if not (flags.fashionista or flags.designer_clothes) then
				return false, "No designer bag"
			end
			return true
		end,
		oneTime = true,
		
		choices = {
			{
				index = 1,
				text = "Yes! Work it!",
				effects = {},
				feedText = "ğŸ“¸ You pose like a pro...",
				onResolve = function(state)
					local roll = RANDOM:NextNumber()
				if roll < 0.3 then
					state.Fame = math.min(100, (state.Fame or 0) + 5) -- CRITICAL FIX: Cap fame at 100
					if state.ModifyStat then state:ModifyStat("Happiness", 12) end
						if state.AddFeed then
							state:AddFeed("ğŸ‘œ The photo went viral! You're a fashion icon now! People asking where you shop!")
						end
					else
						if state.ModifyStat then state:ModifyStat("Happiness", 8) end
						if state.AddFeed then
							state:AddFeed("ğŸ‘œ Got featured on a fashion blog! Looking fabulous!")
						end
					end
				end,
			},
			{
				index = 2,
				text = "No thanks, I'm private",
				effects = { Happiness = 3 },
				feedText = "ğŸ‘œ They understood. Your style speaks for itself anyway.",
			},
		},
	},
}

return events
