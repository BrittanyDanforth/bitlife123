-- ProgressScreen.lua
-- Premium BitLife-style Progress & Awards screen
-- Triple AAA polished UI for tracking awards, past lives, leaderboards, and giving up

local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local UI = require(ReplicatedStorage:WaitForChild("UIComponents"))
local C = UI.Colors or {}
local F = UI.Fonts or {}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FONT SAFETY
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local DEFAULT_FONT = Enum.Font.SourceSans

F = {}
local function tryFont(...)
	local fonts = {...}
	for _, fontName in ipairs(fonts) do
		local success, font = pcall(function()
			return Enum.Font[fontName]
		end)
		if success and font then
			return font
		end
	end
	return DEFAULT_FONT
end

F.Title  = tryFont("GothamBold", "GothamBlack", "SourceSansBold", "SourceSans")
F.Body   = tryFont("Gotham", "GothamMedium", "SourceSans")
F.Medium = tryFont("GothamMedium", "Gotham", "SourceSans")
F.Button = tryFont("GothamBold", "GothamSemibold", "SourceSansBold", "SourceSans")
F.Bold   = tryFont("GothamBold", "GothamBlack", "SourceSansBold", "SourceSans")

for key, value in pairs(F) do
	if not value or type(value) ~= "userdata" then
		F[key] = DEFAULT_FONT
	end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- COLOR SAFETY
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
C.Amber      = C.Amber      or Color3.fromRGB(245, 158, 11)
C.AmberDark  = C.AmberDark  or Color3.fromRGB(217, 119, 6)
C.AmberPale  = C.AmberPale  or Color3.fromRGB(254, 243, 199)
C.Gold       = C.Gold       or Color3.fromRGB(251, 191, 36)
C.Green      = C.Green      or Color3.fromRGB(34, 197, 94)
C.GreenDark  = C.GreenDark  or Color3.fromRGB(22, 163, 74)
C.GreenPale  = C.GreenPale  or Color3.fromRGB(220, 252, 231)
C.Blue       = C.Blue       or Color3.fromRGB(59, 130, 246)
C.BlueDark   = C.BlueDark   or Color3.fromRGB(29, 78, 216)
C.BluePale   = C.BluePale   or Color3.fromRGB(219, 234, 254)
C.Red        = C.Red        or Color3.fromRGB(239, 68, 68)
C.RedDark    = C.RedDark    or Color3.fromRGB(185, 28, 28)
C.RedPale    = C.RedPale    or Color3.fromRGB(254, 226, 226)
C.Purple     = C.Purple     or Color3.fromRGB(139, 92, 246)
C.PurpleDark = C.PurpleDark or Color3.fromRGB(109, 40, 217)
C.PurplePale = C.PurplePale or Color3.fromRGB(237, 233, 254)
C.White      = C.White      or Color3.fromRGB(255, 255, 255)
C.Black      = C.Black      or Color3.fromRGB(0, 0, 0)
C.Gray50     = C.Gray50     or Color3.fromRGB(249, 250, 251)
C.Gray100    = C.Gray100    or Color3.fromRGB(243, 244, 246)
C.Gray200    = C.Gray200    or Color3.fromRGB(229, 231, 235)
C.Gray300    = C.Gray300    or Color3.fromRGB(209, 213, 219)
C.Gray400    = C.Gray400    or Color3.fromRGB(156, 163, 175)
C.Gray500    = C.Gray500    or Color3.fromRGB(107, 114, 128)
C.Gray600    = C.Gray600    or Color3.fromRGB(75, 85, 99)
C.Gray700    = C.Gray700    or Color3.fromRGB(55, 65, 81)
C.Gray800    = C.Gray800    or Color3.fromRGB(31, 41, 55)
C.Gray900    = C.Gray900    or Color3.fromRGB(17, 24, 39)
C.Bg         = C.Bg         or Color3.fromRGB(246, 248, 252)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MOBILE RESPONSIVE SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

local IS_MOBILE = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
local IS_TABLET = IS_MOBILE and (Camera.ViewportSize.X >= 768 or Camera.ViewportSize.Y >= 768)
local IS_SMALL_PHONE = IS_MOBILE and not IS_TABLET and (Camera.ViewportSize.X < 400 or Camera.ViewportSize.Y < 700)
local IS_TINY_PHONE = IS_MOBILE and not IS_TABLET and (Camera.ViewportSize.X <= 380 or Camera.ViewportSize.Y <= 680)
local ViewportSize = Camera.ViewportSize

local function getScale()
	local minDim = math.min(ViewportSize.X, ViewportSize.Y)
	if minDim < 350 then return 0.55 end
	if minDim < 380 then return 0.65 end
	if minDim < 400 then return 0.72 end
	if minDim < 500 then return 0.85 end
	if minDim < 768 then return 0.95 end
	return 1.0
end

local function px(baseValue) return math.floor(baseValue * getScale()) end
local function textSize(baseSize) 
	local minSize = IS_TINY_PHONE and 10 or (IS_SMALL_PHONE and 11 or 12)
	return math.max(minSize, math.floor(baseSize * getScale())) 
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DEBUG LOGGING
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local DEBUG = false
local function log(...)
	if DEBUG then print("[ProgressScreen]", ...) end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MONEY FORMATTING
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function formatMoney(amount)
	if not amount then return "$0" end
	amount = math.floor(amount)
	if amount >= 1000000000 then
		return string.format("$%.1fB", amount / 1000000000)
	elseif amount >= 1000000 then
		return string.format("$%.1fM", amount / 1000000)
	elseif amount >= 1000 then
		return string.format("$%.1fK", amount / 1000)
	else
		return "$" .. tostring(amount)
	end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PROGRESS SCREEN MODULE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local ProgressScreen = {}
ProgressScreen.__index = ProgressScreen

-- Tab definitions - BIGGER BUTTONS
local TABS = {
	{ id = "awards", name = "Awards", icon = "ğŸ†", color = C.Amber },
	{ id = "pastlives", name = "Past Lives", icon = "ğŸ“œ", color = C.Blue },
	{ id = "leaderboards", name = "Ranks", icon = "ğŸ…", color = C.Green },
	{ id = "giveup", name = "Give Up", icon = "â˜ ï¸", color = C.Red },
}

-- Award definitions
local AWARDS = {
	{ id = "first_life", icon = "ğŸ‘¶", name = "First Life", desc = "Start your first life", check = function(state) return true end },
	{ id = "centenarian", icon = "ğŸ’¯", name = "Centenarian", desc = "Live to 100 years old", check = function(state) return state and (state.Age or 0) >= 100 end },
	{ id = "millionaire", icon = "ğŸ’°", name = "Millionaire", desc = "Have $1,000,000+", check = function(state) return state and (state.Money or 0) >= 1000000 end },
	{ id = "billionaire", icon = "ğŸ¤‘", name = "Billionaire", desc = "Have $1,000,000,000+", check = function(state) return state and (state.Money or 0) >= 1000000000 end },
	{ id = "perfect_stats", icon = "â­", name = "Perfect Life", desc = "Max all stats (100)", check = function(state) 
		if not state then return false end
		return (state.Happiness or 0) >= 100 and (state.Health or 0) >= 100 and (state.Smarts or 0) >= 100 and (state.Looks or 0) >= 100
	end },
	{ id = "famous", icon = "ğŸŒŸ", name = "Famous", desc = "Reach 100 Fame", check = function(state) return state and (state.Fame or 0) >= 100 end },
	{ id = "married", icon = "ğŸ’’", name = "Married", desc = "Get married", check = function(state) return state and state.Flags and state.Flags.married end },
	{ id = "royalty", icon = "ğŸ‘‘", name = "Royal Blood", desc = "Become royalty", check = function(state) return state and state.Flags and (state.Flags.is_royalty or state.Flags.royal_birth) end },
	{ id = "mafia_boss", icon = "ğŸ”«", name = "Crime Boss", desc = "Become a mafia boss", check = function(state) return state and state.MobState and state.MobState.rank == "Boss" end },
	{ id = "athlete", icon = "ğŸ…", name = "Pro Athlete", desc = "Become a professional athlete", check = function(state) return state and state.Flags and state.Flags.signed_athlete end },
	{ id = "actor", icon = "ğŸ¬", name = "Movie Star", desc = "Win an Oscar", check = function(state) return state and state.Flags and state.Flags.oscar_winner end },
	{ id = "musician", icon = "ğŸµ", name = "Music Legend", desc = "Win a Grammy", check = function(state) return state and state.Flags and state.Flags.grammy_winner end },
}

print("[ProgressScreen] About to define .new function")

function ProgressScreen.new(screenGui, blurOverlay, showBlurFunc, hideBlurFunc, playerState)
	print("[ProgressScreen] .new function called")
	log("=== CREATING ProgressScreen ===")
	local self = setmetatable({}, ProgressScreen)
	self.screenGui = screenGui
	self.playerState = playerState or {}
	self.showBlur = showBlurFunc
	self.hideBlur = hideBlurFunc
	self.isVisible = false
	self.currentTab = "awards"
	self.pastLivesCards = {}
	
	-- Get remotes
	self.remotes = {}
	local remotesFolder = ReplicatedStorage:FindFirstChild("LifeRemotes")
	if remotesFolder then
		self.remotes.GiveUp = remotesFolder:FindFirstChild("GiveUp")
		self.remotes.GetLeaderboards = remotesFolder:FindFirstChild("GetLeaderboards")
	end
	
	self:createUI()
	log("ProgressScreen created successfully")
	return self
end

function ProgressScreen:getState()
	return self.playerState or {}
end

function ProgressScreen:updateState(newState)
	self.playerState = newState or self.playerState
	-- Refresh current tab when state updates
	if self.isVisible then
		self:switchTab(self.currentTab)
	end
end

function ProgressScreen:createUI()
	log("Creating UI...")
	
	-- Main overlay
	self.overlay = Instance.new("Frame")
	self.overlay.Name = "ProgressScreenOverlay"
	self.overlay.Size = UDim2.fromScale(1, 1)
	self.overlay.BackgroundColor3 = C.Bg
	self.overlay.Visible = false
	self.overlay.ZIndex = 80
	self.overlay.Parent = self.screenGui
	
	-- Header
	self:createHeader()
	
	-- Tab bar with BIGGER buttons
	self:createTabBar()
	
	-- Content container
	self:createContentContainer()
	
	-- Build all tab content
	self:buildAwardsTab()
	self:buildPastLivesTab()
	self:buildLeaderboardsTab()
	self:buildGiveUpTab()
	
	log("UI created")
end

function ProgressScreen:createHeader()
	local headerHeight = IS_TINY_PHONE and 50 or (IS_SMALL_PHONE and 56 or px(65))
	
	self.header = Instance.new("Frame")
	self.header.Name = "Header"
	self.header.Size = UDim2.new(1, 0, 0, headerHeight)
	self.header.BackgroundColor3 = C.Amber
	self.header.ZIndex = 81
	self.header.Parent = self.overlay
	
	local headerGrad = Instance.new("UIGradient")
	headerGrad.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, C.Amber),
		ColorSequenceKeypoint.new(1, C.AmberDark),
	})
	headerGrad.Rotation = 90
	headerGrad.Parent = self.header
	
	-- Title
	local title = Instance.new("TextLabel")
	title.Size = UDim2.new(1, -100, 1, 0)
	title.Position = UDim2.new(0, 16, 0, 0)
	title.BackgroundTransparency = 1
	title.Font = F.Bold
	title.TextSize = IS_TINY_PHONE and 18 or textSize(22)
	title.TextColor3 = C.White
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Text = "ğŸ† Progress"
	title.ZIndex = 82
	title.Parent = self.header
	
	-- Close button - USE NORMAL X
	local closeBtn = Instance.new("TextButton")
	closeBtn.Size = UDim2.new(0, IS_TINY_PHONE and 36 or 44, 0, IS_TINY_PHONE and 36 or 44)
	closeBtn.Position = UDim2.new(1, IS_TINY_PHONE and -42 or -52, 0.5, 0)
	closeBtn.AnchorPoint = Vector2.new(0, 0.5)
	closeBtn.BackgroundColor3 = C.White
	closeBtn.BackgroundTransparency = 0.15
	closeBtn.Font = F.Bold
	closeBtn.TextSize = IS_TINY_PHONE and 18 or 22
	closeBtn.TextColor3 = C.Amber
	closeBtn.Text = "X"  -- NORMAL X, not special character
	closeBtn.AutoButtonColor = false
	closeBtn.ZIndex = 82
	closeBtn.Parent = self.header
	UI.corner(closeBtn, IS_TINY_PHONE and 18 or 22)
	
	closeBtn.MouseEnter:Connect(function()
		UI.tween(closeBtn, TweenInfo.new(0.1), { BackgroundTransparency = 0 })
	end)
	closeBtn.MouseLeave:Connect(function()
		UI.tween(closeBtn, TweenInfo.new(0.1), { BackgroundTransparency = 0.15 })
	end)
	closeBtn.MouseButton1Click:Connect(function()
		self:hide()
	end)
end

function ProgressScreen:createTabBar()
	local headerHeight = IS_TINY_PHONE and 50 or (IS_SMALL_PHONE and 56 or px(65))
	-- BIGGER TAB BAR
	local tabBarHeight = IS_TINY_PHONE and 56 or 68
	
	self.tabBar = Instance.new("Frame")
	self.tabBar.Name = "TabBar"
	self.tabBar.Size = UDim2.new(1, 0, 0, tabBarHeight)
	self.tabBar.Position = UDim2.new(0, 0, 0, headerHeight)
	self.tabBar.BackgroundColor3 = C.White
	self.tabBar.ZIndex = 81
	self.tabBar.Parent = self.overlay
	
	-- Shadow under tab bar
	local shadow = Instance.new("Frame")
	shadow.Size = UDim2.new(1, 0, 0, 3)
	shadow.Position = UDim2.new(0, 0, 1, 0)
	shadow.BackgroundColor3 = C.Black
	shadow.BackgroundTransparency = 0.92
	shadow.ZIndex = 80
	shadow.Parent = self.tabBar
	
	local tabLayout = Instance.new("UIListLayout")
	tabLayout.FillDirection = Enum.FillDirection.Horizontal
	tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	tabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
	tabLayout.Padding = UDim.new(0, IS_TINY_PHONE and 6 or 10)
	tabLayout.Parent = self.tabBar
	
	local tabPad = Instance.new("UIPadding")
	tabPad.PaddingLeft = UDim.new(0, IS_TINY_PHONE and 8 or 12)
	tabPad.PaddingRight = UDim.new(0, IS_TINY_PHONE and 8 or 12)
	tabPad.Parent = self.tabBar
	
	self.tabButtons = {}
	
	-- BIGGER BUTTONS
	local btnWidth = IS_TINY_PHONE and 75 or 85
	local btnHeight = IS_TINY_PHONE and 44 or 52
	
	for i, tab in ipairs(TABS) do
		local tabBtn = Instance.new("TextButton")
		tabBtn.Name = "Tab_" .. tab.id
		tabBtn.Size = UDim2.new(0, btnWidth, 0, btnHeight)
		tabBtn.BackgroundColor3 = i == 1 and tab.color or C.Gray100
		tabBtn.Font = F.Bold
		tabBtn.TextSize = IS_TINY_PHONE and 11 or 13
		tabBtn.TextColor3 = i == 1 and C.White or C.Gray600
		tabBtn.Text = tab.icon .. "\n" .. tab.name
		tabBtn.TextWrapped = true
		tabBtn.AutoButtonColor = false
		tabBtn.LayoutOrder = i
		tabBtn.ZIndex = 82
		tabBtn.Parent = self.tabBar
		UI.corner(tabBtn, 10)
		
		self.tabButtons[tab.id] = { btn = tabBtn, color = tab.color }
		
		-- Hover effect
		tabBtn.MouseEnter:Connect(function()
			if self.currentTab ~= tab.id then
				UI.tween(tabBtn, TweenInfo.new(0.1), { BackgroundColor3 = C.Gray200 })
			end
		end)
		tabBtn.MouseLeave:Connect(function()
			if self.currentTab ~= tab.id then
				UI.tween(tabBtn, TweenInfo.new(0.1), { BackgroundColor3 = C.Gray100 })
			end
		end)
		
		tabBtn.MouseButton1Click:Connect(function()
			self:switchTab(tab.id)
		end)
	end
end

function ProgressScreen:createContentContainer()
	local headerHeight = IS_TINY_PHONE and 50 or (IS_SMALL_PHONE and 56 or px(65))
	local tabBarHeight = IS_TINY_PHONE and 56 or 68
	local topOffset = headerHeight + tabBarHeight
	
	self.contentContainer = Instance.new("Frame")
	self.contentContainer.Name = "ContentContainer"
	self.contentContainer.Size = UDim2.new(1, 0, 1, -topOffset)
	self.contentContainer.Position = UDim2.new(0, 0, 0, topOffset)
	self.contentContainer.BackgroundColor3 = C.Bg
	self.contentContainer.ZIndex = 80
	self.contentContainer.Parent = self.overlay
	
	self.tabContents = {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AWARDS TAB
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ProgressScreen:buildAwardsTab()
	local container = Instance.new("ScrollingFrame")
	container.Name = "AwardsContent"
	container.Size = UDim2.fromScale(1, 1)
	container.BackgroundTransparency = 1
	container.ScrollBarThickness = 4
	container.ScrollBarImageColor3 = C.Gray400
	container.CanvasSize = UDim2.new(0, 0, 0, #AWARDS * 80 + 30)
	container.Visible = true
	container.ZIndex = 81
	container.Parent = self.contentContainer
	
	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0, 10)
	layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	layout.Parent = container
	
	local pad = Instance.new("UIPadding")
	pad.PaddingTop = UDim.new(0, 12)
	pad.PaddingLeft = UDim.new(0, 12)
	pad.PaddingRight = UDim.new(0, 12)
	pad.PaddingBottom = UDim.new(0, 12)
	pad.Parent = container
	
	self.awardItems = {}
	
	for i, award in ipairs(AWARDS) do
		-- Premium card style
		local card = Instance.new("Frame")
		card.Name = "Award_" .. award.id
		card.Size = UDim2.new(1, -10, 0, 70)
		card.BackgroundColor3 = C.White
		card.LayoutOrder = i
		card.ZIndex = 82
		card.Parent = container
		UI.corner(card, 14)
		
		-- Card shadow
		local cardShadow = Instance.new("Frame")
		cardShadow.Size = UDim2.new(1, 4, 1, 4)
		cardShadow.Position = UDim2.new(0, 2, 0, 2)
		cardShadow.BackgroundColor3 = C.Black
		cardShadow.BackgroundTransparency = 0.94
		cardShadow.ZIndex = 81
		cardShadow.Parent = card
		UI.corner(cardShadow, 16)
		
		-- Icon circle
		local iconCircle = Instance.new("Frame")
		iconCircle.Size = UDim2.new(0, 50, 0, 50)
		iconCircle.Position = UDim2.new(0, 10, 0.5, 0)
		iconCircle.AnchorPoint = Vector2.new(0, 0.5)
		iconCircle.BackgroundColor3 = C.Gray100
		iconCircle.ZIndex = 83
		iconCircle.Parent = card
		UI.corner(iconCircle, 25)
		
		local icon = Instance.new("TextLabel")
		icon.Size = UDim2.fromScale(1, 1)
		icon.BackgroundTransparency = 1
		icon.Font = F.Body
		icon.TextSize = 26
		icon.Text = "ğŸ”’"
		icon.ZIndex = 84
		icon.Parent = iconCircle
		
		-- Name
		local name = Instance.new("TextLabel")
		name.Size = UDim2.new(1, -80, 0, 24)
		name.Position = UDim2.new(0, 68, 0, 12)
		name.BackgroundTransparency = 1
		name.Font = F.Bold
		name.TextSize = 15
		name.TextColor3 = C.Gray500
		name.TextXAlignment = Enum.TextXAlignment.Left
		name.Text = award.name
		name.ZIndex = 83
		name.Parent = card
		
		-- Description
		local desc = Instance.new("TextLabel")
		desc.Size = UDim2.new(1, -80, 0, 22)
		desc.Position = UDim2.new(0, 68, 0, 36)
		desc.BackgroundTransparency = 1
		desc.Font = F.Body
		desc.TextSize = 12
		desc.TextColor3 = C.Gray400
		desc.TextXAlignment = Enum.TextXAlignment.Left
		desc.Text = award.desc
		desc.ZIndex = 83
		desc.Parent = card
		
		-- Status indicator
		local statusBadge = Instance.new("Frame")
		statusBadge.Size = UDim2.new(0, 8, 0, 8)
		statusBadge.Position = UDim2.new(1, -18, 0.5, 0)
		statusBadge.AnchorPoint = Vector2.new(0, 0.5)
		statusBadge.BackgroundColor3 = C.Gray300
		statusBadge.ZIndex = 84
		statusBadge.Parent = card
		UI.corner(statusBadge, 4)
		
		self.awardItems[award.id] = { 
			card = card, 
			iconCircle = iconCircle,
			icon = icon, 
			name = name,
			statusBadge = statusBadge,
			award = award 
		}
	end
	
	self.tabContents["awards"] = container
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PAST LIVES TAB - BEAUTIFUL CARDS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ProgressScreen:buildPastLivesTab()
	local container = Instance.new("Frame")
	container.Name = "PastLivesContent"
	container.Size = UDim2.fromScale(1, 1)
	container.BackgroundTransparency = 1
	container.Visible = false
	container.ZIndex = 81
	container.Parent = self.contentContainer
	
	-- Stats summary card at top
	local statsCard = Instance.new("Frame")
	statsCard.Size = UDim2.new(1, -24, 0, 100)
	statsCard.Position = UDim2.new(0, 12, 0, 12)
	statsCard.BackgroundColor3 = C.BluePale
	statsCard.ZIndex = 82
	statsCard.Parent = container
	UI.corner(statsCard, 14)
	
	-- Stats card gradient
	local statsGrad = Instance.new("UIGradient")
	statsGrad.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(219, 234, 254)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(191, 219, 254)),
	})
	statsGrad.Rotation = 90
	statsGrad.Parent = statsCard
	
	-- Stats title
	local statsTitle = Instance.new("TextLabel")
	statsTitle.Size = UDim2.new(1, 0, 0, 28)
	statsTitle.Position = UDim2.new(0, 0, 0, 6)
	statsTitle.BackgroundTransparency = 1
	statsTitle.Font = F.Bold
	statsTitle.TextSize = 16
	statsTitle.TextColor3 = C.BlueDark
	statsTitle.Text = "ğŸ“Š Lifetime Stats"
	statsTitle.ZIndex = 83
	statsTitle.Parent = statsCard
	
	-- Stats grid
	local statsGrid = Instance.new("Frame")
	statsGrid.Size = UDim2.new(1, -16, 0, 60)
	statsGrid.Position = UDim2.new(0, 8, 0, 34)
	statsGrid.BackgroundTransparency = 1
	statsGrid.ZIndex = 83
	statsGrid.Parent = statsCard
	
	local gridLayout = Instance.new("UIGridLayout")
	gridLayout.CellSize = UDim2.new(0.5, -4, 0.5, -2)
	gridLayout.CellPadding = UDim2.new(0, 4, 0, 2)
	gridLayout.Parent = statsGrid
	
	local function createStatBox(text, order)
		local box = Instance.new("Frame")
		box.BackgroundColor3 = C.White
		box.BackgroundTransparency = 0.3
		box.LayoutOrder = order
		box.ZIndex = 84
		box.Parent = statsGrid
		UI.corner(box, 8)
		
		local lbl = Instance.new("TextLabel")
		lbl.Size = UDim2.fromScale(1, 1)
		lbl.BackgroundTransparency = 1
		lbl.Font = F.Bold
		lbl.TextSize = IS_TINY_PHONE and 11 or 13
		lbl.TextColor3 = C.Blue
		lbl.Text = text
		lbl.ZIndex = 85
		lbl.Parent = box
		return lbl
	end
	
	self.pastLivesStats = {
		totalLives = createStatBox("Lives: 1", 1),
		totalYears = createStatBox("Years: 0", 2),
		longestLife = createStatBox("Longest: 0 yrs", 3),
		richestLife = createStatBox("Richest: $0", 4),
	}
	
	-- Lives scroll list
	self.pastLivesScroll = Instance.new("ScrollingFrame")
	self.pastLivesScroll.Size = UDim2.new(1, -24, 1, -130)
	self.pastLivesScroll.Position = UDim2.new(0, 12, 0, 122)
	self.pastLivesScroll.BackgroundTransparency = 1
	self.pastLivesScroll.ScrollBarThickness = 4
	self.pastLivesScroll.ScrollBarImageColor3 = C.Gray400
	self.pastLivesScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	self.pastLivesScroll.ZIndex = 82
	self.pastLivesScroll.Parent = container
	
	local scrollLayout = Instance.new("UIListLayout")
	scrollLayout.Padding = UDim.new(0, 10)
	scrollLayout.Parent = self.pastLivesScroll
	
	-- Placeholder when no past lives
	self.noLivesLabel = Instance.new("TextLabel")
	self.noLivesLabel.Size = UDim2.new(1, 0, 0, 80)
	self.noLivesLabel.BackgroundTransparency = 1
	self.noLivesLabel.Font = F.Medium
	self.noLivesLabel.TextSize = 14
	self.noLivesLabel.TextColor3 = C.Gray400
	self.noLivesLabel.Text = "ğŸŒ± This is your first life!\nYour past lives will appear here."
	self.noLivesLabel.ZIndex = 83
	self.noLivesLabel.Parent = self.pastLivesScroll
	
	self.tabContents["pastlives"] = container
end

function ProgressScreen:createPastLifeCard(lifeData, index)
	-- Beautiful card for each past life
	local card = Instance.new("Frame")
	card.Name = "PastLife_" .. index
	card.Size = UDim2.new(1, 0, 0, 120)
	card.BackgroundColor3 = C.White
	card.LayoutOrder = index
	card.ZIndex = 83
	card.Parent = self.pastLivesScroll
	UI.corner(card, 14)
	
	-- Card border based on how successful the life was
	local borderColor = C.Gray200
	if (lifeData.netWorth or 0) >= 1000000 then
		borderColor = C.Gold
	elseif (lifeData.age or 0) >= 80 then
		borderColor = C.Green
	end
	
	local border = Instance.new("UIStroke")
	border.Color = borderColor
	border.Thickness = 2
	border.Parent = card
	
	-- Life number badge
	local lifeBadge = Instance.new("Frame")
	lifeBadge.Size = UDim2.new(0, 36, 0, 36)
	lifeBadge.Position = UDim2.new(0, 10, 0, 10)
	lifeBadge.BackgroundColor3 = C.Purple
	lifeBadge.ZIndex = 84
	lifeBadge.Parent = card
	UI.corner(lifeBadge, 18)
	
	local lifeNum = Instance.new("TextLabel")
	lifeNum.Size = UDim2.fromScale(1, 1)
	lifeNum.BackgroundTransparency = 1
	lifeNum.Font = F.Bold
	lifeNum.TextSize = 14
	lifeNum.TextColor3 = C.White
	lifeNum.Text = "#" .. index
	lifeNum.ZIndex = 85
	lifeNum.Parent = lifeBadge
	
	-- Name and lifespan
	local nameLabel = Instance.new("TextLabel")
	nameLabel.Size = UDim2.new(1, -60, 0, 22)
	nameLabel.Position = UDim2.new(0, 54, 0, 8)
	nameLabel.BackgroundTransparency = 1
	nameLabel.Font = F.Bold
	nameLabel.TextSize = 16
	nameLabel.TextColor3 = C.Gray800
	nameLabel.TextXAlignment = Enum.TextXAlignment.Left
	nameLabel.Text = lifeData.name or "Unknown"
	nameLabel.ZIndex = 84
	nameLabel.Parent = card
	
	-- Age/lifespan
	local ageLabel = Instance.new("TextLabel")
	ageLabel.Size = UDim2.new(1, -60, 0, 18)
	ageLabel.Position = UDim2.new(0, 54, 0, 30)
	ageLabel.BackgroundTransparency = 1
	ageLabel.Font = F.Medium
	ageLabel.TextSize = 13
	ageLabel.TextColor3 = C.Gray500
	ageLabel.TextXAlignment = Enum.TextXAlignment.Left
	ageLabel.Text = "Lived " .. (lifeData.age or 0) .. " years"
	ageLabel.ZIndex = 84
	ageLabel.Parent = card
	
	-- Divider line
	local divider = Instance.new("Frame")
	divider.Size = UDim2.new(1, -20, 0, 1)
	divider.Position = UDim2.new(0, 10, 0, 54)
	divider.BackgroundColor3 = C.Gray200
	divider.ZIndex = 84
	divider.Parent = card
	
	-- Stats row
	local statsRow = Instance.new("Frame")
	statsRow.Size = UDim2.new(1, -20, 0, 28)
	statsRow.Position = UDim2.new(0, 10, 0, 60)
	statsRow.BackgroundTransparency = 1
	statsRow.ZIndex = 84
	statsRow.Parent = card
	
	-- Net worth
	local worthLabel = Instance.new("TextLabel")
	worthLabel.Size = UDim2.new(0.5, 0, 1, 0)
	worthLabel.BackgroundTransparency = 1
	worthLabel.Font = F.Bold
	worthLabel.TextSize = 14
	worthLabel.TextColor3 = C.Green
	worthLabel.TextXAlignment = Enum.TextXAlignment.Left
	worthLabel.Text = "ğŸ’° " .. formatMoney(lifeData.netWorth or 0)
	worthLabel.ZIndex = 85
	worthLabel.Parent = statsRow
	
	-- Death cause
	local causeLabel = Instance.new("TextLabel")
	causeLabel.Size = UDim2.new(1, -20, 0, 26)
	causeLabel.Position = UDim2.new(0, 10, 0, 88)
	causeLabel.BackgroundTransparency = 1
	causeLabel.Font = F.Body
	causeLabel.TextSize = 12
	causeLabel.TextColor3 = C.Gray500
	causeLabel.TextXAlignment = Enum.TextXAlignment.Left
	causeLabel.Text = "â˜ ï¸ " .. (lifeData.cause or "Natural causes")
	causeLabel.ZIndex = 84
	causeLabel.Parent = card
	
	-- Achievement badges (if any)
	local achievements = lifeData.achievements or {}
	if #achievements > 0 or (lifeData.netWorth or 0) >= 1000000 or (lifeData.age or 0) >= 100 then
		local badgeRow = Instance.new("Frame")
		badgeRow.Size = UDim2.new(0.5, -10, 0, 28)
		badgeRow.Position = UDim2.new(0.5, 0, 0, 0)
		badgeRow.BackgroundTransparency = 1
		badgeRow.ZIndex = 85
		badgeRow.Parent = statsRow
		
		local badgeLayout = Instance.new("UIListLayout")
		badgeLayout.FillDirection = Enum.FillDirection.Horizontal
		badgeLayout.Padding = UDim.new(0, 4)
		badgeLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
		badgeLayout.Parent = badgeRow
		
		-- Auto-add badges based on life stats
		local badges = {}
		if (lifeData.netWorth or 0) >= 1000000000 then
			table.insert(badges, "ğŸ¤‘")
		elseif (lifeData.netWorth or 0) >= 1000000 then
			table.insert(badges, "ğŸ’°")
		end
		if (lifeData.age or 0) >= 100 then
			table.insert(badges, "ğŸ’¯")
		elseif (lifeData.age or 0) >= 80 then
			table.insert(badges, "ğŸ‘´")
		end
		if lifeData.famous then
			table.insert(badges, "â­")
		end
		if lifeData.married then
			table.insert(badges, "ğŸ’’")
		end
		
		for _, badge in ipairs(badges) do
			local badgeLbl = Instance.new("TextLabel")
			badgeLbl.Size = UDim2.new(0, 22, 0, 22)
			badgeLbl.BackgroundTransparency = 1
			badgeLbl.Font = F.Body
			badgeLbl.TextSize = 16
			badgeLbl.Text = badge
			badgeLbl.ZIndex = 86
			badgeLbl.Parent = badgeRow
		end
	end
	
	return card
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- LEADERBOARDS TAB - REAL DATA
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ProgressScreen:buildLeaderboardsTab()
	local container = Instance.new("Frame")
	container.Name = "LeaderboardsContent"
	container.Size = UDim2.fromScale(1, 1)
	container.BackgroundTransparency = 1
	container.Visible = false
	container.ZIndex = 81
	container.Parent = self.contentContainer
	
	-- Your Stats Card (show current player stats)
	local yourCard = Instance.new("Frame")
	yourCard.Size = UDim2.new(1, -24, 0, 90)
	yourCard.Position = UDim2.new(0, 12, 0, 12)
	yourCard.BackgroundColor3 = C.GreenPale
	yourCard.ZIndex = 82
	yourCard.Parent = container
	UI.corner(yourCard, 14)
	
	local yourGrad = Instance.new("UIGradient")
	yourGrad.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 252, 231)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(187, 247, 208)),
	})
	yourGrad.Rotation = 90
	yourGrad.Parent = yourCard
	
	local yourTitle = Instance.new("TextLabel")
	yourTitle.Size = UDim2.new(1, 0, 0, 26)
	yourTitle.Position = UDim2.new(0, 0, 0, 6)
	yourTitle.BackgroundTransparency = 1
	yourTitle.Font = F.Bold
	yourTitle.TextSize = 15
	yourTitle.TextColor3 = C.GreenDark
	yourTitle.Text = "ğŸ… Your Current Stats"
	yourTitle.ZIndex = 83
	yourTitle.Parent = yourCard
	
	-- Your stats row
	local yourStatsRow = Instance.new("Frame")
	yourStatsRow.Size = UDim2.new(1, -16, 0, 50)
	yourStatsRow.Position = UDim2.new(0, 8, 0, 34)
	yourStatsRow.BackgroundTransparency = 1
	yourStatsRow.ZIndex = 83
	yourStatsRow.Parent = yourCard
	
	local yourLayout = Instance.new("UIListLayout")
	yourLayout.FillDirection = Enum.FillDirection.Horizontal
	yourLayout.Padding = UDim.new(0, 8)
	yourLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	yourLayout.Parent = yourStatsRow
	
	local function createYourStat(icon, label, order)
		local stat = Instance.new("Frame")
		stat.Size = UDim2.new(0, 90, 1, 0)
		stat.BackgroundColor3 = C.White
		stat.BackgroundTransparency = 0.4
		stat.LayoutOrder = order
		stat.ZIndex = 84
		stat.Parent = yourStatsRow
		UI.corner(stat, 8)
		
		local iconLbl = Instance.new("TextLabel")
		iconLbl.Size = UDim2.new(1, 0, 0, 20)
		iconLbl.Position = UDim2.new(0, 0, 0, 4)
		iconLbl.BackgroundTransparency = 1
		iconLbl.Font = F.Body
		iconLbl.TextSize = 16
		iconLbl.Text = icon
		iconLbl.ZIndex = 85
		iconLbl.Parent = stat
		
		local valueLbl = Instance.new("TextLabel")
		valueLbl.Size = UDim2.new(1, 0, 0, 22)
		valueLbl.Position = UDim2.new(0, 0, 0, 24)
		valueLbl.BackgroundTransparency = 1
		valueLbl.Font = F.Bold
		valueLbl.TextSize = 12
		valueLbl.TextColor3 = C.Gray700
		valueLbl.Text = label
		valueLbl.ZIndex = 85
		valueLbl.Parent = stat
		
		return valueLbl
	end
	
	self.yourStats = {
		money = createYourStat("ğŸ’°", "$0", 1),
		age = createYourStat("ğŸ“…", "Age 0", 2),
		fame = createYourStat("â­", "0 Fame", 3),
	}
	
	-- Sub-tabs for leaderboard type
	local subTabBar = Instance.new("Frame")
	subTabBar.Size = UDim2.new(1, -24, 0, 44)
	subTabBar.Position = UDim2.new(0, 12, 0, 112)
	subTabBar.BackgroundTransparency = 1
	subTabBar.ZIndex = 82
	subTabBar.Parent = container
	
	local subTabLayout = Instance.new("UIListLayout")
	subTabLayout.FillDirection = Enum.FillDirection.Horizontal
	subTabLayout.Padding = UDim.new(0, 8)
	subTabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	subTabLayout.Parent = subTabBar
	
	local subTabs = { 
		{ id = "richest", name = "ğŸ’° Richest" },
		{ id = "oldest", name = "ğŸ“… Oldest" },
		{ id = "fame", name = "â­ Fame" }
	}
	self.leaderboardSubTabs = {}
	self.currentLeaderboardTab = "richest"
	
	for i, tab in ipairs(subTabs) do
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(0, IS_TINY_PHONE and 85 or 100, 0, 36)
		btn.BackgroundColor3 = i == 1 and C.Green or C.Gray200
		btn.Font = F.Bold
		btn.TextSize = IS_TINY_PHONE and 12 or 14
		btn.TextColor3 = i == 1 and C.White or C.Gray600
		btn.Text = tab.name
		btn.AutoButtonColor = false
		btn.LayoutOrder = i
		btn.ZIndex = 83
		btn.Parent = subTabBar
		UI.corner(btn, 10)
		
		self.leaderboardSubTabs[tab.id] = btn
		
		btn.MouseButton1Click:Connect(function()
			self:switchLeaderboardTab(tab.id)
		end)
	end
	
	-- Leaderboard scroll
	self.leaderboardScroll = Instance.new("ScrollingFrame")
	self.leaderboardScroll.Size = UDim2.new(1, -24, 1, -170)
	self.leaderboardScroll.Position = UDim2.new(0, 12, 0, 164)
	self.leaderboardScroll.BackgroundTransparency = 1
	self.leaderboardScroll.ScrollBarThickness = 4
	self.leaderboardScroll.ScrollBarImageColor3 = C.Gray400
	self.leaderboardScroll.CanvasSize = UDim2.new(0, 0, 0, 600)
	self.leaderboardScroll.ZIndex = 82
	self.leaderboardScroll.Parent = container
	
	local scrollLayout = Instance.new("UIListLayout")
	scrollLayout.Padding = UDim.new(0, 6)
	scrollLayout.Parent = self.leaderboardScroll
	
	self.tabContents["leaderboards"] = container
end

function ProgressScreen:switchLeaderboardTab(tabId)
	self.currentLeaderboardTab = tabId
	
	-- Update button styles
	for id, btn in pairs(self.leaderboardSubTabs) do
		btn.BackgroundColor3 = id == tabId and C.Green or C.Gray200
		btn.TextColor3 = id == tabId and C.White or C.Gray600
	end
	
	self:refreshLeaderboards()
end

function ProgressScreen:createLeaderboardEntry(rank, name, value, isYou)
	local entry = Instance.new("Frame")
	entry.Size = UDim2.new(1, 0, 0, 52)
	entry.BackgroundColor3 = isYou and C.GreenPale or C.White
	entry.LayoutOrder = rank
	entry.ZIndex = 83
	entry.Parent = self.leaderboardScroll
	UI.corner(entry, 10)
	
	if isYou then
		local stroke = Instance.new("UIStroke")
		stroke.Color = C.Green
		stroke.Thickness = 2
		stroke.Parent = entry
	end
	
	-- Rank
	local rankIcon = rank <= 3 and ({ "ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰" })[rank] or tostring(rank)
	local rankLabel = Instance.new("TextLabel")
	rankLabel.Size = UDim2.new(0, 44, 1, 0)
	rankLabel.BackgroundTransparency = 1
	rankLabel.Font = F.Bold
	rankLabel.TextSize = rank <= 3 and 22 or 16
	rankLabel.TextColor3 = rank <= 3 and C.Amber or C.Gray600
	rankLabel.Text = rankIcon
	rankLabel.ZIndex = 84
	rankLabel.Parent = entry
	
	-- Name
	local nameLabel = Instance.new("TextLabel")
	nameLabel.Size = UDim2.new(0.5, -25, 1, 0)
	nameLabel.Position = UDim2.new(0, 48, 0, 0)
	nameLabel.BackgroundTransparency = 1
	nameLabel.Font = isYou and F.Bold or F.Medium
	nameLabel.TextSize = 14
	nameLabel.TextColor3 = isYou and C.GreenDark or C.Gray800
	nameLabel.TextXAlignment = Enum.TextXAlignment.Left
	nameLabel.Text = isYou and name .. " (You)" or name
	nameLabel.ZIndex = 84
	nameLabel.Parent = entry
	
	-- Value
	local valueLabel = Instance.new("TextLabel")
	valueLabel.Size = UDim2.new(0.4, 0, 1, 0)
	valueLabel.Position = UDim2.new(0.6, 0, 0, 0)
	valueLabel.BackgroundTransparency = 1
	valueLabel.Font = F.Bold
	valueLabel.TextSize = 14
	valueLabel.TextColor3 = C.Green
	valueLabel.TextXAlignment = Enum.TextXAlignment.Right
	valueLabel.Text = value
	valueLabel.ZIndex = 84
	valueLabel.Parent = entry
	
	local valuePad = Instance.new("UIPadding")
	valuePad.PaddingRight = UDim.new(0, 12)
	valuePad.Parent = valueLabel
	
	return entry
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- GIVE UP TAB - WORKING PROPERLY
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ProgressScreen:buildGiveUpTab()
	local container = Instance.new("Frame")
	container.Name = "GiveUpContent"
	container.Size = UDim2.fromScale(1, 1)
	container.BackgroundTransparency = 1
	container.Visible = false
	container.ZIndex = 81
	container.Parent = self.contentContainer
	
	-- Warning card
	local card = Instance.new("Frame")
	card.Size = UDim2.new(1, -40, 0, 320)
	card.AnchorPoint = Vector2.new(0.5, 0.5)
	card.Position = UDim2.fromScale(0.5, 0.45)
	card.BackgroundColor3 = C.White
	card.ZIndex = 82
	card.Parent = container
	UI.corner(card, 20)
	
	-- Red border
	local border = Instance.new("UIStroke")
	border.Color = C.Red
	border.Thickness = 3
	border.Parent = card
	
	-- Card shadow
	local shadow = Instance.new("Frame")
	shadow.Size = UDim2.new(1, 10, 1, 10)
	shadow.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow.Position = UDim2.new(0.5, 3, 0.5, 5)
	shadow.BackgroundColor3 = C.Black
	shadow.BackgroundTransparency = 0.9
	shadow.ZIndex = 81
	shadow.Parent = card
	UI.corner(shadow, 22)
	
	-- Warning icon
	local warnIcon = Instance.new("TextLabel")
	warnIcon.Size = UDim2.new(1, 0, 0, 80)
	warnIcon.Position = UDim2.new(0, 0, 0, 20)
	warnIcon.BackgroundTransparency = 1
	warnIcon.Font = F.Body
	warnIcon.TextSize = 64
	warnIcon.Text = "âš ï¸"
	warnIcon.ZIndex = 83
	warnIcon.Parent = card
	
	-- Warning title
	local warnTitle = Instance.new("TextLabel")
	warnTitle.Size = UDim2.new(1, -20, 0, 34)
	warnTitle.Position = UDim2.new(0, 10, 0, 105)
	warnTitle.BackgroundTransparency = 1
	warnTitle.Font = F.Bold
	warnTitle.TextSize = 24
	warnTitle.TextColor3 = C.Red
	warnTitle.Text = "Give Up On Life?"
	warnTitle.ZIndex = 83
	warnTitle.Parent = card
	
	-- Warning text
	local warnText = Instance.new("TextLabel")
	warnText.Size = UDim2.new(1, -30, 0, 60)
	warnText.Position = UDim2.new(0, 15, 0, 145)
	warnText.BackgroundTransparency = 1
	warnText.Font = F.Body
	warnText.TextSize = 14
	warnText.TextColor3 = C.Gray600
	warnText.TextWrapped = true
	warnText.Text = "Are you sure you want to end this life?\nAll progress will be saved to Past Lives\nand you'll start fresh with a new life."
	warnText.ZIndex = 83
	warnText.Parent = card
	
	-- Give Up button
	local giveUpBtn = Instance.new("TextButton")
	giveUpBtn.Size = UDim2.new(0.8, 0, 0, 54)
	giveUpBtn.AnchorPoint = Vector2.new(0.5, 0)
	giveUpBtn.Position = UDim2.new(0.5, 0, 0, 215)
	giveUpBtn.BackgroundColor3 = C.Red
	giveUpBtn.Font = F.Bold
	giveUpBtn.TextSize = 18
	giveUpBtn.TextColor3 = C.White
	giveUpBtn.Text = "â˜ ï¸ Yes, Give Up"
	giveUpBtn.AutoButtonColor = false
	giveUpBtn.ZIndex = 84
	giveUpBtn.Parent = card
	UI.corner(giveUpBtn, 14)
	
	-- Gradient on button
	local btnGrad = Instance.new("UIGradient")
	btnGrad.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, C.Red),
		ColorSequenceKeypoint.new(1, C.RedDark),
	})
	btnGrad.Rotation = 90
	btnGrad.Parent = giveUpBtn
	
	giveUpBtn.MouseEnter:Connect(function()
		UI.tween(giveUpBtn, TweenInfo.new(0.15), { Size = UDim2.new(0.82, 0, 0, 56) })
	end)
	giveUpBtn.MouseLeave:Connect(function()
		UI.tween(giveUpBtn, TweenInfo.new(0.15), { Size = UDim2.new(0.8, 0, 0, 54) })
	end)
	
	giveUpBtn.MouseButton1Click:Connect(function()
		self:handleGiveUp()
	end)
	
	-- Cancel button
	local cancelBtn = Instance.new("TextButton")
	cancelBtn.Size = UDim2.new(0.6, 0, 0, 40)
	cancelBtn.AnchorPoint = Vector2.new(0.5, 0)
	cancelBtn.Position = UDim2.new(0.5, 0, 0, 275)
	cancelBtn.BackgroundColor3 = C.Gray200
	cancelBtn.Font = F.Medium
	cancelBtn.TextSize = 14
	cancelBtn.TextColor3 = C.Gray600
	cancelBtn.Text = "Cancel"
	cancelBtn.AutoButtonColor = false
	cancelBtn.ZIndex = 84
	cancelBtn.Parent = card
	UI.corner(cancelBtn, 10)
	
	cancelBtn.MouseButton1Click:Connect(function()
		self:hide()
	end)
	
	self.tabContents["giveup"] = container
end

function ProgressScreen:handleGiveUp()
	log("Give Up button clicked")
	
	local state = self:getState()
	
	-- Fire the remote to server
	if self.remotes.GiveUp then
		print("[ProgressScreen] Firing GiveUp remote to server")
		pcall(function()
			self.remotes.GiveUp:FireServer()
		end)
	else
		-- Try to find it again
		local remotesFolder = ReplicatedStorage:FindFirstChild("LifeRemotes")
		if remotesFolder then
			local giveUpRemote = remotesFolder:FindFirstChild("GiveUp")
			if giveUpRemote then
				print("[ProgressScreen] Found GiveUp remote, firing")
				pcall(function()
					giveUpRemote:FireServer()
				end)
			else
				warn("[ProgressScreen] GiveUp remote not found!")
			end
		end
	end
	
	-- Close this screen
	self:hide()
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- TAB SWITCHING & REFRESH
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ProgressScreen:switchTab(tabId)
	log("Switching to tab:", tabId)
	self.currentTab = tabId
	
	-- Update tab button styles
	for id, tabData in pairs(self.tabButtons) do
		local isActive = id == tabId
		UI.tween(tabData.btn, TweenInfo.new(0.15), {
			BackgroundColor3 = isActive and tabData.color or C.Gray100,
			TextColor3 = isActive and C.White or C.Gray600
		})
	end
	
	-- Show/hide content with fade
	for id, content in pairs(self.tabContents) do
		content.Visible = id == tabId
	end
	
	-- Refresh content
	if tabId == "awards" then
		self:refreshAwards()
	elseif tabId == "pastlives" then
		self:refreshPastLives()
	elseif tabId == "leaderboards" then
		self:refreshLeaderboards()
	end
end

function ProgressScreen:refreshAwards()
	local state = self:getState()
	
	for id, itemData in pairs(self.awardItems) do
		local unlocked = itemData.award.check(state)
		
		-- Animate the card
		UI.tween(itemData.card, TweenInfo.new(0.2), {
			BackgroundColor3 = unlocked and C.AmberPale or C.White
		})
		UI.tween(itemData.iconCircle, TweenInfo.new(0.2), {
			BackgroundColor3 = unlocked and C.Amber or C.Gray100
		})
		itemData.icon.Text = unlocked and itemData.award.icon or "ğŸ”’"
		UI.tween(itemData.name, TweenInfo.new(0.2), {
			TextColor3 = unlocked and C.AmberDark or C.Gray500
		})
		UI.tween(itemData.statusBadge, TweenInfo.new(0.2), {
			BackgroundColor3 = unlocked and C.Green or C.Gray300
		})
	end
end

function ProgressScreen:refreshPastLives()
	local state = self:getState()
	
	-- Clear existing past life cards
	for _, card in ipairs(self.pastLivesCards) do
		if card and card.Parent then
			card:Destroy()
		end
	end
	self.pastLivesCards = {}
	
	-- Get past lives from state
	local pastLives = state and state.PastLives or {}
	local currentAge = state and state.Age or 0
	local currentMoney = state and state.Money or 0
	
	-- Calculate stats
	local totalYears = currentAge
	local longest = currentAge
	local richest = currentMoney
	
	for _, life in ipairs(pastLives) do
		totalYears = totalYears + (life.age or 0)
		longest = math.max(longest, life.age or 0)
		richest = math.max(richest, life.netWorth or 0)
	end
	
	-- Update stats display
	self.pastLivesStats.totalLives.Text = "Lives: " .. (#pastLives + 1)
	self.pastLivesStats.totalYears.Text = "Years: " .. totalYears
	self.pastLivesStats.longestLife.Text = "Best: " .. longest .. " yrs"
	self.pastLivesStats.richestLife.Text = "Rich: " .. formatMoney(richest)
	
	-- Show/hide no lives label
	self.noLivesLabel.Visible = #pastLives == 0
	
	-- Create cards for past lives (reverse order - newest first)
	for i = #pastLives, 1, -1 do
		local card = self:createPastLifeCard(pastLives[i], #pastLives - i + 1)
		table.insert(self.pastLivesCards, card)
	end
	
	-- Update canvas size
	self.pastLivesScroll.CanvasSize = UDim2.new(0, 0, 0, math.max(100, #pastLives * 130 + 20))
end

function ProgressScreen:refreshLeaderboards()
	local state = self:getState()
	local playerName = Players.LocalPlayer and Players.LocalPlayer.Name or "You"
	
	-- Update your stats
	if self.yourStats then
		self.yourStats.money.Text = formatMoney(state and state.Money or 0)
		self.yourStats.age.Text = "Age " .. (state and state.Age or 0)
		self.yourStats.fame.Text = (state and state.Fame or 0) .. " Fame"
	end
	
	-- Clear existing entries
	for _, child in ipairs(self.leaderboardScroll:GetChildren()) do
		if child:IsA("Frame") then
			child:Destroy()
		end
	end
	
	-- Get value for current tab
	local yourValue, yourDisplay
	if self.currentLeaderboardTab == "richest" then
		yourValue = state and state.Money or 0
		yourDisplay = formatMoney(yourValue)
	elseif self.currentLeaderboardTab == "oldest" then
		yourValue = state and state.Age or 0
		yourDisplay = yourValue .. " years"
	else
		yourValue = state and state.Fame or 0
		yourDisplay = yourValue .. " Fame"
	end
	
	-- Create leaderboard entries (show your position among simulated data)
	-- In production this would fetch from server
	local yourRank = 1
	local entries = {}
	
	-- Add your entry
	table.insert(entries, { name = playerName, value = yourValue, display = yourDisplay, isYou = true })
	
	-- Sort and determine rank (you're the only real player for now)
	-- Just show your position at rank 1 since there's no server leaderboard yet
	self:createLeaderboardEntry(1, playerName, yourDisplay, true)
	
	-- Show message about leaderboards
	local infoLabel = Instance.new("TextLabel")
	infoLabel.Size = UDim2.new(1, 0, 0, 60)
	infoLabel.BackgroundTransparency = 1
	infoLabel.Font = F.Medium
	infoLabel.TextSize = 13
	infoLabel.TextColor3 = C.Gray400
	infoLabel.TextWrapped = true
	infoLabel.Text = "ğŸŒŸ Keep playing to climb the ranks!\nCompete with friends for the top spots."
	infoLabel.LayoutOrder = 100
	infoLabel.ZIndex = 83
	infoLabel.Parent = self.leaderboardScroll
	
	self.leaderboardScroll.CanvasSize = UDim2.new(0, 0, 0, 150)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SHOW/HIDE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ProgressScreen:show(tabId)
	if self.isVisible then return end
	log("Showing ProgressScreen")
	
	if self.showBlur then
		pcall(self.showBlur)
	end
	
	self.isVisible = true
	self.overlay.Visible = true
	
	-- Animate in
	UI.slideInScreen(self.overlay, "right")
	
	-- Switch to requested tab or default
	self:switchTab(tabId or self.currentTab or "awards")
end

function ProgressScreen:hide()
	if not self.isVisible then return end
	log("Hiding ProgressScreen")
	
	-- Animate out
	UI.slideOutScreen(self.overlay, "right", function()
		self.overlay.Visible = false
		if self.hideBlur then
			pcall(self.hideBlur)
		end
	end)
	
	self.isVisible = false
end

print("[ProgressScreen] Module fully loaded, .new exists:", ProgressScreen.new ~= nil)

return ProgressScreen
